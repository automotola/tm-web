/*! For license information please see LICENSES */
(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{678:function(t,e){var i=i||{REVISION:"ALPHA"};!function(t){"use strict";var e=256,n=512,r=1024,s=new Int32Array([-1,1,4,-1,4,-1,-1,-1,8,-1,-1,-1,-1,-1,-1,-1,8]),a=function(t){return 65280&t},o=function(t){return 255&t},h=function(t){return s[(65280&t)>>8]},c=function(){return function(t,e){this.size=-8&(t+7|0),void 0===e?this.buffer=new ArrayBuffer(this.size):(this.buffer=e,this.size=e.length),this.u8=new Uint8Array(this.buffer),this.i32=new Int32Array(this.buffer),this.f32=new Float32Array(this.buffer),this.f64=new Float64Array(this.buffer)}}(),l=function(){function t(t,i,s,h){this.type=0|a(s),this.channel=0|o(s),this.cols=0|t,this.rows=0|i,void 0===h?this.allocate():(this.buffer=h,this.data=this.type&e?this.buffer.u8:this.type&n?this.buffer.i32:this.type&r?this.buffer.f32:this.buffer.f64)}return t.prototype.allocate=function(){delete this.data,delete this.buffer,this.buffer=new c(this.cols*h(this.type)*this.channel*this.rows),this.data=this.type&e?this.buffer.u8:this.type&n?this.buffer.i32:this.type&r?this.buffer.f32:this.buffer.f64},t.prototype.copy_to=function(t){for(var e=t.data,i=this.data,n=0,r=this.cols*this.rows*this.channel|0;n<r-4;n+=4)e[n]=i[n],e[n+1]=i[n+1],e[n+2]=i[n+2],e[n+3]=i[n+3];for(;n<r;++n)e[n]=i[n]},t.prototype.resize=function(t,e,i){void 0===i&&(i=this.channel),t*h(this.type)*i*e>this.buffer.size?(this.cols=t,this.rows=e,this.channel=i,this.allocate()):(this.cols=t,this.rows=e,this.channel=i)},t}(),u=function(){function t(t){this.levels=0|t,this.data=new Array(t),this.pyrdown=i.imgproc.pyrdown}return t.prototype.allocate=function(t,e,i){for(var n=this.levels;--n>=0;)this.data[n]=new l(t>>n,e>>n,i)},t.prototype.build=function(t,e){void 0===e&&(e=!0);var i=2,n=t,r=this.data[0];if(!e)for(var s=t.cols*t.rows;--s>=0;)r.data[s]=t.data[s];for(r=this.data[1],this.pyrdown(n,r);i<this.levels;++i)n=r,r=this.data[i],this.pyrdown(n,r)},t}(),f=function(){return function(t,e,i,n,r){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===r&&(r=-1),this.x=t,this.y=e,this.score=i,this.level=n,this.angle=r}}();t.U8_t=e,t.S32_t=n,t.F32_t=r,t.S64_t=2048,t.F64_t=4096,t.C1_t=1,t.C2_t=2,t.C3_t=3,t.C4_t=4,t.U8C1_t=1|e,t.U8C3_t=3|e,t.U8C4_t=4|e,t.F32C1_t=1|r,t.F32C2_t=2|r,t.S32C1_t=1|n,t.S32C2_t=2|n,t.EPSILON=1.192092896e-7,t.FLT_MIN=1e-37,t.COLOR_RGBA2GRAY=0,t.COLOR_RGB2GRAY=1,t.COLOR_BGRA2GRAY=2,t.COLOR_BGR2GRAY=3,t.BOX_BLUR_NOSCALE=1,t.SVD_U_T=1,t.SVD_V_T=2,t.get_data_type=a,t.get_channel=o,t.get_data_type_size=h,t.data_t=c,t.matrix_t=l,t.pyramid_t=u,t.keypoint_t=f}(i),function(t){"use strict";var e,n,r,s=(r=function(){function t(t){this.next=null,this.data=new i.data_t(t),this.size=this.data.size,this.buffer=this.data.buffer,this.u8=this.data.u8,this.i32=this.data.i32,this.f32=this.data.f32,this.f64=this.data.f64}return t.prototype.resize=function(t){delete this.data,this.data=new i.data_t(t),this.size=this.data.size,this.buffer=this.data.buffer,this.u8=this.data.u8,this.i32=this.data.i32,this.f32=this.data.f32,this.f64=this.data.f64},t}(),{allocate:function(t,i){e=n=new r(i);for(var s=0;s<t;++s){var a=new r(i);n=n.next=a}},get_buffer:function(t){var i=e;return e=e.next,t>i.size&&i.resize(t),i},put_buffer:function(t){n=n.next=t}});t.cache=s,s.allocate(30,2560)}(i),function(t){"use strict";var e,n=(e=new Int32Array(96),{get_gaussian_kernel:function(t,e,n,r){var s=0,a=0,o=0,h=0,c=0,l=0,u=i.cache.get_buffer(t<<2),f=u.f32;if(1==(1&t)&&t<=7&&e<=0)switch(t>>1){case 0:f[0]=1,l=1;break;case 1:f[0]=.25,f[1]=.5,f[2]=.25,l=1;break;case 2:f[0]=.0625,f[1]=.25,f[2]=.375,f[3]=.25,f[4]=.0625,l=1;break;case 3:f[0]=.03125,f[1]=.109375,f[2]=.21875,f[3]=.28125,f[4]=.21875,f[5]=.109375,f[6]=.03125,l=1}else for(c=-.5/((h=e>0?e:.3*(.5*(t-1)-1)+.8)*h);s<t;++s)a=s-.5*(t-1),o=Math.exp(c*a*a),f[s]=o,l+=o;if(r&i.U8_t)for(l=256/l,s=0;s<t;++s)n[s]=f[s]*l+.5|0;else for(l=1/l,s=0;s<t;++s)n[s]=f[s]*l;i.cache.put_buffer(u)},perspective_4point_transform:function(t,e,i,n,r,s,a,o,h,c,l,u,f,d,p,g,v){var _=e,m=c,y=a,x=_*m*y,b=p,w=_*b,C=m*w,S=l,T=_*S,k=s,O=i,A=d,P=O*A,E=P*k,M=A*k*S,I=A*y,L=A*S,D=m*y,j=b*m,F=b*k,R=S*k,B=1/(I-L-D+j-F+R),N=_*A,z=O*k,V=y*_,U=b*V,W=O*m,X=P*S,G=O*S*k,H=y*b*m,Y=b*O,q=-(C-x+T*k-k*w-P*m+E-M+I*m)*B,K=(x-C-N*y+N*S+E-m*z+F*m-M)*B,Z=_,$=(-S*w+U+W*y-P*y+X-G+F*S-H)*B,J=(V*S-U-Y*m+X-G+Y*k+H-I*S)*B,Q=O,tt=(-T+V+W-z+L-I-j+F)*B,et=(-w+T+P-W+F-R-I+D)*B,it=-((C=(m=u)*(w=(_=n)*(b=v)))-(x=_*m*(y=h))+(T=_*(S=f))*(k=o)-k*w-(P=(O=r)*(A=g))*m+(E=P*k)-(M=A*k*S)+(I=A*y)*m)*(B=1/(I-(L=A*S)-(D=m*y)+(j=b*m)-(F=b*k)+(R=S*k))),nt=(x-C-(N=_*A)*y+N*S+E-m*(z=O*k)+F*m-M)*B,rt=_,st=(-S*w+(U=b*(V=y*_))+(W=O*m)*y-P*y+(X=P*S)-(G=O*S*k)+F*S-(H=y*b*m))*B,at=(V*S-U-(Y=b*O)*m+X-G+Y*k+H-I*S)*B,ot=O,ht=(-T+V+W-z+L-I-j+F)*B,ct=(-w+T+P-W+F-R-I+D)*B,lt=Z*tt;E=Q*tt-$;var ut=-$*et+J*tt,ft=q-lt;z=q*et-(T=K*tt);var dt=(x=q*Q)-(C=Z*$),pt=(y=q*J)-(w=$*K);G=(m=J-et*Q)*(A=1/(y-x*et-w+C*et+T*Q-lt*J));var gt=(R=Z*et-K)*A,vt=(V=-K*Q+Z*J)*A,_t=t.data;_t[0]=it*G+nt*(E*A)-rt*(ut*A),_t[1]=it*gt+nt*(ft*A)-rt*(z*A),_t[2]=-it*vt-nt*(dt*A)+rt*(pt*A),_t[3]=st*G+at*(E*A)-ot*(ut*A),_t[4]=st*gt+at*(ft*A)-ot*(z*A),_t[5]=-st*vt-at*(dt*A)+ot*(pt*A),_t[6]=ht*G+ct*(E*A)-ut*A,_t[7]=ht*gt+ct*(ft*A)-z*A,_t[8]=-ht*vt-ct*(dt*A)+pt*A},qsort:function(t,i,n,r){var s,a,o,h,c=0,l=0,u=0,f=0,d=0,p=0,g=0,v=0,_=0,m=0,y=0,x=0,b=0,w=0,C=0,S=0,T=0,k=0,O=e;if(!(n-i+1<=1))for(O[0]=i,O[1]=n;c>=0;)for(l=O[c<<1],u=O[1+(c<<1)],c--;;){if((d=u-l+1)<=7){for(g=l+1;g<=u;g++)for(v=g;v>l&&r(t[v],t[v-1]);v--)s=t[v],t[v]=t[v-1],t[v-1]=s;break}for(k=0,m=l,x=u,w=l+(d>>1),d>40&&(S=l+(_=d>>3),T=l+(_<<1),a=t[C=l],o=t[S],h=t[T],l=r(a,o)?r(o,h)?S:r(a,h)?T:C:r(h,o)?S:r(a,h)?C:T,S=w,T=w+_,a=t[C=w-_],o=t[S],h=t[T],w=r(a,o)?r(o,h)?S:r(a,h)?T:C:r(h,o)?S:r(a,h)?C:T,S=u-_,T=u,a=t[C=u-(_<<1)],o=t[S],h=t[T],u=r(a,o)?r(o,h)?S:r(a,h)?T:C:r(h,o)?S:r(a,h)?C:T),S=w,T=u,a=t[C=l],o=t[S],h=t[T],(w=r(a,o)?r(o,h)?S:r(a,h)?T:C:r(h,o)?S:r(a,h)?C:T)!=m&&(s=t[w],t[w]=t[m],t[m]=s,w=m),l=y=m+1,u=b=x,a=t[w];;){for(;l<=u&&!r(a,t[l]);)r(t[l],a)||(l>y&&(s=t[y],t[y]=t[l],t[l]=s),k=1,y++),l++;for(;l<=u&&!r(t[u],a);)r(a,t[u])||(u<b&&(s=t[b],t[b]=t[u],t[u]=s),k=1,b--),u--;if(l>u)break;s=t[l],t[l]=t[u],t[u]=s,k=1,l++,u--}if(0==k){for(u=x,g=(l=m)+1;g<=u;g++)for(v=g;v>l&&r(t[v],t[v-1]);v--)s=t[v],t[v]=t[v-1],t[v-1]=s;break}for(p=l-(d=Math.min(y-m,l-y))|0,f=0;f<d;++f,++p)s=t[m+f],t[m+f]=t[p],t[p]=s;for(p=x-(d=Math.min(x-b,b-u))+1|0,f=0;f<d;++f,++p)s=t[l+f],t[l+f]=t[p],t[p]=s;if(p=b-u,(d=l-y)>1)p>1?d>p?(O[++c<<1]=m,O[1+(c<<1)]=m+d-1,l=x-p+1,u=x):(O[++c<<1]=x-p+1,O[1+(c<<1)]=x,l=m,u=m+d-1):(l=m,u=m+d-1);else{if(!(p>1))break;l=x-p+1,u=x}}},median:function(t,e,i){for(var n,r=0,s=0,a=0,o=e+i>>1;;){if(i<=e)return t[o];if(i==e+1)return t[e]>t[i]&&(n=t[e],t[e]=t[i],t[i]=n),t[o];for(t[r=e+i>>1]>t[i]&&(n=t[r],t[r]=t[i],t[i]=n),t[e]>t[i]&&(n=t[e],t[e]=t[i],t[i]=n),t[r]>t[e]&&(n=t[r],t[r]=t[e],t[e]=n),s=e+1,n=t[r],t[r]=t[s],t[s]=n,a=i;;){do{++s}while(t[e]>t[s]);do{--a}while(t[a]>t[e]);if(a<s)break;n=t[s],t[s]=t[a],t[a]=n}n=t[e],t[e]=t[a],t[a]=n,a<=o?e=s:a>=o&&(i=a-1)}return 0}});t.math=n}(i),function(t){"use strict";var e={identity:function(t,e){void 0===e&&(e=1);for(var i=t.data,n=t.rows,r=t.cols,s=r+1|0,a=n*r,o=a;--a>=0;)i[a]=0;for(a=o,o=0;o<a;)i[o]=e,o+=s},transpose:function(t,e){for(var i=0,n=0,r=e.rows,s=e.cols,a=0,o=0,h=0,c=e.data,l=t.data;i<r;o+=1,a+=s,i++)for(h=o,n=0;n<s;h+=r,n++)l[h]=c[a+n]},multiply:function(t,e,i){for(var n=0,r=0,s=0,a=0,o=0,h=0,c=0,l=0,u=e.cols,f=e.rows,d=i.cols,p=e.data,g=i.data,v=t.data,_=0;n<f;a+=u,n++)for(c=0,r=0;r<d;l++,c++,r++){for(h=c,o=a,_=0,s=0;s<u;o++,h+=d,s++)_+=p[o]*g[h];v[l]=_}},multiply_ABt:function(t,e,i){for(var n=0,r=0,s=0,a=0,o=0,h=0,c=0,l=e.cols,u=e.rows,f=i.rows,d=e.data,p=i.data,g=t.data,v=0;n<u;a+=l,n++)for(h=0,r=0;r<f;c++,r++){for(o=a,v=0,s=0;s<l;o++,h++,s++)v+=d[o]*p[h];g[c]=v}},multiply_AtB:function(t,e,i){for(var n=0,r=0,s=0,a=0,o=0,h=0,c=0,l=0,u=e.cols,f=e.rows,d=i.cols,p=e.data,g=i.data,v=t.data,_=0;n<u;a++,n++)for(c=0,r=0;r<d;l++,c++,r++){for(h=c,o=a,_=0,s=0;s<f;o+=u,h+=d,s++)_+=p[o]*g[h];v[l]=_}},multiply_AAt:function(t,e){for(var i=0,n=0,r=0,s=0,a=0,o=0,h=0,c=0,l=0,u=e.cols,f=e.rows,d=e.data,p=t.data,g=0;i<f;s+=f+1,a=o,i++)for(c=s,l=s,h=a,n=i;n<f;c++,l+=f,n++){for(o=a,g=0,r=0;r<u;r++)g+=d[o++]*d[h++];p[c]=g,p[l]=g}},multiply_AtA:function(t,e){for(var i=0,n=0,r=0,s=0,a=0,o=0,h=0,c=0,l=0,u=e.cols,f=e.rows,d=e.data,p=t.data,g=0;i<u;h+=u,i++)for(s=i,c=l=h+i,n=i;n<u;c++,l+=u,n++){for(a=s,o=n,g=0,r=0;r<f;a+=u,o+=u,r++)g+=d[a]*d[o];p[c]=g,p[l]=g}},identity_3x3:function(t,e){void 0===e&&(e=1);var i=t.data;i[0]=i[4]=i[8]=e,i[1]=i[2]=i[3]=0,i[5]=i[6]=i[7]=0},invert_3x3:function(t,e){var i=t.data,n=e.data,r=i[4],s=i[8],a=i[5],o=i[7],h=i[0],c=h*r,l=h*a,u=i[3],f=i[1],d=u*f,p=i[2],g=u*p,v=i[6],_=v*f,m=v*p,y=1/(c*s-l*o-d*s+g*o+_*a-m*r);n[0]=(r*s-a*o)*y,n[1]=-(f*s-p*o)*y,n[2]=-(-f*a+p*r)*y,n[3]=-(u*s-a*v)*y,n[4]=(h*s-m)*y,n[5]=-(l-g)*y,n[6]=-(-u*o+r*v)*y,n[7]=-(h*o-_)*y,n[8]=(c-d)*y},multiply_3x3:function(t,e,i){var n=t.data,r=e.data,s=i.data,a=r[0],o=r[1],h=r[2],c=r[3],l=r[4],u=r[5],f=r[6],d=r[7],p=r[8],g=s[0],v=s[1],_=s[2],m=s[3],y=s[4],x=s[5],b=s[6],w=s[7],C=s[8];n[0]=a*g+o*m+h*b,n[1]=a*v+o*y+h*w,n[2]=a*_+o*x+h*C,n[3]=c*g+l*m+u*b,n[4]=c*v+l*y+u*w,n[5]=c*_+l*x+u*C,n[6]=f*g+d*m+p*b,n[7]=f*v+d*y+p*w,n[8]=f*_+d*x+p*C},mat3x3_determinant:function(t){var e=t.data;return e[0]*e[4]*e[8]-e[0]*e[5]*e[7]-e[3]*e[1]*e[8]+e[3]*e[2]*e[7]+e[6]*e[1]*e[5]-e[6]*e[2]*e[4]},determinant_3x3:function(t,e,i,n,r,s,a,o,h){return t*r*h-t*s*o-n*e*h+n*i*o+a*e*s-a*i*r}};i.matmath=e}(),function(t){"use strict";var e,n,r=(e=function(t,e,i,n){n=t[e],t[e]=t[i],t[i]=n},n=function(t,e){return(t=Math.abs(t))>(e=Math.abs(e))?(e/=t,t*Math.sqrt(1+e*e)):e>0?(t/=e,e*Math.sqrt(1+t*t)):0},{lu_solve:function(t,n){var r,s,a,o,h=0,c=0,l=0,u=1,f=t.cols,d=t.data,p=n.data;for(h=0;h<f;h++){for(l=h,c=h+1;c<f;c++)Math.abs(d[c*f+h])>Math.abs(d[l*f+h])&&(l=c);if(Math.abs(d[l*f+h])<i.EPSILON)return 0;if(l!=h){for(c=h;c<f;c++)e(d,h*f+c,l*f+c,r);e(p,h,l,r),u=-u}for(a=-1/d[h*f+h],c=h+1;c<f;c++){for(s=d[c*f+h]*a,l=h+1;l<f;l++)d[c*f+l]+=s*d[h*f+l];p[c]+=s*p[h]}d[h*f+h]=-a}for(h=f-1;h>=0;h--){for(o=p[h],l=h+1;l<f;l++)o-=d[h*f+l]*p[l];p[h]=o*d[h*f+h]}return 1},cholesky_solve:function(t,e){var i,n,r=0,s=0,a=0,o=0,h=0,c=0,l=0,u=t.cols,f=t.data,d=e.data;for(r=0;r<u;r++)for(n=1,h=o=r*u,s=r;s<u;s++){for(i=f[h+r],a=0;a<r;a++)i-=f[a*u+r]*f[h+a];if(s==r){if(f[h+r]=i,0==i)return 0;n=1/i}else f[o+s]=i,f[h+r]=i*n;h+=u}for(o=0,c=0;c<u;c++){for(i=d[c],l=0;l<c;l++)i-=f[o+l]*d[l];d[c]=i,o+=u}for(o=0,c=0;c<u;c++)d[c]/=f[o+c],o+=u;for(c=u-1;c>=0;c--){for(i=d[c],o=(l=c+1)*u;l<u;l++)i-=f[o+c]*d[l],o+=u;d[c]=i}return 1},svd_decompose:function(t,r,s,a,o){void 0===o&&(o=0);var h=0,c=0,l=t.rows,u=t.cols,f=l,d=u,p=t.type|i.C1_t;f<d&&(h=1,c=f,f=d,d=c);var g=i.cache.get_buffer(f*f<<3),v=i.cache.get_buffer(d<<3),_=i.cache.get_buffer(d*d<<3),m=new i.matrix_t(f,f,p,g.data),y=new i.matrix_t(1,d,p,v.data),x=new i.matrix_t(d,d,p,_.data);if(0==h)i.matmath.transpose(m,t);else{for(c=0;c<u*l;c++)m.data[c]=t.data[c];for(;c<d*f;c++)m.data[c]=0}if(function(t,r,s,a,o,h,c,l){for(var u=2*i.EPSILON,f=i.FLT_MIN,d=0,p=0,g=0,v=0,_=Math.max(h,30),m=0,y=0,x=0,b=0,w=0,C=0,S=0,T=0,k=0,O=0,A=0,P=0,E=0,M=0,I=0,L=0,D=0,j=4660,F=0,R=0,B=0,N=i.cache.get_buffer(c<<3),z=N.f64;d<c;d++){for(g=0,A=0;g<h;g++)A+=(T=t[d*r+g])*T;if(z[d]=A,a){for(g=0;g<c;g++)a[d*o+g]=0;a[d*o+d]=1}}for(;v<_;v++){for(w=0,d=0;d<c-1;d++)for(p=d+1;p<c;p++){for(m=d*r|0,y=p*r|0,I=z[d],L=0,D=z[p],g=2,L+=t[m]*t[y],L+=t[m+1]*t[y+1];g<h;g++)L+=t[m+g]*t[y+g];if(!(Math.abs(L)<=u*Math.sqrt(I*D))){for(E=n(L*=2,P=I-D),P<0?(M=.5*(E-P),C=L/(E*(S=Math.sqrt(M/E))*2)):S=L/(E*(C=Math.sqrt((E+P)/(2*E)))*2),I=0,D=0,g=2,k=C*t[m]+S*t[y],O=-S*t[m]+C*t[y],t[m]=k,t[y]=O,I+=k*k,D+=O*O,k=C*t[m+1]+S*t[y+1],O=-S*t[m+1]+C*t[y+1],t[m+1]=k,t[y+1]=O,I+=k*k,D+=O*O;g<h;g++)k=C*t[m+g]+S*t[y+g],O=-S*t[m+g]+C*t[y+g],t[m+g]=k,t[y+g]=O,I+=k*k,D+=O*O;if(z[d]=I,z[p]=D,w=1,a)for(b=p*o|0,g=2,k=C*a[x=d*o|0]+S*a[b],O=-S*a[x]+C*a[b],a[x]=k,a[b]=O,k=C*a[x+1]+S*a[b+1],O=-S*a[x+1]+C*a[b+1],a[x+1]=k,a[b+1]=O;g<c;g++)k=C*a[x+g]+S*a[b+g],O=-S*a[x+g]+C*a[b+g],a[x+g]=k,a[b+g]=O}}if(0==w)break}for(d=0;d<c;d++){for(g=0,A=0;g<h;g++)A+=(T=t[d*r+g])*T;z[d]=Math.sqrt(A)}for(d=0;d<c-1;d++){for(p=d,g=d+1;g<c;g++)z[p]<z[g]&&(p=g);if(d!=p&&(e(z,d,p,A),a)){for(g=0;g<h;g++)e(t,d*r+g,p*r+g,T);for(g=0;g<c;g++)e(a,d*o+g,p*o+g,T)}}for(d=0;d<c;d++)s[d]=z[d];if(a){for(d=0;d<l;d++){for(A=d<c?z[d]:0;A<=f;){for(R=1/h,g=0;g<h;g++)F=0!=(256&(j=214013*j+2531011)>>16)?R:-R,t[d*r+g]=F;for(v=0;v<2;v++)for(p=0;p<d;p++){for(A=0,g=0;g<h;g++)A+=t[d*r+g]*t[p*r+g];for(B=0,g=0;g<h;g++)T=t[d*r+g]-A*t[p*r+g],t[d*r+g]=T,B+=Math.abs(T);for(B=B?1/B:0,g=0;g<h;g++)t[d*r+g]*=B}for(A=0,g=0;g<h;g++)A+=(T=t[d*r+g])*T;A=Math.sqrt(A)}for(S=1/A,g=0;g<h;g++)t[d*r+g]*=S}i.cache.put_buffer(N)}else i.cache.put_buffer(N)}(m.data,f,y.data,x.data,d,f,d,f),r){for(c=0;c<d;c++)r.data[c]=y.data[c];for(;c<u;c++)r.data[c]=0}if(0==h){if(s&&o&i.SVD_U_T)for(c=f*f;--c>=0;)s.data[c]=m.data[c];else s&&i.matmath.transpose(s,m);if(a&&o&i.SVD_V_T)for(c=d*d;--c>=0;)a.data[c]=x.data[c];else a&&i.matmath.transpose(a,x)}else{if(s&&o&i.SVD_U_T)for(c=d*d;--c>=0;)s.data[c]=x.data[c];else s&&i.matmath.transpose(s,x);if(a&&o&i.SVD_V_T)for(c=f*f;--c>=0;)a.data[c]=m.data[c];else a&&i.matmath.transpose(a,m)}i.cache.put_buffer(g),i.cache.put_buffer(v),i.cache.put_buffer(_)},svd_solve:function(t,e,n){var r,s=0,a=0,o=0,h=0,c=0,l=t.rows,u=t.cols,f=0,d=0,p=t.type|i.C1_t,g=i.cache.get_buffer(l*l<<3),v=i.cache.get_buffer(u<<3),_=i.cache.get_buffer(u*u<<3),m=new i.matrix_t(l,l,p,g.data),y=new i.matrix_t(1,u,p,v.data),x=new i.matrix_t(u,u,p,_.data),b=n.data,w=m.data,C=y.data,S=x.data;for(this.svd_decompose(t,y,m,x,0),r=i.EPSILON*C[0]*u;s<u;s++,c+=u){for(d=0,a=0;a<u;a++)if(C[a]>r){for(o=0,f=0,h=0;o<l;o++,h+=u)f+=w[h+a]*b[o];d+=f*S[c+a]/C[a]}e.data[s]=d}i.cache.put_buffer(g),i.cache.put_buffer(v),i.cache.put_buffer(_)},svd_invert:function(t,e){var n,r=0,s=0,a=0,o=0,h=0,c=0,l=e.rows,u=e.cols,f=0,d=e.type|i.C1_t,p=i.cache.get_buffer(l*l<<3),g=i.cache.get_buffer(u<<3),v=i.cache.get_buffer(u*u<<3),_=new i.matrix_t(l,l,d,p.data),m=new i.matrix_t(1,u,d,g.data),y=new i.matrix_t(u,u,d,v.data),x=t.data,b=_.data,w=m.data,C=y.data;for(this.svd_decompose(e,m,_,y,0),n=i.EPSILON*w[0]*u;r<u;r++,h+=u)for(s=0,o=0;s<l;s++,c++){for(a=0,f=0;a<u;a++,o++)w[a]>n&&(f+=C[h+a]*b[o]/w[a]);x[c]=f}i.cache.put_buffer(p),i.cache.put_buffer(g),i.cache.put_buffer(v)},eigenVV:function(t,r,s){for(var a=t.cols,o=a*a,h=t.type|i.C1_t,c=i.cache.get_buffer(a*a<<3),l=i.cache.get_buffer(a<<3),u=new i.matrix_t(a,a,h,c.data),f=new i.matrix_t(1,a,h,l.data);--o>=0;)u.data[o]=t.data[o];if(function(t,r,s,a,o,h){var c=i.EPSILON,l=0,u=0,f=0,d=0,p=0,g=0,v=0,_=0,m=0,y=h*h*30,x=0,b=0,w=0,C=0,S=0,T=0,k=0,O=0,A=0,P=i.cache.get_buffer(h<<2),E=i.cache.get_buffer(h<<2),M=P.i32,I=E.i32;if(a)for(;l<h;l++){for(f=l*o,u=0;u<h;u++)a[f+u]=0;a[f+l]=1}for(f=0;f<h;f++){if(s[f]=t[(r+1)*f],f<h-1){for(d=f+1,x=Math.abs(t[r*f+d]),l=f+2;l<h;l++)x<(b=Math.abs(t[r*f+l]))&&(x=b,d=l);M[f]=d}if(f>0){for(d=0,x=Math.abs(t[f]),l=1;l<f;l++)x<(b=Math.abs(t[r*l+f]))&&(x=b,d=l);I[f]=d}}if(h>1)for(;m<y;m++){for(f=0,x=Math.abs(t[M[0]]),l=1;l<h-1;l++)x<(b=Math.abs(t[r*l+M[l]]))&&(x=b,f=l);for(p=M[f],l=1;l<h;l++)x<(b=Math.abs(t[r*I[l]+l]))&&(x=b,f=I[l],p=l);if(w=t[r*f+p],Math.abs(w)<=c)break;for(C=.5*(s[p]-s[f]),k=(S=Math.abs(C)+n(w,C))/(T=n(w,S)),T=w/T,S=w/S*w,C<0&&(T=-T,S=-S),t[r*f+p]=0,s[f]-=S,s[p]+=S,l=0;l<f;l++)_=r*l+p,O=t[v=r*l+f],A=t[_],t[v]=O*k-A*T,t[_]=O*T+A*k;for(l=f+1;l<p;l++)_=r*l+p,O=t[v=r*f+l],A=t[_],t[v]=O*k-A*T,t[_]=O*T+A*k;for(v=r*f+(l=p+1),_=r*p+l;l<h;l++,v++,_++)O=t[v],A=t[_],t[v]=O*k-A*T,t[_]=O*T+A*k;if(a)for(v=o*f,_=o*p,l=0;l<h;l++,v++,_++)O=a[v],A=a[_],a[v]=O*k-A*T,a[_]=O*T+A*k;for(u=0;u<2;u++){if((g=0==u?f:p)<h-1){for(d=g+1,x=Math.abs(t[r*g+d]),l=g+2;l<h;l++)x<(b=Math.abs(t[r*g+l]))&&(x=b,d=l);M[g]=d}if(g>0){for(d=0,x=Math.abs(t[g]),l=1;l<g;l++)x<(b=Math.abs(t[r*l+g]))&&(x=b,d=l);I[g]=d}}}for(f=0;f<h-1;f++){for(d=f,l=f+1;l<h;l++)s[d]<s[l]&&(d=l);if(f!=d&&(e(s,d,f,x),a))for(l=0;l<h;l++)e(a,o*d+l,o*f+l,x)}i.cache.put_buffer(P),i.cache.put_buffer(E)}(u.data,a,f.data,r?r.data:null,a,a),s)for(;--a>=0;)s.data[a]=f.data[a];i.cache.put_buffer(c),i.cache.put_buffer(l)}});i.linalg=r}(),function(t){"use strict";var e,n,r,s,a,o,h,c,l,u,f=(e=function(t){return t*t},n=new i.matrix_t(3,3,i.F32_t|i.C1_t),r=new i.matrix_t(3,3,i.F32_t|i.C1_t),s=new i.matrix_t(6,6,i.F32_t|i.C1_t),a=new i.matrix_t(6,1,i.F32_t|i.C1_t),o=function(){function t(){}return t.prototype.run=function(t,e,o,h){var c,l,u=0,f=0,d=o.type|i.C1_t,p=o.data,g=n.data,v=r.data,_=0,m=0;!function(t,e,i,n,r){for(var s,a,o=0,h=0,c=0,l=0,u=0,f=0,d=0,p=0,g=0;o<r;++o)h+=t[o].x,c+=t[o].y,u+=e[o].x,f+=e[o].y;for(h/=r,c/=r,u/=r,f/=r,o=0;o<r;++o)p=t[o].x-h,g=t[o].y-c,l+=Math.sqrt(p*p+g*g),p=e[o].x-u,g=e[o].y-f,d+=Math.sqrt(p*p+g*g);l/=r,d/=r,s=Math.SQRT2/l,a=Math.SQRT2/d,i[0]=i[4]=s,i[2]=-h*s,i[5]=-c*s,i[1]=i[3]=i[6]=i[7]=0,i[8]=1,n[0]=n[4]=a,n[2]=-u*a,n[5]=-f*a,n[1]=n[3]=n[6]=n[7]=0,n[8]=1}(t,e,g,v,h);for(var y=i.cache.get_buffer(2*h*6<<3),x=i.cache.get_buffer(2*h<<3),b=new i.matrix_t(6,2*h,d,y.data),w=new i.matrix_t(1,2*h,d,x.data),C=b.data,S=w.data;u<h;++u)c=t[u],l=e[u],_=g[0]*c.x+g[1]*c.y+g[2],m=g[3]*c.x+g[4]*c.y+g[5],C[f=2*u*6]=_,C[f+1]=m,C[f+2]=1,C[f+3]=0,C[f+4]=0,C[f+5]=0,C[f+=6]=0,C[f+1]=0,C[f+2]=0,C[f+3]=_,C[f+4]=m,C[f+5]=1,S[u<<1]=v[0]*l.x+v[1]*l.y+v[2],S[1+(u<<1)]=v[3]*l.x+v[4]*l.y+v[5];return i.matmath.multiply_AtA(s,b),i.matmath.multiply_AtB(a,b,w),i.linalg.lu_solve(s,a),p[0]=a.data[0],p[1]=a.data[1],p[2]=a.data[2],p[3]=a.data[3],p[4]=a.data[4],p[5]=a.data[5],p[6]=0,p[7]=0,p[8]=1,i.matmath.invert_3x3(r,r),i.matmath.multiply_3x3(o,r,o),i.matmath.multiply_3x3(o,o,n),i.cache.put_buffer(y),i.cache.put_buffer(x),1},t.prototype.error=function(t,i,n,r,s){for(var a,o,h=0,c=n.data;h<s;++h)a=t[h],o=i[h],r[h]=e(o.x-c[0]*a.x-c[1]*a.y-c[2])+e(o.y-c[3]*a.x-c[4]*a.y-c[5])},t.prototype.check_subset=function(t,e,i){return!0},t}(),h=new i.matrix_t(9,9,i.F32_t|i.C1_t),c=new i.matrix_t(9,9,i.F32_t|i.C1_t),{affine2d:o,homography2d:function(){function t(){}return t.prototype.run=function(t,e,s,a){for(var o=0,l=0,u=s.data,f=n.data,d=r.data,p=h.data,g=c.data,v=0,_=0,m=0,y=0,x=0,b=0,w=0,C=0,S=0,T=0,k=0,O=0;o<a;++o)w+=e[o].x,C+=e[o].y,k+=t[o].x,O+=t[o].y;for(w/=a,C/=a,k/=a,O/=a,o=0;o<a;++o)x+=Math.abs(e[o].x-w),b+=Math.abs(e[o].y-C),S+=Math.abs(t[o].x-k),T+=Math.abs(t[o].y-O);if(Math.abs(x)<i.EPSILON||Math.abs(b)<i.EPSILON||Math.abs(S)<i.EPSILON||Math.abs(T)<i.EPSILON)return 0;for(x=a/x,b=a/b,S=a/S,T=a/T,f[0]=S,f[1]=0,f[2]=-k*S,f[3]=0,f[4]=T,f[5]=-O*T,f[6]=0,f[7]=0,f[8]=1,d[0]=1/x,d[1]=0,d[2]=w,d[3]=0,d[4]=1/b,d[5]=C,d[6]=0,d[7]=0,d[8]=1,o=81;--o>=0;)p[o]=0;for(o=0;o<a;++o)v=(e[o].x-w)*x,_=(e[o].y-C)*b,m=(t[o].x-k)*S,y=(t[o].y-O)*T,p[0]+=m*m,p[1]+=m*y,p[2]+=m,p[6]+=m*-v*m,p[7]+=m*-v*y,p[8]+=m*-v,p[10]+=y*y,p[11]+=y,p[15]+=y*-v*m,p[16]+=y*-v*y,p[17]+=y*-v,p[20]+=1,p[24]+=-v*m,p[25]+=-v*y,p[26]+=-v,p[30]+=m*m,p[31]+=m*y,p[32]+=m,p[33]+=m*-_*m,p[34]+=m*-_*y,p[35]+=m*-_,p[40]+=y*y,p[41]+=y,p[42]+=y*-_*m,p[43]+=y*-_*y,p[44]+=y*-_,p[50]+=1,p[51]+=-_*m,p[52]+=-_*y,p[53]+=-_,p[60]+=-v*m*-v*m+-_*m*-_*m,p[61]+=-v*m*-v*y+-_*m*-_*y,p[62]+=-v*m*-v+-_*m*-_,p[70]+=-v*y*-v*y+-_*y*-_*y,p[71]+=-v*y*-v+-_*y*-_,p[80]+=-v*-v+-_*-_;for(o=0;o<9;++o)for(l=0;l<o;++l)p[9*o+l]=p[9*l+o];return i.linalg.eigenVV(h,c),u[0]=g[72],u[1]=g[73],u[2]=g[74],u[3]=g[75],u[4]=g[76],u[5]=g[77],u[6]=g[78],u[7]=g[79],u[8]=g[80],i.matmath.multiply_3x3(s,r,s),i.matmath.multiply_3x3(s,s,n),v=1/u[8],u[0]*=v,u[1]*=v,u[2]*=v,u[3]*=v,u[4]*=v,u[5]*=v,u[6]*=v,u[7]*=v,u[8]=1,1},t.prototype.error=function(t,e,i,n,r){for(var s,a,o=0,h=0,c=0,l=0,u=i.data;o<r;++o)s=t[o],a=e[o],h=1/(u[6]*s.x+u[7]*s.y+1),c=(u[0]*s.x+u[1]*s.y+u[2])*h-a.x,l=(u[3]*s.x+u[4]*s.y+u[5])*h-a.y,n[o]=c*c+l*l},t.prototype.check_subset=function(t,e,n){if(4==n){var r=0,s=t[0],a=t[1],o=t[2],h=t[3],c=e[0],l=e[1],u=e[2],f=e[3],d=s.x,p=s.y,g=a.x,v=a.y,_=o.x,m=o.y,y=c.x,x=c.y,b=l.x,w=l.y,C=u.x,S=u.y,T=i.matmath.determinant_3x3(d,p,1,g,v,1,_,m,1),k=i.matmath.determinant_3x3(y,x,1,b,w,1,C,S,1);if(T*k<0&&r++,d=a.x,p=a.y,g=o.x,v=o.y,_=h.x,m=h.y,y=l.x,x=l.y,b=u.x,w=u.y,C=f.x,S=f.y,(T=i.matmath.determinant_3x3(d,p,1,g,v,1,_,m,1))*(k=i.matmath.determinant_3x3(y,x,1,b,w,1,C,S,1))<0&&r++,d=s.x,p=s.y,g=o.x,v=o.y,_=h.x,m=h.y,y=c.x,x=c.y,b=u.x,w=u.y,C=f.x,S=f.y,(T=i.matmath.determinant_3x3(d,p,1,g,v,1,_,m,1))*(k=i.matmath.determinant_3x3(y,x,1,b,w,1,C,S,1))<0&&r++,d=s.x,p=s.y,g=a.x,v=a.y,_=h.x,m=h.y,y=c.x,x=c.y,b=l.x,w=l.y,C=f.x,S=f.y,(T=i.matmath.determinant_3x3(d,p,1,g,v,1,_,m,1))*(k=i.matmath.determinant_3x3(y,x,1,b,w,1,C,S,1))<0&&r++,0!=r&&4!=r)return!1}return!0},t}()}),d=function(){function t(t,e,i,n){void 0===t&&(t=0),void 0===e&&(e=.5),void 0===i&&(i=.5),void 0===n&&(n=.99),this.size=t,this.thresh=e,this.eps=i,this.prob=n}return t.prototype.update_iters=function(t,e){var i=Math.log(1-this.prob),n=Math.log(1-Math.pow(1-t,this.size));return 0|(n>=0||-i>=e*-n?e:Math.round(i/n))},t}(),p=(l=function(t,e,i,n,r,s,a){for(var o=[],h=0,c=0,l=0,u=0,f=!1;l<1e3;++l){for(h=0;h<n&&l<1e3;){for(f=!1,u=0;!f;)for(f=!0,u=o[h]=0|Math.floor(Math.random()*r),c=0;c<h;++c)if(u==o[c]){f=!1;break}s[h]=e[u],a[h]=i[u],t.check_subset(s,a,h+1)?++h:l++}break}return h==n&&l<1e3},u=function(t,e,i,n,r,s,a,o){var h=0,c=0,l=0,u=s*s;for(t.error(i,n,e,a,r);c<r;++c)l=a[c]<=u,o[c]=l,h+=l;return h},{ransac:function(t,e,n,r,s,a,o,h){if(void 0===h&&(h=1e3),s<t.size)return!1;var c=t.size,f=h,d=0,p=!1,g=[],v=[],_=a.cols,m=a.rows,y=a.type|i.C1_t,x=i.cache.get_buffer(_*m<<3),b=i.cache.get_buffer(s),w=i.cache.get_buffer(s<<2),C=new i.matrix_t(_,m,y,x.data),S=new i.matrix_t(s,1,i.U8C1_t,b.data),T=-1,k=0,O=w.f32;if(s==c){if(e.run(n,r,C,s)<=0)return i.cache.put_buffer(x),i.cache.put_buffer(b),i.cache.put_buffer(w),!1;if(C.copy_to(a),o)for(;--s>=0;)o.data[s]=1;return i.cache.put_buffer(x),i.cache.put_buffer(b),i.cache.put_buffer(w),!0}for(;d<f;++d){if(!l(e,n,r,c,s,g,v)){if(0==d)return i.cache.put_buffer(x),i.cache.put_buffer(b),i.cache.put_buffer(w),!1;break}e.run(g,v,C,c)<=0||(k=u(e,C,n,r,s,t.thresh,O,S.data))>Math.max(T,c-1)&&(C.copy_to(a),T=k,o&&S.copy_to(o),f=t.update_iters((s-k)/s,f),p=!0)}return i.cache.put_buffer(x),i.cache.put_buffer(b),i.cache.put_buffer(w),p},lmeds:function(t,e,n,r,s,a,o,h){if(void 0===h&&(h=1e3),s<t.size)return!1;var c=t.size,f=h,d=0,p=!1,g=[],v=[],_=a.cols,m=a.rows,y=a.type|i.C1_t,x=i.cache.get_buffer(_*m<<3),b=i.cache.get_buffer(s),w=i.cache.get_buffer(s<<2),C=new i.matrix_t(_,m,y,x.data),S=new i.matrix_t(s,1,i.U8_t|i.C1_t,b.data),T=0,k=w.f32,O=1e9,A=0,P=0;if(t.eps=.45,f=t.update_iters(t.eps,f),s==c){if(e.run(n,r,C,s)<=0)return i.cache.put_buffer(x),i.cache.put_buffer(b),i.cache.put_buffer(w),!1;if(C.copy_to(a),o)for(;--s>=0;)o.data[s]=1;return i.cache.put_buffer(x),i.cache.put_buffer(b),i.cache.put_buffer(w),!0}for(;d<f;++d){if(!l(e,n,r,c,s,g,v)){if(0==d)return i.cache.put_buffer(x),i.cache.put_buffer(b),i.cache.put_buffer(w),!1;break}e.run(g,v,C,c)<=0||(e.error(n,r,C,k,s),(P=i.math.median(k,0,s-1))<O&&(O=P,C.copy_to(a),p=!0))}return p&&(A=2.5*1.4826*(1+5/(s-c))*Math.sqrt(O),A=Math.max(A,.001),T=u(e,a,n,r,s,A,k,S.data),o&&S.copy_to(o),p=T>=c),i.cache.put_buffer(x),i.cache.put_buffer(b),i.cache.put_buffer(w),p}});t.ransac_params_t=d,t.motion_model=f,t.motion_estimator=p}(i),function(t){"use strict";var e={grayscale:function(t,e,n,r,s){void 0===s&&(s=i.COLOR_RGBA2GRAY);var a=0,o=0,h=0,c=0,l=0,u=0,f=4899,d=1868,p=4;s!=i.COLOR_BGRA2GRAY&&s!=i.COLOR_BGR2GRAY||(f=1868,d=4899),s!=i.COLOR_RGB2GRAY&&s!=i.COLOR_BGR2GRAY||(p=3);var g=p<<1,v=3*p|0;r.resize(e,n,1);var _=r.data;for(o=0;o<n;++o,c+=e,h+=e*p){for(a=0,l=h,u=c;a<=e-4;a+=4,l+=p<<2,u+=4)_[u]=t[l]*f+9617*t[l+1]+t[l+2]*d+8192>>14,_[u+1]=t[l+p]*f+9617*t[l+p+1]+t[l+p+2]*d+8192>>14,_[u+2]=t[l+g]*f+9617*t[l+g+1]+t[l+g+2]*d+8192>>14,_[u+3]=t[l+v]*f+9617*t[l+v+1]+t[l+v+2]*d+8192>>14;for(;a<e;++a,++u,l+=p)_[u]=t[l]*f+9617*t[l+1]+t[l+2]*d+8192>>14}},resample:function(t,e,n,r){var s=t.rows,a=t.cols;s>r&&a>n&&(e.resize(n,r,t.channel),t.type&i.U8_t&&e.type&i.U8_t&&s*a/(r*n)<256?function(t,e,n,r){for(var s=0,a=t.channel,o=t.cols,h=t.rows,c=t.data,l=e.data,u=o/n,f=h/r,d=u*f*65536|0,p=0,g=0,v=0,_=0,m=0,y=0,x=0,b=0,w=0,C=0,S=0,T=0,k=0,O=0,A=0,P=0,E=i.cache.get_buffer(n*a<<2),M=i.cache.get_buffer(n*a<<2),I=i.cache.get_buffer(2*o*3<<2),L=E.i32,D=M.i32,j=I.i32;p<n;p++){for(m=1+(w=p*u)-1e-6|0,y=0|(C=w+u),m=Math.min(m,o-1),y=Math.min(y,o-1),m>w&&(j[b++]=p*a|0,j[b++]=(m-1)*a|0,j[b++]=256*(m-w)|0,s++),v=m;v<y;v++)s++,j[b++]=p*a|0,j[b++]=v*a|0,j[b++]=256;C-y>.001&&(s++,j[b++]=p*a|0,j[b++]=y*a|0,j[b++]=256*(C-y)|0)}for(p=0;p<n*a;p++)L[p]=D[p]=0;for(g=0,_=0;_<h;_++){for(S=o*_,b=0;b<s;b++)for(k=j[3*b],m=j[3*b+1],O=j[3*b+2],x=0;x<a;x++)L[k+x]+=c[S+m+x]*O;if((g+1)*f<=_+1||_==h-1){if(P=256-(A=256*Math.max(_+1-(g+1)*f,0)|0),T=n*g,A<=0)for(p=0;p<n*a;p++)l[T+p]=Math.min(Math.max((D[p]+256*L[p])/d,0),255),D[p]=L[p]=0;else for(p=0;p<n*a;p++)l[T+p]=Math.min(Math.max((D[p]+L[p]*P)/d,0),255),D[p]=L[p]*A,L[p]=0;g++}else for(p=0;p<n*a;p++)D[p]+=256*L[p],L[p]=0}i.cache.put_buffer(M),i.cache.put_buffer(E),i.cache.put_buffer(I)}(t,e,n,r):function(t,e,n,r){for(var s=0,a=t.channel,o=t.cols,h=t.rows,c=t.data,l=e.data,u=o/n,f=h/r,d=1/(u*f),p=0,g=0,v=0,_=0,m=0,y=0,x=0,b=0,w=0,C=0,S=0,T=0,k=0,O=0,A=0,P=0,E=i.cache.get_buffer(n*a<<2),M=i.cache.get_buffer(n*a<<2),I=i.cache.get_buffer(2*o*3<<2),L=E.f32,D=M.f32,j=I.f32;p<n;p++){for(m=1+(w=p*u)-1e-6|0,y=0|(C=w+u),m=Math.min(m,o-1),y=Math.min(y,o-1),m>w&&(s++,j[b++]=(m-1)*a|0,j[b++]=p*a|0,j[b++]=(m-w)*d),v=m;v<y;v++)s++,j[b++]=v*a|0,j[b++]=p*a|0,j[b++]=d;C-y>.001&&(s++,j[b++]=y*a|0,j[b++]=p*a|0,j[b++]=(C-y)*d)}for(p=0;p<n*a;p++)L[p]=D[p]=0;for(g=0,_=0;_<h;_++){for(S=o*_,b=0;b<s;b++)for(m=0|j[3*b],k=0|j[3*b+1],O=j[3*b+2],x=0;x<a;x++)L[k+x]+=c[S+m+x]*O;if((g+1)*f<=_+1||_==h-1){if(P=1-(A=Math.max(_+1-(g+1)*f,0)),T=n*g,Math.abs(A)<.001)for(p=0;p<n*a;p++)l[T+p]=D[p]+L[p],D[p]=L[p]=0;else for(p=0;p<n*a;p++)l[T+p]=D[p]+L[p]*P,D[p]=L[p]*A,L[p]=0;g++}else for(p=0;p<n*a;p++)D[p]+=L[p],L[p]=0}i.cache.put_buffer(M),i.cache.put_buffer(E),i.cache.put_buffer(I)}(t,e,n,r))},box_blur_gray:function(t,e,n,r){void 0===r&&(r=0);var s=t.cols,a=t.rows,o=a<<1,h=s<<1,c=0,l=0,u=0,f=0,d=1+(n<<1)|0,p=n+1|0,g=p+1|0,v=r&i.BOX_BLUR_NOSCALE?1:1/(d*d),_=i.cache.get_buffer(s*a<<2),m=0,y=0,x=0,b=0,w=0,C=_.i32,S=t.data,T=0;for(e.resize(s,a,t.channel),u=0;u<a;++u){for(y=u,m=p*S[x],c=x+1|0,f=x+n|0;c<=f;++c)m+=S[c];for(b=x+p|0,T=S[w=x],l=0;l<n;++l,y+=a)C[y]=m,m+=S[b]-T,b++;for(;l<s-g;l+=2,y+=o)C[y]=m,m+=S[b]-S[w],C[y+a]=m,m+=S[b+1]-S[w+1],b+=2,w+=2;for(;l<s-p;++l,y+=a)C[y]=m,m+=S[b]-S[w],b++,w++;for(T=S[b-1];l<s;++l,y+=a)C[y]=m,m+=T-S[w],w++;x+=s}if(x=0,S=e.data,1==v)for(u=0;u<s;++u){for(y=u,m=p*C[x],c=x+1|0,f=x+n|0;c<=f;++c)m+=C[c];for(b=x+p,T=C[w=x],l=0;l<n;++l,y+=s)S[y]=m,m+=C[b]-T,b++;for(;l<a-g;l+=2,y+=h)S[y]=m,m+=C[b]-C[w],S[y+s]=m,m+=C[b+1]-C[w+1],b+=2,w+=2;for(;l<a-p;++l,y+=s)S[y]=m,m+=C[b]-C[w],b++,w++;for(T=C[b-1];l<a;++l,y+=s)S[y]=m,m+=T-C[w],w++;x+=a}else for(u=0;u<s;++u){for(y=u,m=p*C[x],c=x+1|0,f=x+n|0;c<=f;++c)m+=C[c];for(b=x+p,T=C[w=x],l=0;l<n;++l,y+=s)S[y]=m*v,m+=C[b]-T,b++;for(;l<a-g;l+=2,y+=h)S[y]=m*v,m+=C[b]-C[w],S[y+s]=m*v,m+=C[b+1]-C[w+1],b+=2,w+=2;for(;l<a-p;++l,y+=s)S[y]=m*v,m+=C[b]-C[w],b++,w++;for(T=C[b-1];l<a;++l,y+=s)S[y]=m*v,m+=T-C[w],w++;x+=a}i.cache.put_buffer(_)},gaussian_blur:function(t,e,n,r){void 0===r&&(r=0),void 0===n&&(n=0);var s=(n=0==n?2*Math.max(1,4*r+1-1e-8)+1|0:n)>>1,a=t.cols,o=t.rows,h=t.type,c=h&i.U8_t;e.resize(a,o,t.channel);var l,u,f=t.data,d=e.data,p=n+Math.max(o,a)|0,g=i.cache.get_buffer(p<<2),v=i.cache.get_buffer(n<<2);c?(l=g.i32,u=v.i32):h&i.S32_t?(l=g.i32,u=v.f32):(l=g.f32,u=v.f32),i.math.get_gaussian_kernel(n,r,u,h),c?function(t,e,i,n,r,s,a,o){for(var h=0,c=0,l=0,u=0,f=0,d=0,p=0,g=0,v=0,_=s[0],m=0,y=n<<1,x=3*n,b=n<<2;h<r;++h){for(d=e[u],c=0;c<o;++c)t[c]=d;for(c=0;c<=n-2;c+=2)t[c+o]=e[u+c],t[c+o+1]=e[u+c+1];for(;c<n;++c)t[c+o]=e[u+c];for(d=e[u+n-1],c=n;c<o+n;++c)t[c+o]=d;for(c=0;c<=n-4;c+=4){for(d=t[c]*_,p=t[c+1]*_,g=t[c+2]*_,v=t[c+3]*_,l=1;l<a;++l)m=s[l],d+=t[l+c]*m,p+=t[l+c+1]*m,g+=t[l+c+2]*m,v+=t[l+c+3]*m;i[f+c]=Math.min(d>>8,255),i[f+c+1]=Math.min(p>>8,255),i[f+c+2]=Math.min(g>>8,255),i[f+c+3]=Math.min(v>>8,255)}for(;c<n;++c){for(d=t[c]*_,l=1;l<a;++l)d+=t[l+c]*s[l];i[f+c]=Math.min(d>>8,255)}u+=n,f+=n}for(h=0;h<n;++h){for(d=i[h],c=0;c<o;++c)t[c]=d;for(l=h,c=0;c<=r-2;c+=2,l+=y)t[c+o]=i[l],t[c+o+1]=i[l+n];for(;c<r;++c,l+=n)t[c+o]=i[l];for(d=i[(r-1)*n+h],c=r;c<o+r;++c)t[c+o]=d;for(f=h,c=0;c<=r-4;c+=4,f+=b){for(d=t[c]*_,p=t[c+1]*_,g=t[c+2]*_,v=t[c+3]*_,l=1;l<a;++l)m=s[l],d+=t[l+c]*m,p+=t[l+c+1]*m,g+=t[l+c+2]*m,v+=t[l+c+3]*m;i[f]=Math.min(d>>8,255),i[f+n]=Math.min(p>>8,255),i[f+y]=Math.min(g>>8,255),i[f+x]=Math.min(v>>8,255)}for(;c<r;++c,f+=n){for(d=t[c]*_,l=1;l<a;++l)d+=t[l+c]*s[l];i[f]=Math.min(d>>8,255)}}}(l,f,d,a,o,u,n,s):function(t,e,i,n,r,s,a,o){for(var h=0,c=0,l=0,u=0,f=0,d=0,p=0,g=0,v=0,_=s[0],m=0,y=n<<1,x=3*n,b=n<<2;h<r;++h){for(d=e[u],c=0;c<o;++c)t[c]=d;for(c=0;c<=n-2;c+=2)t[c+o]=e[u+c],t[c+o+1]=e[u+c+1];for(;c<n;++c)t[c+o]=e[u+c];for(d=e[u+n-1],c=n;c<o+n;++c)t[c+o]=d;for(c=0;c<=n-4;c+=4){for(d=t[c]*_,p=t[c+1]*_,g=t[c+2]*_,v=t[c+3]*_,l=1;l<a;++l)m=s[l],d+=t[l+c]*m,p+=t[l+c+1]*m,g+=t[l+c+2]*m,v+=t[l+c+3]*m;i[f+c]=d,i[f+c+1]=p,i[f+c+2]=g,i[f+c+3]=v}for(;c<n;++c){for(d=t[c]*_,l=1;l<a;++l)d+=t[l+c]*s[l];i[f+c]=d}u+=n,f+=n}for(h=0;h<n;++h){for(d=i[h],c=0;c<o;++c)t[c]=d;for(l=h,c=0;c<=r-2;c+=2,l+=y)t[c+o]=i[l],t[c+o+1]=i[l+n];for(;c<r;++c,l+=n)t[c+o]=i[l];for(d=i[(r-1)*n+h],c=r;c<o+r;++c)t[c+o]=d;for(f=h,c=0;c<=r-4;c+=4,f+=b){for(d=t[c]*_,p=t[c+1]*_,g=t[c+2]*_,v=t[c+3]*_,l=1;l<a;++l)m=s[l],d+=t[l+c]*m,p+=t[l+c+1]*m,g+=t[l+c+2]*m,v+=t[l+c+3]*m;i[f]=d,i[f+n]=p,i[f+y]=g,i[f+x]=v}for(;c<r;++c,f+=n){for(d=t[c]*_,l=1;l<a;++l)d+=t[l+c]*s[l];i[f]=d}}}(l,f,d,a,o,u,n,s),i.cache.put_buffer(g),i.cache.put_buffer(v)},pyrdown:function(t,e,i,n){void 0===i&&(i=0),void 0===n&&(n=0);var r=t.cols,s=r>>1,a=t.rows>>1,o=s-(i<<1),h=a-(n<<1),c=0,l=0,u=i+n*r,f=0,d=0,p=0;e.resize(s,a,t.channel);var g=t.data,v=e.data;for(l=0;l<h;++l){for(f=u,p=d,c=0;c<=o-2;c+=2,p+=2,f+=4)v[p]=g[f]+g[f+1]+g[f+r]+g[f+r+1]+2>>2,v[p+1]=g[f+2]+g[f+3]+g[f+r+2]+g[f+r+3]+2>>2;for(;c<o;++c,++p,f+=2)v[p]=g[f]+g[f+1]+g[f+r]+g[f+r+1]+2>>2;u+=r<<1,d+=s}},scharr_derivatives:function(t,e){var n,r,s,a,o,h,c,l,u=t.cols,f=t.rows,d=u<<1,p=0,g=0,v=0,_=0,m=0,y=0,x=0;e.resize(u,f,2);var b=t.data,w=e.data,C=i.cache.get_buffer(u+2<<2),S=i.cache.get_buffer(u+2<<2);for(t.type&i.U8_t||t.type&i.S32_t?(c=C.i32,l=S.i32):(c=C.f32,l=S.f32);g<f;++g,m+=u){for(_=(g>0?g-1:1)*u|0,y=(g<f-1?g+1:f-2)*u|0,x=g*d|0,p=0,v=1;p<=u-2;p+=2,v+=2)n=b[_+p],r=b[y+p],c[v]=3*(n+r)+10*b[m+p],l[v]=r-n,n=b[_+p+1],r=b[y+p+1],c[v+1]=3*(n+r)+10*b[m+p+1],l[v+1]=r-n;for(;p<u;++p,++v)n=b[_+p],r=b[y+p],c[v]=3*(n+r)+10*b[m+p],l[v]=r-n;for(p=u+1|0,c[0]=c[1],c[p]=c[u],l[0]=l[1],l[p]=l[u],p=0;p<=u-4;p+=4)n=l[p+2],r=l[p+1],s=l[p+3],a=l[p+4],o=c[p+2],h=c[p+3],w[x++]=o-c[p],w[x++]=3*(n+l[p])+10*r,w[x++]=h-c[p+1],w[x++]=3*(s+r)+10*n,w[x++]=c[p+4]-o,w[x++]=3*(a+n)+10*s,w[x++]=c[p+5]-h,w[x++]=3*(l[p+5]+s)+10*a;for(;p<u;++p)w[x++]=c[p+2]-c[p],w[x++]=3*(l[p+2]+l[p])+10*l[p+1]}i.cache.put_buffer(C),i.cache.put_buffer(S)},sobel_derivatives:function(t,e){var n,r,s,a,o,h,c,l,u=t.cols,f=t.rows,d=u<<1,p=0,g=0,v=0,_=0,m=0,y=0,x=0;e.resize(u,f,2);var b=t.data,w=e.data,C=i.cache.get_buffer(u+2<<2),S=i.cache.get_buffer(u+2<<2);for(t.type&i.U8_t||t.type&i.S32_t?(c=C.i32,l=S.i32):(c=C.f32,l=S.f32);g<f;++g,m+=u){for(_=(g>0?g-1:1)*u|0,y=(g<f-1?g+1:f-2)*u|0,x=g*d|0,p=0,v=1;p<=u-2;p+=2,v+=2)n=b[_+p],r=b[y+p],c[v]=n+r+2*b[m+p],l[v]=r-n,n=b[_+p+1],r=b[y+p+1],c[v+1]=n+r+2*b[m+p+1],l[v+1]=r-n;for(;p<u;++p,++v)n=b[_+p],r=b[y+p],c[v]=n+r+2*b[m+p],l[v]=r-n;for(p=u+1|0,c[0]=c[1],c[p]=c[u],l[0]=l[1],l[p]=l[u],p=0;p<=u-4;p+=4)n=l[p+2],r=l[p+1],s=l[p+3],a=l[p+4],o=c[p+2],h=c[p+3],w[x++]=o-c[p],w[x++]=n+l[p]+2*r,w[x++]=h-c[p+1],w[x++]=s+r+2*n,w[x++]=c[p+4]-o,w[x++]=a+n+2*s,w[x++]=c[p+5]-h,w[x++]=l[p+5]+s+2*a;for(;p<u;++p)w[x++]=c[p+2]-c[p],w[x++]=l[p+2]+l[p]+2*l[p+1]}i.cache.put_buffer(C),i.cache.put_buffer(S)},compute_integral_image:function(t,e,i,n){var r=0|t.cols,s=0|t.rows,a=t.data,o=r+1|0,h=0,c=0,l=0,u=0,f=0,d=0,p=0,g=0;if(e&&i){for(;f<o;++f)e[f]=0,i[f]=0;for(l=o+1|0,u=1,f=0,g=0;f<s;++f,++l,++u){for(h=c=0,d=0;d<=r-2;d+=2,g+=2,l+=2,u+=2)h+=p=a[g],c+=p*p,e[l]=e[u]+h,i[l]=i[u]+c,h+=p=a[g+1],c+=p*p,e[l+1]=e[u+1]+h,i[l+1]=i[u+1]+c;for(;d<r;++d,++g,++l,++u)h+=p=a[g],c+=p*p,e[l]=e[u]+h,i[l]=i[u]+c}}else if(e){for(;f<o;++f)e[f]=0;for(l=o+1|0,u=1,f=0,g=0;f<s;++f,++l,++u){for(h=0,d=0;d<=r-2;d+=2,g+=2,l+=2,u+=2)h+=a[g],e[l]=e[u]+h,h+=a[g+1],e[l+1]=e[u+1]+h;for(;d<r;++d,++g,++l,++u)h+=a[g],e[l]=e[u]+h}}else if(i){for(;f<o;++f)i[f]=0;for(l=o+1|0,u=1,f=0,g=0;f<s;++f,++l,++u){for(c=0,d=0;d<=r-2;d+=2,g+=2,l+=2,u+=2)c+=(p=a[g])*p,i[l]=i[u]+c,c+=(p=a[g+1])*p,i[l+1]=i[u+1]+c;for(;d<r;++d,++g,++l,++u)c+=(p=a[g])*p,i[l]=i[u]+c}}if(n){for(f=0;f<o;++f)n[f]=0;for(l=o+1|0,u=0,f=0,g=0;f<s;++f,++l,++u){for(d=0;d<=r-2;d+=2,g+=2,l+=2,u+=2)n[l]=a[g]+n[u],n[l+1]=a[g+1]+n[u+1];for(;d<r;++d,++g,++l,++u)n[l]=a[g]+n[u]}for(l=o+r|0,u=r,f=0;f<s;++f,l+=o,u+=o)n[l]+=n[u];for(d=r-1;d>0;--d)for(u=(l=d+s*o)-o,f=s;f>0;--f,l-=o,u-=o)n[l]+=n[u]+n[u+1]}},equalize_histogram:function(t,e){var n=t.cols,r=t.rows,s=t.data;e.resize(n,r,t.channel);var a,o,h=e.data,c=n*r,l=0,u=0,f=i.cache.get_buffer(1024);for(a=f.i32;l<256;++l)a[l]=0;for(l=0;l<c;++l)++a[s[l]];for(u=a[0],l=1;l<256;++l)u=a[l]+=u;for(o=255/c,l=0;l<c;++l)h[l]=a[s[l]]*o+.5|0;i.cache.put_buffer(f)},canny:function(t,e,n,r){var s=t.cols,a=t.rows;t.data,e.resize(s,a,t.channel);var o=e.data,h=0,c=0,l=0,u=s<<1,f=0,d=0,p=0,g=0,v=0,_=0,m=0,y=0,x=i.cache.get_buffer(a*u<<2),b=i.cache.get_buffer(3*(s+2)<<2),w=i.cache.get_buffer((a+2)*(s+2)<<2),C=i.cache.get_buffer(a*s<<2),S=b.i32,T=w.i32,k=C.i32,O=x.i32,A=new i.matrix_t(s,a,i.S32C2_t,x.data),P=1,E=s+2+1|0,M=2*(s+2)+1|0,I=s+2|0,L=I+1|0,D=0;for(this.sobel_derivatives(t,A),n>r&&(h=n,n=r,r=h),h=3*(s+2)|0;--h>=0;)S[h]=0;for(h=(a+2)*(s+2)|0;--h>=0;)T[h]=0;for(;c<s;++c,l+=2)g=O[l],v=O[l+1],S[E+c]=(g^g>>31)-(g>>31)+((v^v>>31)-(v>>31));for(h=1;h<=a;++h,l+=u){if(h==a)for(c=M+s;--c>=M;)S[c]=0;else for(c=0;c<s;c++)g=O[l+(c<<1)],v=O[l+(c<<1)+1],S[M+c]=(g^g>>31)-(g>>31)+((v^v>>31)-(v>>31));for(f=l-u|0,T[L-1]=0,d=0,c=0;c<s;++c,f+=2){if((p=S[E+c])>n)if(_=(g=O[f])^(v=O[f+1]),v=(v^v>>31)-(v>>31)|0,y=(m=13573*(g=(g^g>>31)-(g>>31)|0))+(g+g<<15),(v<<=15)<m){if(p>S[E+c-1]&&p>=S[E+c+1]){p>r&&!d&&2!=T[L+c-I]?(T[L+c]=2,d=1,k[D++]=L+c):T[L+c]=1;continue}}else if(v>y){if(p>S[P+c]&&p>=S[M+c]){p>r&&!d&&2!=T[L+c-I]?(T[L+c]=2,d=1,k[D++]=L+c):T[L+c]=1;continue}}else if(p>S[P+c-(_=_<0?-1:1)]&&p>S[M+c+_]){p>r&&!d&&2!=T[L+c-I]?(T[L+c]=2,d=1,k[D++]=L+c):T[L+c]=1;continue}T[L+c]=0,d=0}T[L+s]=0,L+=I,c=P,P=E,E=M,M=c}for(c=L-I-1,h=0;h<I;++h,++c)T[c]=0;for(;D>0;)L=k[--D],1==T[L-=I+1]&&(T[L]=2,k[D++]=L),1==T[L+=1]&&(T[L]=2,k[D++]=L),1==T[L+=1]&&(T[L]=2,k[D++]=L),1==T[L+=I]&&(T[L]=2,k[D++]=L),1==T[L-=2]&&(T[L]=2,k[D++]=L),1==T[L+=I]&&(T[L]=2,k[D++]=L),1==T[L+=1]&&(T[L]=2,k[D++]=L),1==T[L+=1]&&(T[L]=2,k[D++]=L);for(L=I+1,P=0,h=0;h<a;++h,L+=I)for(c=0;c<s;++c)o[P++]=255*(2==T[L+c]);i.cache.put_buffer(x),i.cache.put_buffer(b),i.cache.put_buffer(w),i.cache.put_buffer(C)},warp_perspective:function(t,e,i,n){void 0===n&&(n=0);for(var r=0|t.cols,s=0|t.rows,a=0|e.cols,o=0|e.rows,h=t.data,c=e.data,l=0,u=0,f=0,d=0,p=0,g=0,v=0,_=0,m=0,y=0,x=0,b=0,w=0,C=0,S=0,T=i.data,k=T[0],O=T[1],A=T[2],P=T[3],E=T[4],M=T[5],I=T[6],L=T[7],D=T[8],j=0;u<o;++u)for(_=O*u+A,m=E*u+M,y=L*u+D,l=0;l<a;++l,++j,_+=k,m+=P,y+=I)d=0|(g=_*(x=1/y)),p=0|(v=m*x),g>0&&v>0&&d<r-1&&p<s-1?(b=Math.max(g-d,0),w=Math.max(v-p,0),C=h[f=r*p+d|0]+b*(h[f+1]-h[f]),S=h[f+r]+b*(h[f+r+1]-h[f+r]),c[j]=C+w*(S-C)):c[j]=n},warp_affine:function(t,e,i,n){void 0===n&&(n=0);for(var r=t.cols,s=t.rows,a=e.cols,o=e.rows,h=t.data,c=e.data,l=0,u=0,f=0,d=0,p=0,g=0,v=0,_=0,m=0,y=0,x=0,b=i.data,w=b[0],C=b[1],S=b[2],T=b[3],k=b[4],O=b[5],A=0;u<o;++u)for(g=C*u+S,v=k*u+O,l=0;l<a;++l,++A,g+=w,v+=T)p=0|v,(d=0|g)>=0&&p>=0&&d<r-1&&p<s-1?(_=g-d,m=v-p,y=h[f=r*p+d]+_*(h[f+1]-h[f]),x=h[f+r]+_*(h[f+r+1]-h[f+r]),c[A]=y+m*(x-y)):c[A]=n},skindetector:function(t,e){for(var i,n,r,s,a=t.width*t.height;a--;)s=4*a,i=t.data[s],n=t.data[s+1],r=t.data[s+2],i>95&&n>40&&r>20&&i>n&&i>r&&i-Math.min(n,r)>15&&Math.abs(i-n)>15?e[a]=255:e[a]=0}};i.imgproc=e}(),function(t){"use strict";var e,n,r,s,a,o,h=(e=new Int32Array([0,3,1,3,2,2,3,1,3,0,3,-1,2,-2,1,-3,0,-3,-1,-3,-2,-2,-3,-1,-3,0,-3,1,-2,2,-1,3]),n=new Uint8Array(512),r=new Int32Array(25),s=new Int32Array(25),a=function(t,e,i,n,r){for(var s=0,a=t[e],o=r,h=0,c=0,l=0;s<25;++s)n[s]=a-t[e+i[s]];for(s=0;s<16;s+=2)h=Math.min(n[s+1],n[s+2]),(h=Math.min(h,n[s+3]))<=o||(h=Math.min(h,n[s+4]),h=Math.min(h,n[s+5]),h=Math.min(h,n[s+6]),h=Math.min(h,n[s+7]),h=Math.min(h,n[s+8]),o=Math.max(o,Math.min(h,n[s])),o=Math.max(o,Math.min(h,n[s+9])));for(c=-o,s=0;s<16;s+=2)l=Math.max(n[s+1],n[s+2]),l=Math.max(l,n[s+3]),l=Math.max(l,n[s+4]),(l=Math.max(l,n[s+5]))>=c||(l=Math.max(l,n[s+6]),l=Math.max(l,n[s+7]),l=Math.max(l,n[s+8]),c=Math.min(c,Math.max(l,n[s])),c=Math.min(c,Math.max(l,n[s+9])));return-c-1},o=20,{set_threshold:function(t){o=Math.min(Math.max(t,0),255);for(var e=-255;e<=255;++e)n[e+255]=e<-o?1:e>o?2:0;return o},detect:function(t,h,c){void 0===c&&(c=3);var l,u=t.data,f=t.cols,d=t.rows,p=0,g=0,v=0,_=0,m=0,y=i.cache.get_buffer(3*f),x=i.cache.get_buffer(3*(f+1)<<2),b=y.u8,w=x.i32,C=r,S=s,T=Math.max(3,c),k=Math.min(d-2,d-c),O=Math.max(3,c),A=Math.min(f-3,f-c),P=0,E=0,M=a,I=n,L=o,D=0,j=0,F=0,R=0,B=0,N=0,z=0,V=0,U=0,W=0,X=0,G=0;!function(t,i,n){for(var r=0,s=e;r<n;++r)t[r]=s[r<<1]+s[1+(r<<1)]*i;for(;r<25;++r)t[r]=t[r-n]}(C,f,16);var H=C[0],Y=C[1],q=C[2],K=C[3],Z=C[4],$=C[5],J=C[6],Q=C[7],tt=C[8],et=C[9],it=C[10],nt=C[11],rt=C[12],st=C[13],at=C[14],ot=C[15];for(p=0;p<3*f;++p)b[p]=0;for(p=T;p<k;++p){for(z=p*f+O|0,N=(m=(p-3)%3)*f|0,B=m*(f+1)|0,g=0;g<f;++g)b[N+g]=0;if(R=0,p<k-1)for(g=O;g<A;++g,++z)if(0!=(F=I[(j=255-(D=u[z]))+u[z+H]]|I[j+u[z+tt]])&&(F&=I[j+u[z+q]]|I[j+u[z+it]],F&=I[j+u[z+Z]]|I[j+u[z+rt]],0!=(F&=I[j+u[z+J]]|I[j+u[z+at]]))){if(F&=I[j+u[z+Y]]|I[j+u[z+et]],F&=I[j+u[z+K]]|I[j+u[z+nt]],F&=I[j+u[z+$]]|I[j+u[z+st]],1&(F&=I[j+u[z+Q]]|I[j+u[z+ot]]))for(_=D-L,P=0,v=0;v<25;++v)if(u[z+C[v]]<_){if(++P>8){w[B+ ++R]=g,b[N+g]=M(u,z,C,S,L);break}}else P=0;if(2&F)for(_=D+L,P=0,v=0;v<25;++v)if(u[z+C[v]]>_){if(++P>8){w[B+ ++R]=g,b[N+g]=M(u,z,C,S,L);break}}else P=0}if(w[B+f]=R,p!=T)for(V=(m=(p-4+3)%3)*f|0,B=m*(f+1)|0,U=(m=(p-5+3)%3)*f|0,R=w[B+f],v=0;v<R;++v)W=(g=w[B+v])+1|0,X=g-1|0,(G=b[V+g])>b[V+W]&&G>b[V+X]&&G>b[U+X]&&G>b[U+g]&&G>b[U+W]&&G>b[N+X]&&G>b[N+g]&&G>b[N+W]&&((l=h[E]).x=g,l.y=p-1,l.score=G,E++)}return i.cache.put_buffer(y),i.cache.put_buffer(x),E}});t.fast_corners=h,h.set_threshold(20)}(i),function(t){"use strict";var e,n=(e=function(t,e,i,n,r,s,a){var o=-2*t[e]+t[e+n]+t[e-n],h=-2*t[e]+t[e+r]+t[e-r],c=t[e+s]+t[e-s]-t[e+a]-t[e-a],l=0|Math.sqrt((o-h)*(o-h)+4*c*c);return Math.min(Math.abs(i-l),Math.abs(-(i+l)))},{laplacian_threshold:30,min_eigen_value_threshold:25,detect:function(t,n,r){void 0===r&&(r=5);var s,a=0,o=0,h=t.cols,c=t.rows,l=t.data,u=5*h|0,f=3+3*h|0,d=3-3*h|0,p=i.cache.get_buffer(h*c<<2),g=p.i32,v=0,_=0,m=0,y=0,x=0,b=this.laplacian_threshold,w=this.min_eigen_value_threshold,C=0|Math.max(5,r),S=0|Math.max(3,r),T=0|Math.min(h-5,h-r),k=0|Math.min(c-3,c-r);for(a=h*c;--a>=0;)g[a]=0;for(function(t,e,i,n,r,s,a,o,h,c){var l=0,u=0,f=o*i+a|0,d=f;for(l=o;l<c;++l,d=f+=i)for(u=a;u<h;++u,++d)e[d]=-4*t[d]+t[d+r]+t[d-r]+t[d+s]+t[d-s]}(l,g,h,0,5,u,C,S,T,k),_=S*h+C|0,o=S;o<k;++o,_+=h)for(a=C,m=_;a<T;++a,++m)((v=g[m])<-b&&v<g[m-1]&&v<g[m+1]&&v<g[m-h]&&v<g[m+h]&&v<g[m-h-1]&&v<g[m+h-1]&&v<g[m-h+1]&&v<g[m+h+1]||v>b&&v>g[m-1]&&v>g[m+1]&&v>g[m-h]&&v>g[m+h]&&v>g[m-h-1]&&v>g[m+h-1]&&v>g[m-h+1]&&v>g[m+h+1])&&(y=e(l,m,v,5,u,f,d))>w&&((s=n[x]).x=a,s.y=o,s.score=y,++x,++a,++m);return i.cache.put_buffer(p),x}});i.yape06=n}(),function(t){"use strict";var e,i,n,r,s=(e=function(t,e,i){var n,r,s=0;for(n=i,r=0;r<n;r++,s++)n=Math.sqrt(i*i-r*r)+.5|0,e[s]=n+t*r;for(n--;n<r&&n>=0;n--,s++)r=Math.sqrt(i*i-n*n)+.5|0,e[s]=n+t*r;for(;-n<r;n--,s++)r=Math.sqrt(i*i-n*n)+.5|0,e[s]=n+t*r;for(r--;r>=0;r--,s++)n=-Math.sqrt(i*i-r*r)-.5|0,e[s]=n+t*r;for(;r>n;r--,s++)n=-Math.sqrt(i*i-r*r)-.5|0,e[s]=n+t*r;for(n++;n<=0;n++,s++)r=-Math.sqrt(i*i-n*n)-.5|0,e[s]=n+t*r;for(;n<-r;n++,s++)r=-Math.sqrt(i*i-n*n)-.5|0,e[s]=n+t*r;for(r++;r<0;r++,s++)n=Math.sqrt(i*i-r*r)+.5|0,e[s]=n+t*r;return e[s]=e[0],e[s+1]=e[1],s},i=function(t,e,i,n,r){var s,a;if(i>0)for(e-=n*r,a=-r;a<=r;++a){for(s=-r;s<=r;++s)if(t[e+s]>i)return!1;e+=n}else for(e-=n*r,a=-r;a<=r;++a){for(s=-r;s<=r;++s)if(t[e+s]<i)return!1;e+=n}return!0},n=function(t,e,i,n,r,s,a,o){var h=0,c=0,l=a-1|0,u=0,f=0,d=0,p=0,g=0;if((u=t[e+s[c]])<=r)if(u>=n)if((f=t[e+s[l]])<=r){if(f>=n)return void(i[e]=0);if((d=t[e+s[++l]])>r)if((p=t[e+s[++l]])>r)g=3;else{if(!(p<n))return void(i[e]=0);g=6}else if((p=t[e+s[++l]])>r)g=7;else{if(!(p<n))return void(i[e]=0);g=2}}else if((d=t[e+s[++l]])>r)if((p=t[e+s[++l]])>r)g=3;else{if(!(p<n))return void(i[e]=0);g=6}else{if(!(d<n))return void(i[e]=0);if((p=t[e+s[++l]])>r)g=7;else{if(!(p<n))return void(i[e]=0);g=2}}else{if((f=t[e+s[l]])>r)return void(i[e]=0);if((d=t[e+s[++l]])>r)return void(i[e]=0);if((p=t[e+s[++l]])>r)return void(i[e]=0);g=1}else{if((f=t[e+s[l]])<n)return void(i[e]=0);if((d=t[e+s[++l]])<n)return void(i[e]=0);if((p=t[e+s[++l]])<n)return void(i[e]=0);g=0}for(c=1;c<=a;c++)switch(u=t[e+s[c]],g){case 0:if(u>r){if(d=p,(p=t[e+s[++l]])<n)return void(i[e]=0);h-=u+d,g=0;break}if(u<n){if(d>r)return void(i[e]=0);if(p>r)return void(i[e]=0);if(d=p,(p=t[e+s[++l]])>r)return void(i[e]=0);h-=u+d,g=8;break}if(d<=r)return void(i[e]=0);if(p<=r)return void(i[e]=0);if(d=p,(p=t[e+s[++l]])>r){h-=u+d,g=3;break}if(p<n){h-=u+d,g=6;break}return void(i[e]=0);case 1:if(u<n){if(d=p,(p=t[e+s[++l]])>r)return void(i[e]=0);h-=u+d,g=1;break}if(u>r){if(d<n)return void(i[e]=0);if(p<n)return void(i[e]=0);if(d=p,(p=t[e+s[++l]])<n)return void(i[e]=0);h-=u+d,g=9;break}if(d>=n)return void(i[e]=0);if(p>=n)return void(i[e]=0);if(d=p,(p=t[e+s[++l]])<n){h-=u+d,g=2;break}if(p>r){h-=u+d,g=7;break}return void(i[e]=0);case 2:if(u>r)return void(i[e]=0);if(d=p,p=t[e+s[++l]],u<n){if(p>r)return void(i[e]=0);h-=u+d,g=4;break}if(p>r){h-=u+d,g=7;break}if(p<n){h-=u+d,g=2;break}return void(i[e]=0);case 3:if(u<n)return void(i[e]=0);if(d=p,p=t[e+s[++l]],u>r){if(p<n)return void(i[e]=0);h-=u+d,g=5;break}if(p>r){h-=u+d,g=3;break}if(p<n){h-=u+d,g=6;break}return void(i[e]=0);case 4:if(u>r)return void(i[e]=0);if(u<n){if(d=p,(p=t[e+s[++l]])>r)return void(i[e]=0);h-=u+d,g=1;break}if(p>=n)return void(i[e]=0);if(d=p,(p=t[e+s[++l]])<n){h-=u+d,g=2;break}if(p>r){h-=u+d,g=7;break}return void(i[e]=0);case 5:if(u<n)return void(i[e]=0);if(u>r){if(d=p,(p=t[e+s[++l]])<n)return void(i[e]=0);h-=u+d,g=0;break}if(p<=r)return void(i[e]=0);if(d=p,(p=t[e+s[++l]])>r){h-=u+d,g=3;break}if(p<n){h-=u+d,g=6;break}return void(i[e]=0);case 7:if(u>r)return void(i[e]=0);if(u<n)return void(i[e]=0);if(d=p,(p=t[e+s[++l]])>r){h-=u+d,g=3;break}if(p<n){h-=u+d,g=6;break}return void(i[e]=0);case 6:if(u>r)return void(i[e]=0);if(u<n)return void(i[e]=0);if(d=p,(p=t[e+s[++l]])<n){h-=u+d,g=2;break}if(p>r){h-=u+d,g=7;break}return void(i[e]=0);case 8:if(u>r){if(p<n)return void(i[e]=0);if(d=p,(p=t[e+s[++l]])<n)return void(i[e]=0);h-=u+d,g=9;break}if(u<n){if(d=p,(p=t[e+s[++l]])>r)return void(i[e]=0);h-=u+d,g=1;break}return void(i[e]=0);case 9:if(u<n){if(p>r)return void(i[e]=0);if(d=p,(p=t[e+s[++l]])>r)return void(i[e]=0);h-=u+d,g=8;break}if(u>r){if(d=p,(p=t[e+s[++l]])<n)return void(i[e]=0);h-=u+d,g=0;break}return void(i[e]=0)}i[e]=h+o*t[e]},r=function(){return function(t,i,n){this.dirs=new Int32Array(1024),this.dirs_count=0|e(t,this.dirs,n),this.scores=new Int32Array(t*i),this.radius=0|n}}(),{level_tables:[],tau:7,init:function(t,e,i,n){var s;for(void 0===n&&(n=1),i=Math.min(i,7),i=Math.max(i,3),s=0;s<n;++s)this.level_tables[s]=new r(t>>s,e>>s,i)},detect:function(t,e,r){void 0===r&&(r=4);var s,a,o,h,c,l=this.level_tables[0],u=0|l.radius,f=u-1|0,d=l.dirs,p=0|l.dirs_count,g=p>>1,v=t.data,_=0|t.cols,m=0|t.rows,y=_>>1,x=l.scores,b=0,w=0,C=0,S=0,T=0,k=0,O=0,A=0,P=0|this.tau,E=0,M=0|Math.max(u+1,r),I=0|Math.max(u+1,r),L=0|Math.min(_-u-2,_-r),D=0|Math.min(m-u-2,m-r);for(C=I*_+M|0,w=I;w<D;++w,C+=_)for(b=M,S=C;b<L;++b,++S)T=v[S]+P,(k=v[S]-P)<v[S+u]&&v[S+u]<T&&k<v[S-u]&&v[S-u]<T?x[S]=0:n(v,S,x,k,T,d,g,p);for(C=I*_+M|0,w=I;w<D;++w,C+=_)for(b=M,S=C;b<L;++b,++S)A=x[S],(O=Math.abs(A))<5?(++b,++S):(h=_,c=void 0,c=0,0!=(a=x)[(o=S)+1]&&c++,0!=a[o-1]&&c++,0!=a[o+h]&&c++,0!=a[o+h+1]&&c++,0!=a[o+h-1]&&c++,0!=a[o-h]&&c++,0!=a[o-h+1]&&c++,0!=a[o-h-1]&&c++,c>=3&&i(x,S,A,y,u)&&((s=e[E]).x=b,s.y=w,s.score=O,++E,b+=f,S+=f));return E}});t.yape=s}(i),function(t){"use strict";var e,n,r,s,a=(e=new Int32Array([8,-3,9,5,4,2,7,-12,-11,9,-8,2,7,-12,12,-13,2,-13,2,12,1,-7,1,6,-2,-10,-2,-4,-13,-13,-11,-8,-13,-3,-12,-9,10,4,11,9,-13,-8,-8,-9,-11,7,-9,12,7,7,12,6,-4,-5,-3,0,-13,2,-12,-3,-9,0,-7,5,12,-6,12,-1,-3,6,-2,12,-6,-13,-4,-8,11,-13,12,-8,4,7,5,1,5,-3,10,-3,3,-7,6,12,-8,-7,-6,-2,-2,11,-1,-10,-13,12,-8,10,-7,3,-5,-3,-4,2,-3,7,-10,-12,-6,11,5,-12,6,-7,5,-6,7,-1,1,0,4,-5,9,11,11,-13,4,7,4,12,2,-1,4,4,-4,-12,-2,7,-8,-5,-7,-10,4,11,9,12,0,-8,1,-13,-13,-2,-8,2,-3,-2,-2,3,-6,9,-4,-9,8,12,10,7,0,9,1,3,7,-5,11,-10,-13,-6,-11,0,10,7,12,1,-6,-3,-6,12,10,-9,12,-4,-13,8,-8,-12,-13,0,-8,-4,3,3,7,8,5,7,10,-7,-1,7,1,-12,3,-10,5,6,2,-4,3,-10,-13,0,-13,5,-13,-7,-12,12,-13,3,-11,8,-7,12,-4,7,6,-10,12,8,-9,-1,-7,-6,-2,-5,0,12,-12,5,-7,5,3,-10,8,-13,-7,-7,-4,5,-3,-2,-1,-7,2,9,5,-11,-11,-13,-5,-13,-1,6,0,-1,5,-3,5,2,-4,-13,-4,12,-9,-6,-9,6,-12,-10,-8,-4,10,2,12,-3,7,12,12,12,-7,-13,-6,5,-4,9,-3,4,7,-1,12,2,-7,6,-5,1,-13,11,-12,5,-3,7,-2,-6,7,-8,12,-7,-13,-7,-11,-12,1,-3,12,12,2,-6,3,0,-4,3,-2,-13,-1,-13,1,9,7,1,8,-6,1,-1,3,12,9,1,12,6,-1,-9,-1,3,-13,-13,-10,5,7,7,10,12,12,-5,12,9,6,3,7,11,5,-13,6,10,2,-12,2,3,3,8,4,-6,2,6,12,-13,9,-12,10,3,-8,4,-7,9,-11,12,-4,-6,1,12,2,-8,6,-9,7,-4,2,3,3,-2,6,3,11,0,3,-3,8,-8,7,8,9,3,-11,-5,-6,-4,-10,11,-5,10,-5,-8,-3,12,-10,5,-9,0,8,-1,12,-6,4,-6,6,-11,-10,12,-8,7,4,-2,6,7,-2,0,-2,12,-5,-8,-5,2,7,-6,10,12,-9,-13,-8,-8,-5,-13,-5,-2,8,-8,9,-13,-9,-11,-9,0,1,-8,1,-2,7,-4,9,1,-2,1,-1,-4,11,-6,12,-11,-12,-9,-6,4,3,7,7,12,5,5,10,8,0,-4,2,8,-9,12,-5,-13,0,7,2,12,-1,2,1,7,5,11,7,-9,3,5,6,-8,-13,-4,-8,9,-5,9,-3,-3,-4,-7,-3,-12,6,5,8,0,-7,6,-6,12,-13,6,-5,-2,1,-10,3,10,4,1,8,-4,-2,-2,2,-13,2,-12,12,12,-2,-13,0,-6,4,1,9,3,-6,-10,-3,-5,-3,-13,-1,1,7,5,12,-11,4,-2,5,-7,-13,9,-9,-5,7,1,8,6,7,-8,7,6,-7,-4,-7,1,-8,11,-7,-8,-13,6,-12,-8,2,4,3,9,10,-5,12,3,-6,-5,-6,7,8,-3,9,-8,2,-12,2,8,-11,-2,-10,3,-12,-13,-7,-9,-11,0,-10,-5,5,-3,11,8,-2,-13,-1,12,-1,-8,0,9,-13,-11,-12,-5,-10,-2,-10,11,-3,9,-2,-13,2,-3,3,2,-9,-13,-4,0,-4,6,-3,-10,-4,12,-2,-7,-6,-11,-4,9,6,-3,6,11,-13,11,-5,5,11,11,12,6,7,-5,12,-2,-1,12,0,7,-4,-8,-3,-2,-7,1,-6,7,-13,-12,-8,-13,-7,-2,-6,-8,-8,5,-6,-9,-5,-1,-4,5,-13,7,-8,10,1,5,5,-13,1,0,10,-13,9,12,10,-1,5,-8,10,-9,-1,11,1,-13,-9,-3,-6,2,-1,-10,1,12,-13,1,-8,-10,8,-11,10,-6,2,-13,3,-6,7,-13,12,-9,-10,-10,-5,-7,-10,-8,-8,-13,4,-6,8,5,3,12,8,-13,-4,2,-3,-3,5,-13,10,-12,4,-13,5,-1,-9,9,-4,3,0,3,3,-9,-12,1,-6,1,3,2,4,-8,-10,-10,-10,9,8,-13,12,12,-8,-12,-6,-5,2,2,3,7,10,6,11,-8,6,8,8,-12,-7,10,-6,5,-3,-9,-3,9,-1,-13,-1,5,-3,-7,-3,4,-8,-2,-8,3,4,2,12,12,2,-5,3,11,6,-9,11,-13,3,-1,7,12,11,-1,12,4,-3,0,-3,6,4,-11,4,12,2,-4,2,1,-10,-6,-8,1,-13,7,-11,1,-13,12,-11,-13,6,0,11,-13,0,-1,1,4,-13,3,-9,-2,-9,8,-6,-3,-13,-6,-8,-2,5,-9,8,10,2,7,3,-9,-1,-6,-1,-1,9,5,11,-2,11,-3,12,-8,3,0,3,5,-1,4,0,10,3,-6,4,5,-13,0,-10,5,5,8,12,11,8,9,9,-6,7,-4,8,-12,-10,4,-10,9,7,3,12,4,9,-7,10,-2,7,0,12,-2,-1,-6,0,-11]),n=new i.matrix_t(3,3,i.F32_t|i.C1_t),r=new i.matrix_t(32,32,i.U8_t|i.C1_t),s=function(t,e,r,s,a,o){var h=Math.cos(r),c=Math.sin(r);n.data[0]=h,n.data[1]=-c,n.data[2]=(-h+c)*o*.5+s,n.data[3]=c,n.data[4]=h,n.data[5]=(-c-h)*o*.5+a,i.imgproc.warp_affine(t,e,n,128)},{describe:function(t,n,a,o){var h=0,c=0,l=0,u=0,f=0,d=0,p=0,g=0,v=(t.data,t.cols,t.rows,r.data),_=0;o.type&i.U8_t?o.resize(32,a,1):(o.type=i.U8_t,o.cols=32,o.rows=a,o.channel=1,o.allocate());var m=o.data,y=0;for(h=0;h<a;++h){for(l=n[h].x,u=n[h].y,f=n[h].angle,s(t,r,f,l,u,32),_=0,c=0;c<32;++c)g=(d=v[528+32*e[_+1]+e[_]])<(p=v[528+32*e[(_+=2)+1]+e[_]])|0,g|=((d=v[528+32*e[(_+=2)+1]+e[_]])<(p=v[528+32*e[(_+=2)+1]+e[_]]))<<1,g|=((d=v[528+32*e[(_+=2)+1]+e[_]])<(p=v[528+32*e[(_+=2)+1]+e[_]]))<<2,g|=((d=v[528+32*e[(_+=2)+1]+e[_]])<(p=v[528+32*e[(_+=2)+1]+e[_]]))<<3,g|=((d=v[528+32*e[(_+=2)+1]+e[_]])<(p=v[528+32*e[(_+=2)+1]+e[_]]))<<4,g|=((d=v[528+32*e[(_+=2)+1]+e[_]])<(p=v[528+32*e[(_+=2)+1]+e[_]]))<<5,g|=((d=v[528+32*e[(_+=2)+1]+e[_]])<(p=v[528+32*e[(_+=2)+1]+e[_]]))<<6,d=v[528+32*e[(_+=2)+1]+e[_]],p=v[528+32*e[(_+=2)+1]+e[_]],_+=2,g|=(d<p)<<7,m[y+c]=g;y+=32}}});t.orb=a}(i),function(t){"use strict";var e,n=(e=i.imgproc.scharr_derivatives,{track:function(t,n,r,s,a,o,h,c,l,u){void 0===h&&(h=30),void 0===c&&(c=new Uint8Array(a)),void 0===l&&(l=.01),void 0===u&&(u=1e-4);var f=.5*(o-1),d=o*o|0,p=d<<1,g=t.data,v=n.data,_=g[0].data,m=v[0].data,y=g[0].cols,x=g[0].rows,b=0,w=0,C=i.cache.get_buffer(d<<2),S=i.cache.get_buffer(p<<2),T=i.cache.get_buffer(x*(y<<1)<<2),k=new i.matrix_t(y,x,i.S32C2_t,T.data),O=C.i32,A=S.i32,P=T.i32,E=0,M=0,I=0,L=0,D=0,j=0,F=0,R=0,B=0,N=0,z=0,V=0,U=0,W=0,X=0,G=0,H=0,Y=0,q=0,K=0,Z=0,$=0,J=0,Q=0,tt=0,et=0,it=0,nt=0,rt=0,st=0,at=0,ot=0,ht=0,ct=0,lt=0,ut=0,ft=0,dt=0,pt=0,gt=0,vt=0,_t=0,mt=0;for(l*=l;K<a;++K)c[K]=1;var yt=t.levels-1|0;for(Q=yt;Q>=0;--Q)for(F=1/(1<<Q),w=x>>Q,E=(b=y>>Q)<<1,_=g[Q].data,m=v[Q].data,it=b-o|0,nt=w-o|0,e(g[Q],k),tt=0;tt<a;++tt)if(Z=1+(K=tt<<1),R=r[K]*F,B=r[Z]*F,Q==yt?(N=R,z=B):(N=2*s[K],z=2*s[Z]),s[K]=N,s[Z]=z,0==($=(G=0|(R-=f))<=0|G>=it|(H=0|(B-=f))<=0|H>=nt)){for(ut=16384-(ht=(1-(rt=R-G))*(1-(st=B-H))*16384+.5|0)-(ct=rt*(1-st)*16384+.5|0)-(lt=(1-rt)*st*16384+.5|0),gt=0,vt=0,_t=0,J=0;J<o;++J)for(I=(M=(J+H)*b+G|0)<<1,D=(L=J*o|0)<<1,$=0;$<o;++$,++M,++L,I+=2)ft=256+(ft=_[M]*ht+_[M+1]*ct+_[M+b]*lt+_[M+b+1]*ut)>>9,dt=8192+(dt=P[I]*ht+P[I+2]*ct+P[I+E]*lt+P[I+E+2]*ut)>>14,pt=8192+(pt=P[I+1]*ht+P[I+3]*ct+P[I+E+1]*lt+P[I+E+3]*ut)>>14,O[L]=ft,A[D++]=dt,A[D++]=pt,gt+=dt*dt,vt+=dt*pt,_t+=pt*pt;if(mt=(gt*=1/(1<<20))*(_t*=1/(1<<20))-(vt*=1/(1<<20))*vt,(_t+gt-Math.sqrt((gt-_t)*(gt-_t)+4*vt*vt))/p<u||mt<1.1920929e-7)0==Q&&(c[tt]=0);else for(mt=1/mt,N-=f,z-=f,V=0,U=0,et=0;et<h;++et){if(0!=($=(Y=0|N)<=0|Y>=it|(q=0|z)<=0|q>=nt)){0==Q&&(c[tt]=0);break}for(ut=16384-(ht=(1-(rt=N-Y))*(1-(st=z-q))*16384+.5|0)-(ct=rt*(1-st)*16384+.5|0)-(lt=(1-rt)*st*16384+.5|0),at=0,ot=0,J=0;J<o;++J)for(j=(J+q)*b+Y|0,D=(L=J*o|0)<<1,$=0;$<o;++$,++j,++L)ft=256+(ft=m[j]*ht+m[j+1]*ct+m[j+b]*lt+m[j+b+1]*ut)>>9,at+=(ft-=O[L])*A[D++],ot+=ft*A[D++];if(N+=W=(vt*(ot*=1/(1<<20))-_t*(at*=1/(1<<20)))*mt,z+=X=(vt*at-gt*ot)*mt,s[K]=N+f,s[Z]=z+f,W*W+X*X<=l)break;if(et>0&&Math.abs(W+V)<.01&&Math.abs(X+U)<.01){s[K]-=.5*W,s[Z]-=.5*X;break}V=W,U=X}}else 0==Q&&(c[tt]=0);i.cache.put_buffer(C),i.cache.put_buffer(S),i.cache.put_buffer(T)}});t.optical_flow_lk=n}(i),function(t){"use strict";var e,n=(e=function(t,e){var i=.25*t.width+.5|0;return e.x<=t.x+i&&e.x>=t.x-i&&e.y<=t.y+i&&e.y>=t.y-i&&e.width<=1.5*t.width+.5|0&&1.5*e.width+.5|0>=t.width},{edges_density:.07,detect_single_scale:function(t,e,i,n,r,s,a,o){var h,c,l,u,f,d,p,g,v,_,m,y,x,b,w,C,S,T,k,O,A,P,E,M,I,L=o.size[0]*a|0,D=o.size[1]*a|0,j=.5*a+1.5|0,F=j,R=r-L|0,B=s-D|0,N=r+1|0,z=1/(L*D),V=!0,U=0,W=L,X=D*N,G=X+L,H=L*D*255*this.edges_density|0,Y=[];for(f=0;f<B;f+=F)for(U=f*N,u=0;u<R;u+=j,U+=j)if(d=t[U]-t[U+W]-t[U+X]+t[U+G],n&&(n[U]-n[U+W]-n[U+X]+n[U+G]<H||d<20))u+=j,U+=j;else{for(d*=z,g=(p=(e[U]-e[U+W]-e[U+X]+e[U+G])*z-d*d)>0?Math.sqrt(p):1,x=(v=o.complexClassifiers).length,V=!0,h=0;h<x;++h){for(C=(_=v[h]).threshold,b=(m=_.simpleClassifiers).length,S=0,c=0;c<b;++c){if(T=0,w=(O=(y=m[c]).features).length,1===y.tilted)for(l=0;l<w;++l)A=~~(u+(k=O[l])[0]*a)+~~(f+k[1]*a)*N,P=(M=~~(k[2]*a))*N,E=(I=~~(k[3]*a))*N,T+=(i[A]-i[A+M+P]-i[A-I+E]+i[A+M-I+P+E])*k[4];else for(l=0;l<w;++l)A=~~(u+(k=O[l])[0]*a)+~~(f+k[1]*a)*N,M=~~(k[2]*a),E=(I=~~(k[3]*a))*N,T+=(t[A]-t[A+M]-t[A+E]+t[A+E+M])*k[4];S+=T*z<y.threshold*g?y.left_val:y.right_val}if(S<C){V=!1;break}}V&&(Y.push({x:u,y:f,width:L,height:D,neighbor:1,confidence:S}),u+=j,U+=j)}return Y},detect_multi_scale:function(t,e,i,n,r,s,a,o,h){void 0===o&&(o=1.2),void 0===h&&(h=1);for(var c=a.size[0],l=a.size[1],u=[];h*c<r&&h*l<s;)u=u.concat(this.detect_single_scale(t,e,i,n,r,s,h,a)),h*=o;return u},group_rectangles:function(t,i){void 0===i&&(i=1);var n,r,s=t.length,a=[];for(n=0;n<s;++n)a[n]={parent:-1,element:t[n],rank:0};for(n=0;n<s;++n)if(a[n].element){for(var o=n;-1!=a[o].parent;)o=a[o].parent;for(r=0;r<s;++r)if(n!=r&&a[r].element&&e(a[n].element,a[r].element)){for(var h=r;-1!=a[h].parent;)h=a[h].parent;if(h!=o){a[o].rank>a[h].rank?a[h].parent=o:(a[o].parent=h,a[o].rank==a[h].rank&&a[h].rank++,o=h);for(var c,l=r;-1!=a[l].parent;)c=l,l=a[l].parent,a[c].parent=o;for(l=n;-1!=a[l].parent;)c=l,l=a[l].parent,a[c].parent=o}}}var u=[],f=0;for(n=0;n<s;n++){r=-1;var d=n;if(a[d].element){for(;-1!=a[d].parent;)d=a[d].parent;a[d].rank>=0&&(a[d].rank=~f++),r=~a[d].rank}u[n]=r}var p=[];for(n=0;n<f+1;++n)p[n]={neighbors:0,x:0,y:0,width:0,height:0,confidence:0};for(n=0;n<s;++n){var g=t[n],v=u[n];0==p[v].neighbors&&(p[v].confidence=g.confidence),++p[v].neighbors,p[v].x+=g.x,p[v].y+=g.y,p[v].width+=g.width,p[v].height+=g.height,p[v].confidence=Math.max(p[v].confidence,g.confidence)}var _=[];for(n=0;n<f;++n)(s=p[n].neighbors)>=i&&_.push({x:(2*p[n].x+s)/(2*s),y:(2*p[n].y+s)/(2*s),width:(2*p[n].width+s)/(2*s),height:(2*p[n].height+s)/(2*s),neighbors:p[n].neighbors,confidence:p[n].confidence});var m=[];for(s=_.length,n=0;n<s;++n){g=_[n];var y=!0;for(r=0;r<s;++r){var x=_[r],b=.25*x.width+.5|0;if(n!=r&&g.x>=x.x-b&&g.y>=x.y-b&&g.x+g.width<=x.x+x.width+b&&g.y+g.height<=x.y+x.height+b&&(x.neighbors>Math.max(3,g.neighbors)||g.neighbors<3)){y=!1;break}}y&&m.push(g)}return m}});i.haar=n}(),function(t){"use strict";var e,n,r=(e=function(t,e){var i=.25*t.width+.5|0;return e.x<=t.x+i&&e.x>=t.x-i&&e.y<=t.y+i&&e.y>=t.y-i&&e.width<=1.5*t.width+.5|0&&1.5*e.width+.5|0>=t.width},n=new i.pyramid_t(1),{interval:4,scale:1.1486,next:5,scale_to:1,prepare_cascade:function(t){for(var e=t.stage_classifier.length,i=0;i<e;i++)for(var n=t.stage_classifier[i].feature,r=t.stage_classifier[i].count,s=t.stage_classifier[i]._feature=new Array(r),a=0;a<r;a++)s[a]={size:n[a].size,px:new Array(n[a].size),pz:new Array(n[a].size),nx:new Array(n[a].size),nz:new Array(n[a].size)}},build_pyramid:function(t,e,r,s){void 0===s&&(s=4);var a=t.cols,o=t.rows,h=0,c=0,l=0,u=!1,f=t,d=t,p=i.U8_t|i.C1_t;this.interval=s,this.scale=Math.pow(2,1/(this.interval+1)),this.next=this.interval+1|0,this.scale_to=Math.log(Math.min(a/e,o/r))/Math.log(this.scale)|0;var g=4*(this.scale_to+2*this.next)|0;for(n.levels!=g&&(n.levels=g,n.data=new Array(g),u=!0,n.data[0]=t),h=1;h<=this.interval;++h)c=a/Math.pow(this.scale,h)|0,l=o/Math.pow(this.scale,h)|0,f=n.data[h<<2],(u||c!=f.cols||l!=f.rows)&&(n.data[h<<2]=new i.matrix_t(c,l,p),f=n.data[h<<2]),i.imgproc.resample(t,f,c,l);for(h=this.next;h<this.scale_to+2*this.next;++h)d=n.data[(h<<2)-(this.next<<2)],f=n.data[h<<2],c=d.cols>>1,l=d.rows>>1,(u||c!=f.cols||l!=f.rows)&&(n.data[h<<2]=new i.matrix_t(c,l,p),f=n.data[h<<2]),i.imgproc.pyrdown(d,f);for(h=2*this.next;h<this.scale_to+2*this.next;++h)c=(d=n.data[(h<<2)-(this.next<<2)]).cols>>1,l=d.rows>>1,f=n.data[1+(h<<2)],(u||c!=f.cols||l!=f.rows)&&(n.data[1+(h<<2)]=new i.matrix_t(c,l,p),f=n.data[1+(h<<2)]),i.imgproc.pyrdown(d,f,1,0),f=n.data[2+(h<<2)],(u||c!=f.cols||l!=f.rows)&&(n.data[2+(h<<2)]=new i.matrix_t(c,l,p),f=n.data[2+(h<<2)]),i.imgproc.pyrdown(d,f,0,1),f=n.data[3+(h<<2)],(u||c!=f.cols||l!=f.rows)&&(n.data[3+(h<<2)]=new i.matrix_t(c,l,p),f=n.data[3+(h<<2)]),i.imgproc.pyrdown(d,f,1,1);return n},detect:function(t,e){this.interval;var i,n,r,s,a,o=this.scale,h=this.next,c=this.scale_to,l=0,u=0,f=0,d=0,p=0,g=0,v=0,_=0,m=0,y=0,x=0,b=0,w=0,C=0,S=0,T=0,k=0,O=0,A=!0,P=!0,E=1,M=1,I=[0,1,0,1],L=[0,0,1,1],D=[],j=t.data,F=[],R=[0,0,0],B=[0,0,0],N=[0,0,0];for(l=0;l<c;l++){for(T=j[(S=l<<2)+(h<<3)].cols-(e.width>>2),k=j[S+(h<<3)].rows-(e.height>>2),B[0]=1*j[S].cols,B[1]=1*j[S+(h<<2)].cols,B[2]=1*j[S+(h<<3)].cols,N[0]=4*j[S].cols-4*T,N[1]=2*j[S+(h<<2)].cols-2*T,N[2]=1*j[S+(h<<3)].cols-1*T,_=e.stage_classifier.length,u=0;u<_;u++)for(r=e.stage_classifier[u].feature,n=e.stage_classifier[u]._feature,m=e.stage_classifier[u].count,f=0;f<m;f++)for(s=n[f],y=0|(a=r[f]).size,v=0;v<y;v++)s.px[v]=1*a.px[v]+a.py[v]*B[a.pz[v]],s.pz[v]=a.pz[v],s.nx[v]=1*a.nx[v]+a.ny[v]*B[a.nz[v]],s.nz[v]=a.nz[v];for(F[0]=j[S].data,F[1]=j[S+(h<<2)].data,v=0;v<4;v++)for(F[2]=j[S+(h<<3)+v].data,R[0]=2*I[v]+L[v]*(2*j[S].cols),R[1]=1*I[v]+L[v]*(1*j[S+(h<<2)].cols),R[2]=0,g=0;g<k;g++){for(p=0;p<T;p++){for(O=0,A=!0,_=e.stage_classifier.length,u=0;u<_;u++){for(O=0,i=e.stage_classifier[u].alpha,n=e.stage_classifier[u]._feature,m=e.stage_classifier[u].count,f=0;f<m;f++)if((b=F[(s=n[f]).pz[0]][R[s.pz[0]]+s.px[0]])<=(w=F[s.nz[0]][R[s.nz[0]]+s.nx[0]]))O+=i[f<<1];else{for(P=!0,y=s.size,C=1;C<y;C++){if(s.pz[C]>=0&&(x=F[s.pz[C]][R[s.pz[C]]+s.px[C]])<b){if(x<=w){P=!1;break}b=x}if(s.nz[C]>=0&&(d=F[s.nz[C]][R[s.nz[C]]+s.nx[C]])>w){if(b<=d){P=!1;break}w=d}}O+=P?i[1+(f<<1)]:i[f<<1]}if(O<e.stage_classifier[u].threshold){A=!1;break}}A&&(D.push({x:(4*p+2*I[v])*E,y:(4*g+2*L[v])*M,width:e.width*E,height:e.height*M,neighbor:1,confidence:O}),++p,R[0]+=4,R[1]+=2,R[2]+=1),R[0]+=4,R[1]+=2,R[2]+=1}R[0]+=N[0],R[1]+=N[1],R[2]+=N[2]}E*=o,M*=o}return D},group_rectangles:function(t,i){void 0===i&&(i=1);var n,r,s=t.length,a=[];for(n=0;n<s;++n)a[n]={parent:-1,element:t[n],rank:0};for(n=0;n<s;++n)if(a[n].element){for(var o=n;-1!=a[o].parent;)o=a[o].parent;for(r=0;r<s;++r)if(n!=r&&a[r].element&&e(a[n].element,a[r].element)){for(var h=r;-1!=a[h].parent;)h=a[h].parent;if(h!=o){a[o].rank>a[h].rank?a[h].parent=o:(a[o].parent=h,a[o].rank==a[h].rank&&a[h].rank++,o=h);for(var c,l=r;-1!=a[l].parent;)c=l,l=a[l].parent,a[c].parent=o;for(l=n;-1!=a[l].parent;)c=l,l=a[l].parent,a[c].parent=o}}}var u=[],f=0;for(n=0;n<s;n++){r=-1;var d=n;if(a[d].element){for(;-1!=a[d].parent;)d=a[d].parent;a[d].rank>=0&&(a[d].rank=~f++),r=~a[d].rank}u[n]=r}var p=[];for(n=0;n<f+1;++n)p[n]={neighbors:0,x:0,y:0,width:0,height:0,confidence:0};for(n=0;n<s;++n){var g=t[n],v=u[n];0==p[v].neighbors&&(p[v].confidence=g.confidence),++p[v].neighbors,p[v].x+=g.x,p[v].y+=g.y,p[v].width+=g.width,p[v].height+=g.height,p[v].confidence=Math.max(p[v].confidence,g.confidence)}var _=[];for(n=0;n<f;++n)(s=p[n].neighbors)>=i&&_.push({x:(2*p[n].x+s)/(2*s),y:(2*p[n].y+s)/(2*s),width:(2*p[n].width+s)/(2*s),height:(2*p[n].height+s)/(2*s),neighbors:p[n].neighbors,confidence:p[n].confidence});var m=[];for(s=_.length,n=0;n<s;++n){g=_[n];var y=!0;for(r=0;r<s;++r){var x=_[r],b=.25*x.width+.5|0;if(n!=r&&g.x>=x.x-b&&g.y>=x.y-b&&g.x+g.width<=x.x+x.width+b&&g.y+g.height<=x.y+x.height+b&&(x.neighbors>Math.max(3,g.neighbors)||g.neighbors<3)){y=!1;break}}y&&m.push(g)}return m}});t.bbf=r}(i),function(e){"use strict";void 0===t||void 0===t.exports?window.jsfeat=e:t.exports=e}(i)},679:function(t,e,i){var n,r,s;(function(a,o){var h=(a=a||i(680)).window,c=a.document,l=new function(){var t=/^(statics|enumerable|beans|preserve)$/,e=[],i=e.slice,n=Object.create,r=Object.getOwnPropertyDescriptor,s=Object.defineProperty,a=e.forEach||function(t,e){for(var i=0,n=this.length;i<n;i++)t.call(e,this[i],i,this)},h=Object.assign||function(t){for(var e=1,i=arguments.length;e<i;e++){var n=arguments[e];for(var r in n)n.hasOwnProperty(r)&&(t[r]=n[r])}return t},c=function(t,e,i){if(t){var n=r(t,"length");(n&&"number"==typeof n.value?a:function(t,e){for(var i in this)this.hasOwnProperty(i)&&t.call(e,this[i],i,this)}).call(t,e,i=i||t)}return i};function l(e,i,n,a,o){var h={};function c(t,c){"string"==typeof(c=c||(c=r(i,t))&&(c.get?c:c.value))&&"#"===c[0]&&(c=e[c.substring(1)]||c);var l,f="function"==typeof c,d=c,p=o||f&&!c.base?c&&c.get?t in e:e[t]:null;o&&p||(f&&p&&(c.base=p),f&&!1!==a&&(l=t.match(/^([gs]et|is)(([A-Z])(.*))$/))&&(h[l[3].toLowerCase()+l[4]]=l[2]),d&&!f&&d.get&&"function"==typeof d.get&&u.isPlainObject(d)||(d={value:d,writable:!0}),(r(e,t)||{configurable:!0}).configurable&&(d.configurable=!0,d.enumerable=null!=n?n:!l),s(e,t,d))}if(i){for(var l in i)i.hasOwnProperty(l)&&!t.test(l)&&c(l);for(var l in h){var f=h[l],d=e["set"+f],p=e["get"+f]||d&&e["is"+f];!p||!0!==a&&0!==p.length||c(l,{get:p,set:d})}}return e}function u(){for(var t=0,e=arguments.length;t<e;t++){var i=arguments[t];i&&h(this,i)}return this}return l(u,{inject:function(t){if(t){var e=!0===t.statics?t:t.statics,i=t.beans,n=t.preserve;e!==t&&l(this.prototype,t,t.enumerable,i,n),l(this,e,null,i,n)}for(var r=1,s=arguments.length;r<s;r++)this.inject(arguments[r]);return this},extend:function(){for(var t,e,i,r=this,a=0,o=arguments.length;a<o&&(!t||!e);a++)i=arguments[a],t=t||i.initialize,e=e||i.prototype;return e=(t=t||function(){r.apply(this,arguments)}).prototype=e||n(this.prototype),s(e,"constructor",{value:t,writable:!0,configurable:!0}),l(t,this),arguments.length&&this.inject.apply(t,arguments),t.base=r,t}}).inject({enumerable:!1,initialize:u,set:u,inject:function(){for(var t=0,e=arguments.length;t<e;t++){var i=arguments[t];i&&l(this,i,i.enumerable,i.beans,i.preserve)}return this},extend:function(){var t=n(this);return t.inject.apply(t,arguments)},each:function(t,e){return c(this,t,e)},clone:function(){return new this.constructor(this)},statics:{set:h,each:c,create:n,define:s,describe:r,clone:function(t){return h(new t.constructor,t)},isPlainObject:function(t){var e=null!=t&&t.constructor;return e&&(e===Object||e===u||"Object"===e.name)},pick:function(t,e){return t!==o?t:e},slice:function(t,e,n){return i.call(t,e,n)}}})};t.exports=l,l.inject({enumerable:!1,toString:function(){return null!=this._id?(this._class||"Object")+(this._name?" '"+this._name+"'":" @"+this._id):"{ "+l.each(this,function(t,e){if(!/^_/.test(e)){var i=typeof t;this.push(e+": "+("number"===i?p.instance.number(t):"string"===i?"'"+t+"'":t))}},[]).join(", ")+" }"},getClassName:function(){return this._class||""},importJSON:function(t){return l.importJSON(t,this)},exportJSON:function(t){return l.exportJSON(this,t)},toJSON:function(){return l.serialize(this)},set:function(t,e){return t&&l.filter(this,t,e,this._prioritize),this}},{beans:!1,statics:{exports:{},extend:function t(){var e=t.base.apply(this,arguments),i=e.prototype._class;return i&&!l.exports[i]&&(l.exports[i]=e),e},equals:function(t,e){if(t===e)return!0;if(t&&t.equals)return t.equals(e);if(e&&e.equals)return e.equals(t);if(t&&e&&"object"==typeof t&&"object"==typeof e){if(Array.isArray(t)&&Array.isArray(e)){if((i=t.length)!==e.length)return!1;for(;i--;)if(!l.equals(t[i],e[i]))return!1}else{var i,n=Object.keys(t);if((i=n.length)!==Object.keys(e).length)return!1;for(;i--;){var r=n[i];if(!e.hasOwnProperty(r)||!l.equals(t[r],e[r]))return!1}}return!0}return!1},read:function(t,e,i,n){if(this===l){var r=this.peek(t,e);return t.__index++,r}var s=this.prototype,a=s._readIndex,h=e||a&&t.__index||0,c=t.length,u=t[h];if(n=n||c-h,u instanceof this||i&&i.readNull&&null==u&&n<=1)return a&&(t.__index=h+1),u&&i&&i.clone?u.clone():u;if(u=l.create(s),a&&(u.__read=!0),u=u.initialize.apply(u,h>0||h+n<c?l.slice(t,h,h+n):t)||u,a){t.__index=h+u.__read;var f=u.__filtered;f&&(t.__filtered=f,u.__filtered=o),u.__read=o}return u},peek:function(t,e){return t[t.__index=e||t.__index||0]},remain:function(t){return t.length-(t.__index||0)},readList:function(t,e,i,n){for(var r,s=[],a=e||0,o=n?a+n:t.length,h=a;h<o;h++)s.push(Array.isArray(r=t[h])?this.read(r,0,i):this.read(t,h,i,1));return s},readNamed:function(t,e,i,n,r){var s=this.getNamed(t,e),a=s!==o;if(a){var h=t.__filtered;h||((h=t.__filtered=l.create(t[0])).__unfiltered=t[0]),h[e]=o}var c=a?[s]:t;return this.read(c,i,n,r)},getNamed:function(t,e){var i=t[0];if(t._hasObject===o&&(t._hasObject=1===t.length&&l.isPlainObject(i)),t._hasObject)return e?i[e]:t.__filtered||i},hasNamed:function(t,e){return!!this.getNamed(t,e)},filter:function(t,e,i,n){var r;function s(n){if(!(i&&n in i||r&&n in r)){var s=e[n];s!==o&&(t[n]=s)}}if(n){for(var a,h={},c=0,l=n.length;c<l;c++)(a=n[c])in e&&(s(a),h[a]=!0);r=h}return Object.keys(e.__unfiltered||e).forEach(s),t},isPlainValue:function(t,e){return l.isPlainObject(t)||Array.isArray(t)||e&&"string"==typeof t},serialize:function(t,e,i,n){e=e||{};var r,s=!n;if(s&&(e.formatter=new p(e.precision),n={length:0,definitions:{},references:{},add:function(t,e){var i="#"+t._id,n=this.references[i];if(!n){this.length++;var r=e.call(t),s=t._class;s&&r[0]!==s&&r.unshift(s),this.definitions[i]=r,n=this.references[i]=[i]}return n}}),t&&t._serialize){r=t._serialize(e,n);var a=t._class;!a||t._compactSerialize||!s&&i||r[0]===a||r.unshift(a)}else if(Array.isArray(t)){r=[];for(var o=0,h=t.length;o<h;o++)r[o]=l.serialize(t[o],e,i,n)}else if(l.isPlainObject(t)){r={};var c=Object.keys(t);for(o=0,h=c.length;o<h;o++){var u=c[o];r[u]=l.serialize(t[u],e,i,n)}}else r="number"==typeof t?e.formatter.number(t,e.precision):t;return s&&n.length>0?[["dictionary",n.definitions],r]:r},deserialize:function(t,e,i,n,r){var s=t,a=!i,o=a&&t&&t.length&&"dictionary"===t[0][0];if(i=i||{},Array.isArray(t)){var h=t[0],c="dictionary"===h;if(1==t.length&&/^#/.test(h))return i.dictionary[h];s=[];for(var u=(h=l.exports[h])?1:0,f=t.length;u<f;u++)s.push(l.deserialize(t[u],e,i,c,o));if(h){var d=s;s=e?e(h,d,a||r):new h(d)}}else if(l.isPlainObject(t))for(var p in s={},n&&(i.dictionary=s),t)s[p]=l.deserialize(t[p],e,i);return o?s[1]:s},exportJSON:function(t,e){var i=l.serialize(t,e);return e&&0==e.asString?i:JSON.stringify(i)},importJSON:function(t,e){return l.deserialize("string"==typeof t?JSON.parse(t):t,function(t,i,n){var r=n&&e&&e.constructor===t,s=r?e:l.create(t.prototype);if(1===i.length&&s instanceof k&&(r||!(s instanceof A))){var a=i[0];l.isPlainObject(a)&&(a.insert=!1)}return(r?s.set:t).apply(s,i),r&&(e=null),s})},push:function(t,e){var i=e.length;if(i<4096)t.push.apply(t,e);else{var n=t.length;t.length+=i;for(var r=0;r<i;r++)t[n+r]=e[r]}return t},splice:function(t,e,i,n){var r=e&&e.length,s=i===o;(i=s?t.length:i)>t.length&&(i=t.length);for(var a=0;a<r;a++)e[a]._index=i+a;if(s)return l.push(t,e),[];var h=[i,n];e&&l.push(h,e);for(var c=t.splice.apply(t,h),u=(a=0,c.length);a<u;a++)c[a]._index=o;for(a=i+r,u=t.length;a<u;a++)t[a]._index=a;return c},capitalize:function(t){return t.replace(/\b[a-z]/g,function(t){return t.toUpperCase()})},camelize:function(t){return t.replace(/-(.)/g,function(t,e){return e.toUpperCase()})},hyphenate:function(t){return t.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}}});var u={on:function(t,e){if("string"!=typeof t)l.each(t,function(t,e){this.on(e,t)},this);else{var i=this._eventTypes,n=i&&i[t],r=this._callbacks=this._callbacks||{};-1===(r=r[t]=r[t]||[]).indexOf(e)&&(r.push(e),n&&n.install&&1===r.length&&n.install.call(this,t))}return this},off:function(t,e){if("string"==typeof t){var i,n=this._eventTypes,r=n&&n[t],s=this._callbacks&&this._callbacks[t];return s&&(!e||-1!==(i=s.indexOf(e))&&1===s.length?(r&&r.uninstall&&r.uninstall.call(this,t),delete this._callbacks[t]):-1!==i&&s.splice(i,1)),this}l.each(t,function(t,e){this.off(e,t)},this)},once:function(t,e){return this.on(t,function(){e.apply(this,arguments),this.off(t,e)})},emit:function(t,e){var i=this._callbacks&&this._callbacks[t];if(!i)return!1;var n=l.slice(arguments,1),r=e&&e.target&&!e.currentTarget;i=i.slice(),r&&(e.currentTarget=this);for(var s=0,a=i.length;s<a;s++)if(0==i[s].apply(this,n)){e&&e.stop&&e.stop();break}return r&&delete e.currentTarget,!0},responds:function(t){return!(!this._callbacks||!this._callbacks[t])},attach:"#on",detach:"#off",fire:"#emit",_installEvents:function(t){var e=this._eventTypes,i=this._callbacks,n=t?"install":"uninstall";if(e)for(var r in i)if(i[r].length>0){var s=e[r],a=s&&s[n];a&&a.call(this,r)}},statics:{inject:function t(e){var i=e._events;if(i){var n={};l.each(i,function(t,i){var r="string"==typeof t,s=r?t:i,a=l.capitalize(s),o=s.substring(2).toLowerCase();n[o]=r?{}:t,s="_"+s,e["get"+a]=function(){return this[s]},e["set"+a]=function(t){var e=this[s];e&&this.off(o,e),t&&this.on(o,t),this[s]=t}}),e._eventTypes=n}return t.base.apply(this,arguments)}}},f=l.extend({_class:"PaperScope",initialize:function t(){lt=this,this.settings=new l({applyMatrix:!0,insertItems:!0,handleSize:4,hitTolerance:0}),this.project=null,this.projects=[],this.tools=[],this._id=t._id++,t._scopes[this._id]=this;var e=t.prototype;if(!this.support){var i=at.getContext(1,1)||{};e.support={nativeDash:"setLineDash"in i||"mozDash"in i,nativeBlendModes:ot.nativeModes},at.release(i)}if(!this.agent){var n=a.navigator.userAgent.toLowerCase(),r=(/(darwin|win|mac|linux|freebsd|sunos)/.exec(n)||[])[0],s="darwin"===r?"mac":r,o=e.agent=e.browser={platform:s};s&&(o[s]=!0),n.replace(/(opera|chrome|safari|webkit|firefox|msie|trident|atom|node)\/?\s*([.\d]+)(?:.*version\/([.\d]+))?(?:.*rv\:v?([.\d]+))?/g,function(t,e,i,n,r){if(!o.chrome){var s="opera"===e?n:/^(node|trident)$/.test(e)?r:i;o.version=s,o.versionNumber=parseFloat(s),e="trident"===e?"msie":e,o.name=e,o[e]=!0}}),o.chrome&&delete o.webkit,o.atom&&delete o.chrome}},version:"0.11.8",getView:function(){var t=this.project;return t&&t._view},getPaper:function(){return this},execute:function(t,e){var i=lt.PaperScript.execute(t,this,e);return $.updateFocus(),i},install:function(t){var e=this;for(var i in l.each(["project","view","tool"],function(i){l.define(t,i,{configurable:!0,get:function(){return e[i]}})}),this)!/^_/.test(i)&&this[i]&&(t[i]=this[i])},setup:function(t){return lt=this,this.project=new T(t),this},createCanvas:function(t,e){return at.getCanvas(t,e)},activate:function(){lt=this},clear:function(){for(var t=this.projects,e=this.tools,i=t.length-1;i>=0;i--)t[i].remove();for(i=e.length-1;i>=0;i--)e[i].remove()},remove:function(){this.clear(),delete f._scopes[this._id]},statics:new function(){function t(t){return t+="Attribute",function(e,i){return e[t](i)||e[t]("data-paper-"+i)}}return{_scopes:{},_id:0,get:function(t){return this._scopes[t]||null},getAttribute:t("get"),hasAttribute:t("has")}}}),d=l.extend(u,{initialize:function(t){this._scope=lt,this._index=this._scope[this._list].push(this)-1,!t&&this._scope[this._reference]||this.activate()},activate:function(){if(!this._scope)return!1;var t=this._scope[this._reference];return t&&t!==this&&t.emit("deactivate"),this._scope[this._reference]=this,this.emit("activate",t),!0},isActive:function(){return this._scope[this._reference]===this},remove:function(){return null!=this._index&&(l.splice(this._scope[this._list],null,this._index,1),this._scope[this._reference]==this&&(this._scope[this._reference]=null),this._scope=null,!0)},getView:function(){return this._scope.getView()}}),p=l.extend({initialize:function(t){this.precision=l.pick(t,5),this.multiplier=Math.pow(10,this.precision)},number:function(t){return this.precision<16?Math.round(t*this.multiplier)/this.multiplier:t},pair:function(t,e,i){return this.number(t)+(i||",")+this.number(e)},point:function(t,e){return this.number(t.x)+(e||",")+this.number(t.y)},size:function(t,e){return this.number(t.width)+(e||",")+this.number(t.height)},rectangle:function(t,e){return this.point(t,e)+(e||",")+this.size(t,e)}});p.instance=new p;var g=new function(){var t=[[.5773502691896257],[0,.7745966692414834],[.33998104358485626,.8611363115940526],[0,.5384693101056831,.906179845938664],[.2386191860831969,.6612093864662645,.932469514203152],[0,.4058451513773972,.7415311855993945,.9491079123427585],[.1834346424956498,.525532409916329,.7966664774136267,.9602898564975363],[0,.3242534234038089,.6133714327005904,.8360311073266358,.9681602395076261],[.14887433898163122,.4333953941292472,.6794095682990244,.8650633666889845,.9739065285171717],[0,.26954315595234496,.5190961292068118,.7301520055740494,.8870625997680953,.978228658146057],[.1252334085114689,.3678314989981802,.5873179542866175,.7699026741943047,.9041172563704749,.9815606342467192],[0,.2304583159551348,.44849275103644687,.6423493394403402,.8015780907333099,.9175983992229779,.9841830547185881],[.10805494870734367,.31911236892788974,.5152486363581541,.6872929048116855,.827201315069765,.9284348836635735,.9862838086968123],[0,.20119409399743451,.3941513470775634,.5709721726085388,.7244177313601701,.8482065834104272,.937273392400706,.9879925180204854],[.09501250983763744,.2816035507792589,.45801677765722737,.6178762444026438,.755404408355003,.8656312023878318,.9445750230732326,.9894009349916499]],e=[[1],[.8888888888888888,.5555555555555556],[.6521451548625461,.34785484513745385],[.5688888888888889,.47862867049936647,.23692688505618908],[.46791393457269104,.3607615730481386,.17132449237917036],[.4179591836734694,.3818300505051189,.27970539148927664,.1294849661688697],[.362683783378362,.31370664587788727,.22238103445337448,.10122853629037626],[.3302393550012598,.31234707704000286,.26061069640293544,.1806481606948574,.08127438836157441],[.29552422471475287,.26926671930999635,.21908636251598204,.1494513491505806,.06667134430868814],[.2729250867779006,.26280454451024665,.23319376459199048,.18629021092773426,.1255803694649046,.05566856711617366],[.24914704581340277,.2334925365383548,.20316742672306592,.16007832854334622,.10693932599531843,.04717533638651183],[.2325515532308739,.22628318026289723,.2078160475368885,.17814598076194574,.13887351021978725,.09212149983772845,.04048400476531588],[.2152638534631578,.2051984637212956,.18553839747793782,.15720316715819355,.12151857068790319,.08015808715976021,.03511946033175186],[.2025782419255613,.19843148532711158,.1861610000155622,.16626920581699392,.13957067792615432,.10715922046717194,.07036604748810812,.03075324199611727],[.1894506104550685,.18260341504492358,.16915651939500254,.14959598881657674,.12462897125553388,.09515851168249279,.062253523938647894,.027152459411754096]],i=Math.abs,n=Math.sqrt,r=Math.pow,s=Math.log2||function(t){return Math.log(t)*Math.LOG2E};function a(t,e,i){return t<e?e:t>i?i:t}function o(t,e,n){function r(t){var e=134217729*t,i=t-e+e;return[i,t-i]}var s=e*e-t*n,a=e*e+t*n;if(3*i(s)<a){var o=r(t),h=r(e),c=r(n),l=e*e,u=t*n;s=l-u+(h[0]*h[0]-l+2*h[0]*h[1]+h[1]*h[1]-(o[0]*c[0]-u+o[0]*c[1]+o[1]*c[0]+o[1]*c[1]))}return s}function h(){var t=Math.max.apply(Math,arguments);return t&&(t<1e-8||t>1e8)?r(2,-Math.round(s(t))):0}return{EPSILON:1e-12,MACHINE_EPSILON:1.12e-16,CURVETIME_EPSILON:1e-8,GEOMETRIC_EPSILON:1e-7,TRIGONOMETRIC_EPSILON:1e-8,KAPPA:4*(n(2)-1)/3,isZero:function(t){return t>=-1e-12&&t<=1e-12},clamp:a,integrate:function(i,n,r,s){for(var a=t[s-2],o=e[s-2],h=.5*(r-n),c=h+n,l=0,u=s+1>>1,f=1&s?o[l++]*i(c):0;l<u;){var d=h*a[l];f+=o[l++]*(i(c+d)+i(c-d))}return h*f},findRoot:function(t,e,n,r,s,o,h){for(var c=0;c<o;c++){var l=t(n),u=l/e(n),f=n-u;if(i(u)<h){n=f;break}l>0?(s=n,n=f<=r?.5*(r+s):f):(r=n,n=f>=s?.5*(r+s):f)}return a(n,r,s)},solveQuadratic:function(t,e,r,s,c,l){var u,f=1/0;if(i(t)<1e-12){if(i(e)<1e-12)return i(r)<1e-12?-1:0;u=-r/e}else{var d=o(t,e*=-.5,r);if(d&&i(d)<1.12e-16){var p=h(i(t),i(e),i(r));p&&(d=o(t*=p,e*=p,r*=p))}if(d>=-1.12e-16){var g=d<0?0:n(d),v=e+(e<0?-g:g);0===v?f=-(u=r/t):(u=v/t,f=r/v)}}var _=0,m=null==c,y=c-1e-12,x=l+1e-12;return isFinite(u)&&(m||u>y&&u<x)&&(s[_++]=m?u:a(u,c,l)),f!==u&&isFinite(f)&&(m||f>y&&f<x)&&(s[_++]=m?f:a(f,c,l)),_},solveCubic:function(t,e,s,o,c,l,u){var f,d,p,v,_,m=h(i(t),i(e),i(s),i(o));function y(i){var n=t*(f=i);v=(n+(d=n+e))*f+(p=d*f+s),_=p*f+o}if(m&&(t*=m,e*=m,s*=m,o*=m),i(t)<1e-12)t=e,d=s,p=o,f=1/0;else if(i(o)<1e-12)d=e,p=s,f=0;else{y(-e/t/3);var x=_/t,b=r(i(x),1/3),w=x<0?-1:1,C=-v/t,S=C>0?1.324717957244746*Math.max(b,n(C)):b,T=f-w*S;if(T!==f){do{y(T),T=0===v?f:f-_/v/(1+1.12e-16)}while(w*T>w*f);i(t)*f*f>i(o/f)&&(d=((p=-o/f)-s)/f)}}var k=g.solveQuadratic(t,d,p,c,l,u),O=null==l;return isFinite(f)&&(0===k||k>0&&f!==c[0]&&f!==c[1])&&(O||f>l-1e-12&&f<u+1e-12)&&(c[k++]=O?f:a(f,l,u)),k}}},v={_id:1,_pools:{},get:function(t){if(t){var e=this._pools[t];return e||(e=this._pools[t]={_id:1}),e._id++}return this._id++}},_=l.extend({_class:"Point",_readIndex:!0,initialize:function(t,e){var i=typeof t,n=this.__read,r=0;if("number"===i){var s="number"==typeof e;this._set(t,s?e:t),n&&(r=s?2:1)}else if("undefined"===i||null===t)this._set(0,0),n&&(r=null===t?1:0);else{var a="string"===i?t.split(/[\s,]+/)||[]:t;r=1,Array.isArray(a)?this._set(+a[0],+(a.length>1?a[1]:a[0])):"x"in a?this._set(a.x||0,a.y||0):"width"in a?this._set(a.width||0,a.height||0):"angle"in a?(this._set(a.length||0,0),this.setAngle(a.angle||0)):(this._set(0,0),r=0)}return n&&(this.__read=r),this},set:"#initialize",_set:function(t,e){return this.x=t,this.y=e,this},equals:function(t){return this===t||t&&(this.x===t.x&&this.y===t.y||Array.isArray(t)&&this.x===t[0]&&this.y===t[1])||!1},clone:function(){return new _(this.x,this.y)},toString:function(){var t=p.instance;return"{ x: "+t.number(this.x)+", y: "+t.number(this.y)+" }"},_serialize:function(t){var e=t.formatter;return[e.number(this.x),e.number(this.y)]},getLength:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},setLength:function(t){if(this.isZero()){var e=this._angle||0;this._set(Math.cos(e)*t,Math.sin(e)*t)}else{var i=t/this.getLength();g.isZero(i)&&this.getAngle(),this._set(this.x*i,this.y*i)}},getAngle:function(){return 180*this.getAngleInRadians.apply(this,arguments)/Math.PI},setAngle:function(t){this.setAngleInRadians.call(this,t*Math.PI/180)},getAngleInDegrees:"#getAngle",setAngleInDegrees:"#setAngle",getAngleInRadians:function(){if(arguments.length){var t=_.read(arguments),e=this.getLength()*t.getLength();if(g.isZero(e))return NaN;var i=this.dot(t)/e;return Math.acos(i<-1?-1:i>1?1:i)}return this.isZero()?this._angle||0:this._angle=Math.atan2(this.y,this.x)},setAngleInRadians:function(t){if(this._angle=t,!this.isZero()){var e=this.getLength();this._set(Math.cos(t)*e,Math.sin(t)*e)}},getQuadrant:function(){return this.x>=0?this.y>=0?1:4:this.y>=0?2:3}},{beans:!1,getDirectedAngle:function(){var t=_.read(arguments);return 180*Math.atan2(this.cross(t),this.dot(t))/Math.PI},getDistance:function(){var t=_.read(arguments),e=t.x-this.x,i=t.y-this.y,n=e*e+i*i;return l.read(arguments)?n:Math.sqrt(n)},normalize:function(t){t===o&&(t=1);var e=this.getLength(),i=0!==e?t/e:0,n=new _(this.x*i,this.y*i);return i>=0&&(n._angle=this._angle),n},rotate:function(t,e){if(0===t)return this.clone();t=t*Math.PI/180;var i=e?this.subtract(e):this,n=Math.sin(t),r=Math.cos(t);return i=new _(i.x*r-i.y*n,i.x*n+i.y*r),e?i.add(e):i},transform:function(t){return t?t._transformPoint(this):this},add:function(){var t=_.read(arguments);return new _(this.x+t.x,this.y+t.y)},subtract:function(){var t=_.read(arguments);return new _(this.x-t.x,this.y-t.y)},multiply:function(){var t=_.read(arguments);return new _(this.x*t.x,this.y*t.y)},divide:function(){var t=_.read(arguments);return new _(this.x/t.x,this.y/t.y)},modulo:function(){var t=_.read(arguments);return new _(this.x%t.x,this.y%t.y)},negate:function(){return new _(-this.x,-this.y)},isInside:function(){return b.read(arguments).contains(this)},isClose:function(){var t=_.read(arguments),e=l.read(arguments);return this.getDistance(t)<=e},isCollinear:function(){var t=_.read(arguments);return _.isCollinear(this.x,this.y,t.x,t.y)},isColinear:"#isCollinear",isOrthogonal:function(){var t=_.read(arguments);return _.isOrthogonal(this.x,this.y,t.x,t.y)},isZero:function(){var t=g.isZero;return t(this.x)&&t(this.y)},isNaN:function(){return isNaN(this.x)||isNaN(this.y)},isInQuadrant:function(t){return this.x*(t>1&&t<4?-1:1)>=0&&this.y*(t>2?-1:1)>=0},dot:function(){var t=_.read(arguments);return this.x*t.x+this.y*t.y},cross:function(){var t=_.read(arguments);return this.x*t.y-this.y*t.x},project:function(){var t=_.read(arguments),e=t.isZero()?0:this.dot(t)/t.dot(t);return new _(t.x*e,t.y*e)},statics:{min:function(){var t=_.read(arguments),e=_.read(arguments);return new _(Math.min(t.x,e.x),Math.min(t.y,e.y))},max:function(){var t=_.read(arguments),e=_.read(arguments);return new _(Math.max(t.x,e.x),Math.max(t.y,e.y))},random:function(){return new _(Math.random(),Math.random())},isCollinear:function(t,e,i,n){return Math.abs(t*n-e*i)<=1e-8*Math.sqrt((t*t+e*e)*(i*i+n*n))},isOrthogonal:function(t,e,i,n){return Math.abs(t*i+e*n)<=1e-8*Math.sqrt((t*t+e*e)*(i*i+n*n))}}},l.each(["round","ceil","floor","abs"],function(t){var e=Math[t];this[t]=function(){return new _(e(this.x),e(this.y))}},{})),m=_.extend({initialize:function(t,e,i,n){this._x=t,this._y=e,this._owner=i,this._setter=n},_set:function(t,e,i){return this._x=t,this._y=e,i||this._owner[this._setter](this),this},getX:function(){return this._x},setX:function(t){this._x=t,this._owner[this._setter](this)},getY:function(){return this._y},setY:function(t){this._y=t,this._owner[this._setter](this)},isSelected:function(){return!!(this._owner._selection&this._getSelection())},setSelected:function(t){this._owner._changeSelection(this._getSelection(),t)},_getSelection:function(){return"setPosition"===this._setter?4:0}}),y=l.extend({_class:"Size",_readIndex:!0,initialize:function(t,e){var i=typeof t,n=this.__read,r=0;if("number"===i){var s="number"==typeof e;this._set(t,s?e:t),n&&(r=s?2:1)}else if("undefined"===i||null===t)this._set(0,0),n&&(r=null===t?1:0);else{var a="string"===i?t.split(/[\s,]+/)||[]:t;r=1,Array.isArray(a)?this._set(+a[0],+(a.length>1?a[1]:a[0])):"width"in a?this._set(a.width||0,a.height||0):"x"in a?this._set(a.x||0,a.y||0):(this._set(0,0),r=0)}return n&&(this.__read=r),this},set:"#initialize",_set:function(t,e){return this.width=t,this.height=e,this},equals:function(t){return t===this||t&&(this.width===t.width&&this.height===t.height||Array.isArray(t)&&this.width===t[0]&&this.height===t[1])||!1},clone:function(){return new y(this.width,this.height)},toString:function(){var t=p.instance;return"{ width: "+t.number(this.width)+", height: "+t.number(this.height)+" }"},_serialize:function(t){var e=t.formatter;return[e.number(this.width),e.number(this.height)]},add:function(){var t=y.read(arguments);return new y(this.width+t.width,this.height+t.height)},subtract:function(){var t=y.read(arguments);return new y(this.width-t.width,this.height-t.height)},multiply:function(){var t=y.read(arguments);return new y(this.width*t.width,this.height*t.height)},divide:function(){var t=y.read(arguments);return new y(this.width/t.width,this.height/t.height)},modulo:function(){var t=y.read(arguments);return new y(this.width%t.width,this.height%t.height)},negate:function(){return new y(-this.width,-this.height)},isZero:function(){var t=g.isZero;return t(this.width)&&t(this.height)},isNaN:function(){return isNaN(this.width)||isNaN(this.height)},statics:{min:function(t,e){return new y(Math.min(t.width,e.width),Math.min(t.height,e.height))},max:function(t,e){return new y(Math.max(t.width,e.width),Math.max(t.height,e.height))},random:function(){return new y(Math.random(),Math.random())}}},l.each(["round","ceil","floor","abs"],function(t){var e=Math[t];this[t]=function(){return new y(e(this.width),e(this.height))}},{})),x=y.extend({initialize:function(t,e,i,n){this._width=t,this._height=e,this._owner=i,this._setter=n},_set:function(t,e,i){return this._width=t,this._height=e,i||this._owner[this._setter](this),this},getWidth:function(){return this._width},setWidth:function(t){this._width=t,this._owner[this._setter](this)},getHeight:function(){return this._height},setHeight:function(t){this._height=t,this._owner[this._setter](this)}}),b=l.extend({_class:"Rectangle",_readIndex:!0,beans:!0,initialize:function(t,e,i,n){var r,s=typeof t;if("number"===s?(this._set(t,e,i,n),r=4):"undefined"===s||null===t?(this._set(0,0,0,0),r=null===t?1:0):1===arguments.length&&(Array.isArray(t)?(this._set.apply(this,t),r=1):t.x!==o||t.width!==o?(this._set(t.x||0,t.y||0,t.width||0,t.height||0),r=1):t.from===o&&t.to===o&&(this._set(0,0,0,0),l.filter(this,t),r=1)),r===o){var a,h,c=_.readNamed(arguments,"from"),u=l.peek(arguments),f=c.x,d=c.y;if(u&&u.x!==o||l.hasNamed(arguments,"to")){var p=_.readNamed(arguments,"to");a=p.x-f,h=p.y-d,a<0&&(f=p.x,a=-a),h<0&&(d=p.y,h=-h)}else{var g=y.read(arguments);a=g.width,h=g.height}this._set(f,d,a,h),r=arguments.__index;var v=arguments.__filtered;v&&(this.__filtered=v)}return this.__read&&(this.__read=r),this},set:"#initialize",_set:function(t,e,i,n){return this.x=t,this.y=e,this.width=i,this.height=n,this},clone:function(){return new b(this.x,this.y,this.width,this.height)},equals:function(t){var e=l.isPlainValue(t)?b.read(arguments):t;return e===this||e&&this.x===e.x&&this.y===e.y&&this.width===e.width&&this.height===e.height||!1},toString:function(){var t=p.instance;return"{ x: "+t.number(this.x)+", y: "+t.number(this.y)+", width: "+t.number(this.width)+", height: "+t.number(this.height)+" }"},_serialize:function(t){var e=t.formatter;return[e.number(this.x),e.number(this.y),e.number(this.width),e.number(this.height)]},getPoint:function(t){return new(t?_:m)(this.x,this.y,this,"setPoint")},setPoint:function(){var t=_.read(arguments);this.x=t.x,this.y=t.y},getSize:function(t){return new(t?y:x)(this.width,this.height,this,"setSize")},_fw:1,_fh:1,setSize:function(){var t=y.read(arguments),e=this._sx,i=this._sy,n=t.width,r=t.height;e&&(this.x+=(this.width-n)*e),i&&(this.y+=(this.height-r)*i),this.width=n,this.height=r,this._fw=this._fh=1},getLeft:function(){return this.x},setLeft:function(t){if(!this._fw){var e=t-this.x;this.width-=.5===this._sx?2*e:e}this.x=t,this._sx=this._fw=0},getTop:function(){return this.y},setTop:function(t){if(!this._fh){var e=t-this.y;this.height-=.5===this._sy?2*e:e}this.y=t,this._sy=this._fh=0},getRight:function(){return this.x+this.width},setRight:function(t){if(!this._fw){var e=t-this.x;this.width=.5===this._sx?2*e:e}this.x=t-this.width,this._sx=1,this._fw=0},getBottom:function(){return this.y+this.height},setBottom:function(t){if(!this._fh){var e=t-this.y;this.height=.5===this._sy?2*e:e}this.y=t-this.height,this._sy=1,this._fh=0},getCenterX:function(){return this.x+this.width/2},setCenterX:function(t){this._fw||.5===this._sx?this.x=t-this.width/2:(this._sx&&(this.x+=2*(t-this.x)*this._sx),this.width=2*(t-this.x)),this._sx=.5,this._fw=0},getCenterY:function(){return this.y+this.height/2},setCenterY:function(t){this._fh||.5===this._sy?this.y=t-this.height/2:(this._sy&&(this.y+=2*(t-this.y)*this._sy),this.height=2*(t-this.y)),this._sy=.5,this._fh=0},getCenter:function(t){return new(t?_:m)(this.getCenterX(),this.getCenterY(),this,"setCenter")},setCenter:function(){var t=_.read(arguments);return this.setCenterX(t.x),this.setCenterY(t.y),this},getArea:function(){return this.width*this.height},isEmpty:function(){return 0===this.width||0===this.height},contains:function(t){return t&&t.width!==o||4===(Array.isArray(t)?t:arguments).length?this._containsRectangle(b.read(arguments)):this._containsPoint(_.read(arguments))},_containsPoint:function(t){var e=t.x,i=t.y;return e>=this.x&&i>=this.y&&e<=this.x+this.width&&i<=this.y+this.height},_containsRectangle:function(t){var e=t.x,i=t.y;return e>=this.x&&i>=this.y&&e+t.width<=this.x+this.width&&i+t.height<=this.y+this.height},intersects:function(){var t=b.read(arguments),e=l.read(arguments)||0;return t.x+t.width>this.x-e&&t.y+t.height>this.y-e&&t.x<this.x+this.width+e&&t.y<this.y+this.height+e},intersect:function(){var t=b.read(arguments),e=Math.max(this.x,t.x),i=Math.max(this.y,t.y),n=Math.min(this.x+this.width,t.x+t.width),r=Math.min(this.y+this.height,t.y+t.height);return new b(e,i,n-e,r-i)},unite:function(){var t=b.read(arguments),e=Math.min(this.x,t.x),i=Math.min(this.y,t.y),n=Math.max(this.x+this.width,t.x+t.width),r=Math.max(this.y+this.height,t.y+t.height);return new b(e,i,n-e,r-i)},include:function(){var t=_.read(arguments),e=Math.min(this.x,t.x),i=Math.min(this.y,t.y),n=Math.max(this.x+this.width,t.x),r=Math.max(this.y+this.height,t.y);return new b(e,i,n-e,r-i)},expand:function(){var t=y.read(arguments),e=t.width,i=t.height;return new b(this.x-e/2,this.y-i/2,this.width+e,this.height+i)},scale:function(t,e){return this.expand(this.width*t-this.width,this.height*(e===o?t:e)-this.height)}},l.each([["Top","Left"],["Top","Right"],["Bottom","Left"],["Bottom","Right"],["Left","Center"],["Top","Center"],["Right","Center"],["Bottom","Center"]],function(t,e){var i=t.join(""),n=/^[RL]/.test(i);e>=4&&(t[1]+=n?"Y":"X");var r=t[n?0:1],s=t[n?1:0],a="get"+r,o="get"+s,h="set"+r,c="set"+s,l="set"+i;this["get"+i]=function(t){return new(t?_:m)(this[a](),this[o](),this,l)},this[l]=function(){var t=_.read(arguments);this[h](t.x),this[c](t.y)}},{beans:!0})),w=b.extend({initialize:function(t,e,i,n,r,s){this._set(t,e,i,n,!0),this._owner=r,this._setter=s},_set:function(t,e,i,n,r){return this._x=t,this._y=e,this._width=i,this._height=n,r||this._owner[this._setter](this),this}},new function(){var t=b.prototype;return l.each(["x","y","width","height"],function(t){var e=l.capitalize(t),i="_"+t;this["get"+e]=function(){return this[i]},this["set"+e]=function(t){this[i]=t,this._dontNotify||this._owner[this._setter](this)}},l.each(["Point","Size","Center","Left","Top","Right","Bottom","CenterX","CenterY","TopLeft","TopRight","BottomLeft","BottomRight","LeftCenter","TopCenter","RightCenter","BottomCenter"],function(e){var i="set"+e;this[i]=function(){this._dontNotify=!0,t[i].apply(this,arguments),this._dontNotify=!1,this._owner[this._setter](this)}},{isSelected:function(){return!!(2&this._owner._selection)},setSelected:function(t){var e=this._owner;e._changeSelection&&e._changeSelection(2,t)}}))}),C=l.extend({_class:"Matrix",initialize:function t(e,i){var n=arguments.length,r=!0;if(n>=6?this._set.apply(this,arguments):1===n||2===n?e instanceof t?this._set(e._a,e._b,e._c,e._d,e._tx,e._ty,i):Array.isArray(e)?this._set.apply(this,i?e.concat([i]):e):r=!1:n?r=!1:this.reset(),!r)throw new Error("Unsupported matrix parameters");return this},set:"#initialize",_set:function(t,e,i,n,r,s,a){return this._a=t,this._b=e,this._c=i,this._d=n,this._tx=r,this._ty=s,a||this._changed(),this},_serialize:function(t,e){return l.serialize(this.getValues(),t,!0,e)},_changed:function(){var t=this._owner;t&&(t._applyMatrix?t.transform(null,!0):t._changed(25))},clone:function(){return new C(this._a,this._b,this._c,this._d,this._tx,this._ty)},equals:function(t){return t===this||t&&this._a===t._a&&this._b===t._b&&this._c===t._c&&this._d===t._d&&this._tx===t._tx&&this._ty===t._ty},toString:function(){var t=p.instance;return"[["+[t.number(this._a),t.number(this._c),t.number(this._tx)].join(", ")+"], ["+[t.number(this._b),t.number(this._d),t.number(this._ty)].join(", ")+"]]"},reset:function(t){return this._a=this._d=1,this._b=this._c=this._tx=this._ty=0,t||this._changed(),this},apply:function(t,e){var i=this._owner;return!!i&&(i.transform(null,!0,l.pick(t,!0),e),this.isIdentity())},translate:function(){var t=_.read(arguments),e=t.x,i=t.y;return this._tx+=e*this._a+i*this._c,this._ty+=e*this._b+i*this._d,this._changed(),this},scale:function(){var t=_.read(arguments),e=_.read(arguments,0,{readNull:!0});return e&&this.translate(e),this._a*=t.x,this._b*=t.x,this._c*=t.y,this._d*=t.y,e&&this.translate(e.negate()),this._changed(),this},rotate:function(t){t*=Math.PI/180;var e=_.read(arguments,1),i=e.x,n=e.y,r=Math.cos(t),s=Math.sin(t),a=i-i*r+n*s,o=n-i*s-n*r,h=this._a,c=this._b,l=this._c,u=this._d;return this._a=r*h+s*l,this._b=r*c+s*u,this._c=-s*h+r*l,this._d=-s*c+r*u,this._tx+=a*h+o*l,this._ty+=a*c+o*u,this._changed(),this},shear:function(){var t=_.read(arguments),e=_.read(arguments,0,{readNull:!0});e&&this.translate(e);var i=this._a,n=this._b;return this._a+=t.y*this._c,this._b+=t.y*this._d,this._c+=t.x*i,this._d+=t.x*n,e&&this.translate(e.negate()),this._changed(),this},skew:function(){var t=_.read(arguments),e=_.read(arguments,0,{readNull:!0}),i=Math.PI/180,n=new _(Math.tan(t.x*i),Math.tan(t.y*i));return this.shear(n,e)},append:function(t,e){if(t){var i=this._a,n=this._b,r=this._c,s=this._d,a=t._a,o=t._c,h=t._b,c=t._d,l=t._tx,u=t._ty;this._a=a*i+h*r,this._c=o*i+c*r,this._b=a*n+h*s,this._d=o*n+c*s,this._tx+=l*i+u*r,this._ty+=l*n+u*s,e||this._changed()}return this},prepend:function(t,e){if(t){var i=this._a,n=this._b,r=this._c,s=this._d,a=this._tx,o=this._ty,h=t._a,c=t._c,l=t._b,u=t._d,f=t._tx,d=t._ty;this._a=h*i+c*n,this._c=h*r+c*s,this._b=l*i+u*n,this._d=l*r+u*s,this._tx=h*a+c*o+f,this._ty=l*a+u*o+d,e||this._changed()}return this},appended:function(t){return this.clone().append(t)},prepended:function(t){return this.clone().prepend(t)},invert:function(){var t=this._a,e=this._b,i=this._c,n=this._d,r=this._tx,s=this._ty,a=t*n-e*i,o=null;return a&&!isNaN(a)&&isFinite(r)&&isFinite(s)&&(this._a=n/a,this._b=-e/a,this._c=-i/a,this._d=t/a,this._tx=(i*s-n*r)/a,this._ty=(e*r-t*s)/a,o=this),o},inverted:function(){return this.clone().invert()},concatenate:"#append",preConcatenate:"#prepend",chain:"#appended",_shiftless:function(){return new C(this._a,this._b,this._c,this._d,0,0)},_orNullIfIdentity:function(){return this.isIdentity()?null:this},isIdentity:function(){return 1===this._a&&0===this._b&&0===this._c&&1===this._d&&0===this._tx&&0===this._ty},isInvertible:function(){var t=this._a*this._d-this._c*this._b;return t&&!isNaN(t)&&isFinite(this._tx)&&isFinite(this._ty)},isSingular:function(){return!this.isInvertible()},transform:function(t,e,i){return arguments.length<3?this._transformPoint(_.read(arguments)):this._transformCoordinates(t,e,i)},_transformPoint:function(t,e,i){var n=t.x,r=t.y;return e||(e=new _),e._set(n*this._a+r*this._c+this._tx,n*this._b+r*this._d+this._ty,i)},_transformCoordinates:function(t,e,i){for(var n=0,r=2*i;n<r;n+=2){var s=t[n],a=t[n+1];e[n]=s*this._a+a*this._c+this._tx,e[n+1]=s*this._b+a*this._d+this._ty}return e},_transformCorners:function(t){var e=t.x,i=t.y,n=e+t.width,r=i+t.height,s=[e,i,n,i,n,r,e,r];return this._transformCoordinates(s,s,4)},_transformBounds:function(t,e,i){for(var n=this._transformCorners(t),r=n.slice(0,2),s=r.slice(),a=2;a<8;a++){var o=n[a],h=1&a;o<r[h]?r[h]=o:o>s[h]&&(s[h]=o)}return e||(e=new b),e._set(r[0],r[1],s[0]-r[0],s[1]-r[1],i)},inverseTransform:function(){return this._inverseTransform(_.read(arguments))},_inverseTransform:function(t,e,i){var n=this._a,r=this._b,s=this._c,a=this._d,o=this._tx,h=this._ty,c=n*a-r*s,l=null;if(c&&!isNaN(c)&&isFinite(o)&&isFinite(h)){var u=t.x-this._tx,f=t.y-this._ty;e||(e=new _),l=e._set((u*a-f*s)/c,(f*n-u*r)/c,i)}return l},decompose:function(){var t,e,i,n=this._a,r=this._b,s=this._c,a=this._d,o=n*a-r*s,h=Math.sqrt,c=Math.atan2,l=180/Math.PI;if(0!==n||0!==r){var u=h(n*n+r*r);t=Math.acos(n/u)*(r>0?1:-1),e=[u,o/u],i=[c(n*s+r*a,u*u),0]}else if(0!==s||0!==a){var f=h(s*s+a*a);t=Math.asin(s/f)*(a>0?1:-1),e=[o/f,f],i=[0,c(n*s+r*a,f*f)]}else t=0,i=e=[0,0];return{translation:this.getTranslation(),rotation:t*l,scaling:new _(e),skewing:new _(i[0]*l,i[1]*l)}},getValues:function(){return[this._a,this._b,this._c,this._d,this._tx,this._ty]},getTranslation:function(){return new _(this._tx,this._ty)},getScaling:function(){return(this.decompose()||{}).scaling},getRotation:function(){return(this.decompose()||{}).rotation},applyToContext:function(t){this.isIdentity()||t.transform(this._a,this._b,this._c,this._d,this._tx,this._ty)}},l.each(["a","b","c","d","tx","ty"],function(t){var e=l.capitalize(t),i="_"+t;this["get"+e]=function(){return this[i]},this["set"+e]=function(t){this[i]=t,this._changed()}},{})),S=l.extend({_class:"Line",initialize:function(t,e,i,n,r){var s=!1;arguments.length>=4?(this._px=t,this._py=e,this._vx=i,this._vy=n,s=r):(this._px=t.x,this._py=t.y,this._vx=e.x,this._vy=e.y,s=i),s||(this._vx-=this._px,this._vy-=this._py)},getPoint:function(){return new _(this._px,this._py)},getVector:function(){return new _(this._vx,this._vy)},getLength:function(){return this.getVector().getLength()},intersect:function(t,e){return S.intersect(this._px,this._py,this._vx,this._vy,t._px,t._py,t._vx,t._vy,!0,e)},getSide:function(t,e){return S.getSide(this._px,this._py,this._vx,this._vy,t.x,t.y,!0,e)},getDistance:function(t){return Math.abs(this.getSignedDistance(t))},getSignedDistance:function(t){return S.getSignedDistance(this._px,this._py,this._vx,this._vy,t.x,t.y,!0)},isCollinear:function(t){return _.isCollinear(this._vx,this._vy,t._vx,t._vy)},isOrthogonal:function(t){return _.isOrthogonal(this._vx,this._vy,t._vx,t._vy)},statics:{intersect:function(t,e,i,n,r,s,a,o,h,c){h||(i-=t,n-=e,a-=r,o-=s);var l=i*o-n*a;if(!g.isZero(l)){var u=t-r,f=e-s,d=(a*f-o*u)/l,p=(i*f-n*u)/l;if(c||-1e-12<d&&d<1+1e-12&&-1e-12<p&&p<1+1e-12)return c||(d=d<=0?0:d>=1?1:d),new _(t+d*i,e+d*n)}},getSide:function(t,e,i,n,r,s,a,o){a||(i-=t,n-=e);var h=r-t,c=h*n-(s-e)*i;return!o&&g.isZero(c)&&(c=(h*i+h*i)/(i*i+n*n))>=0&&c<=1&&(c=0),c<0?-1:c>0?1:0},getSignedDistance:function(t,e,i,n,r,s,a){return a||(i-=t,n-=e),0===i?n>0?r-t:t-r:0===n?i<0?s-e:e-s:((r-t)*n-(s-e)*i)/Math.sqrt(i*i+n*n)},getDistance:function(t,e,i,n,r,s,a){return Math.abs(S.getSignedDistance(t,e,i,n,r,s,a))}}}),T=d.extend({_class:"Project",_list:"projects",_reference:"project",_compactSerialize:!0,initialize:function(t){d.call(this,!0),this._children=[],this._namedChildren={},this._activeLayer=null,this._currentStyle=new q(null,null,this),this._view=$.create(this,t||at.getCanvas(1,1)),this._selectionItems={},this._selectionCount=0,this._updateVersion=0},_serialize:function(t,e){return l.serialize(this._children,t,!0,e)},_changed:function(t,e){if(1&t){var i=this._view;i&&(i._needsUpdate=!0,!i._requested&&i._autoUpdate&&i.requestUpdate())}var n=this._changes;if(n&&e){var r=this._changesById,s=e._id,a=r[s];a?a.flags|=t:n.push(r[s]={item:e,flags:t})}},clear:function(){for(var t=this._children,e=t.length-1;e>=0;e--)t[e].remove()},isEmpty:function(){return!this._children.length},remove:function t(){return!!t.base.call(this)&&(this._view&&this._view.remove(),!0)},getView:function(){return this._view},getCurrentStyle:function(){return this._currentStyle},setCurrentStyle:function(t){this._currentStyle.set(t)},getIndex:function(){return this._index},getOptions:function(){return this._scope.settings},getLayers:function(){return this._children},getActiveLayer:function(){return this._activeLayer||new A({project:this,insert:!0})},getSymbolDefinitions:function(){var t=[],e={};return this.getItems({class:M,match:function(i){var n=i._definition,r=n._id;return e[r]||(e[r]=!0,t.push(n)),!1}}),t},getSymbols:"getSymbolDefinitions",getSelectedItems:function(){var t=this._selectionItems,e=[];for(var i in t){var n=t[i],r=n._selection;1&r&&n.isInserted()?e.push(n):r||this._updateSelection(n)}return e},_updateSelection:function(t){var e=t._id,i=this._selectionItems;t._selection?i[e]!==t&&(this._selectionCount++,i[e]=t):i[e]===t&&(this._selectionCount--,delete i[e])},selectAll:function(){for(var t=this._children,e=0,i=t.length;e<i;e++)t[e].setFullySelected(!0)},deselectAll:function(){var t=this._selectionItems;for(var e in t)t[e].setFullySelected(!1)},addLayer:function(t){return this.insertLayer(o,t)},insertLayer:function(t,e){if(e instanceof A){e._remove(!1,!0),l.splice(this._children,[e],t,0),e._setProject(this,!0);var i=e._name;i&&e.setName(i),this._changes&&e._changed(5),this._activeLayer||(this._activeLayer=e)}else e=null;return e},_insertItem:function(t,e,i){return e=this.insertLayer(t,e)||(this._activeLayer||this._insertItem(o,new A(k.NO_INSERT),!0)).insertChild(t,e),i&&e.activate&&e.activate(),e},getItems:function(t){return k._getItems(this,t)},getItem:function(t){return k._getItems(this,t,null,null,!0)[0]||null},importJSON:function(t){this.activate();var e=this._activeLayer;return l.importJSON(t,e&&e.isEmpty()&&e)},removeOn:function(t){var e=this._removeSets;if(e){"mouseup"===t&&(e.mousedrag=null);var i=e[t];if(i){for(var n in i){var r=i[n];for(var s in e){var a=e[s];a&&a!=i&&delete a[r._id]}r.remove()}e[t]=null}}},draw:function(t,e,i){this._updateVersion++,t.save(),e.applyToContext(t);for(var n=this._children,r=new l({offset:new _(0,0),pixelRatio:i,viewMatrix:e.isIdentity()?null:e,matrices:[new C],updateMatrix:!0}),s=0,a=n.length;s<a;s++)n[s].draw(t,r);if(t.restore(),this._selectionCount>0){t.save(),t.strokeWidth=1;var o=this._selectionItems,h=this._scope.settings.handleSize,c=this._updateVersion;for(var u in o)o[u]._drawSelection(t,e,h,o,c);t.restore()}}}),k=l.extend(u,{statics:{extend:function t(e){return e._serializeFields&&(e._serializeFields=l.set({},this.prototype._serializeFields,e._serializeFields)),t.base.apply(this,arguments)},NO_INSERT:{insert:!1}},_class:"Item",_name:null,_applyMatrix:!0,_canApplyMatrix:!0,_canScaleStroke:!1,_pivot:null,_visible:!0,_blendMode:"normal",_opacity:1,_locked:!1,_guide:!1,_clipMask:!1,_selection:0,_selectBounds:!0,_selectChildren:!1,_serializeFields:{name:null,applyMatrix:null,matrix:new C,pivot:null,visible:!0,blendMode:"normal",opacity:1,locked:!1,guide:!1,clipMask:!1,selected:!1,data:{}},_prioritize:["applyMatrix"]},new function(){var t=["onMouseDown","onMouseUp","onMouseDrag","onClick","onDoubleClick","onMouseMove","onMouseEnter","onMouseLeave"];return l.each(t,function(t){this._events[t]={install:function(t){this.getView()._countItemEvent(t,1)},uninstall:function(t){this.getView()._countItemEvent(t,-1)}}},{_events:{onFrame:{install:function(){this.getView()._animateItem(this,!0)},uninstall:function(){this.getView()._animateItem(this,!1)}},onLoad:{},onError:{}},statics:{_itemHandlers:t}})},{initialize:function(){},_initialize:function(t,e){var i=t&&l.isPlainObject(t),n=i&&!0===t.internal,r=this._matrix=new C,s=i&&t.project||lt.project,a=lt.settings;return this._id=n?null:v.get(),this._parent=this._index=null,this._applyMatrix=this._canApplyMatrix&&a.applyMatrix,e&&r.translate(e),r._owner=this,this._style=new q(s._currentStyle,this,s),n||i&&0==t.insert||!a.insertItems&&(!i||!0!==t.insert)?this._setProject(s):(i&&t.parent||s)._insertItem(o,this,!0),i&&t!==k.NO_INSERT&&this.set(t,{internal:!0,insert:!0,project:!0,parent:!0}),i},_serialize:function(t,e){var i={},n=this;function r(r){for(var s in r){var a=n[s];l.equals(a,"leading"===s?1.2*r.fontSize:r[s])||(i[s]=l.serialize(a,t,"data"!==s,e))}}return r(this._serializeFields),this instanceof O||r(this._style._defaults),[this._class,i]},_changed:function(t){var e=this._symbol,i=this._parent||e,n=this._project;8&t&&(this._bounds=this._position=this._decomposed=o),16&t&&(this._globalMatrix=o),i&&72&t&&k._clearBoundsCache(i),2&t&&k._clearBoundsCache(this),n&&n._changed(t,this),e&&e._changed(t)},getId:function(){return this._id},getName:function(){return this._name},setName:function(t){if(this._name&&this._removeNamed(),t===+t+"")throw new Error("Names consisting only of numbers are not supported.");var e=this._getOwner();if(t&&e){var i=e._children,n=e._namedChildren;(n[t]=n[t]||[]).push(this),t in i||(i[t]=this)}this._name=t||o,this._changed(256)},getStyle:function(){return this._style},setStyle:function(t){this.getStyle().set(t)}},l.each(["locked","visible","blendMode","opacity","guide"],function(t){var e=l.capitalize(t),i="_"+t,n={locked:256,visible:265};this["get"+e]=function(){return this[i]},this["set"+e]=function(e){e!=this[i]&&(this[i]=e,this._changed(n[t]||257))}},{}),{beans:!0,getSelection:function(){return this._selection},setSelection:function(t){if(t!==this._selection){this._selection=t;var e=this._project;e&&(e._updateSelection(this),this._changed(257))}},_changeSelection:function(t,e){var i=this._selection;this.setSelection(e?i|t:i&~t)},isSelected:function(){if(this._selectChildren)for(var t=this._children,e=0,i=t.length;e<i;e++)if(t[e].isSelected())return!0;return!!(1&this._selection)},setSelected:function(t){if(this._selectChildren)for(var e=this._children,i=0,n=e.length;i<n;i++)e[i].setSelected(t);this._changeSelection(1,t)},isFullySelected:function(){var t=this._children,e=!!(1&this._selection);if(t&&e){for(var i=0,n=t.length;i<n;i++)if(!t[i].isFullySelected())return!1;return!0}return e},setFullySelected:function(t){var e=this._children;if(e)for(var i=0,n=e.length;i<n;i++)e[i].setFullySelected(t);this._changeSelection(1,t)},isClipMask:function(){return this._clipMask},setClipMask:function(t){this._clipMask!=(t=!!t)&&(this._clipMask=t,t&&(this.setFillColor(null),this.setStrokeColor(null)),this._changed(257),this._parent&&this._parent._changed(2048))},getData:function(){return this._data||(this._data={}),this._data},setData:function(t){this._data=t},getPosition:function(t){var e=t?_:m,i=this._position||(this._position=this._getPositionFromBounds());return new e(i.x,i.y,this,"setPosition")},setPosition:function(){this.translate(_.read(arguments).subtract(this.getPosition(!0)))},_getPositionFromBounds:function(t){return this._pivot?this._matrix._transformPoint(this._pivot):(t||this.getBounds()).getCenter(!0)},getPivot:function(){var t=this._pivot;return t?new m(t.x,t.y,this,"setPivot"):null},setPivot:function(){this._pivot=_.read(arguments,0,{clone:!0,readNull:!0}),this._position=o}},l.each({getStrokeBounds:{stroke:!0},getHandleBounds:{handle:!0},getInternalBounds:{internal:!0}},function(t,e){this[e]=function(e){return this.getBounds(e,t)}},{beans:!0,getBounds:function(t,e){var i=e||t instanceof C,n=l.set({},i?e:t,this._boundsOptions);n.stroke&&!this.getStrokeScaling()||(n.cacheItem=this);var r=this._getCachedBounds(i&&t,n).rect;return arguments.length?r:new w(r.x,r.y,r.width,r.height,this,"setBounds")},setBounds:function(){var t=b.read(arguments),e=this.getBounds(),i=this._matrix,n=new C,r=t.getCenter();n.translate(r),t.width==e.width&&t.height==e.height||(i.isInvertible()||(i.set(i._backup||(new C).translate(i.getTranslation())),e=this.getBounds()),n.scale(0!==e.width?t.width/e.width:0,0!==e.height?t.height/e.height:0)),r=e.getCenter(),n.translate(-r.x,-r.y),this.transform(n)},_getBounds:function(t,e){var i=this._children;return i&&i.length?(k._updateBoundsCache(this,e.cacheItem),k._getBounds(i,t,e)):new b},_getBoundsCacheKey:function(t,e){return[t.stroke?1:0,t.handle?1:0,e?1:0].join("")},_getCachedBounds:function(t,e,i){t=t&&t._orNullIfIdentity();var n=e.internal&&!i,r=e.cacheItem,s=n?null:this._matrix._orNullIfIdentity(),a=r&&(!t||t.equals(s))&&this._getBoundsCacheKey(e,n),o=this._bounds;if(k._updateBoundsCache(this._parent||this._symbol,r),a&&o&&a in o)return{rect:(f=o[a]).rect.clone(),nonscaling:f.nonscaling};var h=this._getBounds(t||s,e),c=h.rect||h,l=this._style,u=h.nonscaling||l.hasStroke()&&!l.getStrokeScaling();if(a){o||(this._bounds=o={});var f=o[a]={rect:c.clone(),nonscaling:u,internal:n}}return{rect:c,nonscaling:u}},_getStrokeMatrix:function(t,e){var i=this.getStrokeScaling()?null:e&&e.internal?this:this._parent||this._symbol&&this._symbol._item,n=i?i.getViewMatrix().invert():t;return n&&n._shiftless()},statics:{_updateBoundsCache:function(t,e){if(t&&e){var i=e._id,n=t._boundsCache=t._boundsCache||{ids:{},list:[]};n.ids[i]||(n.list.push(e),n.ids[i]=e)}},_clearBoundsCache:function(t){var e=t._boundsCache;if(e){t._bounds=t._position=t._boundsCache=o;for(var i=0,n=e.list,r=n.length;i<r;i++){var s=n[i];s!==t&&(s._bounds=s._position=o,s._boundsCache&&k._clearBoundsCache(s))}}},_getBounds:function(t,e,i){var n=1/0,r=-n,s=n,a=r,o=!1;i=i||{};for(var h=0,c=t.length;h<c;h++){var l=t[h];if(l._visible&&!l.isEmpty()){var u=l._getCachedBounds(e&&e.appended(l._matrix),i,!0),f=u.rect;n=Math.min(f.x,n),s=Math.min(f.y,s),r=Math.max(f.x+f.width,r),a=Math.max(f.y+f.height,a),u.nonscaling&&(o=!0)}}return{rect:isFinite(n)?new b(n,s,r-n,a-s):new b,nonscaling:o}}}}),{beans:!0,_decompose:function(){return this._applyMatrix?null:this._decomposed||(this._decomposed=this._matrix.decompose())},getRotation:function(){var t=this._decompose();return t?t.rotation:0},setRotation:function(t){var e=this.getRotation();if(null!=e&&null!=t){var i=this._decomposed;this.rotate(t-e),i&&(i.rotation=t,this._decomposed=i)}},getScaling:function(){var t=this._decompose(),e=t&&t.scaling;return new m(e?e.x:1,e?e.y:1,this,"setScaling")},setScaling:function(){var t=this.getScaling(),e=_.read(arguments,0,{clone:!0,readNull:!0});if(t&&e&&!t.equals(e)){var i=this.getRotation(),n=this._decomposed,r=new C,s=this.getPosition(!0);r.translate(s),i&&r.rotate(i),r.scale(e.x/t.x,e.y/t.y),i&&r.rotate(-i),r.translate(s.negate()),this.transform(r),n&&(n.scaling=e,this._decomposed=n)}},getMatrix:function(){return this._matrix},setMatrix:function(){var t=this._matrix;t.initialize.apply(t,arguments)},getGlobalMatrix:function(t){var e=this._globalMatrix;if(e)for(var i=this._parent,n=[];i;){if(!i._globalMatrix){e=null;for(var r=0,s=n.length;r<s;r++)n[r]._globalMatrix=null;break}n.push(i),i=i._parent}e||(e=this._globalMatrix=this._matrix.clone(),(i=this._parent)&&e.prepend(i.getGlobalMatrix(!0)));return t?e:e.clone()},getViewMatrix:function(){return this.getGlobalMatrix().prepend(this.getView()._matrix)},getApplyMatrix:function(){return this._applyMatrix},setApplyMatrix:function(t){(this._applyMatrix=this._canApplyMatrix&&!!t)&&this.transform(null,!0)},getTransformContent:"#getApplyMatrix",setTransformContent:"#setApplyMatrix"},{getProject:function(){return this._project},_setProject:function(t,e){if(this._project!==t){this._project&&this._installEvents(!1),this._project=t;for(var i=this._children,n=0,r=i&&i.length;n<r;n++)i[n]._setProject(t);e=!0}e&&this._installEvents(!0)},getView:function(){return this._project._view},_installEvents:function t(e){t.base.call(this,e);for(var i=this._children,n=0,r=i&&i.length;n<r;n++)i[n]._installEvents(e)},getLayer:function(){for(var t=this;t=t._parent;)if(t instanceof A)return t;return null},getParent:function(){return this._parent},setParent:function(t){return t.addChild(this)},_getOwner:"#getParent",getChildren:function(){return this._children},setChildren:function(t){this.removeChildren(),this.addChildren(t)},getFirstChild:function(){return this._children&&this._children[0]||null},getLastChild:function(){return this._children&&this._children[this._children.length-1]||null},getNextSibling:function(){var t=this._getOwner();return t&&t._children[this._index+1]||null},getPreviousSibling:function(){var t=this._getOwner();return t&&t._children[this._index-1]||null},getIndex:function(){return this._index},equals:function(t){return t===this||t&&this._class===t._class&&this._style.equals(t._style)&&this._matrix.equals(t._matrix)&&this._locked===t._locked&&this._visible===t._visible&&this._blendMode===t._blendMode&&this._opacity===t._opacity&&this._clipMask===t._clipMask&&this._guide===t._guide&&this._equals(t)||!1},_equals:function(t){return l.equals(this._children,t._children)},clone:function(t){var e=new this.constructor(k.NO_INSERT),i=this._children,n=l.pick(t?t.insert:o,t===o||!0===t),r=l.pick(t?t.deep:o,!0);i&&e.copyAttributes(this),i&&!r||e.copyContent(this),i||e.copyAttributes(this),n&&e.insertAbove(this);var s=this._name,a=this._parent;if(s&&a){i=a._children;for(var h=s,c=1;i[s];)s=h+" "+c++;s!==h&&e.setName(s)}return e},copyContent:function(t){for(var e=t._children,i=0,n=e&&e.length;i<n;i++)this.addChild(e[i].clone(!1),!0)},copyAttributes:function(t,e){this.setStyle(t._style);for(var i=["_locked","_visible","_blendMode","_opacity","_clipMask","_guide"],n=0,r=i.length;n<r;n++){var s=i[n];t.hasOwnProperty(s)&&(this[s]=t[s])}e||this._matrix.set(t._matrix,!0),this.setApplyMatrix(t._applyMatrix),this.setPivot(t._pivot),this.setSelection(t._selection);var a=t._data,o=t._name;this._data=a?l.clone(a):null,o&&this.setName(o)},rasterize:function(t,e){var i=this.getStrokeBounds(),n=(t||this.getView().getResolution())/72,r=i.getTopLeft().floor(),s=i.getBottomRight().ceil(),a=new y(s.subtract(r)),h=new E(k.NO_INSERT);if(!a.isZero()){var c=at.getCanvas(a.multiply(n)),u=c.getContext("2d"),f=(new C).scale(n).translate(r.negate());u.save(),f.applyToContext(u),this.draw(u,new l({matrices:[f]})),u.restore(),h.setCanvas(c)}return h.transform((new C).translate(r.add(a.divide(2))).scale(1/n)),(e===o||e)&&h.insertAbove(this),h},contains:function(){return!!this._contains(this._matrix._inverseTransform(_.read(arguments)))},_contains:function(t){var e=this._children;if(e){for(var i=e.length-1;i>=0;i--)if(e[i].contains(t))return!0;return!1}return t.isInside(this.getInternalBounds())},isInside:function(){return b.read(arguments).contains(this.getBounds())},_asPathItem:function(){return new N.Rectangle({rectangle:this.getInternalBounds(),matrix:this._matrix,insert:!1})},intersects:function(t,e){return t instanceof k&&this._asPathItem().getIntersections(t._asPathItem(),null,e,!0).length>0}},new function(){function t(){return this._hitTest(_.read(arguments),L.getOptions(arguments))}function e(){var t=_.read(arguments),e=L.getOptions(arguments),i=[];return this._hitTest(t,l.set({all:i},e)),i}function i(t,e,i,n){var r=this._children;if(r)for(var s=r.length-1;s>=0;s--){var a=r[s],o=a!==n&&a._hitTest(t,e,i);if(o&&!e.all)return o}return null}return T.inject({hitTest:t,hitTestAll:e,_hitTest:i}),{hitTest:t,hitTestAll:e,_hitTestChildren:i}},{_hitTest:function(t,e,i){if(this._locked||!this._visible||this._guide&&!e.guides||this.isEmpty())return null;var n=this._matrix,r=i?i.appended(n):this.getGlobalMatrix().prepend(this.getView()._matrix),s=Math.max(e.tolerance,1e-12),a=e._tolerancePadding=new y(N._getStrokePadding(s,n._shiftless().invert()));if(!(t=n._inverseTransform(t))||!this._children&&!this.getBounds({internal:!0,stroke:!0,handle:!0}).expand(a.multiply(2))._containsPoint(t))return null;var o,h,c=!(e.guides&&!this._guide||e.selected&&!this.isSelected()||e.type&&e.type!==l.hyphenate(this._class)||e.class&&!(this instanceof e.class)),u=e.match,f=this;function d(t){return t&&u&&!u(t)&&(t=null),t&&e.all&&e.all.push(t),t}function p(e,i){var n=i?o["get"+i]():f.getPosition();if(t.subtract(n).divide(a).length<=1)return new L(e,f,{name:i?l.hyphenate(i):e,point:n})}var g=e.position,v=e.center,_=e.bounds;if(c&&this._parent&&(g||v||_)){if((v||_)&&(o=this.getInternalBounds()),!(h=g&&p("position")||v&&p("center","Center"))&&_)for(var m=["TopLeft","TopRight","BottomLeft","BottomRight","LeftCenter","TopCenter","RightCenter","BottomCenter"],x=0;x<8&&!h;x++)h=p("bounds",m[x]);h=d(h)}return h||(h=this._hitTestChildren(t,e,r)||c&&d(this._hitTestSelf(t,e,r,this.getStrokeScaling()?null:r._shiftless().invert()))||null),h&&h.point&&(h.point=n.transform(h.point)),h},_hitTestSelf:function(t,e){if(e.fill&&this.hasFill()&&this._contains(t))return new L("fill",this)},matches:function(t,e){var i=typeof t;if("object"===i){for(var n in t)if(t.hasOwnProperty(n)&&!this.matches(n,t[n]))return!1;return!0}if("function"===i)return t(this);if("match"===t)return e(this);var r=/^(empty|editable)$/.test(t)?this["is"+l.capitalize(t)]():"type"===t?l.hyphenate(this._class):this[t];if("class"===t){if("function"==typeof e)return this instanceof e;r=this._class}if("function"==typeof e)return!!e(r);if(e){if(e.test)return e.test(r);if(l.isPlainObject(e))return function t(e,i){for(var n in e)if(e.hasOwnProperty(n)){var r=e[n],s=i[n];if(l.isPlainObject(r)&&l.isPlainObject(s)){if(!t(r,s))return!1}else if(!l.equals(r,s))return!1}return!0}(e,r)}return l.equals(r,e)},getItems:function(t){return k._getItems(this,t,this._matrix)},getItem:function(t){return k._getItems(this,t,this._matrix,null,!0)[0]||null},statics:{_getItems:function t(e,i,n,r,s){if(!r){var a="object"==typeof i&&i,o=a&&a.overlapping,h=a&&a.inside,c=(m=o||h)&&b.read([m]);r={items:[],recursive:a&&!1!==a.recursive,inside:!!h,overlapping:!!o,rect:c,path:o&&new N.Rectangle({rectangle:c,insert:!1})},a&&(i=l.filter({},i,{recursive:!0,inside:!0,overlapping:!0}))}var u=e._children,f=r.items;n=(c=r.rect)&&(n||new C);for(var d=0,p=u&&u.length;d<p;d++){var g=u[d],v=n&&n.appended(g._matrix),_=!0;if(c){var m=g.getBounds(v);if(!c.intersects(m))continue;c.contains(m)||r.overlapping&&(m.contains(c)||r.path.intersects(g,v))||(_=!1)}if(_&&g.matches(i)&&(f.push(g),s))break;if(!1!==r.recursive&&t(g,i,v,r,s),s&&f.length>0)break}return f}}},{importJSON:function(t){var e=l.importJSON(t,this);return e!==this?this.addChild(e):e},addChild:function(t){return this.insertChild(o,t)},insertChild:function(t,e){var i=e?this.insertChildren(t,[e]):null;return i&&i[0]},addChildren:function(t){return this.insertChildren(this._children.length,t)},insertChildren:function(t,e){var i=this._children;if(i&&e&&e.length>0){for(var n={},r=(e=l.slice(e)).length-1;r>=0;r--){var s=(c=e[r])&&c._id;!c||n[s]?e.splice(r,1):(c._remove(!1,!0),n[s]=!0)}l.splice(i,e,t,0);for(var a=this._project,o=a._changes,h=(r=0,e.length);r<h;r++){var c,u=(c=e[r])._name;c._parent=this,c._setProject(a,!0),u&&c.setName(u),o&&c._changed(5)}this._changed(11)}else e=null;return e},_insertItem:"#insertChild",_insertAt:function(t,e){var i=t&&t._getOwner(),n=t!==this&&i?this:null;return n&&(n._remove(!1,!0),i._insertItem(t._index+e,n)),n},insertAbove:function(t){return this._insertAt(t,1)},insertBelow:function(t){return this._insertAt(t,0)},sendToBack:function(){var t=this._getOwner();return t?t._insertItem(0,this):null},bringToFront:function(){var t=this._getOwner();return t?t._insertItem(o,this):null},appendTop:"#addChild",appendBottom:function(t){return this.insertChild(0,t)},moveAbove:"#insertAbove",moveBelow:"#insertBelow",addTo:function(t){return t._insertItem(o,this)},copyTo:function(t){return this.clone(!1).addTo(t)},reduce:function(t){var e=this._children;if(e&&1===e.length){var i=e[0].reduce(t);return this._parent?(i.insertAbove(this),this.remove()):i.remove(),i}return this},_removeNamed:function(){var t=this._getOwner();if(t){var e=t._children,i=t._namedChildren,n=this._name,r=i[n],s=r?r.indexOf(this):-1;-1!==s&&(e[n]==this&&delete e[n],r.splice(s,1),r.length?e[n]=r[0]:delete i[n])}},_remove:function(t,e){var i=this._getOwner(),n=this._project,r=this._index;return this._style&&this._style._dispose(),!!i&&(this._name&&this._removeNamed(),null!=r&&(n._activeLayer===this&&(n._activeLayer=this.getNextSibling()||this.getPreviousSibling()),l.splice(i._children,null,r,1)),this._installEvents(!1),t&&n._changes&&this._changed(5),e&&i._changed(11,this),this._parent=null,!0)},remove:function(){return this._remove(!0,!0)},replaceWith:function(t){var e=t&&t.insertBelow(this);return e&&this.remove(),e},removeChildren:function(t,e){if(!this._children)return null;t=t||0,e=l.pick(e,this._children.length);for(var i=l.splice(this._children,null,t,e-t),n=i.length-1;n>=0;n--)i[n]._remove(!0,!1);return i.length>0&&this._changed(11),i},clear:"#removeChildren",reverseChildren:function(){if(this._children){this._children.reverse();for(var t=0,e=this._children.length;t<e;t++)this._children[t]._index=t;this._changed(11)}},isEmpty:function(){var t=this._children;return!t||!t.length},isEditable:function(){for(var t=this;t;){if(!t._visible||t._locked)return!1;t=t._parent}return!0},hasFill:function(){return this.getStyle().hasFill()},hasStroke:function(){return this.getStyle().hasStroke()},hasShadow:function(){return this.getStyle().hasShadow()},_getOrder:function(t){function e(t){var e=[];do{e.unshift(t)}while(t=t._parent);return e}for(var i=e(this),n=e(t),r=0,s=Math.min(i.length,n.length);r<s;r++)if(i[r]!=n[r])return i[r]._index<n[r]._index?1:-1;return 0},hasChildren:function(){return this._children&&this._children.length>0},isInserted:function(){return!!this._parent&&this._parent.isInserted()},isAbove:function(t){return-1===this._getOrder(t)},isBelow:function(t){return 1===this._getOrder(t)},isParent:function(t){return this._parent===t},isChild:function(t){return t&&t._parent===this},isDescendant:function(t){for(var e=this;e=e._parent;)if(e===t)return!0;return!1},isAncestor:function(t){return!!t&&t.isDescendant(this)},isSibling:function(t){return this._parent===t._parent},isGroupedWith:function(t){for(var e=this._parent;e;){if(e._parent&&/^(Group|Layer|CompoundPath)$/.test(e._class)&&t.isDescendant(e))return!0;e=e._parent}return!1}},l.each(["rotate","scale","shear","skew"],function(t){var e="rotate"===t;this[t]=function(){var i=(e?l:_).read(arguments),n=_.read(arguments,0,{readNull:!0});return this.transform((new C)[t](i,n||this.getPosition(!0)))}},{translate:function(){var t=new C;return this.transform(t.translate.apply(t,arguments))},transform:function(t,e,i,n){var r=this._matrix,s=t&&!t.isIdentity(),a=(e||this._applyMatrix)&&(!r.isIdentity()||s||e&&i&&this._children);if(!s&&!a)return this;if(s){!t.isInvertible()&&r.isInvertible()&&(r._backup=r.getValues()),r.prepend(t,!0);var o=this._style,h=o.getFillColor(!0),c=o.getStrokeColor(!0);h&&h.transform(t),c&&c.transform(t)}if(a&&(a=this._transformContent(r,i,n))){var l=this._pivot;l&&r._transformPoint(l,l,!0),r.reset(!0),n&&this._canApplyMatrix&&(this._applyMatrix=!0)}var u=this._bounds,f=this._position;(s||a)&&this._changed(25);var d=s&&u&&t.decompose();if(d&&d.skewing.isZero()&&d.rotation%90==0){for(var p in u){var g=u[p];if(g.nonscaling)delete u[p];else if(a||!g.internal){var v=g.rect;t._transformBounds(v,v)}}this._bounds=u;var _=u[this._getBoundsCacheKey(this._boundsOptions||{})];_&&(this._position=this._getPositionFromBounds(_.rect))}else s&&f&&this._pivot&&(this._position=t._transformPoint(f,f));return this},_transformContent:function(t,e,i){var n=this._children;if(n){for(var r=0,s=n.length;r<s;r++)n[r].transform(t,!0,e,i);return!0}},globalToLocal:function(){return this.getGlobalMatrix(!0)._inverseTransform(_.read(arguments))},localToGlobal:function(){return this.getGlobalMatrix(!0)._transformPoint(_.read(arguments))},parentToLocal:function(){return this._matrix._inverseTransform(_.read(arguments))},localToParent:function(){return this._matrix._transformPoint(_.read(arguments))},fitBounds:function(t,e){t=b.read(arguments);var i=this.getBounds(),n=i.height/i.width,r=t.height/t.width,s=(e?n>r:n<r)?t.width/i.width:t.height/i.height,a=new b(new _,new y(i.width*s,i.height*s));a.setCenter(t.getCenter()),this.setBounds(a)}}),{_setStyles:function(t,e,i){var n=this._style,r=this._matrix;if(n.hasFill()&&(t.fillStyle=n.getFillColor().toCanvasStyle(t,r)),n.hasStroke()){t.strokeStyle=n.getStrokeColor().toCanvasStyle(t,r),t.lineWidth=n.getStrokeWidth();var s=n.getStrokeJoin(),a=n.getStrokeCap(),o=n.getMiterLimit();if(s&&(t.lineJoin=s),a&&(t.lineCap=a),o&&(t.miterLimit=o),lt.support.nativeDash){var h=n.getDashArray(),c=n.getDashOffset();h&&h.length&&("setLineDash"in t?(t.setLineDash(h),t.lineDashOffset=c):(t.mozDash=h,t.mozDashOffset=c))}}if(n.hasShadow()){var l=e.pixelRatio||1,u=i._shiftless().prepend((new C).scale(l,l)),f=u.transform(new _(n.getShadowBlur(),0)),d=u.transform(this.getShadowOffset());t.shadowColor=n.getShadowColor().toCanvasStyle(t),t.shadowBlur=f.getLength(),t.shadowOffsetX=d.x,t.shadowOffsetY=d.y}},draw:function(t,e,i){this._updateVersion=this._project._updateVersion;if(this._visible&&0!==this._opacity){var n=e.matrices,r=e.viewMatrix,s=this._matrix,a=n[n.length-1].appended(s);if(a.isInvertible()){r=r?r.appended(a):a,n.push(a),e.updateMatrix&&(this._globalMatrix=a);var o,h,c,l=this._blendMode,u=this._opacity,f="normal"===l,d=ot.nativeModes[l],p=f&&1===u||e.dontStart||e.clip||(d||f&&u<1)&&this._canComposite(),g=e.pixelRatio||1;if(!p){var v=this.getStrokeBounds(r);if(!v.width||!v.height)return void n.pop();c=e.offset,h=e.offset=v.getTopLeft().floor(),o=t,t=at.getContext(v.getSize().ceil().add(1).multiply(g)),1!==g&&t.scale(g,g)}t.save();var _=i?i.appended(s):this._canScaleStroke&&!this.getStrokeScaling(!0)&&r,m=!p&&e.clipItem,y=!_||m;if(p?(t.globalAlpha=u,d&&(t.globalCompositeOperation=l)):y&&t.translate(-h.x,-h.y),y&&(p?s:r).applyToContext(t),m&&e.clipItem.draw(t,e.extend({clip:!0})),_){t.setTransform(g,0,0,g,0,0);var x=e.offset;x&&t.translate(-x.x,-x.y)}this._draw(t,e,r,_),t.restore(),n.pop(),e.clip&&!e.dontFinish&&t.clip(),p||(ot.process(l,t,o,u,h.subtract(c).multiply(g)),at.release(t),e.offset=c)}}},_isUpdated:function(t){var e=this._parent;if(e instanceof z)return e._isUpdated(t);var i=this._updateVersion===t;return!i&&e&&e._visible&&e._isUpdated(t)&&(this._updateVersion=t,i=!0),i},_drawSelection:function(t,e,i,n,r){var s=this._selection,a=1&s,o=2&s||a&&this._selectBounds,h=4&s;if(this._drawSelected||(a=!1),(a||o||h)&&this._isUpdated(r)){var c,l=this.getSelectedColor(!0)||(c=this.getLayer())&&c.getSelectedColor(!0),u=e.appended(this.getGlobalMatrix(!0)),f=i/2;if(t.strokeStyle=t.fillStyle=l?l.toCanvasStyle(t):"#009dec",a&&this._drawSelected(t,u,n),h){var d=this.getPosition(!0),p=this._parent,g=p?p.localToGlobal(d):d,v=g.x,_=g.y;t.beginPath(),t.arc(v,_,f,0,2*Math.PI,!0),t.stroke();for(var m=[[0,-1],[1,0],[0,1],[-1,0]],y=f,x=i+1,b=0;b<4;b++){var w=m[b],C=w[0],S=w[1];t.moveTo(v+C*y,_+S*y),t.lineTo(v+C*x,_+S*x),t.stroke()}}if(o){var T=u._transformCorners(this.getInternalBounds());t.beginPath();for(b=0;b<8;b++)t[b?"lineTo":"moveTo"](T[b],T[++b]);t.closePath(),t.stroke();for(b=0;b<8;b++)t.fillRect(T[b]-f,T[++b]-f,i,i)}}},_canComposite:function(){return!1}},l.each(["down","drag","up","move"],function(t){this["removeOn"+l.capitalize(t)]=function(){var e={};return e[t]=!0,this.removeOn(e)}},{removeOn:function(t){for(var e in t)if(t[e]){var i="mouse"+e,n=this._project,r=n._removeSets=n._removeSets||{};r[i]=r[i]||{},r[i][this._id]=this}return this}})),O=k.extend({_class:"Group",_selectBounds:!1,_selectChildren:!0,_serializeFields:{children:[]},initialize:function(t){this._children=[],this._namedChildren={},this._initialize(t)||this.addChildren(Array.isArray(t)?t:arguments)},_changed:function t(e){t.base.call(this,e),2050&e&&(this._clipItem=o)},_getClipItem:function(){var t=this._clipItem;if(t===o){t=null;for(var e=this._children,i=0,n=e.length;i<n;i++)if(e[i]._clipMask){t=e[i];break}this._clipItem=t}return t},isClipped:function(){return!!this._getClipItem()},setClipped:function(t){var e=this.getFirstChild();e&&e.setClipMask(t)},_getBounds:function t(e,i){var n=this._getClipItem();return n?n._getCachedBounds(e&&e.appended(n._matrix),l.set({},i,{stroke:!1})):t.base.call(this,e,i)},_hitTestChildren:function t(e,i,n){var r=this._getClipItem();return(!r||r.contains(e))&&t.base.call(this,e,i,n,r)},_draw:function(t,e){var i=e.clip,n=!i&&this._getClipItem();e=e.extend({clipItem:n,clip:!1}),i?(t.beginPath(),e.dontStart=e.dontFinish=!0):n&&n.draw(t,e.extend({clip:!0}));for(var r=this._children,s=0,a=r.length;s<a;s++){var o=r[s];o!==n&&o.draw(t,e)}}}),A=O.extend({_class:"Layer",initialize:function(){O.apply(this,arguments)},_getOwner:function(){return this._parent||null!=this._index&&this._project},isInserted:function t(){return this._parent?t.base.call(this):null!=this._index},activate:function(){this._project._activeLayer=this},_hitTestSelf:function(){}}),P=k.extend({_class:"Shape",_applyMatrix:!1,_canApplyMatrix:!1,_canScaleStroke:!0,_serializeFields:{type:null,size:null,radius:null},initialize:function(t,e){this._initialize(t,e)},_equals:function(t){return this._type===t._type&&this._size.equals(t._size)&&l.equals(this._radius,t._radius)},copyContent:function(t){this.setType(t._type),this.setSize(t._size),this.setRadius(t._radius)},getType:function(){return this._type},setType:function(t){this._type=t},getShape:"#getType",setShape:"#setType",getSize:function(){var t=this._size;return new x(t.width,t.height,this,"setSize")},setSize:function(){var t=y.read(arguments);if(this._size){if(!this._size.equals(t)){var e=this._type,i=t.width,n=t.height;"rectangle"===e?this._radius.set(y.min(this._radius,t.divide(2))):"circle"===e?(i=n=(i+n)/2,this._radius=i/2):"ellipse"===e&&this._radius._set(i/2,n/2),this._size._set(i,n),this._changed(9)}}else this._size=t.clone()},getRadius:function(){var t=this._radius;return"circle"===this._type?t:new x(t.width,t.height,this,"setRadius")},setRadius:function(t){var e=this._type;if("circle"===e){if(t===this._radius)return;var i=2*t;this._radius=t,this._size._set(i,i)}else if(t=y.read(arguments),this._radius){if(this._radius.equals(t))return;if(this._radius.set(t),"rectangle"===e){i=y.max(this._size,t.multiply(2));this._size.set(i)}else"ellipse"===e&&this._size._set(2*t.width,2*t.height)}else this._radius=t.clone();this._changed(9)},isEmpty:function(){return!1},toPath:function(t){var e=new(N[l.capitalize(this._type)])({center:new _,size:this._size,radius:this._radius,insert:!1});return e.copyAttributes(this),lt.settings.applyMatrix&&e.setApplyMatrix(!0),(t===o||t)&&e.insertAbove(this),e},toShape:"#clone",_asPathItem:function(){return this.toPath(!1)},_draw:function(t,e,i,n){var r=this._style,s=r.hasFill(),a=r.hasStroke(),o=e.dontFinish||e.clip,h=!n;if(s||a||o){var c=this._type,l=this._radius,u="circle"===c;if(e.dontStart||t.beginPath(),h&&u)t.arc(0,0,l,0,2*Math.PI,!0);else{var f=u?l:l.width,d=u?l:l.height,p=this._size,g=p.width,v=p.height;if(h&&"rectangle"===c&&0===f&&0===d)t.rect(-g/2,-v/2,g,v);else{var _=g/2,m=v/2,y=.44771525016920644,x=f*y,b=d*y,w=[-_,-m+d,-_,-m+b,-_+x,-m,-_+f,-m,_-f,-m,_-x,-m,_,-m+b,_,-m+d,_,m-d,_,m-b,_-x,m,_-f,m,-_+f,m,-_+x,m,-_,m-b,-_,m-d];n&&n.transform(w,w,32),t.moveTo(w[0],w[1]),t.bezierCurveTo(w[2],w[3],w[4],w[5],w[6],w[7]),_!==f&&t.lineTo(w[8],w[9]),t.bezierCurveTo(w[10],w[11],w[12],w[13],w[14],w[15]),m!==d&&t.lineTo(w[16],w[17]),t.bezierCurveTo(w[18],w[19],w[20],w[21],w[22],w[23]),_!==f&&t.lineTo(w[24],w[25]),t.bezierCurveTo(w[26],w[27],w[28],w[29],w[30],w[31])}}t.closePath()}o||!s&&!a||(this._setStyles(t,e,i),s&&(t.fill(r.getFillRule()),t.shadowColor="rgba(0,0,0,0)"),a&&t.stroke())},_canComposite:function(){return!(this.hasFill()&&this.hasStroke())},_getBounds:function(t,e){var i=new b(this._size).setCenter(0,0),n=this._style,r=e.stroke&&n.hasStroke()&&n.getStrokeWidth();return t&&(i=t._transformBounds(i)),r?i.expand(N._getStrokePadding(r,this._getStrokeMatrix(t,e))):i}},new function(){function t(t,e,i){var n=t._radius;if(!n.isZero())for(var r=t._size.divide(2),s=1;s<=4;s++){var a=new _(s>1&&s<4?-1:1,s>2?-1:1),o=a.multiply(r),h=o.subtract(a.multiply(n));if(new b(i?o.add(a.multiply(i)):o,h).contains(e))return{point:h,quadrant:s}}}function e(t,e,i,n){var r=t.divide(e);return(!n||r.isInQuadrant(n))&&r.subtract(r.normalize()).multiply(e).divide(i).length<=1}return{_contains:function e(i){if("rectangle"===this._type){var n=t(this,i);return n?i.subtract(n.point).divide(this._radius).getLength()<=1:e.base.call(this,i)}return i.divide(this.size).getLength()<=.5},_hitTestSelf:function i(n,r,s,a){var o=!1,h=this._style,c=r.stroke&&h.hasStroke(),l=r.fill&&h.hasFill();if(c||l){var u=this._type,f=this._radius,d=c?h.getStrokeWidth()/2:0,p=r._tolerancePadding.add(N._getStrokePadding(d,!h.getStrokeScaling()&&a));if("rectangle"===u){var g=p.multiply(2),v=t(this,n,g);if(v)o=e(n.subtract(v.point),f,p,v.quadrant);else{var _=new b(this._size).setCenter(0,0),m=_.expand(g),y=_.expand(g.negate());o=m._containsPoint(n)&&!y._containsPoint(n)}}else o=e(n,f,p)}return o?new L(c?"stroke":"fill",this):i.base.apply(this,arguments)}}},{statics:new function(){function t(t,e,i,n,r){var s=new P(l.getNamed(r),e);return s._type=t,s._size=i,s._radius=n,s}return{Circle:function(){var e=_.readNamed(arguments,"center"),i=l.readNamed(arguments,"radius");return t("circle",e,new y(2*i),i,arguments)},Rectangle:function(){var e=b.readNamed(arguments,"rectangle"),i=y.min(y.readNamed(arguments,"radius"),e.getSize(!0).divide(2));return t("rectangle",e.getCenter(!0),e.getSize(!0),i,arguments)},Ellipse:function(){var e=P._readEllipse(arguments),i=e.radius;return t("ellipse",e.center,i.multiply(2),i,arguments)},_readEllipse:function(t){var e,i;if(l.hasNamed(t,"radius"))e=_.readNamed(t,"center"),i=y.readNamed(t,"radius");else{var n=b.readNamed(t,"rectangle");e=n.getCenter(!0),i=n.getSize(!0).divide(2)}return{center:e,radius:i}}}}}),E=k.extend({_class:"Raster",_applyMatrix:!1,_canApplyMatrix:!1,_boundsOptions:{stroke:!1,handle:!1},_serializeFields:{crossOrigin:null,source:null},_prioritize:["crossOrigin"],_smoothing:!0,initialize:function(t,e){if(!this._initialize(t,e!==o&&_.read(arguments,1))){var i="string"==typeof t?c.getElementById(t):t;i?this.setImage(i):this.setSource(t)}this._size||(this._size=new y,this._loaded=!1)},_equals:function(t){return this.getSource()===t.getSource()},copyContent:function(t){var e=t._image,i=t._canvas;if(e)this._setImage(e);else if(i){var n=at.getCanvas(t._size);n.getContext("2d").drawImage(i,0,0),this._setImage(n)}this._crossOrigin=t._crossOrigin},getSize:function(){var t=this._size;return new x(t?t.width:0,t?t.height:0,this,"setSize")},setSize:function(){var t=y.read(arguments);if(!t.equals(this._size))if(t.width>0&&t.height>0){var e=this.getElement();this._setImage(at.getCanvas(t)),e&&this.getContext(!0).drawImage(e,0,0,t.width,t.height)}else this._canvas&&at.release(this._canvas),this._size=t.clone()},getWidth:function(){return this._size?this._size.width:0},setWidth:function(t){this.setSize(t,this.getHeight())},getHeight:function(){return this._size?this._size.height:0},setHeight:function(t){this.setSize(this.getWidth(),t)},getLoaded:function(){return this._loaded},isEmpty:function(){var t=this._size;return!t||0===t.width&&0===t.height},getResolution:function(){var t=this._matrix,e=new _(0,0).transform(t),i=new _(1,0).transform(t).subtract(e),n=new _(0,1).transform(t).subtract(e);return new y(72/i.getLength(),72/n.getLength())},getPpi:"#getResolution",getImage:function(){return this._image},setImage:function(t){var e=this;function i(t){var i=e.getView(),n=t&&t.type||"load";i&&e.responds(n)&&(lt=i._scope,e.emit(n,new Q(t)))}this._setImage(t),this._loaded?setTimeout(i,0):t&&Z.add(t,{load:function(n){e._setImage(t),i(n)},error:i})},_setImage:function(t){this._canvas&&at.release(this._canvas),t&&t.getContext?(this._image=null,this._canvas=t,this._loaded=!0):(this._image=t,this._canvas=null,this._loaded=!!(t&&t.src&&t.complete)),this._size=new y(t?t.naturalWidth||t.width:0,t?t.naturalHeight||t.height:0),this._context=null,this._changed(1033)},getCanvas:function(){if(!this._canvas){var t=at.getContext(this._size);try{this._image&&t.drawImage(this._image,0,0),this._canvas=t.canvas}catch(e){at.release(t)}}return this._canvas},setCanvas:"#setImage",getContext:function(t){return this._context||(this._context=this.getCanvas().getContext("2d")),t&&(this._image=null,this._changed(1025)),this._context},setContext:function(t){this._context=t},getSource:function(){var t=this._image;return t&&t.src||this.toDataURL()},setSource:function(t){var e=new a.Image,i=this._crossOrigin;i&&(e.crossOrigin=i),e.src=t,this.setImage(e)},getCrossOrigin:function(){var t=this._image;return t&&t.crossOrigin||this._crossOrigin||""},setCrossOrigin:function(t){this._crossOrigin=t;var e=this._image;e&&(e.crossOrigin=t)},getSmoothing:function(){return this._smoothing},setSmoothing:function(t){this._smoothing=t,this._changed(257)},getElement:function(){return this._canvas||this._loaded&&this._image}},{beans:!1,getSubCanvas:function(){var t=b.read(arguments),e=at.getContext(t.getSize());return e.drawImage(this.getCanvas(),t.x,t.y,t.width,t.height,0,0,t.width,t.height),e.canvas},getSubRaster:function(){var t=b.read(arguments),e=new E(k.NO_INSERT);return e._setImage(this.getSubCanvas(t)),e.translate(t.getCenter().subtract(this.getSize().divide(2))),e._matrix.prepend(this._matrix),e.insertAbove(this),e},toDataURL:function(){var t=this._image,e=t&&t.src;if(/^data:/.test(e))return e;var i=this.getCanvas();return i?i.toDataURL.apply(i,arguments):null},drawImage:function(t){var e=_.read(arguments,1);this.getContext(!0).drawImage(t,e.x,e.y)},getAverageColor:function(t){var e,i;if(t?t instanceof B?(i=t,e=t.getBounds()):"object"==typeof t&&("width"in t?e=new b(t):"x"in t&&(e=new b(t.x-.5,t.y-.5,1,1))):e=this.getBounds(),!e)return null;var n=Math.min(e.width,32),r=Math.min(e.height,32),s=E._sampleContext;s?s.clearRect(0,0,33,33):s=E._sampleContext=at.getContext(new y(32)),s.save();var a=(new C).scale(n/e.width,r/e.height).translate(-e.x,-e.y);a.applyToContext(s),i&&i.draw(s,new l({clip:!0,matrices:[a]})),this._matrix.applyToContext(s);var o=this.getElement(),h=this._size;o&&s.drawImage(o,-h.width/2,-h.height/2),s.restore();for(var c=s.getImageData(.5,.5,Math.ceil(n),Math.ceil(r)).data,u=[0,0,0],f=0,d=0,p=c.length;d<p;d+=4){var g=c[d+3];f+=g,g/=255,u[0]+=c[d]*g,u[1]+=c[d+1]*g,u[2]+=c[d+2]*g}for(d=0;d<3;d++)u[d]/=f;return f?G.read(u):null},getPixel:function(){var t=_.read(arguments),e=this.getContext().getImageData(t.x,t.y,1,1).data;return new G("rgb",[e[0]/255,e[1]/255,e[2]/255],e[3]/255)},setPixel:function(){var t=_.read(arguments),e=G.read(arguments),i=e._convert("rgb"),n=e._alpha,r=this.getContext(!0),s=r.createImageData(1,1),a=s.data;a[0]=255*i[0],a[1]=255*i[1],a[2]=255*i[2],a[3]=null!=n?255*n:255,r.putImageData(s,t.x,t.y)},createImageData:function(){var t=y.read(arguments);return this.getContext().createImageData(t.width,t.height)},getImageData:function(){var t=b.read(arguments);return t.isEmpty()&&(t=new b(this._size)),this.getContext().getImageData(t.x,t.y,t.width,t.height)},setImageData:function(t){var e=_.read(arguments,1);this.getContext(!0).putImageData(t,e.x,e.y)},_getBounds:function(t,e){var i=new b(this._size).setCenter(0,0);return t?t._transformBounds(i):i},_hitTestSelf:function(t){if(this._contains(t)){var e=this;return new L("pixel",e,{offset:t.add(e._size.divide(2)).round(),color:{get:function(){return e.getPixel(this.offset)}}})}},_draw:function(t,e,i){var n=this.getElement();n&&(t.globalAlpha=this._opacity,this._setStyles(t,e,i),K.setPrefixed(t,"imageSmoothingEnabled",this._smoothing),t.drawImage(n,-this._size.width/2,-this._size.height/2))},_canComposite:function(){return!0}}),M=k.extend({_class:"SymbolItem",_applyMatrix:!1,_canApplyMatrix:!1,_boundsOptions:{stroke:!0},_serializeFields:{symbol:null},initialize:function(t,e){this._initialize(t,e!==o&&_.read(arguments,1))||this.setDefinition(t instanceof I?t:new I(t))},_equals:function(t){return this._definition===t._definition},copyContent:function(t){this.setDefinition(t._definition)},getDefinition:function(){return this._definition},setDefinition:function(t){this._definition=t,this._changed(9)},getSymbol:"#getDefinition",setSymbol:"#setDefinition",isEmpty:function(){return this._definition._item.isEmpty()},_getBounds:function(t,e){var i=this._definition._item;return i._getCachedBounds(i._matrix.prepended(t),e)},_hitTestSelf:function(t,e,i){var n=this._definition._item._hitTest(t,e,i);return n&&(n.item=this),n},_draw:function(t,e){this._definition._item.draw(t,e)}}),I=l.extend({_class:"SymbolDefinition",initialize:function(t,e){this._id=v.get(),this.project=lt.project,t&&this.setItem(t,e)},_serialize:function(t,e){return e.add(this,function(){return l.serialize([this._class,this._item],t,!1,e)})},_changed:function(t){8&t&&k._clearBoundsCache(this),1&t&&this.project._changed(t)},getItem:function(){return this._item},setItem:function(t,e){t._symbol&&(t=t.clone()),this._item&&(this._item._symbol=null),this._item=t,t.remove(),t.setSelected(!1),e||t.setPosition(new _),t._symbol=this,this._changed(9)},getDefinition:"#getItem",setDefinition:"#setItem",place:function(t){return new M(this,t)},clone:function(){return new I(this._item.clone(!1))},equals:function(t){return t===this||t&&this._item.equals(t._item)||!1}}),L=l.extend({_class:"HitResult",initialize:function(t,e,i){this.type=t,this.item=e,i&&this.inject(i)},statics:{getOptions:function(t){var e=t&&l.read(t);return l.set({type:null,tolerance:lt.settings.hitTolerance,fill:!e,stroke:!e,segments:!e,handles:!1,ends:!1,position:!1,center:!1,bounds:!1,guides:!1,selected:!1},e)}}}),D=l.extend({_class:"Segment",beans:!0,_selection:0,initialize:function(t,e,i,n,r,s){var a,h,c,l,u=arguments.length;u>0&&(null==t||"object"==typeof t?1===u&&t&&"point"in t?(a=t.point,h=t.handleIn,c=t.handleOut,l=t.selection):(a=t,h=e,c=i,l=n):(a=[t,e],h=i!==o?[i,n]:null,c=r!==o?[r,s]:null)),new j(a,this,"_point"),new j(h,this,"_handleIn"),new j(c,this,"_handleOut"),l&&this.setSelection(l)},_serialize:function(t,e){var i=this._point,n=this._selection,r=n||this.hasHandles()?[i,this._handleIn,this._handleOut]:i;return n&&r.push(n),l.serialize(r,t,!0,e)},_changed:function(t){var e=this._path;if(e){var i,n=e._curves,r=this._index;n&&(t&&t!==this._point&&t!==this._handleIn||!(i=r>0?n[r-1]:e._closed?n[n.length-1]:null)||i._changed(),t&&t!==this._point&&t!==this._handleOut||!(i=n[r])||i._changed()),e._changed(41)}},getPoint:function(){return this._point},setPoint:function(){this._point.set(_.read(arguments))},getHandleIn:function(){return this._handleIn},setHandleIn:function(){this._handleIn.set(_.read(arguments))},getHandleOut:function(){return this._handleOut},setHandleOut:function(){this._handleOut.set(_.read(arguments))},hasHandles:function(){return!this._handleIn.isZero()||!this._handleOut.isZero()},isSmooth:function(){var t=this._handleIn,e=this._handleOut;return!t.isZero()&&!e.isZero()&&t.isCollinear(e)},clearHandles:function(){this._handleIn._set(0,0),this._handleOut._set(0,0)},getSelection:function(){return this._selection},setSelection:function(t){var e=this._selection,i=this._path;this._selection=t=t||0,i&&t!==e&&(i._updateSelection(this,e,t),i._changed(257))},_changeSelection:function(t,e){var i=this._selection;this.setSelection(e?i|t:i&~t)},isSelected:function(){return!!(7&this._selection)},setSelected:function(t){this._changeSelection(7,t)},getIndex:function(){return this._index!==o?this._index:null},getPath:function(){return this._path||null},getCurve:function(){var t=this._path,e=this._index;return t?(e>0&&!t._closed&&e===t._segments.length-1&&e--,t.getCurves()[e]||null):null},getLocation:function(){var t=this.getCurve();return t?new R(t,this===t._segment1?0:1):null},getNext:function(){var t=this._path&&this._path._segments;return t&&(t[this._index+1]||this._path._closed&&t[0])||null},smooth:function(t,e,i){var n=t||{},r=n.type,s=n.factor,a=this.getPrevious(),h=this.getNext(),c=(a||this)._point,l=this._point,u=(h||this)._point,f=c.getDistance(l),d=l.getDistance(u);if(r&&"catmull-rom"!==r){if("geometric"!==r)throw new Error("Smoothing method '"+r+"' not supported.");if(a&&h){var p=c.subtract(u),g=s===o?.4:s,v=g*f/(f+d);e||this.setHandleIn(p.multiply(v)),i||this.setHandleOut(p.multiply(v-g))}}else{var m=s===o?.5:s,y=Math.pow(f,m),x=y*y,b=Math.pow(d,m),w=b*b;if(!e&&a){var C=2*w+3*b*y+x,S=3*b*(b+y);this.setHandleIn(0!==S?new _((w*c._x+C*l._x-x*u._x)/S-l._x,(w*c._y+C*l._y-x*u._y)/S-l._y):new _)}if(!i&&h){C=2*x+3*y*b+w,S=3*y*(y+b);this.setHandleOut(0!==S?new _((x*u._x+C*l._x-w*c._x)/S-l._x,(x*u._y+C*l._y-w*c._y)/S-l._y):new _)}}},getPrevious:function(){var t=this._path&&this._path._segments;return t&&(t[this._index-1]||this._path._closed&&t[t.length-1])||null},isFirst:function(){return!this._index},isLast:function(){var t=this._path;return t&&this._index===t._segments.length-1||!1},reverse:function(){var t=this._handleIn,e=this._handleOut,i=t.clone();t.set(e),e.set(i)},reversed:function(){return new D(this._point,this._handleOut,this._handleIn)},remove:function(){return!!this._path&&!!this._path.removeSegment(this._index)},clone:function(){return new D(this._point,this._handleIn,this._handleOut)},equals:function(t){return t===this||t&&this._class===t._class&&this._point.equals(t._point)&&this._handleIn.equals(t._handleIn)&&this._handleOut.equals(t._handleOut)||!1},toString:function(){var t=["point: "+this._point];return this._handleIn.isZero()||t.push("handleIn: "+this._handleIn),this._handleOut.isZero()||t.push("handleOut: "+this._handleOut),"{ "+t.join(", ")+" }"},transform:function(t){this._transformCoordinates(t,new Array(6),!0),this._changed()},interpolate:function(t,e,i){var n=1-i,r=i,s=t._point,a=e._point,o=t._handleIn,h=e._handleIn,c=e._handleOut,l=t._handleOut;this._point._set(n*s._x+r*a._x,n*s._y+r*a._y,!0),this._handleIn._set(n*o._x+r*h._x,n*o._y+r*h._y,!0),this._handleOut._set(n*l._x+r*c._x,n*l._y+r*c._y,!0),this._changed()},_transformCoordinates:function(t,e,i){var n=this._point,r=i&&this._handleIn.isZero()?null:this._handleIn,s=i&&this._handleOut.isZero()?null:this._handleOut,a=n._x,o=n._y,h=2;return e[0]=a,e[1]=o,r&&(e[h++]=r._x+a,e[h++]=r._y+o),s&&(e[h++]=s._x+a,e[h++]=s._y+o),t&&(t._transformCoordinates(e,e,h/2),a=e[0],o=e[1],i?(n._x=a,n._y=o,h=2,r&&(r._x=e[h++]-a,r._y=e[h++]-o),s&&(s._x=e[h++]-a,s._y=e[h++]-o)):(r||(e[h++]=a,e[h++]=o),s||(e[h++]=a,e[h++]=o))),e}}),j=_.extend({initialize:function(t,e,i){var n,r,s;if(t)if((n=t[0])!==o)r=t[1];else{var a=t;(n=a.x)===o&&(n=(a=_.read(arguments)).x),r=a.y,s=a.selected}else n=r=0;this._x=n,this._y=r,this._owner=e,e[i]=this,s&&this.setSelected(!0)},_set:function(t,e){return this._x=t,this._y=e,this._owner._changed(this),this},getX:function(){return this._x},setX:function(t){this._x=t,this._owner._changed(this)},getY:function(){return this._y},setY:function(t){this._y=t,this._owner._changed(this)},isZero:function(){var t=g.isZero;return t(this._x)&&t(this._y)},isSelected:function(){return!!(this._owner._selection&this._getSelection())},setSelected:function(t){this._owner._changeSelection(this._getSelection(),t)},_getSelection:function(){var t=this._owner;return this===t._point?1:this===t._handleIn?2:this===t._handleOut?4:0}}),F=l.extend({_class:"Curve",beans:!0,initialize:function(t,e,i,n,r,s,a,o){var h,c,l,u,f,d,p=arguments.length;3===p?(this._path=t,h=e,c=i):p?1===p?"segment1"in t?(h=new D(t.segment1),c=new D(t.segment2)):"point1"in t?(l=t.point1,f=t.handle1,d=t.handle2,u=t.point2):Array.isArray(t)&&(l=[t[0],t[1]],u=[t[6],t[7]],f=[t[2]-t[0],t[3]-t[1]],d=[t[4]-t[6],t[5]-t[7]]):2===p?(h=new D(t),c=new D(e)):4===p?(l=t,f=e,d=i,u=n):8===p&&(l=[t,e],u=[a,o],f=[i-t,n-e],d=[r-a,s-o]):(h=new D,c=new D),this._segment1=h||new D(l,null,f),this._segment2=c||new D(u,d,null)},_serialize:function(t,e){return l.serialize(this.hasHandles()?[this.getPoint1(),this.getHandle1(),this.getHandle2(),this.getPoint2()]:[this.getPoint1(),this.getPoint2()],t,!0,e)},_changed:function(){this._length=this._bounds=o},clone:function(){return new F(this._segment1,this._segment2)},toString:function(){var t=["point1: "+this._segment1._point];return this._segment1._handleOut.isZero()||t.push("handle1: "+this._segment1._handleOut),this._segment2._handleIn.isZero()||t.push("handle2: "+this._segment2._handleIn),t.push("point2: "+this._segment2._point),"{ "+t.join(", ")+" }"},classify:function(){return F.classify(this.getValues())},remove:function(){var t=!1;if(this._path){var e=this._segment2,i=e._handleOut;(t=e.remove())&&this._segment1._handleOut.set(i)}return t},getPoint1:function(){return this._segment1._point},setPoint1:function(){this._segment1._point.set(_.read(arguments))},getPoint2:function(){return this._segment2._point},setPoint2:function(){this._segment2._point.set(_.read(arguments))},getHandle1:function(){return this._segment1._handleOut},setHandle1:function(){this._segment1._handleOut.set(_.read(arguments))},getHandle2:function(){return this._segment2._handleIn},setHandle2:function(){this._segment2._handleIn.set(_.read(arguments))},getSegment1:function(){return this._segment1},getSegment2:function(){return this._segment2},getPath:function(){return this._path},getIndex:function(){return this._segment1._index},getNext:function(){var t=this._path&&this._path._curves;return t&&(t[this._segment1._index+1]||this._path._closed&&t[0])||null},getPrevious:function(){var t=this._path&&this._path._curves;return t&&(t[this._segment1._index-1]||this._path._closed&&t[t.length-1])||null},isFirst:function(){return!this._segment1._index},isLast:function(){var t=this._path;return t&&this._segment1._index===t._curves.length-1||!1},isSelected:function(){return this.getPoint1().isSelected()&&this.getHandle1().isSelected()&&this.getHandle2().isSelected()&&this.getPoint2().isSelected()},setSelected:function(t){this.getPoint1().setSelected(t),this.getHandle1().setSelected(t),this.getHandle2().setSelected(t),this.getPoint2().setSelected(t)},getValues:function(t){return F.getValues(this._segment1,this._segment2,t)},getPoints:function(){for(var t=this.getValues(),e=[],i=0;i<8;i+=2)e.push(new _(t[i],t[i+1]));return e}},{getLength:function(){return null==this._length&&(this._length=F.getLength(this.getValues(),0,1)),this._length},getArea:function(){return F.getArea(this.getValues())},getLine:function(){return new S(this._segment1._point,this._segment2._point)},getPart:function(t,e){return new F(F.getPart(this.getValues(),t,e))},getPartLength:function(t,e){return F.getLength(this.getValues(),t,e)},divideAt:function(t){return this.divideAtTime(t&&t.curve===this?t.time:this.getTimeAt(t))},divideAtTime:function(t,e){var i=null;if(t>=1e-8&&t<=1-1e-8){var n=F.subdivide(this.getValues(),t),r=n[0],s=n[1],a=e||this.hasHandles(),o=this._segment1,h=this._segment2,c=this._path;a&&(o._handleOut._set(r[2]-r[0],r[3]-r[1]),h._handleIn._set(s[4]-s[6],s[5]-s[7]));var l=r[6],u=r[7],f=new D(new _(l,u),a&&new _(r[4]-l,r[5]-u),a&&new _(s[2]-l,s[3]-u));c?(c.insert(o._index+1,f),i=this.getNext()):(this._segment2=f,this._changed(),i=new F(f,h))}return i},splitAt:function(t){var e=this._path;return e?e.splitAt(t):null},splitAtTime:function(t){return this.splitAt(this.getLocationAtTime(t))},divide:function(t,e){return this.divideAtTime(t===o?.5:e?t:this.getTimeAt(t))},split:function(t,e){return this.splitAtTime(t===o?.5:e?t:this.getTimeAt(t))},reversed:function(){return new F(this._segment2.reversed(),this._segment1.reversed())},clearHandles:function(){this._segment1._handleOut._set(0,0),this._segment2._handleIn._set(0,0)},statics:{getValues:function(t,e,i,n){var r=t._point,s=t._handleOut,a=e._handleIn,o=e._point,h=r.x,c=r.y,l=o.x,u=o.y,f=n?[h,c,h,c,l,u,l,u]:[h,c,h+s._x,c+s._y,l+a._x,u+a._y,l,u];return i&&i._transformCoordinates(f,f,4),f},subdivide:function(t,e){var i=t[0],n=t[1],r=t[2],s=t[3],a=t[4],h=t[5],c=t[6],l=t[7];e===o&&(e=.5);var u=1-e,f=u*i+e*r,d=u*n+e*s,p=u*r+e*a,g=u*s+e*h,v=u*a+e*c,_=u*h+e*l,m=u*f+e*p,y=u*d+e*g,x=u*p+e*v,b=u*g+e*_,w=u*m+e*x,C=u*y+e*b;return[[i,n,f,d,m,y,w,C],[w,C,x,b,v,_,c,l]]},getMonoCurves:function(t,e){var i=[],n=e?0:1,r=t[n+0],s=t[n+2],a=t[n+4],o=t[n+6];if(r>=s==s>=a&&s>=a==a>=o||F.isStraight(t))i.push(t);else{var h=3*(s-a)-r+o,c=2*(r+a)-4*s,l=s-r,u=[],f=g.solveQuadratic(h,c,l,u,1e-8,1-1e-8);if(f){u.sort();var d=u[0],p=F.subdivide(t,d);i.push(p[0]),f>1&&(d=(u[1]-d)/(1-d),p=F.subdivide(p[1],d),i.push(p[0])),i.push(p[1])}else i.push(t)}return i},solveCubic:function(t,e,i,n,r,s){var a=t[e],o=t[e+2],h=t[e+4],c=t[e+6],l=0;if(!(a<i&&c<i&&o<i&&h<i||a>i&&c>i&&o>i&&h>i)){var u=3*(o-a),f=3*(h-o)-u,d=c-a-u-f;l=g.solveCubic(d,f,u,a-i,n,r,s)}return l},getTimeOf:function(t,e){var i=new _(t[0],t[1]),n=new _(t[6],t[7]);if(null===(e.isClose(i,1e-12)?0:e.isClose(n,1e-12)?1:null))for(var r=[e.x,e.y],s=[],a=0;a<2;a++)for(var o=F.solveCubic(t,a,r[a],s,0,1),h=0;h<o;h++){var c=s[h];if(e.isClose(F.getPoint(t,c),1e-7))return c}return e.isClose(i,1e-7)?0:e.isClose(n,1e-7)?1:null},getNearestTime:function(t,e){if(F.isStraight(t)){var i=t[0],n=t[1],r=t[6]-i,s=t[7]-n,a=r*r+s*s;if(0===a)return 0;var o=((e.x-i)*r+(e.y-n)*s)/a;return o<1e-12?0:o>.999999999999?1:F.getTimeOf(t,new _(i+o*r,n+o*s))}var h=1/0,c=0;function l(i){if(i>=0&&i<=1){var n=e.getDistance(F.getPoint(t,i),!0);if(n<h)return h=n,c=i,!0}}for(var u=0;u<=100;u++)l(u/100);for(var f=.005;f>1e-8;)l(c-f)||l(c+f)||(f/=2);return c},getPart:function(t,e,i){var n=e>i;if(n){var r=e;e=i,i=r}return e>0&&(t=F.subdivide(t,e)[1]),i<1&&(t=F.subdivide(t,(i-e)/(1-e))[0]),n?[t[6],t[7],t[4],t[5],t[2],t[3],t[0],t[1]]:t},isFlatEnough:function(t,e){var i=t[0],n=t[1],r=t[2],s=t[3],a=t[4],o=t[5],h=t[6],c=t[7],l=3*r-2*i-h,u=3*s-2*n-c,f=3*a-2*h-i,d=3*o-2*c-n;return Math.max(l*l,f*f)+Math.max(u*u,d*d)<=16*e*e},getArea:function(t){var e=t[0],i=t[1],n=t[2],r=t[3],s=t[4],a=t[5],o=t[6],h=t[7];return 3*((h-i)*(n+s)-(o-e)*(r+a)+r*(e-s)-n*(i-a)+h*(s+e/3)-o*(a+i/3))/20},getBounds:function(t){for(var e=t.slice(0,2),i=e.slice(),n=[0,0],r=0;r<2;r++)F._addBounds(t[r],t[r+2],t[r+4],t[r+6],r,0,e,i,n);return new b(e[0],e[1],i[0]-e[0],i[1]-e[1])},_addBounds:function(t,e,i,n,r,s,a,o,h){function c(t,e){var i=t-e,n=t+e;i<a[r]&&(a[r]=i),n>o[r]&&(o[r]=n)}s/=2;var l=a[r]-s,u=o[r]+s;if(t<l||e<l||i<l||n<l||t>u||e>u||i>u||n>u)if(e<t!=e<n&&i<t!=i<n)c(t,s),c(n,s);else{var f=3*(e-i)-t+n,d=2*(t+i)-4*e,p=e-t,v=g.solveQuadratic(f,d,p,h);c(n,0);for(var _=0;_<v;_++){var m=h[_],y=1-m;1e-8<=m&&m<=1-1e-8&&c(y*y*y*t+3*y*y*m*e+3*y*m*m*i+m*m*m*n,s)}}}}},l.each(["getBounds","getStrokeBounds","getHandleBounds"],function(t){this[t]=function(){this._bounds||(this._bounds={});var e=this._bounds[t];return e||(e=this._bounds[t]=N[t]([this._segment1,this._segment2],!1,this._path)),e.clone()}},{}),l.each({isStraight:function(t,e,i,n){if(e.isZero()&&i.isZero())return!0;var r=n.subtract(t);if(r.isZero())return!1;if(r.isCollinear(e)&&r.isCollinear(i)){var s=new S(t,n);if(s.getDistance(t.add(e))<1e-7&&s.getDistance(n.add(i))<1e-7){var a=r.dot(r),o=r.dot(e)/a,h=r.dot(i)/a;return o>=0&&o<=1&&h<=0&&h>=-1}}return!1},isLinear:function(t,e,i,n){var r=n.subtract(t).divide(3);return e.equals(r)&&i.negate().equals(r)}},function(t,e){this[e]=function(e){var i=this._segment1,n=this._segment2;return t(i._point,i._handleOut,n._handleIn,n._point,e)},this.statics[e]=function(e,i){var n=e[0],r=e[1],s=e[6],a=e[7];return t(new _(n,r),new _(e[2]-n,e[3]-r),new _(e[4]-s,e[5]-a),new _(s,a),i)}},{statics:{},hasHandles:function(){return!this._segment1._handleOut.isZero()||!this._segment2._handleIn.isZero()},hasLength:function(t){return(!this.getPoint1().equals(this.getPoint2())||this.hasHandles())&&this.getLength()>(t||0)},isCollinear:function(t){return t&&this.isStraight()&&t.isStraight()&&this.getLine().isCollinear(t.getLine())},isHorizontal:function(){return this.isStraight()&&Math.abs(this.getTangentAtTime(.5).y)<1e-8},isVertical:function(){return this.isStraight()&&Math.abs(this.getTangentAtTime(.5).x)<1e-8}}),{beans:!1,getLocationAt:function(t,e){return this.getLocationAtTime(e?t:this.getTimeAt(t))},getLocationAtTime:function(t){return null!=t&&t>=0&&t<=1?new R(this,t):null},getTimeAt:function(t,e){return F.getTimeAt(this.getValues(),t,e)},getParameterAt:"#getTimeAt",getTimesWithTangent:function(){var t=_.read(arguments);return t.isZero()?[]:F.getTimesWithTangent(this.getValues(),t)},getOffsetAtTime:function(t){return this.getPartLength(0,t)},getLocationOf:function(){return this.getLocationAtTime(this.getTimeOf(_.read(arguments)))},getOffsetOf:function(){var t=this.getLocationOf.apply(this,arguments);return t?t.getOffset():null},getTimeOf:function(){return F.getTimeOf(this.getValues(),_.read(arguments))},getParameterOf:"#getTimeOf",getNearestLocation:function(){var t=_.read(arguments),e=this.getValues(),i=F.getNearestTime(e,t),n=F.getPoint(e,i);return new R(this,i,n,null,t.getDistance(n))},getNearestPoint:function(){var t=this.getNearestLocation.apply(this,arguments);return t?t.getPoint():t}},new function(){var t=["getPoint","getTangent","getNormal","getWeightedTangent","getWeightedNormal","getCurvature"];return l.each(t,function(t){this[t+"At"]=function(e,i){var n=this.getValues();return F[t](n,i?e:F.getTimeAt(n,e))},this[t+"AtTime"]=function(e){return F[t](this.getValues(),e)}},{statics:{_evaluateMethods:t}})},new function(){function t(t){var e=t[0],i=t[1],n=t[2],r=t[3],s=t[4],a=t[5],o=t[6],h=t[7],c=9*(n-s)+3*(o-e),l=6*(e+s)-12*n,u=3*(n-e),f=9*(r-a)+3*(h-i),d=6*(i+a)-12*r,p=3*(r-i);return function(t){var e=(c*t+l)*t+u,i=(f*t+d)*t+p;return Math.sqrt(e*e+i*i)}}function e(t,e){return Math.max(2,Math.min(16,Math.ceil(32*Math.abs(e-t))))}function i(t,e,i,n){if(null==e||e<0||e>1)return null;var r=t[0],s=t[1],a=t[2],o=t[3],h=t[4],c=t[5],l=t[6],u=t[7],f=g.isZero;f(a-r)&&f(o-s)&&(a=r,o=s),f(h-l)&&f(c-u)&&(h=l,c=u);var d,p,v=3*(a-r),m=3*(h-a)-v,y=l-r-v-m,x=3*(o-s),b=3*(c-o)-x,w=u-s-x-b;if(0===i)d=0===e?r:1===e?l:((y*e+m)*e+v)*e+r,p=0===e?s:1===e?u:((w*e+b)*e+x)*e+s;else{if(e<1e-8?(d=v,p=x):e>1-1e-8?(d=3*(l-h),p=3*(u-c)):(d=(3*y*e+2*m)*e+v,p=(3*w*e+2*b)*e+x),n){0===d&&0===p&&(e<1e-8||e>1-1e-8)&&(d=h-a,p=c-o);var C=Math.sqrt(d*d+p*p);C&&(d/=C,p/=C)}if(3===i){h=6*y*e+2*m,c=6*w*e+2*b;var S=Math.pow(d*d+p*p,1.5);d=0!==S?(d*c-p*h)/S:0,p=0}}return 2===i?new _(p,-d):new _(d,p)}return{statics:{classify:function(t){var e=t[0],i=t[1],n=t[2],r=t[3],s=t[4],a=t[5],h=t[6],c=t[7],l=n*(i-c)+r*(h-e)+e*c-i*h,u=3*(s*(r-i)+a*(e-n)+n*i-r*e),f=u-l,d=f-l+(e*(c-a)+i*(s-h)+h*a-c*s),p=Math.sqrt(d*d+f*f+u*u),v=0!==p?1/p:0,_=g.isZero;function m(t,e,i){var n=e!==o,r=n&&e>0&&e<1,s=n&&i>0&&i<1;return!n||(r||s)&&("loop"!==t||r&&s)||(t="arch",r=s=!1),{type:t,roots:r||s?r&&s?e<i?[e,i]:[i,e]:[r?e:i]:null}}if(f*=v,u*=v,_(d*=v))return _(f)?m(_(u)?"line":"quadratic"):m("serpentine",u/(3*f));var y=3*f*f-4*d*u;if(_(y))return m("cusp",f/(2*d));var x=y>0?Math.sqrt(y/3):Math.sqrt(-y),b=2*d;return m(y>0?"serpentine":"loop",(f+x)/b,(f-x)/b)},getLength:function(i,n,r,s){if(n===o&&(n=0),r===o&&(r=1),F.isStraight(i)){var a=i;r<1&&(a=F.subdivide(a,r)[0],n/=r),n>0&&(a=F.subdivide(a,n)[1]);var h=a[6]-a[0],c=a[7]-a[1];return Math.sqrt(h*h+c*c)}return g.integrate(s||t(i),n,r,e(n,r))},getTimeAt:function(i,n,r){if(r===o&&(r=n<0?1:0),0===n)return r;var s=Math.abs,a=n>0,h=a?r:0,c=a?1:r,l=t(i),u=F.getLength(i,h,c,l),f=s(n)-u;if(s(f)<1e-12)return a?c:h;if(f>1e-12)return null;var d=n/u,p=0;return g.findRoot(function(t){return p+=g.integrate(l,r,t,e(r,t)),r=t,p-n},l,r+d,h,c,32,1e-12)},getPoint:function(t,e){return i(t,e,0,!1)},getTangent:function(t,e){return i(t,e,1,!0)},getWeightedTangent:function(t,e){return i(t,e,1,!1)},getNormal:function(t,e){return i(t,e,2,!0)},getWeightedNormal:function(t,e){return i(t,e,2,!1)},getCurvature:function(t,e){return i(t,e,3,!1).x},getPeaks:function(t){var e=t[0],i=t[1],n=t[2],r=t[3],s=t[4],a=t[5],o=3*n-e-3*s+t[6],h=3*e-6*n+3*s,c=-3*e+3*n,l=3*r-i-3*a+t[7],u=3*i-6*r+3*a,f=-3*i+3*r,d=[];return g.solveCubic(9*(o*o+l*l),9*(o*h+u*l),2*(h*h+u*u)+3*(c*o+f*l),c*h+u*f,d,1e-8,1-1e-8),d.sort()}}}},new function(){function t(t,e,i,n,r,s,a){var o=!a&&i.getPrevious()===r,h=!a&&i!==r&&i.getNext()===r;if(null!==n&&n>=(o?1e-8:0)&&n<=(h?1-1e-8:1)&&null!==s&&s>=(h?1e-8:0)&&s<=(o?1-1e-8:1)){var c=new R(i,n,null,a),l=new R(r,s,null,a);c._intersection=l,l._intersection=c,e&&!e(c)||R.insert(t,c,!0)}}function e(t,e,n,r){return t[0][1]<n?i(t,!0,n):e[0][1]>r?i(e,!1,r):t[0][0]}function i(t,e,i){for(var n=t[0][0],r=t[0][1],s=1,a=t.length;s<a;s++){var o=t[s][0],h=t[s][1];if(e?h>=i:h<=i)return h===i?o:n+(i-r)*(o-n)/(h-r);n=o,r=h}return null}function n(t,e,i,n,r){var s=g.isZero;if(s(n)&&s(r)){var a=F.getTimeOf(t,new _(e,i));return null===a?[]:[a]}for(var o=Math.atan2(-r,n),h=Math.sin(o),c=Math.cos(o),l=[],u=[],f=0;f<8;f+=2){var d=t[f]-e,p=t[f+1]-i;l.push(d*c-p*h,d*h+p*c)}return F.solveCubic(l,1,0,u,0,1),u}function r(i,r,s,o,h,c){var l=Math.min,u=Math.max;if(u(i[0],i[2],i[4],i[6])+1e-12>l(r[0],r[2],r[4],r[6])&&l(i[0],i[2],i[4],i[6])-1e-12<u(r[0],r[2],r[4],r[6])&&u(i[1],i[3],i[5],i[7])+1e-12>l(r[1],r[3],r[5],r[7])&&l(i[1],i[3],i[5],i[7])-1e-12<u(r[1],r[3],r[5],r[7])){var f=a(i,r);if(f)for(var d=0;d<2;d++){var p=f[d];t(h,c,s,p[0],o,p[1],!0)}else{var g=F.isStraight(i),v=F.isStraight(r),m=g&&v,y=g&&!v,x=h.length;if((m?function(e,i,n,r,s,a){var o=S.intersect(e[0],e[1],e[6],e[7],i[0],i[1],i[6],i[7]);o&&t(s,a,n,F.getTimeOf(e,o),r,F.getTimeOf(i,o))}:g||v?function(e,i,r,s,a,o,h){for(var c=i[0],l=i[1],u=n(e,c,l,i[6]-c,i[7]-l),f=0,d=u.length;f<d;f++){var p=u[f],g=F.getPoint(e,p),v=F.getTimeOf(i,g);null!==v&&t(a,o,h?s:r,h?v:p,h?r:s,h?p:v)}}:function i(n,r,s,a,o,h,c,l,u,f,d,p,g){if(++u>=4096||++l>=40)return u;var v,_,m=r[0],y=r[1],x=r[6],b=r[7],w=S.getSignedDistance,C=w(m,y,x,b,r[2],r[3]),T=w(m,y,x,b,r[4],r[5]),k=C*T>0?.75:4/9,O=k*Math.min(0,C,T),A=k*Math.max(0,C,T),P=w(m,y,x,b,n[0],n[1]),E=w(m,y,x,b,n[2],n[3]),M=w(m,y,x,b,n[4],n[5]),I=w(m,y,x,b,n[6],n[7]),L=function(t,e,i,n){var r,s=[0,t],a=[1/3,e],o=[2/3,i],h=[1,n],c=e-(2*t+n)/3,l=i-(t+2*n)/3;if(c*l<0)r=[[s,a,h],[s,o,h]];else{var u=c/l;r=[u>=2?[s,a,h]:u<=.5?[s,o,h]:[s,a,o,h],[s,h]]}return(c||l)<0?r.reverse():r}(P,E,M,I),D=L[0],j=L[1];if(0===C&&0===T&&0===P&&0===E&&0===M&&0===I||null==(v=e(D,j,O,A))||null==(_=e(D.reverse(),j.reverse(),O,A)))return u;var R=f+(d-f)*v,B=f+(d-f)*_;if(Math.max(g-p,B-R)<1e-9){var N=(R+B)/2,z=(p+g)/2;t(o,h,c?a:s,c?z:N,c?s:a,c?N:z)}else if(n=F.getPart(n,v,_),_-v>.8)if(B-R>g-p)N=(R+B)/2,u=i(r,(V=F.subdivide(n,.5))[0],a,s,o,h,!c,l,u,p,g,R,N),u=i(r,V[1],a,s,o,h,!c,l,u,p,g,N,B);else{var V;z=(p+g)/2,u=i((V=F.subdivide(r,.5))[0],n,a,s,o,h,!c,l,u,p,z,R,B),u=i(V[1],n,a,s,o,h,!c,l,u,z,g,R,B)}else u=g-p>=1e-9?i(r,n,a,s,o,h,!c,l,u,p,g,R,B):i(n,r,s,a,o,h,c,l,u,R,B,p,g);return u})(y?r:i,y?i:r,y?o:s,y?s:o,h,c,y,0,0,0,1,0,1),!m||h.length===x)for(d=0;d<4;d++){var b=d>>1,w=1&d,C=6*b,T=6*w,k=new _(i[C],i[C+1]),O=new _(r[T],r[T+1]);k.isClose(O,1e-12)&&t(h,c,s,b,o,w)}}}return h}function s(e,i,n,r){var s=F.classify(e);if("loop"===s.type){var a=s.roots;t(n,r,i,a[0],i,a[1])}return n}function a(t,e){function i(t){var e=t[6]-t[0],i=t[7]-t[1];return e*e+i*i}var n=Math.abs,r=S.getDistance,s=F.isStraight(t),a=F.isStraight(e),o=s&&a,h=i(t)<i(e),c=h?e:t,l=h?t:e,u=c[0],f=c[1],d=c[6]-u,p=c[7]-f;if(r(u,f,d,p,l[0],l[1],!0)<1e-7&&r(u,f,d,p,l[6],l[7],!0)<1e-7)!o&&r(u,f,d,p,c[2],c[3],!0)<1e-7&&r(u,f,d,p,c[4],c[5],!0)<1e-7&&r(u,f,d,p,l[2],l[3],!0)<1e-7&&r(u,f,d,p,l[4],l[5],!0)<1e-7&&(s=a=o=!0);else if(o)return null;if(s^a)return null;for(var g=[t,e],v=[],m=0;m<4&&v.length<2;m++){var y=1&m,x=1^y,b=m>>1,w=F.getTimeOf(g[y],new _(g[x][b?6:0],g[x][b?7:1]));if(null!=w){var C=y?[b,w]:[w,b];(!v.length||n(C[0]-v[0][0])>1e-8&&n(C[1]-v[0][1])>1e-8)&&v.push(C)}if(m>2&&!v.length)break}if(2!==v.length)v=null;else if(!o){var T=F.getPart(t,v[0][0],v[1][0]),k=F.getPart(e,v[0][1],v[1][1]);(n(k[2]-T[2])>1e-7||n(k[3]-T[3])>1e-7||n(k[4]-T[4])>1e-7||n(k[5]-T[5])>1e-7)&&(v=null)}return v}return{getIntersections:function(t){var e=this.getValues(),i=t&&t!==this&&t.getValues();return i?r(e,i,this,t,[]):s(e,this,[])},statics:{getOverlaps:a,getIntersections:function(t,e,i,n,a,o){var h=!e;h&&(e=t);for(var c,u,f=t.length,d=e.length,p=[],g=[],v=0;v<d;v++)p[v]=e[v].getValues(a);for(v=0;v<f;v++){var _=t[v],m=h?p[v]:_.getValues(n),y=_.getPath();y!==u&&(u=y,c=[],g.push(c)),h&&s(m,_,c,i);for(var x=h?v+1:0;x<d;x++){if(o&&c.length)return c;r(m,p[x],_,e[x],c,i)}}c=[],v=0;for(var b=g.length;v<b;v++)l.push(c,g[v]);return c},getCurveLineIntersections:n,getTimesWithTangent:function(t,e){var i=t[0],n=t[1],r=t[2],s=t[3],a=t[4],o=t[5],h=t[6],c=t[7],l=e.normalize(),u=l.x,f=l.y,d=3*h-9*a+9*r-3*i,p=3*c-9*o+9*s-3*n,v=6*a-12*r+6*i,_=6*o-12*s+6*n,m=3*r-3*i,y=3*s-3*n,x=2*d*f-2*p*u,b=[];if(Math.abs(x)<g.CURVETIME_EPSILON){if(0!=(x=d*_-p*v)){var w=-(d*y-p*m)/x;w>=0&&w<=1&&b.push(w)}}else{var C=(v*v-4*d*m)*f*f+(-2*v*_+4*p*m+4*d*y)*u*f+(_*_-4*p*y)*u*u,S=v*f-_*u;if(C>=0&&0!=x){var T=Math.sqrt(C),k=-(S+T)/x,O=(-S+T)/x;k>=0&&k<=1&&b.push(k),O>=0&&O<=1&&b.push(O)}}return b}}}}),R=l.extend({_class:"CurveLocation",initialize:function(t,e,i,n,r){if(e>=.99999999){var s=t.getNext();s&&(e=0,t=s)}this._setCurve(t),this._time=e,this._point=i||t.getPointAtTime(e),this._overlap=n,this._distance=r,this._intersection=this._next=this._previous=null},_setCurve:function(t){var e=t._path;this._path=e,this._version=e?e._version:0,this._curve=t,this._segment=null,this._segment1=t._segment1,this._segment2=t._segment2},_setSegment:function(t){this._setCurve(t.getCurve()),this._segment=t,this._time=t===this._segment1?0:1,this._point=t._point.clone()},getSegment:function(){var t=this._segment;if(!t){var e=this.getCurve(),i=this.getTime();0===i?t=e._segment1:1===i?t=e._segment2:null!=i&&(t=e.getPartLength(0,i)<e.getPartLength(i,1)?e._segment1:e._segment2),this._segment=t}return t},getCurve:function(){var t=this._path,e=this;function i(t){var i=t&&t.getCurve();if(i&&null!=(e._time=i.getTimeOf(e._point)))return e._setCurve(i),i}return t&&t._version!==this._version&&(this._time=this._offset=this._curveOffset=this._curve=null),this._curve||i(this._segment)||i(this._segment1)||i(this._segment2.getPrevious())},getPath:function(){var t=this.getCurve();return t&&t._path},getIndex:function(){var t=this.getCurve();return t&&t.getIndex()},getTime:function(){var t=this.getCurve(),e=this._time;return t&&null==e?this._time=t.getTimeOf(this._point):e},getParameter:"#getTime",getPoint:function(){return this._point},getOffset:function(){var t=this._offset;if(null==t){t=0;var e=this.getPath(),i=this.getIndex();if(e&&null!=i)for(var n=e.getCurves(),r=0;r<i;r++)t+=n[r].getLength();this._offset=t+=this.getCurveOffset()}return t},getCurveOffset:function(){var t=this._curveOffset;if(null==t){var e=this.getCurve(),i=this.getTime();this._curveOffset=t=null!=i&&e&&e.getPartLength(0,i)}return t},getIntersection:function(){return this._intersection},getDistance:function(){return this._distance},divide:function(){var t=this.getCurve(),e=t&&t.divideAtTime(this.getTime());return e&&this._setSegment(e._segment1),e},split:function(){var t=this.getCurve(),e=t._path,i=t&&t.splitAtTime(this.getTime());return i&&this._setSegment(e.getLastSegment()),i},equals:function(t,e){var i=this===t;if(!i&&t instanceof R){var n=this.getCurve(),r=t.getCurve(),s=n._path;if(s===r._path){var a=Math.abs,o=a(this.getOffset()-t.getOffset()),h=!e&&this._intersection,c=!e&&t._intersection;i=(o<1e-7||s&&a(s.getLength()-o)<1e-7)&&(!h&&!c||h&&c&&h.equals(c,!0))}}return i},toString:function(){var t=[],e=this.getPoint(),i=p.instance;e&&t.push("point: "+e);var n=this.getIndex();null!=n&&t.push("index: "+n);var r=this.getTime();return null!=r&&t.push("time: "+i.number(r)),null!=this._distance&&t.push("distance: "+i.number(this._distance)),"{ "+t.join(", ")+" }"},isTouching:function(){var t=this._intersection;if(t&&this.getTangent().isCollinear(t.getTangent())){var e=this.getCurve(),i=t.getCurve();return!(e.isStraight()&&i.isStraight()&&e.getLine().intersect(i.getLine()))}return!1},isCrossing:function(){var t=this._intersection;if(!t)return!1;var e=this.getTime(),i=t.getTime(),n=e>=1e-8&&e<=1-1e-8,r=i>=1e-8&&i<=1-1e-8;if(n&&r)return!this.isTouching();var s=this.getCurve(),a=e<1e-8?s.getPrevious():s,o=t.getCurve(),h=i<1e-8?o.getPrevious():o;if(e>1-1e-8&&(s=s.getNext()),i>1-1e-8&&(o=o.getNext()),!(a&&s&&h&&o))return!1;var c=[];function l(t,e){var i=t.getValues(),n=F.classify(i).roots||F.getPeaks(i),r=n.length,s=e&&r>1?n[r-1]:r>0?n[0]:.5;c.push(F.getLength(i,e?s:0,e?1:s)/2)}function u(t,e,i){return e<i?t>e&&t<i:t>e||t<i}n||(l(a,!0),l(s,!1)),r||(l(h,!0),l(o,!1));var f=this.getPoint(),d=Math.min.apply(Math,c),p=n?s.getTangentAtTime(e):s.getPointAt(d).subtract(f),g=n?p.negate():a.getPointAt(-d).subtract(f),v=r?o.getTangentAtTime(i):o.getPointAt(d).subtract(f),_=r?v.negate():h.getPointAt(-d).subtract(f),m=g.getAngle(),y=p.getAngle(),x=_.getAngle(),b=v.getAngle();return!!(n?u(m,x,b)^u(y,x,b)&&u(m,b,x)^u(y,b,x):u(x,m,y)^u(b,m,y)&&u(x,y,m)^u(b,y,m))},hasOverlap:function(){return!!this._overlap}},l.each(F._evaluateMethods,function(t){var e=t+"At";this[t]=function(){var t=this.getCurve(),i=this.getTime();return null!=i&&t&&t[e](i,!0)}},{preserve:!0}),new function(){function t(t,e,i){var n=t.length,r=0,s=n-1;function a(i,r){for(var s=i+r;s>=-1&&s<=n;s+=r){var a=t[(s%n+n)%n];if(!e.getPoint().isClose(a.getPoint(),1e-7))break;if(e.equals(a))return a}return null}for(;r<=s;){var o,h=r+s>>>1,c=t[h];if(i&&(o=e.equals(c)?c:a(h,-1)||a(h,1)))return e._overlap&&(o._overlap=o._intersection._overlap=!0),o;var l=e.getPath(),u=c.getPath();(l!==u?l._id-u._id:e.getIndex()+e.getTime()-(c.getIndex()+c.getTime()))<0?s=h-1:r=h+1}return t.splice(r,0,e),e}return{statics:{insert:t,expand:function(e){for(var i=e.slice(),n=e.length-1;n>=0;n--)t(i,e[n]._intersection,!1);return i}}}}),B=k.extend({_class:"PathItem",_selectBounds:!1,_canScaleStroke:!0,beans:!0,initialize:function(){},statics:{create:function(t){var e,i,n;if(l.isPlainObject(t)?(i=t.segments,e=t.pathData):Array.isArray(t)?i=t:"string"==typeof t&&(e=t),i){var r=i[0];n=r&&Array.isArray(r[0])}else e&&(n=(e.match(/m/gi)||[]).length>1||/z\s*\S+/i.test(e));return new(n?z:N)(t)}},_asPathItem:function(){return this},isClockwise:function(){return this.getArea()>=0},setClockwise:function(t){this.isClockwise()!=(t=!!t)&&this.reverse()},setPathData:function(t){var e,i,n,r=t&&t.match(/[mlhvcsqtaz][^mlhvcsqtaz]*/gi),s=!1,a=new _,o=new _;function h(t,i){var n=+e[t];return s&&(n+=a[i]),n}function c(t){return new _(h(t,"x"),h(t+1,"y"))}this.clear();for(var l=0,u=r&&r.length;l<u;l++){var f=r[l],d=f[0],p=d.toLowerCase(),g=(e=f.match(/[+-]?(?:\d*\.\d+|\d+\.?)(?:[eE][+-]?\d+)?/g))&&e.length;switch(s=d===p,"z"!==i||/[mz]/.test(p)||this.moveTo(a),p){case"m":case"l":for(var v="m"===p,m=0;m<g;m+=2)this[v?"moveTo":"lineTo"](a=c(m)),v&&(o=a,v=!1);n=a;break;case"h":case"v":var x="h"===p?"x":"y";a=a.clone();for(m=0;m<g;m++)a[x]=h(m,x),this.lineTo(a);n=a;break;case"c":for(m=0;m<g;m+=6)this.cubicCurveTo(c(m),n=c(m+2),a=c(m+4));break;case"s":for(m=0;m<g;m+=4)this.cubicCurveTo(/[cs]/.test(i)?a.multiply(2).subtract(n):a,n=c(m),a=c(m+2)),i=p;break;case"q":for(m=0;m<g;m+=4)this.quadraticCurveTo(n=c(m),a=c(m+2));break;case"t":for(m=0;m<g;m+=2)this.quadraticCurveTo(n=/[qt]/.test(i)?a.multiply(2).subtract(n):a,a=c(m)),i=p;break;case"a":for(m=0;m<g;m+=7)this.arcTo(a=c(m+5),new y(+e[m],+e[m+1]),+e[m+2],+e[m+4],+e[m+3]);break;case"z":this.closePath(1e-12),a=o}i=p}},_canComposite:function(){return!(this.hasFill()&&this.hasStroke())},_contains:function(t){var e=t.isInside(this.getBounds({internal:!0,handle:!0}))?this._getWinding(t):{};return e.onPath||!!("evenodd"===this.getFillRule()?1&e.windingL||1&e.windingR:e.winding)},getIntersections:function(t,e,i,n){var r=this===t||!t,s=this._matrix._orNullIfIdentity(),a=r?s:(i||t._matrix)._orNullIfIdentity();return r||this.getBounds(s).intersects(t.getBounds(a),1e-12)?F.getIntersections(this.getCurves(),!r&&t.getCurves(),e,s,a,n):[]},getCrossings:function(t){return this.getIntersections(t,function(t){return t.hasOverlap()||t.isCrossing()})},getNearestLocation:function(){for(var t=_.read(arguments),e=this.getCurves(),i=1/0,n=null,r=0,s=e.length;r<s;r++){var a=e[r].getNearestLocation(t);a._distance<i&&(i=a._distance,n=a)}return n},getNearestPoint:function(){var t=this.getNearestLocation.apply(this,arguments);return t?t.getPoint():t},interpolate:function(t,e,i){var n=!this._children,r=n?"_segments":"_children",s=t[r],a=e[r],o=this[r];if(!s||!a||s.length!==a.length)throw new Error("Invalid operands in interpolate() call: "+t+", "+e);var h=o.length,c=a.length;if(h<c)for(var l=n?D:N,u=h;u<c;u++)this.add(new l);else h>c&&this[n?"removeSegments":"removeChildren"](c,h);for(u=0;u<c;u++)o[u].interpolate(s[u],a[u],i);n&&(this.setClosed(t._closed),this._changed(9))},compare:function(t){var e=!1;if(t){var i=this._children||[this],n=t._children?t._children.slice():[t],r=i.length,s=n.length,a=[],o=0;e=!0;for(var h=r-1;h>=0&&e;h--){var c=i[h];e=!1;for(var l=s-1;l>=0&&!e;l--)c.compare(n[l])&&(a[l]||(a[l]=!0,o++),e=!0)}e=e&&o===s}return e}}),N=B.extend({_class:"Path",_serializeFields:{segments:[],closed:!1},initialize:function(t){this._closed=!1,this._segments=[],this._version=0;var e=Array.isArray(t)?"object"==typeof t[0]?t:arguments:!t||t.size!==o||t.x===o&&t.point===o?null:arguments;e&&e.length>0?this.setSegments(e):(this._curves=o,this._segmentSelection=0,e||"string"!=typeof t||(this.setPathData(t),t=null)),this._initialize(!e&&t)},_equals:function(t){return this._closed===t._closed&&l.equals(this._segments,t._segments)},copyContent:function(t){this.setSegments(t._segments),this._closed=t._closed},_changed:function t(e){if(t.base.call(this,e),8&e){if(this._length=this._area=o,32&e)this._version++;else if(this._curves)for(var i=0,n=this._curves.length;i<n;i++)this._curves[i]._changed()}else 64&e&&(this._bounds=o)},getStyle:function(){var t=this._parent;return(t instanceof z?t:this)._style},getSegments:function(){return this._segments},setSegments:function(t){var e=this.isFullySelected(),i=t&&t.length;if(this._segments.length=0,this._segmentSelection=0,this._curves=o,i){var n=t[i-1];"boolean"==typeof n&&(this.setClosed(n),i--),this._add(D.readList(t,0,{},i))}e&&this.setFullySelected(!0)},getFirstSegment:function(){return this._segments[0]},getLastSegment:function(){return this._segments[this._segments.length-1]},getCurves:function(){var t=this._curves,e=this._segments;if(!t){var i=this._countCurves();t=this._curves=new Array(i);for(var n=0;n<i;n++)t[n]=new F(this,e[n],e[n+1]||e[0])}return t},getFirstCurve:function(){return this.getCurves()[0]},getLastCurve:function(){var t=this.getCurves();return t[t.length-1]},isClosed:function(){return this._closed},setClosed:function(t){if(this._closed!=(t=!!t)){if(this._closed=t,this._curves){var e=this._curves.length=this._countCurves();t&&(this._curves[e-1]=new F(this,this._segments[e-1],this._segments[0]))}this._changed(41)}}},{beans:!0,getPathData:function(t,e){var i,n,r,s,a,o,h,c,l=this._segments,u=l.length,f=new p(e),d=new Array(6),g=!0,v=[];function _(e,l){if(e._transformCoordinates(t,d),i=d[0],n=d[1],g)v.push("M"+f.pair(i,n)),g=!1;else if(a=d[2],o=d[3],a===i&&o===n&&h===r&&c===s){if(!l){var u=i-r,p=n-s;v.push(0===u?"v"+f.number(p):0===p?"h"+f.number(u):"l"+f.pair(u,p))}}else v.push("c"+f.pair(h-r,c-s)+" "+f.pair(a-r,o-s)+" "+f.pair(i-r,n-s));r=i,s=n,h=d[4],c=d[5]}if(!u)return"";for(var m=0;m<u;m++)_(l[m]);return this._closed&&u>0&&(_(l[0],!0),v.push("z")),v.join("")},isEmpty:function(){return!this._segments.length},_transformContent:function(t){for(var e=this._segments,i=new Array(6),n=0,r=e.length;n<r;n++)e[n]._transformCoordinates(t,i,!0);return!0},_add:function(t,e){for(var i=this._segments,n=this._curves,r=t.length,s=null==e,a=(e=s?i.length:e,0);a<r;a++){var o=t[a];o._path&&(o=t[a]=o.clone()),o._path=this,o._index=e+a,o._selection&&this._updateSelection(o,0,o._selection)}if(s)l.push(i,t);else{i.splice.apply(i,[e,0].concat(t));a=e+r;for(var h=i.length;a<h;a++)i[a]._index=a}if(n){var c=this._countCurves(),u=e>0&&e+r-1===c?e-1:e,f=u,d=Math.min(u+r,c);t._curves&&(n.splice.apply(n,[u,0].concat(t._curves)),f+=t._curves.length);for(a=f;a<d;a++)n.splice(a,0,new F(this,null,null));this._adjustCurves(u,d)}return this._changed(41),t},_adjustCurves:function(t,e){for(var i,n=this._segments,r=this._curves,s=t;s<e;s++)(i=r[s])._path=this,i._segment1=n[s],i._segment2=n[s+1]||n[0],i._changed();(i=r[this._closed&&!t?n.length-1:t-1])&&(i._segment2=n[t]||n[0],i._changed()),(i=r[e])&&(i._segment1=n[e],i._changed())},_countCurves:function(){var t=this._segments.length;return!this._closed&&t>0?t-1:t},add:function(t){return arguments.length>1&&"number"!=typeof t?this._add(D.readList(arguments)):this._add([D.read(arguments)])[0]},insert:function(t,e){return arguments.length>2&&"number"!=typeof e?this._add(D.readList(arguments,1),t):this._add([D.read(arguments,1)],t)[0]},addSegment:function(){return this._add([D.read(arguments)])[0]},insertSegment:function(t){return this._add([D.read(arguments,1)],t)[0]},addSegments:function(t){return this._add(D.readList(t))},insertSegments:function(t,e){return this._add(D.readList(e),t)},removeSegment:function(t){return this.removeSegments(t,t+1)[0]||null},removeSegments:function(t,e,i){t=t||0,e=l.pick(e,this._segments.length);var n=this._segments,r=this._curves,s=n.length,a=n.splice(t,e-t),o=a.length;if(!o)return a;for(var h=0;h<o;h++){var c=a[h];c._selection&&this._updateSelection(c,c._selection,0),c._index=c._path=null}h=t;for(var u=n.length;h<u;h++)n[h]._index=h;if(r){var f=t>0&&e===s+(this._closed?1:0)?t-1:t;for(h=(r=r.splice(f,o)).length-1;h>=0;h--)r[h]._path=null;i&&(a._curves=r.slice(1)),this._adjustCurves(f,f)}return this._changed(41),a},clear:"#removeSegments",hasHandles:function(){for(var t=this._segments,e=0,i=t.length;e<i;e++)if(t[e].hasHandles())return!0;return!1},clearHandles:function(){for(var t=this._segments,e=0,i=t.length;e<i;e++)t[e].clearHandles()},getLength:function(){if(null==this._length){for(var t=this.getCurves(),e=0,i=0,n=t.length;i<n;i++)e+=t[i].getLength();this._length=e}return this._length},getArea:function(){var t=this._area;if(null==t){var e=this._segments,i=this._closed;t=0;for(var n=0,r=e.length;n<r;n++){var s=n+1===r;t+=F.getArea(F.getValues(e[n],e[s?0:n+1],null,s&&!i))}this._area=t}return t},isFullySelected:function(){var t=this._segments.length;return this.isSelected()&&t>0&&this._segmentSelection===7*t},setFullySelected:function(t){t&&this._selectSegments(!0),this.setSelected(t)},setSelection:function t(e){1&e||this._selectSegments(!1),t.base.call(this,e)},_selectSegments:function(t){var e=this._segments,i=e.length,n=t?7:0;this._segmentSelection=n*i;for(var r=0;r<i;r++)e[r]._selection=n},_updateSelection:function(t,e,i){t._selection=i,(this._segmentSelection+=i-e)>0&&this.setSelected(!0)},divideAt:function(t){var e,i=this.getLocationAt(t);return i&&(e=i.getCurve().divideAt(i.getCurveOffset()))?e._segment1:null},splitAt:function(t){var e=this.getLocationAt(t),i=e&&e.index,n=e&&e.time;n>1-1e-8&&(i++,n=0);var r=this.getCurves();if(i>=0&&i<r.length){n>=1e-8&&r[i++].divideAtTime(n);var s,a=this.removeSegments(i,this._segments.length,!0);return this._closed?(this.setClosed(!1),s=this):((s=new N(k.NO_INSERT)).insertAbove(this),s.copyAttributes(this)),s._add(a,0),this.addSegment(a[0]),s}return null},split:function(t,e){var i,n=e===o?t:(i=this.getCurves()[t])&&i.getLocationAtTime(e);return null!=n?this.splitAt(n):null},join:function(t,e){var i=e||0;if(t&&t!==this){var n=t._segments,r=this.getLastSegment(),s=t.getLastSegment();if(!s)return this;r&&r._point.isClose(s._point,i)&&t.reverse();var a=t.getFirstSegment();if(r&&r._point.isClose(a._point,i))r.setHandleOut(a._handleOut),this._add(n.slice(1));else{var o=this.getFirstSegment();o&&o._point.isClose(a._point,i)&&t.reverse(),s=t.getLastSegment(),o&&o._point.isClose(s._point,i)?(o.setHandleIn(s._handleIn),this._add(n.slice(0,n.length-1),0)):this._add(n.slice())}t._closed&&this._add([n[0]]),t.remove()}var h=this.getFirstSegment(),c=this.getLastSegment();return h!==c&&h._point.isClose(c._point,i)&&(h.setHandleIn(c._handleIn),c.remove(),this.setClosed(!0)),this},reduce:function(t){for(var e=this.getCurves(),i=t&&t.simplify,n=i?1e-7:0,r=e.length-1;r>=0;r--){var s=e[r];!s.hasHandles()&&(!s.hasLength(n)||i&&s.isCollinear(s.getNext()))&&s.remove()}return this},reverse:function(){this._segments.reverse();for(var t=0,e=this._segments.length;t<e;t++){var i=this._segments[t],n=i._handleIn;i._handleIn=i._handleOut,i._handleOut=n,i._index=t}this._curves=null,this._changed(9)},flatten:function(t){for(var e=new V(this,t||.25,256,!0).parts,i=e.length,n=[],r=0;r<i;r++)n.push(new D(e[r].curve.slice(0,2)));!this._closed&&i>0&&n.push(new D(e[i-1].curve.slice(6))),this.setSegments(n)},simplify:function(t){var e=new U(this).fit(t||2.5);return e&&this.setSegments(e),!!e},smooth:function(t){var e=this,i=t||{},n=i.type||"asymmetric",r=this._segments,s=r.length,a=this._closed;function h(t,i){var n=t&&t.index;if(null!=n){var r=t.path;if(r&&r!==e)throw new Error(t._class+" "+n+" of "+r+" is not part of "+e);i&&t instanceof F&&n++}else n="number"==typeof t?t:i;return Math.min(n<0&&a?n%s:n<0?n+s:n,s-1)}var c=a&&i.from===o&&i.to===o,l=h(i.from,0),u=h(i.to,s-1);if(l>u)if(a)l-=s;else{var f=l;l=u,u=f}if(/^(?:asymmetric|continuous)$/.test(n)){var d="asymmetric"===n,p=Math.min,g=u-l+1,v=g-1,_=c?p(g,4):1,m=_,y=_,x=[];if(a||(m=p(1,l),y=p(1,s-u-1)),(v+=m+y)<=1)return;for(var b=0,w=l-m;b<=v;b++,w++)x[b]=r[(w<0?w+s:w)%s]._point;var C=x[0]._x+2*x[1]._x,S=x[0]._y+2*x[1]._y,T=2,k=v-1,O=[C],A=[S],P=[T],E=[],M=[];for(b=1;b<v;b++){var I=b<k,L=I?4:d?2:7,D=I?4:d?3:8,j=I?2:d?0:1,R=(I?1:d?1:2)/T;T=P[b]=L-R,C=O[b]=D*x[b]._x+j*x[b+1]._x-R*C,S=A[b]=D*x[b]._y+j*x[b+1]._y-R*S}E[k]=O[k]/P[k],M[k]=A[k]/P[k];for(b=v-2;b>=0;b--)E[b]=(O[b]-E[b+1])/P[b],M[b]=(A[b]-M[b+1])/P[b];E[v]=(3*x[v]._x-E[k])/2,M[v]=(3*x[v]._y-M[k])/2;b=m;var B=v-y;for(w=l;b<=B;b++,w++){var N=r[w<0?w+s:w],z=N._point,V=E[b]-z._x,U=M[b]-z._y;(c||b<B)&&N.setHandleOut(V,U),(c||b>m)&&N.setHandleIn(-V,-U)}}else for(b=l;b<=u;b++)r[b<0?b+s:b].smooth(i,!c&&b===l,!c&&b===u)},toShape:function(t){if(!this._closed)return null;var e,i,n,r,s,a,h,c=this._segments;function l(t,e){var i=c[t],n=i.getNext(),r=c[e],s=r.getNext();return i._handleOut.isZero()&&n._handleIn.isZero()&&r._handleOut.isZero()&&s._handleIn.isZero()&&n._point.subtract(i._point).isCollinear(s._point.subtract(r._point))}function u(t){var e=c[t],i=e.getNext(),n=e._handleOut,r=i._handleIn;if(n.isOrthogonal(r)){var s=e._point,a=i._point,o=new S(s,n,!0).intersect(new S(a,r,!0),!0);return o&&g.isZero(n.getLength()/o.subtract(s).getLength()-.5522847498307936)&&g.isZero(r.getLength()/o.subtract(a).getLength()-.5522847498307936)}return!1}function f(t,e){return c[t]._point.getDistance(c[e]._point)}if(!this.hasHandles()&&4===c.length&&l(0,2)&&l(1,3)&&(s=c[1],a=s.getPrevious(),h=s.getNext(),a._handleOut.isZero()&&s._handleIn.isZero()&&s._handleOut.isZero()&&h._handleIn.isZero()&&s._point.subtract(a._point).isOrthogonal(h._point.subtract(s._point)))?(e=P.Rectangle,i=new y(f(0,3),f(0,1)),r=c[1]._point.add(c[2]._point).divide(2)):8===c.length&&u(0)&&u(2)&&u(4)&&u(6)&&l(1,5)&&l(3,7)?(e=P.Rectangle,n=(i=new y(f(1,6),f(0,3))).subtract(new y(f(0,7),f(1,2))).divide(2),r=c[3]._point.add(c[4]._point).divide(2)):4===c.length&&u(0)&&u(1)&&u(2)&&u(3)&&(g.isZero(f(0,2)-f(1,3))?(e=P.Circle,n=f(0,2)/2):(e=P.Ellipse,n=new y(f(2,0)/2,f(3,1)/2)),r=c[1]._point),e){var d=this.getPosition(!0),p=new e({center:d,size:i,radius:n,insert:!1});return p.copyAttributes(this,!0),p._matrix.prepend(this._matrix),p.rotate(r.subtract(d).getAngle()+90),(t===o||t)&&p.insertAbove(this),p}return null},toPath:"#clone",compare:function t(e){if(!e||e instanceof z)return t.base.call(this,e);var i=this.getCurves(),n=e.getCurves(),r=i.length,s=n.length;if(!r||!s)return r==s;for(var a,o,h=i[0].getValues(),c=[],l=0,u=0,f=0;f<s;f++){var d=n[f].getValues();if(c.push(d),v=F.getOverlaps(h,d)){a=!f&&v[0][0]>0?s-1:f,o=v[0][1];break}}var p,g=Math.abs;for(d=c[a];h&&d;){var v;if(v=F.getOverlaps(h,d))if(g(v[0][0]-u)<1e-8){1===(u=v[1][0])&&(h=++l<r?i[l].getValues():null,u=0);var _=v[0][1];if(g(_-o)<1e-8){if(p||(p=[a,_]),1===(o=v[1][1])&&(++a>=s&&(a=0),d=c[a]||n[a].getValues(),o=0),!h)return p[0]===a&&p[1]===o;continue}}break}return!1},_hitTestSelf:function(t,e,i,n){var r,s,a,o,h,c,l=this,u=this.getStyle(),f=this._segments,d=f.length,p=this._closed,g=e._tolerancePadding,v=g,_=e.stroke&&u.hasStroke(),m=e.fill&&u.hasFill(),y=e.curves,x=_?u.getStrokeWidth()/2:m&&e.tolerance>0||y?0:null;function b(e,i){return t.subtract(e).divide(i).length<=1}function w(t,i,n){if(!e.selected||i.isSelected()){var r=t._point;if(i!==r&&(i=i.add(r)),b(i,v))return new L(n,l,{segment:t,point:i})}}function C(t,i){return(i||e.segments)&&w(t,t._point,"segment")||!i&&e.handles&&(w(t,t._handleIn,"handle-in")||w(t,t._handleOut,"handle-out"))}function S(t){o.add(t)}function T(e){var i,h=p||e._index>0&&e._index<d-1;return"round"===(h?r:s)?b(e._point,v):(o=new N({internal:!0,closed:!0}),h?e.isSmooth()||N._addBevelJoin(e,r,x,a,null,n,S,!0):"square"===s&&N._addSquareCap(e,s,x,null,n,S,!0),o.isEmpty()?void 0:o.contains(t)||(i=o.getNearestLocation(t))&&b(i.getPoint(),g))}if(null!==x&&(x>0?(r=u.getStrokeJoin(),s=u.getStrokeCap(),a=u.getMiterLimit(),v=v.add(N._getStrokePadding(x,n))):r=s="round"),!e.ends||e.segments||p){if(e.segments||e.handles)for(var k=0;k<d;k++)if(c=C(f[k]))return c}else if(c=C(f[0],!0)||C(f[d-1],!0))return c;if(null!==x){if(h=this.getNearestLocation(t)){var O=h.getTime();0===O||1===O&&d>1?T(h.getSegment())||(h=null):b(h.getPoint(),v)||(h=null)}if(!h&&"miter"===r&&d>1)for(k=0;k<d;k++){var A=f[k];if(t.getDistance(A._point)<=a*x&&T(A)){h=A.getLocation();break}}}return!h&&m&&this._contains(t)||h&&!_&&!y?new L("fill",this):h?new L(_?"stroke":"curve",this,{location:h,point:h.getPoint()}):null}},l.each(F._evaluateMethods,function(t){this[t+"At"]=function(e){var i=this.getLocationAt(e);return i&&i[t]()}},{beans:!1,getLocationOf:function(){for(var t=_.read(arguments),e=this.getCurves(),i=0,n=e.length;i<n;i++){var r=e[i].getLocationOf(t);if(r)return r}return null},getOffsetOf:function(){var t=this.getLocationOf.apply(this,arguments);return t?t.getOffset():null},getLocationAt:function(t){if("number"==typeof t){for(var e=this.getCurves(),i=0,n=0,r=e.length;n<r;n++){var s=i,a=e[n];if((i+=a.getLength())>t)return a.getLocationAt(t-s)}if(e.length>0&&t<=this.getLength())return new R(e[e.length-1],1)}else if(t&&t.getPath&&t.getPath()===this)return t;return null},getOffsetsWithTangent:function(){var t=_.read(arguments);if(t.isZero())return[];for(var e=[],i=0,n=this.getCurves(),r=0,s=n.length;r<s;r++){for(var a=n[r],o=a.getTimesWithTangent(t),h=0,c=o.length;h<c;h++){var l=i+a.getOffsetAtTime(o[h]);e.indexOf(l)<0&&e.push(l)}i+=a.length}return e}}),new function(){function t(t,e,i){var n,r,s,a,o,h,c,l,u=e._segments,f=u.length,d=new Array(6),p=!0;function g(e){if(i)e._transformCoordinates(i,d),n=d[0],r=d[1];else{var u=e._point;n=u._x,r=u._y}if(p)t.moveTo(n,r),p=!1;else{if(i)o=d[2],h=d[3];else{var f=e._handleIn;o=n+f._x,h=r+f._y}o===n&&h===r&&c===s&&l===a?t.lineTo(n,r):t.bezierCurveTo(c,l,o,h,n,r)}if(s=n,a=r,i)c=d[4],l=d[5];else{f=e._handleOut;c=s+f._x,l=a+f._y}}for(var v=0;v<f;v++)g(u[v]);e._closed&&f>0&&g(u[0])}return{_draw:function(e,i,n,r){var s=i.dontStart,a=i.dontFinish||i.clip,o=this.getStyle(),h=o.hasFill(),c=o.hasStroke(),l=o.getDashArray(),u=!lt.support.nativeDash&&c&&l&&l.length;function f(t){return l[(t%u+u)%u]}if(s||e.beginPath(),(h||c&&!u||a)&&(t(e,this,r),this._closed&&e.closePath()),!a&&(h||c)&&(this._setStyles(e,i,n),h&&(e.fill(o.getFillRule()),e.shadowColor="rgba(0,0,0,0)"),c)){if(u){s||e.beginPath();var d,p=new V(this,.25,32,!1,r),g=p.length,v=-o.getDashOffset(),_=0;for(v%=g;v>0;)v-=f(_--)+f(_--);for(;v<g;)d=v+f(_++),(v>0||d>0)&&p.drawPart(e,Math.max(v,0),Math.max(d,0)),v=d+f(_++)}e.stroke()}},_drawSelected:function(e,i){e.beginPath(),t(e,this,i),e.stroke(),function(t,e,i,n){var r,s,a=n/2,o=new Array(6);function h(e){var i=o[e],n=o[e+1];r==i&&s==n||(t.beginPath(),t.moveTo(r,s),t.lineTo(i,n),t.stroke(),t.beginPath(),t.arc(i,n,a,0,2*Math.PI,!0),t.fill())}for(var c=0,l=e.length;c<l;c++){var u=e[c],f=u._selection;if(u._transformCoordinates(i,o),r=o[0],s=o[1],2&f&&h(2),4&f&&h(4),t.fillRect(r-a,s-a,n,n),!(1&f)){var d=t.fillStyle;t.fillStyle="#ffffff",t.fillRect(r-a+1,s-a+1,n-2,n-2),t.fillStyle=d}}}(e,this._segments,i,lt.settings.handleSize)}}},new function(){function t(t){var e=t._segments;if(!e.length)throw new Error("Use a moveTo() command first");return e[e.length-1]}return{moveTo:function(){var t=this._segments;1===t.length&&this.removeSegment(0),t.length||this._add([new D(_.read(arguments))])},moveBy:function(){throw new Error("moveBy() is unsupported on Path items.")},lineTo:function(){this._add([new D(_.read(arguments))])},cubicCurveTo:function(){var e=_.read(arguments),i=_.read(arguments),n=_.read(arguments),r=t(this);r.setHandleOut(e.subtract(r._point)),this._add([new D(n,i.subtract(n))])},quadraticCurveTo:function(){var e=_.read(arguments),i=_.read(arguments),n=t(this)._point;this.cubicCurveTo(e.add(n.subtract(e).multiply(1/3)),e.add(i.subtract(e).multiply(1/3)),i)},curveTo:function(){var e=_.read(arguments),i=_.read(arguments),n=l.pick(l.read(arguments),.5),r=1-n,s=t(this)._point,a=e.subtract(s.multiply(r*r)).subtract(i.multiply(n*n)).divide(2*n*r);if(a.isNaN())throw new Error("Cannot put a curve through points with parameter = "+n);this.quadraticCurveTo(a,i)},arcTo:function(){var e,i,n,r,s=Math.abs,a=Math.sqrt,o=t(this),h=o._point,c=_.read(arguments),u=l.peek(arguments);if("boolean"==typeof(m=l.pick(u,!0)))var f=(b=h.add(c).divide(2)).add(b.subtract(h).rotate(m?-90:90));else if(l.remain(arguments)<=2)f=c,c=_.read(arguments);else{var d=y.read(arguments),p=g.isZero;if(p(d.width)||p(d.height))return this.lineTo(c);var v=l.read(arguments),m=!!l.read(arguments),x=!!l.read(arguments),b=h.add(c).divide(2),w=(H=h.subtract(b).rotate(-v)).x,T=H.y,k=s(d.width),O=s(d.height),A=k*k,P=O*O,E=w*w,M=T*T,I=a(E/A+M/P);if(I>1&&(A=(k*=I)*k,P=(O*=I)*O),s(I=(A*P-A*M-P*E)/(A*M+P*E))<1e-12&&(I=0),I<0)throw new Error("Cannot create an arc with the given arguments");e=new _(k*T/O,-O*w/k).multiply((x===m?-1:1)*a(I)).rotate(v).add(b),i=(n=(r=(new C).translate(e).rotate(v).scale(k,O))._inverseTransform(h)).getDirectedAngle(r._inverseTransform(c)),!m&&i>0?i-=360:m&&i<0&&(i+=360)}if(f){var L=new S(h.add(f).divide(2),f.subtract(h).rotate(90),!0),j=new S(f.add(c).divide(2),c.subtract(f).rotate(90),!0),F=new S(h,c),R=F.getSide(f);if(!(e=L.intersect(j,!0))){if(!R)return this.lineTo(c);throw new Error("Cannot create an arc with the given arguments")}i=(n=h.subtract(e)).getDirectedAngle(c.subtract(e));var B=F.getSide(e,!0);0===B?i=R*s(i):R===B&&(i+=i<0?360:-360)}for(var N=s(i),z=N>=360?4:Math.ceil((N-1e-7)/90),V=i/z,U=V*Math.PI/360,W=4/3*Math.sin(U)/(1+Math.cos(U)),X=[],G=0;G<=z;G++){var H=c,Y=null;if(G<z&&(Y=n.rotate(90).multiply(W),r?(H=r._transformPoint(n),Y=r._transformPoint(n.add(Y)).subtract(H)):H=e.add(n)),G){var q=n.rotate(-90).multiply(W);r&&(q=r._transformPoint(n.add(q)).subtract(H)),X.push(new D(H,q,Y))}else o.setHandleOut(Y);n=n.rotate(V)}this._add(X)},lineBy:function(){var e=_.read(arguments),i=t(this)._point;this.lineTo(i.add(e))},curveBy:function(){var e=_.read(arguments),i=_.read(arguments),n=l.read(arguments),r=t(this)._point;this.curveTo(r.add(e),r.add(i),n)},cubicCurveBy:function(){var e=_.read(arguments),i=_.read(arguments),n=_.read(arguments),r=t(this)._point;this.cubicCurveTo(r.add(e),r.add(i),r.add(n))},quadraticCurveBy:function(){var e=_.read(arguments),i=_.read(arguments),n=t(this)._point;this.quadraticCurveTo(n.add(e),n.add(i))},arcBy:function(){var e=t(this)._point,i=e.add(_.read(arguments)),n=l.pick(l.peek(arguments),!0);"boolean"==typeof n?this.arcTo(i,n):this.arcTo(i,e.add(_.read(arguments)))},closePath:function(t){this.setClosed(!0),this.join(this,t)}}},{_getBounds:function(t,e){var i=e.handle?"getHandleBounds":e.stroke?"getStrokeBounds":"getBounds";return N[i](this._segments,this._closed,this,t,e)},statics:{getBounds:function(t,e,i,n,r,s){var a=t[0];if(!a)return new b;var o=new Array(6),h=a._transformCoordinates(n,new Array(6)),c=h.slice(0,2),l=c.slice(),u=new Array(2);function f(t){t._transformCoordinates(n,o);for(var e=0;e<2;e++)F._addBounds(h[e],h[e+4],o[e+2],o[e],e,s?s[e]:0,c,l,u);var i=h;h=o,o=i}for(var d=1,p=t.length;d<p;d++)f(t[d]);return e&&f(a),new b(c[0],c[1],l[0]-c[0],l[1]-c[1])},getStrokeBounds:function(t,e,i,n,r){var s=i.getStyle(),a=s.hasStroke(),o=s.getStrokeWidth(),h=a&&i._getStrokeMatrix(n,r),c=a&&N._getStrokePadding(o,h),l=N.getBounds(t,e,i,n,r,c);if(!a)return l;var u=o/2,f=s.getStrokeJoin(),d=s.getStrokeCap(),p=s.getMiterLimit(),g=new b(new y(c));function v(t){l=l.include(t)}function _(t){l=l.unite(g.setCenter(t._point.transform(n)))}function m(t,e){"round"===e||t.isSmooth()?_(t):N._addBevelJoin(t,e,u,p,n,h,v)}function x(t,e){"round"===e?_(t):N._addSquareCap(t,e,u,n,h,v)}for(var w=t.length-(e?0:1),C=1;C<w;C++)m(t[C],f);return e?m(t[0],f):w>0&&(x(t[0],d),x(t[t.length-1],d)),l},_getStrokePadding:function(t,e){if(!e)return[t,t];var i=new _(t,0).transform(e),n=new _(0,t).transform(e),r=i.getAngleInRadians(),s=i.getLength(),a=n.getLength(),o=Math.sin(r),h=Math.cos(r),c=Math.tan(r),l=Math.atan2(a*c,s),u=Math.atan2(a,c*s);return[Math.abs(s*Math.cos(l)*h+a*Math.sin(l)*o),Math.abs(a*Math.sin(u)*h+s*Math.cos(u)*o)]},_addBevelJoin:function(t,e,i,n,r,s,a,o){var h=t.getCurve(),c=h.getPrevious(),l=h.getPoint1().transform(r),u=c.getNormalAtTime(1).multiply(i).transform(s),f=h.getNormalAtTime(0).multiply(i).transform(s);if(u.getDirectedAngle(f)<0&&(u=u.negate(),f=f.negate()),o&&a(l),a(l.add(u)),"miter"===e){var d=new S(l.add(u),new _(-u.y,u.x),!0).intersect(new S(l.add(f),new _(-f.y,f.x),!0),!0);d&&l.getDistance(d)<=n*i&&a(d)}a(l.add(f))},_addSquareCap:function(t,e,i,n,r,s,a){var o=t._point.transform(n),h=t.getLocation(),c=h.getNormal().multiply(0===h.getTime()?i:-i).transform(r);"square"===e&&(a&&(s(o.subtract(c)),s(o.add(c))),o=o.add(c.rotate(-90))),s(o.add(c)),s(o.subtract(c))},getHandleBounds:function(t,e,i,n,r){var s,a,o=i.getStyle();if(r.stroke&&o.hasStroke()){var h=i._getStrokeMatrix(n,r),c=o.getStrokeWidth()/2,l=c;"miter"===o.getStrokeJoin()&&(l=c*o.getMiterLimit()),"square"===o.getStrokeCap()&&(l=Math.max(l,c*Math.SQRT2)),s=N._getStrokePadding(c,h),a=N._getStrokePadding(l,h)}for(var u=new Array(6),f=1/0,d=-f,p=f,g=d,v=0,_=t.length;v<_;v++){t[v]._transformCoordinates(n,u);for(var m=0;m<6;m+=2){var y=m?s:a,x=y?y[0]:0,w=y?y[1]:0,C=u[m],S=u[m+1],T=C-x,k=C+x,O=S-w,A=S+w;T<f&&(f=T),k>d&&(d=k),O<p&&(p=O),A>g&&(g=A)}}return new b(f,p,d-f,g-p)}}});N.inject({statics:new function(){var t=.5522847498307936,e=[new D([-1,0],[0,t],[0,-t]),new D([0,-1],[-t,0],[t,0]),new D([1,0],[0,-t],[0,t]),new D([0,1],[t,0],[-t,0])];function i(t,e,i){var n=l.getNamed(i),r=new N(n&&0==n.insert&&k.NO_INSERT);return r._add(t),r._closed=e,r.set(n,{insert:!0})}function n(t,n,r){for(var s=new Array(4),a=0;a<4;a++){var o=e[a];s[a]=new D(o._point.multiply(n).add(t),o._handleIn.multiply(n),o._handleOut.multiply(n))}return i(s,!0,r)}return{Line:function(){return i([new D(_.readNamed(arguments,"from")),new D(_.readNamed(arguments,"to"))],!1,arguments)},Circle:function(){var t=_.readNamed(arguments,"center"),e=l.readNamed(arguments,"radius");return n(t,new y(e),arguments)},Rectangle:function(){var e,n=b.readNamed(arguments,"rectangle"),r=y.readNamed(arguments,"radius",0,{readNull:!0}),s=n.getBottomLeft(!0),a=n.getTopLeft(!0),o=n.getTopRight(!0),h=n.getBottomRight(!0);if(!r||r.isZero())e=[new D(s),new D(a),new D(o),new D(h)];else{var c=(r=y.min(r,n.getSize(!0).divide(2))).width,l=r.height,u=c*t,f=l*t;e=[new D(s.add(c,0),null,[-u,0]),new D(s.subtract(0,l),[0,f]),new D(a.add(0,l),null,[0,-f]),new D(a.add(c,0),[-u,0],null),new D(o.subtract(c,0),null,[u,0]),new D(o.add(0,l),[0,-f],null),new D(h.subtract(0,l),null,[0,f]),new D(h.subtract(c,0),[u,0])]}return i(e,!0,arguments)},RoundRectangle:"#Rectangle",Ellipse:function(){var t=P._readEllipse(arguments);return n(t.center,t.radius,arguments)},Oval:"#Ellipse",Arc:function(){var t=_.readNamed(arguments,"from"),e=_.readNamed(arguments,"through"),i=_.readNamed(arguments,"to"),n=l.getNamed(arguments),r=new N(n&&0==n.insert&&k.NO_INSERT);return r.moveTo(t),r.arcTo(e,i),r.set(n)},RegularPolygon:function(){for(var t=_.readNamed(arguments,"center"),e=l.readNamed(arguments,"sides"),n=l.readNamed(arguments,"radius"),r=360/e,s=e%3==0,a=new _(0,s?-n:n),o=s?-1:.5,h=new Array(e),c=0;c<e;c++)h[c]=new D(t.add(a.rotate((c+o)*r)));return i(h,!0,arguments)},Star:function(){for(var t=_.readNamed(arguments,"center"),e=2*l.readNamed(arguments,"points"),n=l.readNamed(arguments,"radius1"),r=l.readNamed(arguments,"radius2"),s=360/e,a=new _(0,-1),o=new Array(e),h=0;h<e;h++)o[h]=new D(t.add(a.rotate(s*h).multiply(h%2?r:n)));return i(o,!0,arguments)}}}});var z=B.extend({_class:"CompoundPath",_serializeFields:{children:[]},beans:!0,initialize:function(t){this._children=[],this._namedChildren={},this._initialize(t)||("string"==typeof t?this.setPathData(t):this.addChildren(Array.isArray(t)?t:arguments))},insertChildren:function t(e,i){var n=i,r=n[0];r&&"number"==typeof r[0]&&(n=[n]);for(var s=i.length-1;s>=0;s--){var a=n[s];n!==i||a instanceof N||(n=l.slice(n)),Array.isArray(a)?n[s]=new N({segments:a,insert:!1}):a instanceof z&&(n.splice.apply(n,[s,1].concat(a.removeChildren())),a.remove())}return t.base.call(this,e,n)},reduce:function t(e){for(var i=this._children,n=i.length-1;n>=0;n--){var r;(r=i[n].reduce(e)).isEmpty()&&r.remove()}return i.length?t.base.call(this):((r=new N(k.NO_INSERT)).copyAttributes(this),r.insertAbove(this),this.remove(),r)},isClosed:function(){for(var t=this._children,e=0,i=t.length;e<i;e++)if(!t[e]._closed)return!1;return!0},setClosed:function(t){for(var e=this._children,i=0,n=e.length;i<n;i++)e[i].setClosed(t)},getFirstSegment:function(){var t=this.getFirstChild();return t&&t.getFirstSegment()},getLastSegment:function(){var t=this.getLastChild();return t&&t.getLastSegment()},getCurves:function(){for(var t=this._children,e=[],i=0,n=t.length;i<n;i++)l.push(e,t[i].getCurves());return e},getFirstCurve:function(){var t=this.getFirstChild();return t&&t.getFirstCurve()},getLastCurve:function(){var t=this.getLastChild();return t&&t.getLastCurve()},getArea:function(){for(var t=this._children,e=0,i=0,n=t.length;i<n;i++)e+=t[i].getArea();return e},getLength:function(){for(var t=this._children,e=0,i=0,n=t.length;i<n;i++)e+=t[i].getLength();return e},getPathData:function(t,e){for(var i=this._children,n=[],r=0,s=i.length;r<s;r++){var a=i[r],o=a._matrix;n.push(a.getPathData(t&&!o.isIdentity()?t.appended(o):t,e))}return n.join("")},_hitTestChildren:function t(e,i,n){return t.base.call(this,e,i.class===N||"path"===i.type?i:l.set({},i,{fill:!1}),n)},_draw:function(t,e,i,n){var r=this._children;if(r.length){e=e.extend({dontStart:!0,dontFinish:!0}),t.beginPath();for(var s=0,a=r.length;s<a;s++)r[s].draw(t,e,n);if(!e.clip){this._setStyles(t,e,i);var o=this._style;o.hasFill()&&(t.fill(o.getFillRule()),t.shadowColor="rgba(0,0,0,0)"),o.hasStroke()&&t.stroke()}}},_drawSelected:function(t,e,i){for(var n=this._children,r=0,s=n.length;r<s;r++){var a=n[r],o=a._matrix;i[a._id]||a._drawSelected(t,o.isIdentity()?e:e.appended(o))}}},new function(){function t(t,e){var i=t._children;if(e&&!i.length)throw new Error("Use a moveTo() command first");return i[i.length-1]}return l.each(["lineTo","cubicCurveTo","quadraticCurveTo","curveTo","arcTo","lineBy","cubicCurveBy","quadraticCurveBy","curveBy","arcBy"],function(e){this[e]=function(){var i=t(this,!0);i[e].apply(i,arguments)}},{moveTo:function(){var e=t(this),i=e&&e.isEmpty()?e:new N(k.NO_INSERT);i!==e&&this.addChild(i),i.moveTo.apply(i,arguments)},moveBy:function(){var e=t(this,!0),i=e&&e.getLastSegment(),n=_.read(arguments);this.moveTo(i?n.add(i._point):n)},closePath:function(e){t(this,!0).closePath(e)}})},l.each(["reverse","flatten","simplify","smooth"],function(t){this[t]=function(e){for(var i,n=this._children,r=0,s=n.length;r<s;r++)i=n[r][t](e)||i;return i}},{}));B.inject(new function(){var t=Math.min,e=Math.max,i=Math.abs,n={unite:{1:!0,2:!0},intersect:{2:!0},subtract:{1:!0},exclude:{1:!0,"-1":!0}};function r(t,e){var i=t.clone(!1).reduce({simplify:!0}).transform(null,!0,!0);return e?i.resolveCrossings().reorient("nonzero"===i.getFillRule(),!0):i}function s(t,e,i,n,r){var s=new z(k.NO_INSERT);return s.addChildren(t,!0),s=s.reduce({simplify:e}),r&&0==r.insert||s.insertAbove(n&&i.isSibling(n)&&i.getIndex()<n.getIndex()?n:i),s.copyAttributes(i,!0),s}function a(t,e,i,a){if(a&&(0==a.trace||a.stroke)&&/^(subtract|intersect)$/.test(i))return h(t,e,i);var o=r(t,!0),c=e&&t!==e&&r(e,!0),u=n[i];u[i]=!0,c&&(u.subtract||u.exclude)^c.isClockwise()^o.isClockwise()&&c.reverse();var p,g=d(R.expand(o.getCrossings(c))),m=o._children||[o],y=c&&(c._children||[c]),x=[],b=[];function w(t){for(var e=0,i=t.length;e<i;e++){var n=t[e];l.push(x,n._segments),l.push(b,n.getCurves()),n._overlapsOnly=!0}}if(g.length){w(m),y&&w(y);for(var C=0,S=g.length;C<S;C++)v(g[C]._segment,o,c,b,u);for(C=0,S=x.length;C<S;C++){var T=x[C],k=T._intersection;T._winding||v(T,o,c,b,u),k&&k._overlap||(T._path._overlapsOnly=!1)}p=_(x,u)}else p=f(y?m.concat(y):m.slice(),function(t){return!!u[t]});return s(p,!0,t,e,a)}function h(t,e,i){var n=r(t),a=r(e),o=n.getCrossings(a),h="subtract"===i,c="divide"===i,l={},u=[];function f(t){if(!l[t._id]&&(c||a.contains(t.getPointAt(t.getLength()/2))^h))return u.unshift(t),l[t._id]=!0}for(var d=o.length-1;d>=0;d--){var p=o[d].split();p&&(f(p)&&p.getFirstSegment().setHandleIn(0,0),n.getLastSegment().setHandleOut(0,0))}return f(n),s(u,!1,t,e)}function c(t,e){for(var i=t;i;){if(i===e)return;i=i._previous}for(;t._next&&t._next!==e;)t=t._next;if(!t._next){for(;e._previous;)e=e._previous;t._next=e,e._previous=t}}function u(t){for(var e=t.length-1;e>=0;e--)t[e].clearHandles()}function f(t,e,n){var r=t&&t.length;if(r){var s=l.each(t,function(t,e){this[t._id]={container:null,winding:t.isClockwise()?1:-1,index:e}},{}),a=t.slice().sort(function(t,e){return i(e.getArea())-i(t.getArea())}),o=a[0];null==n&&(n=o.isClockwise());for(var h=0;h<r;h++){for(var c=a[h],u=s[c._id],f=c.getInteriorPoint(),d=0,p=h-1;p>=0;p--){var g=a[p];if(g.contains(f)){var v=s[g._id];d=v.winding,u.winding+=d,u.container=v.exclude?v.container:g;break}}if(e(u.winding)===e(d))u.exclude=!0,t[u.index]=null;else{var _=u.container;c.setClockwise(_?!_.isClockwise():n)}}}return t}function d(t,e,i){var n,r,s,a=e&&[],o=!1,h=i||[],l=i&&{};function f(t){return t._path._id+"."+t._segment1._index}for(var d=(i&&i.length)-1;d>=0;d--){(p=i[d])._path&&(l[f(p)]=!0)}for(d=t.length-1;d>=0;d--){var p,g,v=t[d],_=v._time,m=_,y=e&&!e(v);if((p=v._curve)&&(p!==r?(o=!p.hasHandles()||l&&l[f(p)],n=[],s=null,r=p):s>=1e-8&&(_/=s)),y)n&&n.push(v);else{if(e&&a.unshift(v),s=m,_<1e-8)g=p._segment1;else if(_>1-1e-8)g=p._segment2;else{var x=p.divideAtTime(_,!0);o&&h.push(p,x),g=x._segment1;for(var b=n.length-1;b>=0;b--){var w=n[b];w._time=(w._time-_)/(1-_)}}v._setSegment(g);var C=g._intersection,S=v._intersection;if(C){c(C,S);for(var T=C;T;)c(T._intersection,C),T=T._next}else g._intersection=S}}return i||u(h),a||t}function p(n,r,s,a,o){var h,c,l=s?1:0,u=1^l,f=[n.x,n.y],d=f[l],g=f[u],v=1e-6,_=d-1e-9,m=d+1e-9,y=0,x=0,b=0,w=0,C=!1,S=!1,T=1,k=[];function O(i){var c=i[u+0],f=i[u+6];if(!(g<t(c,f)||g>e(c,f))){var y=i[l+0],x=i[l+2],S=i[l+4],O=i[l+6];if(c!==f){var A=g===c?0:g===f?1:_>e(y,x,S,O)||m<t(y,x,S,O)?1:F.solveCubic(i,u,g,k,0,1)>0?k[0]:1,P=0===A?y:1===A?O:F.getPoint(i,A)[s?"y":"x"],E=c>f?1:-1,M=h[u]>h[u+6]?1:-1,I=h[l+6];return g!==c?(P<_?b+=E:P>m?w+=E:C=!0,P>d-v&&P<d+v&&(T/=2)):(E!==M?y<_?b+=E:y>m&&(w+=E):y!=I&&(I<m&&P>m?(w+=E,C=!0):I>_&&P<_&&(b+=E,C=!0)),T=0),h=i,!o&&P>_&&P<m&&0===F.getTangent(i,A)[s?"x":"y"]&&p(n,r,!s,a,!0)}(y<m&&O>_||O<m&&y>_)&&(C=!0)}}function A(i){var n=i[u+0],r=i[u+2],a=i[u+4],o=i[u+6];if(g<=e(n,r,a,o)&&g>=t(n,r,a,o))for(var h,c=i[l+0],f=i[l+2],d=i[l+4],p=i[l+6],v=_>e(c,f,d,p)||m<t(c,f,d,p)?[i]:F.getMonoCurves(i,s),y=0,x=v.length;y<x;y++)if(h=O(v[y]))return h}for(var P=0,E=r.length;P<E;P++){var M,I=r[P],L=I._path,D=I.getValues();if(!(P&&r[P-1]._path===L||(h=null,L._closed||(c=F.getValues(L.getLastCurve().getSegment2(),I.getSegment1(),null,!a))[u]!==c[u+6]&&(h=c),h))){h=D;for(var j=L.getLastCurve();j&&j!==I;){var R=j.getValues();if(R[u]!==R[u+6]){h=R;break}j=j.getPrevious()}}if(M=A(D))return M;if(P+1===E||r[P+1]._path!==L){if(c&&(M=A(c)))return M;!C||b||w||(b=w=L.isClockwise(a)^s?1:-1),y+=b,x+=w,b=w=0,C&&(S=!0,C=!1),c=null}}return y=i(y),x=i(x),{winding:e(y,x),windingL:y,windingR:x,quality:T,onPath:S}}function v(t,e,n,r,s){var a=[],o=t,h=0;do{var c=(y=t.getCurve()).getLength();a.push({segment:t,curve:y,length:c}),h+=c,t=t.getNext()}while(t&&!t._intersection&&t!==o);for(var l=[.5,.25,.75],u={winding:0,quality:-1},f=0;f<l.length&&u.quality<.5;f++){c=h*l[f];for(var d=0,v=a.length;d<v;d++){var _=a[d],m=_.length;if(c<=m){var y,x=(y=_.curve)._path,b=x._parent,w=b instanceof z?b:x,C=g.clamp(y.getTimeAt(c),1e-8,1-1e-8),S=y.getPointAtTime(C),T=i(y.getTangentAtTime(C).y)<Math.SQRT1_2,k=null;if(s.subtract&&n){var O=w===e?n._getWinding(S,T,!0):e._getWinding(S,T,!0);if(w===e&&O.winding||w===n&&!O.winding){if(O.quality<1)continue;k={winding:0,quality:1}}}(k=k||p(S,r,T,!0)).quality>u.quality&&(u=k);break}c-=m}}for(d=a.length-1;d>=0;d--)a[d].segment._winding=u}function _(t,e){var i,n=[];function r(t){var i;return!(!t||t._visited||e&&(!e[(i=t._winding||{}).winding]||e.unite&&2===i.winding&&i.windingL&&i.windingR))}function s(t){if(t)for(var e=0,n=i.length;e<n;e++)if(t===i[e])return!0;return!1}function a(t){for(var e=t._segments,i=0,n=e.length;i<n;i++)e[i]._visited=!0}function o(t,e){var n=t._intersection,a=n,o=[];function h(n,a){for(;n&&n!==a;){var h=n._segment,c=h&&h._path;if(c){var l=h.getNext()||c.getFirstSegment(),u=l._intersection;h!==t&&(s(h)||s(l)||l&&r(h)&&(r(l)||u&&r(u._segment)))&&o.push(h),e&&i.push(h)}n=n._next}}if(e&&(i=[t]),n){for(h(n);n&&n._prev;)n=n._prev;h(n,a)}return o}t.sort(function(t,e){var i=t._intersection,n=e._intersection,r=!(!i||!i._overlap),s=!(!n||!n._overlap),a=t._path,o=e._path;return r^s?r?1:-1:!i^!n?i?1:-1:a!==o?a._id-o._id:t._index-e._index});for(var h=0,c=t.length;h<c;h++){var l,u,f,d=t[h],p=r(d),g=null,v=!1,_=!0,m=[];if(p&&d._path._overlapsOnly){var y=d._path,x=d._intersection._segment._path;y.compare(x)&&(y.getArea()&&n.push(y.clone(!1)),a(y),a(x),p=!1)}for(;p;){var b=!g,w=o(d,b),C=w.shift(),S=!(v=!b&&(s(d)||s(C)))&&C;if(b&&(g=new N(k.NO_INSERT),l=null),v){(d.isFirst()||d.isLast())&&(_=d._path._closed),d._visited=!0;break}if(S&&l&&(m.push(l),l=null),l||(S&&w.push(d),l={start:g._segments.length,crossings:w,visited:u=[],handleIn:f}),S&&(d=C),!r(d)){g.removeSegments(l.start);for(var T=0,O=u.length;T<O;T++)u[T]._visited=!1;u.length=0;do{(d=l&&l.crossings.shift())&&d._path||(d=null,(l=m.pop())&&(u=l.visited,f=l.handleIn))}while(l&&!r(d));if(!d)break}var A=d.getNext();g.add(new D(d._point,f,A&&d._handleOut)),d._visited=!0,u.push(d),d=A||d._path.getFirstSegment(),f=A&&A._handleIn}v&&(_&&(g.getFirstSegment().setHandleIn(f),g.setClosed(_)),0!==g.getArea()&&n.push(g))}return n}return{_getWinding:function(t,e,i){return p(t,this.getCurves(),e,i)},unite:function(t,e){return a(this,t,"unite",e)},intersect:function(t,e){return a(this,t,"intersect",e)},subtract:function(t,e){return a(this,t,"subtract",e)},exclude:function(t,e){return a(this,t,"exclude",e)},divide:function(t,e){return e&&(0==e.trace||e.stroke)?h(this,t,"divide"):s([this.subtract(t,e),this.intersect(t,e)],!0,this,t,e)},resolveCrossings:function(){var t=this._children,e=t||[this];function i(t,e){var i=t&&t._intersection;return i&&i._overlap&&i._path===e}var n=!1,r=!1,s=this.getIntersections(null,function(t){return t.hasOverlap()&&(n=!0)||t.isCrossing()&&(r=!0)}),a=n&&r&&[];if(s=R.expand(s),n)for(var o=d(s,function(t){return t.hasOverlap()},a),h=o.length-1;h>=0;h--){var c=o[h],f=c._path,p=c._segment,g=p.getPrevious(),v=p.getNext();i(g,f)&&i(v,f)&&(p.remove(),g._handleOut._set(0,0),v._handleIn._set(0,0),g===p||g.getCurve().hasLength()||(v._handleIn.set(g._handleIn),g.remove()))}r&&(d(s,n&&function(t){var e=t.getCurve(),i=t.getSegment(),n=t._intersection,r=n._curve,s=n._segment;if(e&&r&&e._path&&r._path)return!0;i&&(i._intersection=null),s&&(s._intersection=null)},a),a&&u(a),e=_(l.each(e,function(t){l.push(this,t._segments)},[])));var m,y=e.length;return y>1&&t?(e!==t&&this.setChildren(e),m=this):1!==y||t||(e[0]!==this&&this.setSegments(e[0].removeSegments()),m=this),m||((m=new z(k.NO_INSERT)).addChildren(e),(m=m.reduce()).copyAttributes(this),this.replaceWith(m)),m},reorient:function(t,e){var i=this._children;return i&&i.length?this.setChildren(f(this.removeChildren(),function(e){return!!(t?e:1&e)},e)):e!==o&&this.setClockwise(e),this},getInteriorPoint:function(){var i=this.getBounds().getCenter(!0);if(!this.contains(i)){for(var n=this.getCurves(),r=i.y,s=[],a=[],o=0,h=n.length;o<h;o++){var c=n[o].getValues(),l=c[1],u=c[3],f=c[5],d=c[7];if(r>=t(l,u,f,d)&&r<=e(l,u,f,d))for(var p=F.getMonoCurves(c),g=0,v=p.length;g<v;g++){var _=p[g],m=_[1],y=_[7];if(m!==y&&(r>=m&&r<=y||r>=y&&r<=m)){var x=r===m?_[0]:r===y?_[6]:1===F.solveCubic(_,1,r,a,0,1)?F.getPoint(_,a[0]).x:(_[0]+_[6])/2;s.push(x)}}}s.length>1&&(s.sort(function(t,e){return t-e}),i.x=(s[0]+s[1])/2)}return i}}});var V=l.extend({_class:"PathFlattener",initialize:function(t,e,i,n,r){var s,a=[],o=[],h=0,c=1/(i||32),l=t._segments,u=l[0];function f(t,i){var s=F.getValues(t,i,r);a.push(s),function t(i,r,s,a){if(!(a-s>c)||n&&F.isStraight(i)||F.isFlatEnough(i,e||.25)){var l=i[6]-i[0],u=i[7]-i[1],f=Math.sqrt(l*l+u*u);f>0&&(h+=f,o.push({offset:h,curve:i,index:r,time:a}))}else{var d=F.subdivide(i,.5),p=(s+a)/2;t(d[0],r,s,p),t(d[1],r,p,a)}}(s,t._index,0,1)}for(var d=1,p=l.length;d<p;d++)f(u,s=l[d]),u=s;t._closed&&f(s||u,l[0]),this.curves=a,this.parts=o,this.length=h,this.index=0},_get:function(t){for(var e,i=this.parts,n=i.length,r=this.index;e=r,r&&!(i[--r].offset<t););for(;e<n;e++){var s=i[e];if(s.offset>=t){this.index=e;var a=i[e-1],o=a&&a.index===s.index?a.time:0,h=a?a.offset:0;return{index:s.index,time:o+(s.time-o)*(t-h)/(s.offset-h)}}}return{index:i[n-1].index,time:1}},drawPart:function(t,e,i){for(var n=this._get(e),r=this._get(i),s=n.index,a=r.index;s<=a;s++){var o=F.getPart(this.curves[s],s===n.index?n.time:0,s===r.index?r.time:1);s===n.index&&t.moveTo(o[0],o[1]),t.bezierCurveTo.apply(t,o.slice(2))}}},l.each(F._evaluateMethods,function(t){this[t+"At"]=function(e){var i=this._get(e);return F[t](this.curves[i.index],i.time)}},{})),U=l.extend({initialize:function(t){for(var e,i=this.points=[],n=t._segments,r=t._closed,s=0,a=n.length;s<a;s++){var o=n[s].point;e&&e.equals(o)||i.push(e=o.clone())}r&&(i.unshift(i[i.length-1]),i.push(i[1])),this.closed=r},fit:function(t){var e=this.points,i=e.length,n=null;return i>0&&(n=[new D(e[0])],i>1&&(this.fitCubic(n,t,0,i-1,e[1].subtract(e[0]),e[i-2].subtract(e[i-1])),this.closed&&(n.shift(),n.pop()))),n},fitCubic:function(t,e,i,n,r,s){var a=this.points;if(n-i!=1){for(var o,h=this.chordLengthParameterize(i,n),c=Math.max(e,e*e),l=!0,u=0;u<=4;u++){var f=this.generateBezier(i,n,h,r,s),d=this.findMaxError(i,n,f,h);if(d.error<e&&l)return void this.addCurve(t,f);if(o=d.index,d.error>=c)break;l=this.reparameterize(i,n,h,f),c=d.error}var p=a[o-1].subtract(a[o+1]);this.fitCubic(t,e,i,o,r,p),this.fitCubic(t,e,o,n,p.negate(),s)}else{var g=a[i],v=a[n],_=g.getDistance(v)/3;this.addCurve(t,[g,g.add(r.normalize(_)),v.add(s.normalize(_)),v])}},addCurve:function(t,e){t[t.length-1].setHandleOut(e[1].subtract(e[0])),t.push(new D(e[3],e[2].subtract(e[3])))},generateBezier:function(t,e,i,n,r){for(var s=Math.abs,a=this.points,o=a[t],h=a[e],c=[[0,0],[0,0]],l=[0,0],u=0,f=e-t+1;u<f;u++){var d=i[u],p=1-d,g=3*d*p,v=p*p*p,_=g*p,m=g*d,y=d*d*d,x=n.normalize(_),b=r.normalize(m),w=a[t+u].subtract(o.multiply(v+_)).subtract(h.multiply(m+y));c[0][0]+=x.dot(x),c[0][1]+=x.dot(b),c[1][0]=c[0][1],c[1][1]+=b.dot(b),l[0]+=x.dot(w),l[1]+=b.dot(w)}var C,S,T=c[0][0]*c[1][1]-c[1][0]*c[0][1];if(s(T)>1e-12){var k=c[0][0]*l[1]-c[1][0]*l[0];C=(l[0]*c[1][1]-l[1]*c[0][1])/T,S=k/T}else{var O=c[0][0]+c[0][1],A=c[1][0]+c[1][1];C=S=s(O)>1e-12?l[0]/O:s(A)>1e-12?l[1]/A:0}var P,E,M=h.getDistance(o),I=1e-12*M;if(C<I||S<I)C=S=M/3;else{var L=h.subtract(o);P=n.normalize(C),E=r.normalize(S),P.dot(L)-E.dot(L)>M*M&&(C=S=M/3,P=E=null)}return[o,o.add(P||n.normalize(C)),h.add(E||r.normalize(S)),h]},reparameterize:function(t,e,i,n){for(var r=t;r<=e;r++)i[r-t]=this.findRoot(n,this.points[r],i[r-t]);r=1;for(var s=i.length;r<s;r++)if(i[r]<=i[r-1])return!1;return!0},findRoot:function(t,e,i){for(var n=[],r=[],s=0;s<=2;s++)n[s]=t[s+1].subtract(t[s]).multiply(3);for(s=0;s<=1;s++)r[s]=n[s+1].subtract(n[s]).multiply(2);var a=this.evaluate(3,t,i),o=this.evaluate(2,n,i),h=this.evaluate(1,r,i),c=a.subtract(e),l=o.dot(o)+c.dot(h);return g.isZero(l)?i:i-c.dot(o)/l},evaluate:function(t,e,i){for(var n=e.slice(),r=1;r<=t;r++)for(var s=0;s<=t-r;s++)n[s]=n[s].multiply(1-i).add(n[s+1].multiply(i));return n[0]},chordLengthParameterize:function(t,e){for(var i=[0],n=t+1;n<=e;n++)i[n-t]=i[n-t-1]+this.points[n].getDistance(this.points[n-1]);n=1;for(var r=e-t;n<=r;n++)i[n]/=i[r];return i},findMaxError:function(t,e,i,n){for(var r=Math.floor((e-t+1)/2),s=0,a=t+1;a<e;a++){var o=this.evaluate(3,i,n[a-t]).subtract(this.points[a]),h=o.x*o.x+o.y*o.y;h>=s&&(s=h,r=a)}return{error:s,index:r}}}),W=k.extend({_class:"TextItem",_applyMatrix:!1,_canApplyMatrix:!1,_serializeFields:{content:null},_boundsOptions:{stroke:!1,handle:!1},initialize:function(t){this._content="",this._lines=[];var e=t&&l.isPlainObject(t)&&t.x===o&&t.y===o;this._initialize(e&&t,!e&&_.read(arguments))},_equals:function(t){return this._content===t._content},copyContent:function(t){this.setContent(t._content)},getContent:function(){return this._content},setContent:function(t){this._content=""+t,this._lines=this._content.split(/\r\n|\n|\r/gm),this._changed(521)},isEmpty:function(){return!this._content},getCharacterStyle:"#getStyle",setCharacterStyle:"#setStyle",getParagraphStyle:"#getStyle",setParagraphStyle:"#setStyle"}),X=W.extend({_class:"PointText",initialize:function(){W.apply(this,arguments)},getPoint:function(){var t=this._matrix.getTranslation();return new m(t.x,t.y,this,"setPoint")},setPoint:function(){var t=_.read(arguments);this.translate(t.subtract(this._matrix.getTranslation()))},_draw:function(t,e,i){if(this._content){this._setStyles(t,e,i);var n=this._lines,r=this._style,s=r.hasFill(),a=r.hasStroke(),o=r.getLeading(),h=t.shadowColor;t.font=r.getFontStyle(),t.textAlign=r.getJustification();for(var c=0,l=n.length;c<l;c++){t.shadowColor=h;var u=n[c];s&&(t.fillText(u,0,0),t.shadowColor="rgba(0,0,0,0)"),a&&t.strokeText(u,0,0),t.translate(0,o)}}},_getBounds:function(t,e){var i=this._style,n=this._lines,r=n.length,s=i.getJustification(),a=i.getLeading(),o=this.getView().getTextWidth(i.getFontStyle(),n),h=0;"left"!==s&&(h-=o/("center"===s?2:1));var c=new b(h,r?-.75*a:0,o,r*a);return t?t._transformBounds(c,c):c}}),G=l.extend(new function(){var t,e={gray:["gray"],rgb:["red","green","blue"],hsb:["hue","saturation","brightness"],hsl:["hue","saturation","lightness"],gradient:["gradient","origin","destination","highlight"]},i={},n={transparent:[0,0,0,0]};var r=[[0,3,1],[2,0,1],[1,0,3],[1,2,0],[3,1,0],[0,1,2]],s={"rgb-hsb":function(t,e,i){var n=Math.max(t,e,i),r=n-Math.min(t,e,i);return[0===r?0:60*(n==t?(e-i)/r+(e<i?6:0):n==e?(i-t)/r+2:(t-e)/r+4),0===n?0:r/n,n]},"hsb-rgb":function(t,e,i){var n,s=(t=(t/60%6+6)%6)-(n=Math.floor(t)),a=[i,i*(1-e),i*(1-e*s),i*(1-e*(1-s))];return[a[(n=r[n])[0]],a[n[1]],a[n[2]]]},"rgb-hsl":function(t,e,i){var n=Math.max(t,e,i),r=Math.min(t,e,i),s=n-r,a=0===s,o=(n+r)/2;return[a?0:60*(n==t?(e-i)/s+(e<i?6:0):n==e?(i-t)/s+2:(t-e)/s+4),a?0:o<.5?s/(n+r):s/(2-n-r),o]},"hsl-rgb":function(t,e,i){if(0===e)return[i,i,i];for(var n=[(t=(t/360%1+1)%1)+1/3,t,t-1/3],r=i<.5?i*(1+e):i+e-i*e,s=2*i-r,a=[],o=0;o<3;o++){var h=n[o];h<0&&(h+=1),h>1&&(h-=1),a[o]=6*h<1?s+6*(r-s)*h:2*h<1?r:3*h<2?s+(r-s)*(2/3-h)*6:s}return a},"rgb-gray":function(t,e,i){return[.2989*t+.587*e+.114*i]},"gray-rgb":function(t){return[t,t,t]},"gray-hsb":function(t){return[0,0,t]},"gray-hsl":function(t){return[0,0,t]},"gradient-rgb":function(){return[]},"rgb-gradient":function(){return[]}};return l.each(e,function(t,n){i[n]=[],l.each(t,function(t,r){var s=l.capitalize(t),a=/^(hue|saturation)$/.test(t),o=i[n][r]="gradient"===n?"gradient"===t?function(t){var e=this._components[0];return e!==(t=H.read(Array.isArray(t)?t:arguments,0,{readNull:!0}))&&(e&&e._removeOwner(this),t&&t._addOwner(this)),t}:function(){return _.read(arguments,0,{readNull:"highlight"===t,clone:!0})}:function(t){return null==t||isNaN(t)?0:+t};this["get"+s]=function(){return this._type===n||a&&/^hs[bl]$/.test(this._type)?this._components[r]:this._convert(n)[r]},this["set"+s]=function(t){this._type===n||a&&/^hs[bl]$/.test(this._type)||(this._components=this._convert(n),this._properties=e[n],this._type=n),this._components[r]=o.call(this,t),this._changed()}},this)},{_class:"Color",_readIndex:!0,initialize:function r(s){var a,o,c,u,f=arguments,d=this.__read,p=0;Array.isArray(s)&&(s=(f=s)[0]);var g=null!=s&&typeof s;if("string"===g&&s in e&&(a=s,s=f[1],Array.isArray(s)?(o=s,c=f[2]):(d&&(p=1),f=l.slice(f,1),g=typeof s)),!o){if(u="number"===g?f:"object"===g&&null!=s.length?s:null){a||(a=u.length>=3?"rgb":"gray");var v=e[a].length;c=u[v],d&&(p+=u===arguments?v+(null!=c?1:0):1),u.length>v&&(u=l.slice(u,0,v))}else if("string"===g){var _=function(e){var i,r=e.match(/^#([\da-f]{2})([\da-f]{2})([\da-f]{2})([\da-f]{2})?$/i)||e.match(/^#([\da-f])([\da-f])([\da-f])([\da-f])?$/i),s="rgb";if(r){var a=r[4]?4:3;i=new Array(a);for(var o=0;o<a;o++){var c=r[o+1];i[o]=parseInt(1==c.length?c+c:c,16)/255}}else if(r=e.match(/^(rgb|hsl)a?\((.*)\)$/)){s=r[1],i=r[2].split(/[,\s]+/g);for(var l="hsl"===s,u=(o=0,Math.min(i.length,4));o<u;o++){var f=i[o];if(c=parseFloat(f),l)if(0===o){var d=f.match(/([a-z]*)$/)[1];c*={turn:360,rad:180/Math.PI,grad:.9}[d]||1}else o<3&&(c/=100);else o<3&&(c/=255);i[o]=c}}else{var p=n[e];if(!p)if(h){t||((t=at.getContext(1,1)).globalCompositeOperation="copy"),t.fillStyle="rgba(0,0,0,0)",t.fillStyle=e,t.fillRect(0,0,1,1);var g=t.getImageData(0,0,1,1).data;p=n[e]=[g[0]/255,g[1]/255,g[2]/255]}else p=[0,0,0];i=p.slice()}return[s,i]}(s);a=_[0],4===(o=_[1]).length&&(c=o[3],o.length--)}else if("object"===g)if(s.constructor===r){if(a=s._type,o=s._components.slice(),c=s._alpha,"gradient"===a)for(var m=1,y=o.length;m<y;m++){var x=o[m];x&&(o[m]=x.clone())}}else if(s.constructor===H)a="gradient",u=f;else{var b=e[a="hue"in s?"lightness"in s?"hsl":"hsb":"gradient"in s||"stops"in s||"radial"in s?"gradient":"gray"in s?"gray":"rgb"],w=i[a];this._components=o=[];for(m=0,y=b.length;m<y;m++){null==(C=s[b[m]])&&!m&&"gradient"===a&&"stops"in s&&(C={stops:s.stops,radial:s.radial}),null!=(C=w[m].call(this,C))&&(o[m]=C)}c=s.alpha}d&&a&&(p=1)}if(this._type=a||"rgb",!o){this._components=o=[];for(m=0,y=(w=i[this._type]).length;m<y;m++){var C;null!=(C=w[m].call(this,u&&u[m]))&&(o[m]=C)}}return this._components=o,this._properties=e[this._type],this._alpha=c,d&&(this.__read=p),this},set:"#initialize",_serialize:function(t,e){var i=this.getComponents();return l.serialize(/^(gray|rgb)$/.test(this._type)?i:[this._type].concat(i),t,!0,e)},_changed:function(){this._canvasStyle=null,this._owner&&this._owner._changed(129)},_convert:function(t){var e;return this._type===t?this._components.slice():(e=s[this._type+"-"+t])?e.apply(this,this._components):s["rgb-"+t].apply(this,s[this._type+"-rgb"].apply(this,this._components))},convert:function(t){return new G(t,this._convert(t),this._alpha)},getType:function(){return this._type},setType:function(t){this._components=this._convert(t),this._properties=e[t],this._type=t},getComponents:function(){var t=this._components.slice();return null!=this._alpha&&t.push(this._alpha),t},getAlpha:function(){return null!=this._alpha?this._alpha:1},setAlpha:function(t){this._alpha=null==t?null:Math.min(Math.max(t,0),1),this._changed()},hasAlpha:function(){return null!=this._alpha},equals:function(t){var e=l.isPlainValue(t,!0)?G.read(arguments):t;return e===this||e&&this._class===e._class&&this._type===e._type&&this.getAlpha()===e.getAlpha()&&l.equals(this._components,e._components)||!1},toString:function(){for(var t=this._properties,e=[],i="gradient"===this._type,n=p.instance,r=0,s=t.length;r<s;r++){var a=this._components[r];null!=a&&e.push(t[r]+": "+(i?a:n.number(a)))}return null!=this._alpha&&e.push("alpha: "+n.number(this._alpha)),"{ "+e.join(", ")+" }"},toCSS:function(t){var e=this._convert("rgb"),i=t||null==this._alpha?1:this._alpha;function n(t){return Math.round(255*(t<0?0:t>1?1:t))}return e=[n(e[0]),n(e[1]),n(e[2])],i<1&&e.push(i<0?0:i),t?"#"+((1<<24)+(e[0]<<16)+(e[1]<<8)+e[2]).toString(16).slice(1):(4==e.length?"rgba(":"rgb(")+e.join(",")+")"},toCanvasStyle:function(t,e){if(this._canvasStyle)return this._canvasStyle;if("gradient"!==this._type)return this._canvasStyle=this.toCSS();var i,n=this._components,r=n[0],s=r._stops,a=n[1],o=n[2],h=n[3],c=e&&e.inverted();if(c&&(a=c._transformPoint(a),o=c._transformPoint(o),h&&(h=c._transformPoint(h))),r._radial){var l=o.getDistance(a);if(h){var u=h.subtract(a);u.getLength()>l&&(h=a.add(u.normalize(l-.1)))}var f=h||a;i=t.createRadialGradient(f.x,f.y,0,a.x,a.y,l)}else i=t.createLinearGradient(a.x,a.y,o.x,o.y);for(var d=0,p=s.length;d<p;d++){var g=s[d],v=g._offset;i.addColorStop(null==v?d/(p-1):v,g._color.toCanvasStyle())}return this._canvasStyle=i},transform:function(t){if("gradient"===this._type){for(var e=this._components,i=1,n=e.length;i<n;i++){var r=e[i];t._transformPoint(r,r,!0)}this._changed()}},statics:{_types:e,random:function(){var t=Math.random;return new G(t(),t(),t())}}})},new function(){return l.each({add:function(t,e){return t+e},subtract:function(t,e){return t-e},multiply:function(t,e){return t*e},divide:function(t,e){return t/e}},function(t,e){this[e]=function(e){e=G.read(arguments);for(var i=this._type,n=this._components,r=e._convert(i),s=0,a=n.length;s<a;s++)r[s]=t(n[s],r[s]);return new G(i,r,null!=this._alpha?t(this._alpha,e.getAlpha()):null)}},{})}),H=l.extend({_class:"Gradient",initialize:function(t,e){this._id=v.get(),t&&l.isPlainObject(t)&&(this.set(t),t=e=null),null==this._stops&&this.setStops(t||["white","black"]),null==this._radial&&this.setRadial("string"==typeof e&&"radial"===e||e||!1)},_serialize:function(t,e){return e.add(this,function(){return l.serialize([this._stops,this._radial],t,!0,e)})},_changed:function(){for(var t=0,e=this._owners&&this._owners.length;t<e;t++)this._owners[t]._changed()},_addOwner:function(t){this._owners||(this._owners=[]),this._owners.push(t)},_removeOwner:function(t){var e=this._owners?this._owners.indexOf(t):-1;-1!=e&&(this._owners.splice(e,1),this._owners.length||(this._owners=o))},clone:function(){for(var t=[],e=0,i=this._stops.length;e<i;e++)t[e]=this._stops[e].clone();return new H(t,this._radial)},getStops:function(){return this._stops},setStops:function(t){if(t.length<2)throw new Error("Gradient stop list needs to contain at least two stops.");var e=this._stops;if(e)for(var i=0,n=e.length;i<n;i++)e[i]._owner=o;for(i=0,n=(e=this._stops=Y.readList(t,0,{clone:!0})).length;i<n;i++)e[i]._owner=this;this._changed()},getRadial:function(){return this._radial},setRadial:function(t){this._radial=t,this._changed()},equals:function(t){if(t===this)return!0;if(t&&this._class===t._class){var e=this._stops,i=t._stops,n=e.length;if(n===i.length){for(var r=0;r<n;r++)if(!e[r].equals(i[r]))return!1;return!0}}return!1}}),Y=l.extend({_class:"GradientStop",initialize:function(t,e){var i=t,n=e;"object"==typeof t&&e===o&&(Array.isArray(t)&&"number"!=typeof t[0]?(i=t[0],n=t[1]):("color"in t||"offset"in t||"rampPoint"in t)&&(i=t.color,n=t.offset||t.rampPoint||0)),this.setColor(i),this.setOffset(n)},clone:function(){return new Y(this._color.clone(),this._offset)},_serialize:function(t,e){var i=this._color,n=this._offset;return l.serialize(null==n?[i]:[i,n],t,!0,e)},_changed:function(){this._owner&&this._owner._changed(129)},getOffset:function(){return this._offset},setOffset:function(t){this._offset=t,this._changed()},getRampPoint:"#getOffset",setRampPoint:"#setOffset",getColor:function(){return this._color},setColor:function(){var t=G.read(arguments,0,{clone:!0});t&&(t._owner=this),this._color=t,this._changed()},equals:function(t){return t===this||t&&this._class===t._class&&this._color.equals(t._color)&&this._offset==t._offset||!1}}),q=l.extend(new function(){var t={fillColor:null,fillRule:"nonzero",strokeColor:null,strokeWidth:1,strokeCap:"butt",strokeJoin:"miter",strokeScaling:!0,miterLimit:10,dashOffset:0,dashArray:[],shadowColor:null,shadowBlur:0,shadowOffset:new _,selectedColor:null},e=l.set({},t,{fontFamily:"sans-serif",fontWeight:"normal",fontSize:12,leading:null,justification:"left"}),i=l.set({},e,{fillColor:new G}),n={strokeWidth:193,strokeCap:193,strokeJoin:193,strokeScaling:201,miterLimit:193,fontFamily:9,fontWeight:9,fontSize:9,font:9,leading:9,justification:9},r={beans:!0},s={_class:"Style",beans:!0,initialize:function(n,r,s){this._values={},this._owner=r,this._project=r&&r._project||s||lt.project,this._defaults=!r||r instanceof O?e:r instanceof W?i:t,n&&this.set(n)}};return l.each(e,function(t,e){var i=/Color$/.test(e),a="shadowOffset"===e,h=l.capitalize(e),c=n[e],u="set"+h,f="get"+h;s[u]=function(t){var n=this._owner,r=n&&n._children;if(r&&r.length>0&&!(n instanceof z))for(var s=0,a=r.length;s<a;s++)r[s]._style[u](t);else if(e in this._defaults){var h=this._values[e];h!==t&&(i&&(h&&h._owner!==o&&(h._owner=o,h._canvasStyle=null),t&&t.constructor===G&&(t._owner&&(t=t.clone()),t._owner=n)),this._values[e]=t,n&&n._changed(c||129))}},s[f]=function(t){var n,r=this._owner,s=r&&r._children;if(e in this._defaults&&(!s||!s.length||t||r instanceof z))if((n=this._values[e])===o)(n=this._defaults[e])&&n.clone&&(n=n.clone());else{var h=i?G:a?_:null;!h||n&&n.constructor===h||(this._values[e]=n=h.read([n],0,{readNull:!0,clone:!0}),n&&i&&(n._owner=r))}else if(s)for(var c=0,u=s.length;c<u;c++){var d=s[c]._style[f]();if(c){if(!l.equals(n,d))return o}else n=d}return n},r[f]=function(t){return this._style[f](t)},r[u]=function(t){this._style[u](t)}}),l.each({Font:"FontFamily",WindingRule:"FillRule"},function(t,e){var i="get"+e,n="set"+e;s[i]=r[i]="#get"+t,s[n]=r[n]="#set"+t}),k.inject(r),s},{set:function(t){var e=t instanceof q,i=e?t._values:t;if(i)for(var n in i)if(n in this._defaults){var r=i[n];this[n]=r&&e&&r.clone?r.clone():r}},equals:function(t){function e(t,e,i){var n=t._values,r=e._values,s=e._defaults;for(var a in n){var h=n[a],c=r[a];if(!(i&&a in r||l.equals(h,c===o?s[a]:c)))return!1}return!0}return t===this||t&&this._class===t._class&&e(this,t)&&e(t,this,!0)||!1},_dispose:function(){var t;(t=this.getFillColor())&&(t._canvasStyle=null),(t=this.getStrokeColor())&&(t._canvasStyle=null),(t=this.getShadowColor())&&(t._canvasStyle=null)},hasFill:function(){var t=this.getFillColor();return!!t&&t.alpha>0},hasStroke:function(){var t=this.getStrokeColor();return!!t&&t.alpha>0&&this.getStrokeWidth()>0},hasShadow:function(){var t=this.getShadowColor();return!!t&&t.alpha>0&&(this.getShadowBlur()>0||!this.getShadowOffset().isZero())},getView:function(){return this._project._view},getFontStyle:function(){var t=this.getFontSize();return this.getFontWeight()+" "+t+(/[a-z]/i.test(t+"")?" ":"px ")+this.getFontFamily()},getFont:"#getFontFamily",setFont:"#setFontFamily",getLeading:function t(){var e=t.base.call(this),i=this.getFontSize();return/pt|em|%|px/.test(i)&&(i=this.getView().getPixelSize(i)),null!=e?e:1.2*i}}),K=new function(){function t(t,e,i,n){for(var r=["","webkit","moz","Moz","ms","o"],s=e[0].toUpperCase()+e.substring(1),a=0;a<6;a++){var o=r[a],h=o?o+s:e;if(h in t){if(!i)return t[h];t[h]=n;break}}}return{getStyles:function(t){var e=t&&9!==t.nodeType?t.ownerDocument:t,i=e&&e.defaultView;return i&&i.getComputedStyle(t,"")},getBounds:function(t,e){var i,n=t.ownerDocument,r=n.body,s=n.documentElement;try{i=t.getBoundingClientRect()}catch(t){i={left:0,top:0,width:0,height:0}}var a=i.left-(s.clientLeft||r.clientLeft||0),o=i.top-(s.clientTop||r.clientTop||0);if(!e){var h=n.defaultView;a+=h.pageXOffset||s.scrollLeft||r.scrollLeft,o+=h.pageYOffset||s.scrollTop||r.scrollTop}return new b(a,o,i.width,i.height)},getViewportBounds:function(t){var e=t.ownerDocument,i=e.defaultView,n=e.documentElement;return new b(0,0,i.innerWidth||n.clientWidth,i.innerHeight||n.clientHeight)},getOffset:function(t,e){return K.getBounds(t,e).getPoint()},getSize:function(t){return K.getBounds(t,!0).getSize()},isInvisible:function(t){return K.getSize(t).equals(new y(0,0))},isInView:function(t){return!K.isInvisible(t)&&K.getViewportBounds(t).intersects(K.getBounds(t,!0))},isInserted:function(t){return c.body.contains(t)},getPrefixed:function(e,i){return e&&t(e,i)},setPrefixed:function(e,i,n){if("object"==typeof i)for(var r in i)t(e,r,!0,i[r]);else t(e,i,!0,n)}}},Z={add:function(t,e){if(t)for(var i in e)for(var n=e[i],r=i.split(/[\s,]+/g),s=0,a=r.length;s<a;s++){var o=r[s],h=t===c&&("touchstart"===o||"touchmove"===o)&&{passive:!1};t.addEventListener(o,n,h)}},remove:function(t,e){if(t)for(var i in e)for(var n=e[i],r=i.split(/[\s,]+/g),s=0,a=r.length;s<a;s++)t.removeEventListener(r[s],n,!1)},getPoint:function(t){var e=t.targetTouches?t.targetTouches.length?t.targetTouches[0]:t.changedTouches[0]:t;return new _(e.pageX||e.clientX+c.documentElement.scrollLeft,e.pageY||e.clientY+c.documentElement.scrollTop)},getTarget:function(t){return t.target||t.srcElement},getRelatedTarget:function(t){return t.relatedTarget||t.toElement},getOffset:function(t,e){return Z.getPoint(t).subtract(K.getOffset(e||Z.getTarget(t)))}};Z.requestAnimationFrame=new function(){var t,e=K.getPrefixed(h,"requestAnimationFrame"),i=!1,n=[];function r(){var t=n;n=[];for(var s=0,a=t.length;s<a;s++)t[s]();(i=e&&n.length)&&e(r)}return function(s){n.push(s),e?i||(e(r),i=!0):t||(t=setInterval(r,1e3/60))}};var $=l.extend(u,{_class:"View",initialize:function t(e,i){function n(t){return i[t]||parseInt(i.getAttribute(t),10)}function r(){var t=K.getSize(i);return t.isNaN()||t.isZero()?new y(n("width"),n("height")):t}var s;if(h&&i){this._id=i.getAttribute("id"),null==this._id&&i.setAttribute("id",this._id="view-"+t._id++),Z.add(i,this._viewEvents);if(K.setPrefixed(i.style,{userDrag:"none",userSelect:"none",touchCallout:"none",contentZooming:"none",tapHighlightColor:"rgba(0,0,0,0)"}),f.hasAttribute(i,"resize")){var a=this;Z.add(h,this._windowEvents={resize:function(){a.setViewSize(r())}})}if(s=r(),f.hasAttribute(i,"stats")&&"undefined"!=typeof Stats){this._stats=new Stats;var o=this._stats.domElement,l=o.style,u=K.getOffset(i);l.position="absolute",l.left=u.x+"px",l.top=u.y+"px",c.body.appendChild(o)}}else s=new y(i),i=null;this._project=e,this._scope=e._scope,this._element=i,this._pixelRatio||(this._pixelRatio=h&&h.devicePixelRatio||1),this._setElementSize(s.width,s.height),this._viewSize=s,t._views.push(this),t._viewsById[this._id]=this,(this._matrix=new C)._owner=this,t._focused||(t._focused=this),this._frameItems={},this._frameItemCount=0,this._itemEvents={native:{},virtual:{}},this._autoUpdate=!lt.agent.node,this._needsUpdate=!1},remove:function(){if(!this._project)return!1;$._focused===this&&($._focused=null),$._views.splice($._views.indexOf(this),1),delete $._viewsById[this._id];var t=this._project;return t._view===this&&(t._view=null),Z.remove(this._element,this._viewEvents),Z.remove(h,this._windowEvents),this._element=this._project=null,this.off("frame"),this._animate=!1,this._frameItems={},!0},_events:l.each(k._itemHandlers.concat(["onResize","onKeyDown","onKeyUp"]),function(t){this[t]={}},{onFrame:{install:function(){this.play()},uninstall:function(){this.pause()}}}),_animate:!1,_time:0,_count:0,getAutoUpdate:function(){return this._autoUpdate},setAutoUpdate:function(t){this._autoUpdate=t,t&&this.requestUpdate()},update:function(){},draw:function(){this.update()},requestUpdate:function(){if(!this._requested){var t=this;Z.requestAnimationFrame(function(){if(t._requested=!1,t._animate){t.requestUpdate();var e=t._element;K.getPrefixed(c,"hidden")&&"true"!==f.getAttribute(e,"keepalive")||!K.isInView(e)||t._handleFrame()}t._autoUpdate&&t.update()}),this._requested=!0}},play:function(){this._animate=!0,this.requestUpdate()},pause:function(){this._animate=!1},_handleFrame:function(){lt=this._scope;var t=Date.now()/1e3,e=this._last?t-this._last:0;this._last=t,this.emit("frame",new l({delta:e,time:this._time+=e,count:this._count++})),this._stats&&this._stats.update()},_animateItem:function(t,e){var i=this._frameItems;e?(i[t._id]={item:t,time:0,count:0},1==++this._frameItemCount&&this.on("frame",this._handleFrameItems)):(delete i[t._id],0==--this._frameItemCount&&this.off("frame",this._handleFrameItems))},_handleFrameItems:function(t){for(var e in this._frameItems){var i=this._frameItems[e];i.item.emit("frame",new l(t,{time:i.time+=t.delta,count:i.count++}))}},_changed:function(){this._project._changed(4097),this._bounds=this._decomposed=o},getElement:function(){return this._element},getPixelRatio:function(){return this._pixelRatio},getResolution:function(){return 72*this._pixelRatio},getViewSize:function(){var t=this._viewSize;return new x(t.width,t.height,this,"setViewSize")},setViewSize:function(){var t=y.read(arguments),e=t.subtract(this._viewSize);e.isZero()||(this._setElementSize(t.width,t.height),this._viewSize.set(t),this._changed(),this.emit("resize",{size:t,delta:e}),this._autoUpdate&&this.update())},_setElementSize:function(t,e){var i=this._element;i&&(i.width!==t&&(i.width=t),i.height!==e&&(i.height=e))},getBounds:function(){return this._bounds||(this._bounds=this._matrix.inverted()._transformBounds(new b(new _,this._viewSize))),this._bounds},getSize:function(){return this.getBounds().getSize()},isVisible:function(){return K.isInView(this._element)},isInserted:function(){return K.isInserted(this._element)},getPixelSize:function(t){var e,i=this._element;if(i){var n=i.parentNode,r=c.createElement("div");r.style.fontSize=t,n.appendChild(r),e=parseFloat(K.getStyles(r).fontSize),n.removeChild(r)}else e=parseFloat(e);return e},getTextWidth:function(t,e){return 0}},l.each(["rotate","scale","shear","skew"],function(t){var e="rotate"===t;this[t]=function(){var i=(e?l:_).read(arguments),n=_.read(arguments,0,{readNull:!0});return this.transform((new C)[t](i,n||this.getCenter(!0)))}},{_decompose:function(){return this._decomposed||(this._decomposed=this._matrix.decompose())},translate:function(){var t=new C;return this.transform(t.translate.apply(t,arguments))},getCenter:function(){return this.getBounds().getCenter()},setCenter:function(){var t=_.read(arguments);this.translate(this.getCenter().subtract(t))},getZoom:function(){var t=this._decompose(),e=t&&t.scaling;return e?(e.x+e.y)/2:0},setZoom:function(t){this.transform((new C).scale(t/this.getZoom(),this.getCenter()))},getRotation:function(){var t=this._decompose();return t&&t.rotation},setRotation:function(t){var e=this.getRotation();null!=e&&null!=t&&this.rotate(t-e)},getScaling:function(){var t=this._decompose(),e=t&&t.scaling;return e?new m(e.x,e.y,this,"setScaling"):o},setScaling:function(){var t=this.getScaling(),e=_.read(arguments,0,{clone:!0,readNull:!0});t&&e&&this.scale(e.x/t.x,e.y/t.y)},getMatrix:function(){return this._matrix},setMatrix:function(){var t=this._matrix;t.initialize.apply(t,arguments)},transform:function(t){this._matrix.append(t)},scrollBy:function(){this.translate(_.read(arguments).negate())}}),{projectToView:function(){return this._matrix._transformPoint(_.read(arguments))},viewToProject:function(){return this._matrix._inverseTransform(_.read(arguments))},getEventPoint:function(t){return this.viewToProject(Z.getOffset(t,this._element))}},{statics:{_views:[],_viewsById:{},_id:0,create:function(t,e){return c&&"string"==typeof e&&(e=c.getElementById(e)),new(h?J:$)(t,e)}}},new function(){if(h){var t,e,i,n,r,s=!1,a=!1,o=h.navigator;o.pointerEnabled||o.msPointerEnabled?(i="pointerdown MSPointerDown",n="pointermove MSPointerMove",r="pointerup pointercancel MSPointerUp MSPointerCancel"):(i="touchstart",n="touchmove",r="touchend touchcancel","ontouchstart"in h&&o.userAgent.match(/mobile|tablet|ip(ad|hone|od)|android|silk/i)||(i+=" mousedown",n+=" mousemove",r+=" mouseup"));var l={},u={mouseout:function(t){var e=$._focused,i=Z.getRelatedTarget(t);if(e&&(!i||"HTML"===i.nodeName)){var n=Z.getOffset(t,e._element),r=n.x,s=Math.abs,a=s(r),o=a-(1<<25);n.x=s(o)<a?o*(r<0?-1:1):r,O(e,t,e.viewToProject(n))}},scroll:k};l[i]=function(t){var e=$._focused=T(t);s||(s=!0,e._handleMouseEvent("mousedown",t))},u[n]=function(i){var n=$._focused;if(!a){var r=T(i);r?n!==r&&(n&&O(n,i),t||(t=n),n=$._focused=e=r):e&&e===n&&(t&&!t.isInserted()&&(t=null),n=$._focused=t,t=null,k())}n&&O(n,i)},u[i]=function(){a=!0},u[r]=function(t){var e=$._focused;e&&s&&e._handleMouseEvent("mouseup",t),a=s=!1},Z.add(c,u),Z.add(h,{load:k});var f,d,p,g,v,_,m,y,x=!1,b=!1,w={doubleclick:"click",mousedrag:"mousemove"},C=!1,S={mousedown:{mousedown:1,mousedrag:1,click:1,doubleclick:1},mouseup:{mouseup:1,mousedrag:1,click:1,doubleclick:1},mousemove:{mousedrag:1,mousemove:1,mouseenter:1,mouseleave:1}};return{_viewEvents:l,_handleMouseEvent:function(t,e,i){var n=this._itemEvents,r=n.native[t],a="mousemove"===t,o=this._scope.tool,h=this;function c(t){return n.virtual[t]||h.responds(t)||o&&o.responds(t)}a&&s&&c("mousedrag")&&(t="mousedrag"),i||(i=this.getEventPoint(e));var l=this.getBounds().contains(i),u=r&&l&&h._project.hitTest(i,{tolerance:0,fill:!0,stroke:!0}),w=u&&u.item||null,S=!1,T={};if(T[t.substr(5)]=!0,r&&w!==g&&(g&&A(g,null,"mouseleave",e,i),w&&A(w,null,"mouseenter",e,i),g=w),C^l&&(A(this,null,l?"mouseenter":"mouseleave",e,i),l?this:null,S=!0),!l&&!T.drag||i.equals(d)||(P(this,w,a?t:"mousemove",e,i,d),S=!0),C=l,T.down&&l||T.up&&f){if(P(this,w,t,e,i,f),T.down){if(y=w===_&&Date.now()-m<300,p=_=w,!b&&w){for(var k=w;k&&!k.responds("mousedrag");)k=k._parent;k&&(v=w)}f=i}else T.up&&(b||w!==p||(m=Date.now(),P(this,w,y?"doubleclick":"click",e,i,f),y=!1),p=v=null);C=!1,S=!0}d=i,S&&o&&(x=o._handleMouseEvent(t,e,i,T)||x),!1!==e.cancelable&&(x&&!T.move||T.down&&c("mouseup"))&&e.preventDefault()},_handleKeyEvent:function(t,e,i,n){var r,s=this._scope,a=s.tool;function o(a){a.responds(t)&&(lt=s,a.emit(t,r=r||new tt(t,e,i,n)))}this.isVisible()&&(o(this),a&&a.responds(t)&&o(a))},_countItemEvent:function(t,e){var i=this._itemEvents,n=i.native,r=i.virtual;for(var s in S)n[s]=(n[s]||0)+(S[s][t]||0)*e;r[t]=(r[t]||0)+e},statics:{updateFocus:k,_resetState:function(){s=a=x=C=!1,t=e=f=d=p=g=v=_=m=y=null}}}}function T(t){var e=Z.getTarget(t);return e.getAttribute&&$._viewsById[e.getAttribute("id")]}function k(){var t=$._focused;if(!t||!t.isVisible())for(var i=0,n=$._views.length;i<n;i++)if((t=$._views[i]).isVisible()){$._focused=e=t;break}}function O(t,e,i){t._handleMouseEvent("mousemove",e,i)}function A(t,e,i,n,r,s,a){var o,h=!1;function c(t,i){if(t.responds(i)){if(o||(o=new it(i,n,r,e||t,s?r.subtract(s):null)),t.emit(i,o)&&(x=!0,o.prevented&&(b=!0),o.stopped))return h=!0}else{var a=w[i];if(a)return c(t,a)}}for(;t&&t!==a&&!c(t,i);)t=t._parent;return h}function P(t,e,i,n,r,s){return t._project.removeOn(i),b=x=!1,v&&A(v,null,i,n,r,s)||e&&e!==v&&!e.isDescendant(v)&&A(e,null,i,n,r,s,v)||A(t,v||e||t,i,n,r,s)}}),J=$.extend({_class:"CanvasView",initialize:function(t,e){if(!(e instanceof h.HTMLCanvasElement)){var i=y.read(arguments,1);if(i.isZero())throw new Error("Cannot create CanvasView with the provided argument: "+l.slice(arguments,1));e=at.getCanvas(i)}var n=this._context=e.getContext("2d");if(n.save(),this._pixelRatio=1,!/^off|false$/.test(f.getAttribute(e,"hidpi"))){var r=h.devicePixelRatio||1,s=K.getPrefixed(n,"backingStorePixelRatio")||1;this._pixelRatio=r/s}$.call(this,t,e),this._needsUpdate=!0},remove:function t(){return this._context.restore(),t.base.call(this)},_setElementSize:function t(e,i){var n=this._pixelRatio;if(t.base.call(this,e*n,i*n),1!==n){var r=this._element,s=this._context;if(!f.hasAttribute(r,"resize")){var a=r.style;a.width=e+"px",a.height=i+"px"}s.restore(),s.save(),s.scale(n,n)}},getPixelSize:function t(e){var i,n=lt.agent;if(n&&n.firefox)i=t.base.call(this,e);else{var r=this._context,s=r.font;r.font=e+" serif",i=parseFloat(r.font),r.font=s}return i},getTextWidth:function(t,e){var i=this._context,n=i.font,r=0;i.font=t;for(var s=0,a=e.length;s<a;s++)r=Math.max(r,i.measureText(e[s]).width);return i.font=n,r},update:function(){if(!this._needsUpdate)return!1;var t=this._project,e=this._context,i=this._viewSize;return e.clearRect(0,0,i.width+1,i.height+1),t&&t.draw(e,this._matrix,this._pixelRatio),this._needsUpdate=!1,!0}}),Q=l.extend({_class:"Event",initialize:function(t){this.event=t,this.type=t&&t.type},prevented:!1,stopped:!1,preventDefault:function(){this.prevented=!0,this.event.preventDefault()},stopPropagation:function(){this.stopped=!0,this.event.stopPropagation()},stop:function(){this.stopPropagation(),this.preventDefault()},getTimeStamp:function(){return this.event.timeStamp},getModifiers:function(){return et.modifiers}}),tt=Q.extend({_class:"KeyEvent",initialize:function(t,e,i,n){this.type=t,this.event=e,this.key=i,this.character=n},toString:function(){return"{ type: '"+this.type+"', key: '"+this.key+"', character: '"+this.character+"', modifiers: "+this.getModifiers()+" }"}}),et=new function(){var t,e,i={"\t":"tab"," ":"space","\b":"backspace","":"delete",Spacebar:"space",Del:"delete",Win:"meta",Esc:"escape"},n={tab:"\t",space:" ",enter:"\r"},r={},s={},a=new l({shift:!1,control:!1,alt:!1,meta:!1,capsLock:!1,space:!1}).inject({option:{get:function(){return this.alt}},command:{get:function(){var t=lt&&lt.agent;return t&&t.mac?this.meta:this.control}}});function u(t){var e=t.key||t.keyIdentifier;return e=/^U\+/.test(e)?String.fromCharCode(parseInt(e.substr(2),16)):/^Arrow[A-Z]/.test(e)?e.substr(5):"Unidentified"===e||e===o?String.fromCharCode(t.keyCode):e,i[e]||(e.length>1?l.hyphenate(e):e.toLowerCase())}function f(e,i,n,o){var h,c=$._focused;if(r[i]=e,e?s[i]=n:delete s[i],i.length>1&&(h=l.camelize(i))in a){a[h]=e;var u=lt&&lt.agent;if("meta"===h&&u&&u.mac)if(e)t={};else{for(var d in t)d in s&&f(!1,d,t[d],o);t=null}}else e&&t&&(t[i]=n);c&&c._handleKeyEvent(e?"keydown":"keyup",o,i,n)}return Z.add(c,{keydown:function(t){var i=u(t),r=lt&&lt.agent;i.length>1||r&&r.chrome&&(t.altKey||r.mac&&t.metaKey||!r.mac&&t.ctrlKey)?f(!0,i,n[i]||(i.length>1?"":i),t):e=i},keypress:function(t){if(e){var i=u(t),n=t.charCode,r=n>=32?String.fromCharCode(n):i.length>1?"":i;i!==e&&(i=r.toLowerCase()),f(!0,i,r,t),e=null}},keyup:function(t){var e=u(t);e in s&&f(!1,e,s[e],t)}}),Z.add(h,{blur:function(t){for(var e in s)f(!1,e,s[e],t)}}),{modifiers:a,isDown:function(t){return!!r[t]}}},it=Q.extend({_class:"MouseEvent",initialize:function(t,e,i,n,r){this.type=t,this.event=e,this.point=i,this.target=n,this.delta=r},toString:function(){return"{ type: '"+this.type+"', point: "+this.point+", target: "+this.target+(this.delta?", delta: "+this.delta:"")+", modifiers: "+this.getModifiers()+" }"}}),nt=Q.extend({_class:"ToolEvent",_item:null,initialize:function(t,e,i){this.tool=t,this.type=e,this.event=i},_choosePoint:function(t,e){return t||(e?e.clone():null)},getPoint:function(){return this._choosePoint(this._point,this.tool._point)},setPoint:function(t){this._point=t},getLastPoint:function(){return this._choosePoint(this._lastPoint,this.tool._lastPoint)},setLastPoint:function(t){this._lastPoint=t},getDownPoint:function(){return this._choosePoint(this._downPoint,this.tool._downPoint)},setDownPoint:function(t){this._downPoint=t},getMiddlePoint:function(){return!this._middlePoint&&this.tool._lastPoint?this.tool._point.add(this.tool._lastPoint).divide(2):this._middlePoint},setMiddlePoint:function(t){this._middlePoint=t},getDelta:function(){return!this._delta&&this.tool._lastPoint?this.tool._point.subtract(this.tool._lastPoint):this._delta},setDelta:function(t){this._delta=t},getCount:function(){return this.tool[/^mouse(down|up)$/.test(this.type)?"_downCount":"_moveCount"]},setCount:function(t){this.tool[/^mouse(down|up)$/.test(this.type)?"downCount":"count"]=t},getItem:function(){if(!this._item){var t=this.tool._scope.project.hitTest(this.getPoint());if(t){for(var e=t.item,i=e._parent;/^(Group|CompoundPath)$/.test(i._class);)e=i,i=i._parent;this._item=e}}return this._item},setItem:function(t){this._item=t},toString:function(){return"{ type: "+this.type+", point: "+this.getPoint()+", count: "+this.getCount()+", modifiers: "+this.getModifiers()+" }"}}),rt=d.extend({_class:"Tool",_list:"tools",_reference:"tool",_events:["onMouseDown","onMouseUp","onMouseDrag","onMouseMove","onActivate","onDeactivate","onEditOptions","onKeyDown","onKeyUp"],initialize:function(t){d.call(this),this._moveCount=-1,this._downCount=-1,this.set(t)},getMinDistance:function(){return this._minDistance},setMinDistance:function(t){this._minDistance=t,null!=t&&null!=this._maxDistance&&t>this._maxDistance&&(this._maxDistance=t)},getMaxDistance:function(){return this._maxDistance},setMaxDistance:function(t){this._maxDistance=t,null!=this._minDistance&&null!=t&&t<this._minDistance&&(this._minDistance=t)},getFixedDistance:function(){return this._minDistance==this._maxDistance?this._minDistance:null},setFixedDistance:function(t){this._minDistance=this._maxDistance=t},_handleMouseEvent:function(t,e,i,n){lt=this._scope,n.drag&&!this.responds(t)&&(t="mousemove");var r=n.move||n.drag,s=this.responds(t),a=this.minDistance,o=this.maxDistance,h=!1,c=this;function l(t,e){var s=i,a=r?c._point:c._downPoint||s;if(r){if(c._moveCount>=0&&s.equals(a))return!1;if(a&&(null!=t||null!=e)){var o=s.subtract(a),h=o.getLength();if(h<(t||0))return!1;e&&(s=a.add(o.normalize(Math.min(h,e))))}c._moveCount++}return c._point=s,c._lastPoint=a||s,n.down&&(c._moveCount=-1,c._downPoint=s,c._downCount++),!0}function u(){s&&(h=c.emit(t,new nt(c,t,e))||h)}if(n.down)l(),u();else if(n.up)l(null,o),u();else if(s)for(;l(a,o);)u();return h}}),st={request:function(t){var e=new a.XMLHttpRequest;return e.open((t.method||"get").toUpperCase(),t.url,l.pick(t.async,!0)),t.mimeType&&e.overrideMimeType(t.mimeType),e.onload=function(){var i=e.status;0===i||200===i?t.onLoad&&t.onLoad.call(e,e.responseText):e.onerror()},e.onerror=function(){var i=e.status,n='Could not load "'+t.url+'" (Status: '+i+")";if(!t.onError)throw new Error(n);t.onError(n,i)},e.send(null)}},at={canvases:[],getCanvas:function(t,e){if(!h)return null;var i,n=!0;"object"==typeof t&&(e=t.height,t=t.width),this.canvases.length?i=this.canvases.pop():(i=c.createElement("canvas"),n=!1);var r=i.getContext("2d");if(!r)throw new Error("Canvas "+i+" is unable to provide a 2D context.");return i.width===t&&i.height===e?n&&r.clearRect(0,0,t+1,e+1):(i.width=t,i.height=e),r.save(),i},getContext:function(t,e){var i=this.getCanvas(t,e);return i?i.getContext("2d"):null},release:function(t){var e=t&&t.canvas?t.canvas:t;e&&e.getContext&&(e.getContext("2d").restore(),this.canvases.push(e))}},ot=new function(){var t,e,i,n,r,s,a,o,h,c,u,f=Math.min,d=Math.max,p=Math.abs;function g(t,e,i){return.2989*t+.587*e+.114*i}function v(t,e,i,n){var r=n-g(t,e,i),s=(n=g(h=t+r,c=e+r,u=i+r),f(h,c,u)),a=d(h,c,u);if(s<0){var o=n-s;h=n+(h-n)*n/o,c=n+(c-n)*n/o,u=n+(u-n)*n/o}if(a>255){var l=255-n,p=a-n;h=n+(h-n)*l/p,c=n+(c-n)*l/p,u=n+(u-n)*l/p}}function _(t,e,i){return d(t,e,i)-f(t,e,i)}function m(t,e,i,n){var r,s=[t,e,i],a=d(t,e,i),o=f(t,e,i);r=0===f(o=o===t?0:o===e?1:2,a=a===t?0:a===e?1:2)?1===d(o,a)?2:1:0,s[a]>s[o]?(s[r]=(s[r]-s[o])*n/(s[a]-s[o]),s[a]=n):s[r]=s[a]=0,s[o]=0,h=s[0],c=s[1],u=s[2]}var y={multiply:function(){h=r*t/255,c=s*e/255,u=a*i/255},screen:function(){h=r+t-r*t/255,c=s+e-s*e/255,u=a+i-a*i/255},overlay:function(){h=r<128?2*r*t/255:255-2*(255-r)*(255-t)/255,c=s<128?2*s*e/255:255-2*(255-s)*(255-e)/255,u=a<128?2*a*i/255:255-2*(255-a)*(255-i)/255},"soft-light":function(){var n=t*r/255;h=n+r*(255-(255-r)*(255-t)/255-n)/255,c=(n=e*s/255)+s*(255-(255-s)*(255-e)/255-n)/255,u=(n=i*a/255)+a*(255-(255-a)*(255-i)/255-n)/255},"hard-light":function(){h=t<128?2*t*r/255:255-2*(255-t)*(255-r)/255,c=e<128?2*e*s/255:255-2*(255-e)*(255-s)/255,u=i<128?2*i*a/255:255-2*(255-i)*(255-a)/255},"color-dodge":function(){h=0===r?0:255===t?255:f(255,255*r/(255-t)),c=0===s?0:255===e?255:f(255,255*s/(255-e)),u=0===a?0:255===i?255:f(255,255*a/(255-i))},"color-burn":function(){h=255===r?255:0===t?0:d(0,255-255*(255-r)/t),c=255===s?255:0===e?0:d(0,255-255*(255-s)/e),u=255===a?255:0===i?0:d(0,255-255*(255-a)/i)},darken:function(){h=r<t?r:t,c=s<e?s:e,u=a<i?a:i},lighten:function(){h=r>t?r:t,c=s>e?s:e,u=a>i?a:i},difference:function(){(h=r-t)<0&&(h=-h),(c=s-e)<0&&(c=-c),(u=a-i)<0&&(u=-u)},exclusion:function(){h=r+t*(255-r-r)/255,c=s+e*(255-s-s)/255,u=a+i*(255-a-a)/255},hue:function(){m(t,e,i,_(r,s,a)),v(h,c,u,g(r,s,a))},saturation:function(){m(r,s,a,_(t,e,i)),v(h,c,u,g(r,s,a))},luminosity:function(){v(r,s,a,g(t,e,i))},color:function(){v(t,e,i,g(r,s,a))},add:function(){h=f(r+t,255),c=f(s+e,255),u=f(a+i,255)},subtract:function(){h=d(r-t,0),c=d(s-e,0),u=d(a-i,0)},average:function(){h=(r+t)/2,c=(s+e)/2,u=(a+i)/2},negation:function(){h=255-p(255-t-r),c=255-p(255-e-s),u=255-p(255-i-a)}},x=this.nativeModes=l.each(["source-over","source-in","source-out","source-atop","destination-over","destination-in","destination-out","destination-atop","lighter","darker","copy","xor"],function(t){this[t]=!0},{}),b=at.getContext(1,1);b&&(l.each(y,function(t,e){var i="darken"===e,n=!1;b.save();try{b.fillStyle=i?"#300":"#a00",b.fillRect(0,0,1,1),b.globalCompositeOperation=e,b.globalCompositeOperation===e&&(b.fillStyle=i?"#a00":"#300",b.fillRect(0,0,1,1),n=b.getImageData(0,0,1,1).data[0]!==i?170:51)}catch(t){}b.restore(),x[e]=n}),at.release(b)),this.process=function(l,f,d,p,g){var v=f.canvas,_="normal"===l;if(_||x[l])d.save(),d.setTransform(1,0,0,1,0,0),d.globalAlpha=p,_||(d.globalCompositeOperation=l),d.drawImage(v,g.x,g.y),d.restore();else{var m=y[l];if(!m)return;for(var b=d.getImageData(g.x,g.y,v.width,v.height),w=b.data,C=f.getImageData(0,0,v.width,v.height).data,S=0,T=w.length;S<T;S+=4){t=C[S],r=w[S],e=C[S+1],s=w[S+1],i=C[S+2],a=w[S+2],n=C[S+3],o=w[S+3],m();var k=n*p/255,O=1-k;w[S]=k*h+O*r,w[S+1]=k*c+O*s,w[S+2]=k*u+O*a,w[S+3]=n*p+O*o}d.putImageData(b,g.x,g.y)}}},ht=new function(){var t="http://www.w3.org/2000/svg",e="http://www.w3.org/2000/xmlns",i="http://www.w3.org/1999/xlink",n={href:i,xlink:e,xmlns:e+"/","xmlns:xlink":e+"/"};function r(t,e,i){for(var r in e){var s=e[r],a=n[r];"number"==typeof s&&i&&(s=i.number(s)),a?t.setAttributeNS(a,r,s):t.setAttribute(r,s)}return t}return{svg:t,xmlns:e,xlink:i,create:function(e,i,n){return r(c.createElementNS(t,e),i,n)},get:function(t,e){var i=n[e],r=i?t.getAttributeNS(i,e):t.getAttribute(e);return"null"===r?null:r},set:r}},ct=l.each({fillColor:["fill","color"],fillRule:["fill-rule","string"],strokeColor:["stroke","color"],strokeWidth:["stroke-width","number"],strokeCap:["stroke-linecap","string"],strokeJoin:["stroke-linejoin","string"],strokeScaling:["vector-effect","lookup",{true:"none",false:"non-scaling-stroke"},function(t,e){return!e&&(t instanceof B||t instanceof P||t instanceof W)}],miterLimit:["stroke-miterlimit","number"],dashArray:["stroke-dasharray","array"],dashOffset:["stroke-dashoffset","number"],fontFamily:["font-family","string"],fontWeight:["font-weight","string"],fontSize:["font-size","number"],justification:["text-anchor","lookup",{left:"start",center:"middle",right:"end"}],opacity:["opacity","number"],blendMode:["mix-blend-mode","style"]},function(t,e){var i=l.capitalize(e),n=t[2];this[e]={type:t[1],property:e,attribute:t[0],toSVG:n,fromSVG:n&&l.each(n,function(t,e){this[t]=e},{}),exportFilter:t[3],get:"get"+i,set:"set"+i}},{});new function(){var t;function e(e,i,n){var r=new l,s=e.getTranslation();if(i){var a=(e=e._shiftless())._inverseTransform(s);r[n?"cx":"x"]=a.x,r[n?"cy":"y"]=a.y,s=null}if(!e.isIdentity()){var o=e.decompose();if(o){var h=[],c=o.rotation,u=o.scaling,f=o.skewing;s&&!s.isZero()&&h.push("translate("+t.point(s)+")"),c&&h.push("rotate("+t.number(c)+")"),g.isZero(u.x-1)&&g.isZero(u.y-1)||h.push("scale("+t.point(u)+")"),f.x&&h.push("skewX("+t.number(f.x)+")"),f.y&&h.push("skewY("+t.number(f.y)+")"),r.transform=h.join(" ")}else r.transform="matrix("+e.getValues().join(",")+")"}return r}function i(i,n){for(var r=e(i._matrix),s=i._children,a=ht.create("g",r,t),o=0,h=s.length;o<h;o++){var l=s[o],u=f(l,n);if(u)if(l.isClipMask()){var d=ht.create("clipPath");d.appendChild(u),c(l,d,"clip"),ht.set(a,{"clip-path":"url(#"+d.id+")"})}else a.appendChild(u)}return a}function n(i){var n=i._type,r=i._radius,s=e(i._matrix,!0,"rectangle"!==n);if("rectangle"===n){n="rect";var a=i._size,o=a.width,h=a.height;s.x-=o/2,s.y-=h/2,s.width=o,s.height=h,r.isZero()&&(r=null)}return r&&("circle"===n?s.r=r:(s.rx=r.width,s.ry=r.height)),ht.create(n,s,t)}var r,s={Group:i,Layer:i,Raster:function(i,n){var r=e(i._matrix,!0),s=i.getSize(),a=i.getImage();return r.x-=s.width/2,r.y-=s.height/2,r.width=s.width,r.height=s.height,r.href=0==n.embedImages&&a&&a.src||i.toDataURL(),ht.create("image",r,t)},Path:function(i,r){var s=r.matchShapes;if(s){var a=i.toShape(!1);if(a)return n(a)}var o,h=i._segments,c=h.length,l=e(i._matrix);if(s&&c>=2&&!i.hasHandles())if(c>2){o=i._closed?"polygon":"polyline";for(var u=[],f=0;f<c;f++)u.push(t.point(h[f]._point));l.points=u.join(" ")}else{o="line";var d=h[0]._point,p=h[1]._point;l.set({x1:d.x,y1:d.y,x2:p.x,y2:p.y})}else o="path",l.d=i.getPathData(null,r.precision);return ht.create(o,l,t)},Shape:n,CompoundPath:function(i,n){var r=e(i._matrix),s=i.getPathData(null,n.precision);return s&&(r.d=s),ht.create("path",r,t)},SymbolItem:function(i,n){var r=e(i._matrix,!0),s=i._definition,a=h(s,"symbol"),o=s._item,l=o.getBounds();return a||((a=ht.create("symbol",{viewBox:t.rectangle(l)})).appendChild(f(o,n)),c(s,a,"symbol")),r.href="#"+a.id,r.x+=l.x,r.y+=l.y,r.width=l.width,r.height=l.height,r.overflow="visible",ht.create("use",r,t)},PointText:function(i){var n=ht.create("text",e(i._matrix,!0),t);return n.textContent=i._content,n}};function o(e,i,n){var r={},s=!n&&e.getParent(),a=[];return null!=e._name&&(r.id=e._name),l.each(ct,function(i){var n=i.get,o=i.type,u=e[n]();if(i.exportFilter?i.exportFilter(e,u):!s||!l.equals(s[n](),u)){if("color"===o&&null!=u){var f=u.getAlpha();f<1&&(r[i.attribute+"-opacity"]=f)}"style"===o?a.push(i.attribute+": "+u):r[i.attribute]=null==u?"none":"color"===o?u.gradient?function(e){var i=h(e,"color");if(!i){var n,r=e.getGradient(),s=r._radial,a=e.getOrigin(),o=e.getDestination();if(s){n={cx:a.x,cy:a.y,r:a.getDistance(o)};var l=e.getHighlight();l&&(n.fx=l.x,n.fy=l.y)}else n={x1:a.x,y1:a.y,x2:o.x,y2:o.y};n.gradientUnits="userSpaceOnUse",i=ht.create((s?"radial":"linear")+"Gradient",n,t);for(var u=r._stops,f=0,d=u.length;f<d;f++){var p=u[f],g=p._color,v=g.getAlpha(),_=p._offset;n={offset:null==_?f/(d-1):_},g&&(n["stop-color"]=g.toCSS(!0)),v<1&&(n["stop-opacity"]=v),i.appendChild(ht.create("stop",n,t))}c(e,i,"color")}return"url(#"+i.id+")"}(u):u.toCSS(!0):"array"===o?u.join(","):"lookup"===o?i.toSVG[u]:u}}),a.length&&(r.style=a.join(";")),1===r.opacity&&delete r.opacity,e._visible||(r.visibility="hidden"),ht.set(i,r,t)}function h(t,e){return r||(r={ids:{},svgs:{}}),t&&r.svgs[e+"-"+(t._id||t.__id||(t.__id=v.get("svg")))]}function c(t,e,i){r||h();var n=r.ids[i]=(r.ids[i]||0)+1;e.id=i+"-"+n,r.svgs[i+"-"+(t._id||t.__id)]=e}function u(t,e){var i=t,n=null;if(r){for(var s in i="svg"===t.nodeName.toLowerCase()&&t,r.svgs)n||(i||(i=ht.create("svg")).appendChild(t),n=i.insertBefore(ht.create("defs"),i.firstChild)),n.appendChild(r.svgs[s]);r=null}return e.asString?(new a.XMLSerializer).serializeToString(i):i}function f(t,e,i){var n=s[t._class],r=n&&n(t,e);if(r){var a=e.onExport;a&&(r=a(t,r,e)||r);var h=JSON.stringify(t._data);h&&"{}"!==h&&"null"!==h&&r.setAttribute("data-paper-data",h)}return r&&o(t,r,i)}function d(e){return e||(e={}),t=new p(e.precision),e}k.inject({exportSVG:function(t){return u(f(this,t=d(t),!0),t)}}),T.inject({exportSVG:function(i){i=d(i);var n=this._children,r=this.getView(),s=l.pick(i.bounds,"view"),a=i.matrix||"view"===s&&r._matrix,o=a&&C.read([a]),h="view"===s?new b([0,0],r.getViewSize()):"content"===s?k._getBounds(n,o,{stroke:!0}).rect:b.read([s],0,{readNull:!0}),c={version:"1.1",xmlns:ht.svg,"xmlns:xlink":ht.xlink};h&&(c.width=h.width,c.height=h.height,(h.x||h.y)&&(c.viewBox=t.rectangle(h)));var p=ht.create("svg",c,t),g=p;o&&!o.isIdentity()&&(g=p.appendChild(ht.create("g",e(o),t)));for(var v=0,_=n.length;v<_;v++)g.appendChild(f(n[v],i,!0));return u(p,i)}})},new function(){var t,e={};function i(e,i,n,r,s){var a=ht.get(e,i),o=null==a?r?null:n?"":0:n?a:parseFloat(a);return/%\s*$/.test(a)?o/100*(s?1:t[/x|^width/.test(i)?"width":"height"]):o}function n(t,e,n,r,s){return e=i(t,e||"x",!1,r,s),n=i(t,n||"y",!1,r,s),!r||null!=e&&null!=n?new _(e,n):null}function r(t,e,n,r,s){return e=i(t,e||"width",!1,r,s),n=i(t,n||"height",!1,r,s),!r||null!=e&&null!=n?new y(e,n):null}function s(t,e,i){return"none"===t?null:"number"===e?parseFloat(t):"array"===e?t?t.split(/[\s,]+/g).map(parseFloat):[]:"color"===e?S(t)||t:"lookup"===e?i[t]:t}function u(t,e,i,n){var r=t.childNodes,s="clippath"===e,a="defs"===e,o=new O,h=o._project,c=h._currentStyle,l=[];if(s||a||(o=w(o,t,n),h._currentStyle=o._style.clone()),n)for(var u=t.querySelectorAll("defs"),f=0,d=u.length;f<d;f++)A(u[f],i,!1);for(f=0,d=r.length;f<d;f++){var p,g=r[f];1!==g.nodeType||/^defs$/i.test(g.nodeName)||!(p=A(g,i,!1))||p instanceof I||l.push(p)}return o.addChildren(l),s&&(o=w(o.reduce(),t,n)),h._currentStyle=c,(s||a)&&(o.remove(),o=null),o}function f(t,e){for(var i=t.getAttribute("points").match(/[+-]?(?:\d*\.\d+|\d+\.?)(?:[eE][+-]?\d+)?/g),n=[],r=0,s=i.length;r<s;r+=2)n.push(new _(parseFloat(i[r]),parseFloat(i[r+1])));var a=new N(n);return"polygon"===e&&a.closePath(),a}function d(t,r){var s,a=(i(t,"href",!0)||"").substring(1),o="radialgradient"===r;if(a)(s=e[a].getGradient())._radial^o&&((s=s.clone())._radial=o);else{for(var h=t.childNodes,c=[],l=0,u=h.length;l<u;l++){var f=h[l];1===f.nodeType&&c.push(w(new Y,f))}s=new H(c,o)}var d,p,g,v="userSpaceOnUse"!==i(t,"gradientUnits",!0);return o?(p=(d=n(t,"cx","cy",!1,v)).add(i(t,"r",!1,!1,v),0),g=n(t,"fx","fy",!0,v)):(d=n(t,"x1","y1",!1,v),p=n(t,"x2","y2",!1,v)),w(new G(s,d,p,g),t)._scaleToBounds=v,null}var p={"#document":function(t,e,i,n){for(var r=t.childNodes,s=0,a=r.length;s<a;s++){var o=r[s];if(1===o.nodeType)return A(o,i,n)}},g:u,svg:u,clippath:u,polygon:f,polyline:f,path:function(t){return B.create(t.getAttribute("d"))},lineargradient:d,radialgradient:d,image:function(t){var e=new E(i(t,"href",!0));return e.on("load",function(){var e=r(t);this.setSize(e);var i=n(t).add(e.divide(2));this._matrix.append((new C).translate(i))}),e},symbol:function(t,e,i,n){return new I(u(t,e,i,n),!0)},defs:u,use:function(t){var r=(i(t,"href",!0)||"").substring(1),s=e[r],a=n(t);return s?s instanceof I?s.place(a):s.clone().translate(a):null},circle:function(t){return new P.Circle(n(t,"cx","cy"),i(t,"r"))},ellipse:function(t){return new P.Ellipse({center:n(t,"cx","cy"),radius:r(t,"rx","ry")})},rect:function(t){return new P.Rectangle(new b(n(t),r(t)),r(t,"rx","ry"))},line:function(t){return new N.Line(n(t,"x1","y1"),n(t,"x2","y2"))},text:function(t){var e=new X(n(t).add(n(t,"dx","dy")));return e.setContent(t.textContent.trim()||""),e}};function g(t,e,i,n){if(t.transform){for(var r=(n.getAttribute(i)||"").split(/\)\s*/g),s=new C,a=0,o=r.length;a<o;a++){var h=r[a];if(!h)break;for(var c=h.split(/\(\s*/),l=c[0],u=c[1].split(/[\s,]+/g),f=0,d=u.length;f<d;f++)u[f]=parseFloat(u[f]);switch(l){case"matrix":s.append(new C(u[0],u[1],u[2],u[3],u[4],u[5]));break;case"rotate":s.rotate(u[0],u[1]||0,u[2]||0);break;case"translate":s.translate(u[0],u[1]||0);break;case"scale":s.scale(u);break;case"skewX":s.skew(u[0],0);break;case"skewY":s.skew(0,u[0])}}t.transform(s)}}function v(t,e,i){var n="fill-opacity"===i?"getFillColor":"getStrokeColor",r=t[n]&&t[n]();r&&r.setAlpha(parseFloat(e))}var m=l.set(l.each(ct,function(t){this[t.attribute]=function(e,i){if(e[t.set]&&(e[t.set](s(i,t.type,t.fromSVG)),"color"===t.type)){var n=e[t.get]();if(n&&n._scaleToBounds){var r=e.getBounds();n.transform((new C).translate(r.getPoint()).scale(r.getSize()))}}}},{}),{id:function(t,i){e[i]=t,t.setName&&t.setName(i)},"clip-path":function(t,e){var i=S(e);if(i){if((i=i.clone()).setClipMask(!0),!(t instanceof O))return new O(i,t);t.insertChild(0,i)}},gradientTransform:g,transform:g,"fill-opacity":v,"stroke-opacity":v,visibility:function(t,e){t.setVisible&&t.setVisible("visible"===e)},display:function(t,e){t.setVisible&&t.setVisible(null!==e)},"stop-color":function(t,e){t.setColor&&t.setColor(e)},"stop-opacity":function(t,e){t._color&&t._color.setAlpha(parseFloat(e))},offset:function(t,e){if(t.setOffset){var i=e.match(/(.*)%$/);t.setOffset(i?i[1]/100:parseFloat(e))}},viewBox:function(t,e,i,n,a){var o,h=new b(s(e,"array")),c=r(n,null,null,!0);if(t instanceof O){var l=c?c.divide(h.getSize()):1,u=(new C).scale(l).translate(h.getPoint().negate());o=t}else t instanceof I&&(c&&h.setSize(c),o=t._item);if(o){if("visible"!==x(n,"overflow",a)){var f=new P.Rectangle(h);f.setClipMask(!0),o.addChild(f)}u&&o.transform(u)}}});function x(t,e,i){var n=t.attributes[e],r=n&&n.value;if(!r&&t.style){var s=l.camelize(e);(r=t.style[s])||i.node[s]===i.parent[s]||(r=i.node[s])}return r?"none"===r?null:r:o}function w(t,e,i){var n=e.parentNode,r={node:K.getStyles(e)||{},parent:!i&&!/^defs$/i.test(n.tagName)&&K.getStyles(n)||{}};return l.each(m,function(i,n){var s=x(e,n,r);t=s!==o&&i(t,s,n,e,r)||t}),t}function S(t){var i=t&&t.match(/\((?:["'#]*)([^"')]+)/),n=i&&i[1],r=n&&e[h?n.replace(h.location.href.split("#")[0]+"#",""):n];return r&&r._scaleToBounds&&((r=r.clone())._scaleToBounds=!0),r}function A(i,n,s){var a,o,h,u=i.nodeName.toLowerCase(),f="#document"!==u,d=c.body;s&&f&&(t=lt.getView().getSize(),t=r(i,null,null,!0)||t,a=ht.create("svg",{style:"stroke-width: 1px; stroke-miterlimit: 10"}),o=i.parentNode,h=i.nextSibling,a.appendChild(i),d.appendChild(a));var g=lt.settings,v=g.applyMatrix,_=g.insertItems;g.applyMatrix=!1,g.insertItems=!1;var m=p[u],y=m&&m(i,u,n,s)||null;if(g.insertItems=_,g.applyMatrix=v,y){!f||y instanceof O||(y=w(y,i,s));var x=n.onImport,b=f&&i.getAttribute("data-paper-data");x&&(y=x(i,y,n)||y),n.expandShapes&&y instanceof P&&(y.remove(),y=y.toPath()),b&&(y._data=JSON.parse(b))}return a&&(d.removeChild(a),o&&(h?o.insertBefore(i,h):o.appendChild(i))),s&&(e={},y&&l.pick(n.applyMatrix,v)&&y.matrix.apply(!0,!0)),y}function M(t,e,i){if(!t)return null;e="function"==typeof e?{onLoad:e}:e||{};var n=lt,r=null;function s(s){try{var c="object"==typeof s?s:(new a.DOMParser).parseFromString(s,"image/svg+xml");if(!c.nodeName)throw c=null,new Error("Unsupported SVG source: "+t);lt=n,r=A(c,e,!0),e&&!1===e.insert||i._insertItem(o,r);var l=e.onLoad;l&&l(r,s)}catch(t){h(t)}}function h(t,i){var n=e.onError;if(!n)throw new Error(t);n(t,i)}if("string"!=typeof t||/^.*</.test(t)){if("undefined"!=typeof File&&t instanceof File){var l=new FileReader;return l.onload=function(){s(l.result)},l.onerror=function(){h(l.error)},l.readAsText(t)}s(t)}else{var u=c.getElementById(t);u?s(u):st.request({url:t,async:!0,onLoad:s,onError:h})}return r}k.inject({importSVG:function(t,e){return M(t,e,this)}}),T.inject({importSVG:function(t,e){return this.activate(),M(t,e,this)}})},l.exports.PaperScript=function(){var t,e,u,d=this,p=d.acorn;if(!p)try{p=i(681)}catch(t){}p||(p=t=e={},u=function(t){"use strict";var e,i,n,r;t.version="0.5.0",t.parse=function(t,r){return i=String(t),n=i.length,a(r),Ht(),function(t){_=m=o,e.locations&&(y=new Gt);x=w=null,b=[],Jt();var i=t||le(),n=!0;t||(i.body=[]);for(;f!==E;){var r=we();i.body.push(r),n&&de(r)&&oe(!0),n=!1}return fe(i,"Program")}(e.program)};var s=t.defaultOptions={ecmaVersion:5,strictSemicolons:!1,allowTrailingCommas:!0,forbidReserved:!1,allowReturnOutsideFunction:!1,locations:!1,onComment:null,ranges:!1,program:null,sourceFile:null,directSourceFile:null};function a(t){for(var i in e=t||{},s)Object.prototype.hasOwnProperty.call(e,i)||(e[i]=s[i]);r=e.sourceFile||null}var o,h,c,l,u,f,d,p,g,v,_,m,y,x,b,w,C=t.getLineInfo=function(t,e){for(var i=1,n=0;;){Ut.lastIndex=n;var r=Ut.exec(t);if(!(r&&r.index<e))break;++i,n=r.index+r[0].length}return{line:i,column:e-n}};function S(t,e){var n=C(i,t);e+=" ("+n.line+":"+n.column+")";var r=new SyntaxError(e);throw r.pos=t,r.loc=n,r.raisedAt=o,r}t.tokenize=function(t,r){i=String(t),n=i.length,a(r),Ht();var s={};function _(t){return m=c,Jt(t),s.start=h,s.end=c,s.startLoc=l,s.endLoc=u,s.type=f,s.value=d,s}return _.jumpTo=function(t,n){var r;if(o=t,e.locations)for(g=1,v=Ut.lastIndex=0;(r=Ut.exec(i))&&r.index<t;)++g,v=r.index+r[0].length;p=n,Zt()},_};var T=[],k={type:"num"},O={type:"regexp"},A={type:"string"},P={type:"name"},E={type:"eof"},M={keyword:"break"},I={keyword:"case",beforeExpr:!0},L={keyword:"catch"},D={keyword:"continue"},j={keyword:"debugger"},F={keyword:"default"},R={keyword:"do",isLoop:!0},B={keyword:"else",beforeExpr:!0},N={keyword:"finally"},z={keyword:"for",isLoop:!0},V={keyword:"function"},U={keyword:"if"},W={keyword:"return",beforeExpr:!0},X={keyword:"switch"},G={keyword:"throw",beforeExpr:!0},H={keyword:"try"},Y={keyword:"var"},q={keyword:"while",isLoop:!0},K={keyword:"with"},Z={keyword:"new",beforeExpr:!0},$={keyword:"this"},J={keyword:"null",atomValue:null},Q={keyword:"true",atomValue:!0},tt={keyword:"false",atomValue:!1},et={keyword:"in",binop:7,beforeExpr:!0},it={break:M,case:I,catch:L,continue:D,debugger:j,default:F,do:R,else:B,finally:N,for:z,function:V,if:U,return:W,switch:X,throw:G,try:H,var:Y,while:q,with:K,null:J,true:Q,false:tt,new:Z,in:et,instanceof:{keyword:"instanceof",binop:7,beforeExpr:!0},this:$,typeof:{keyword:"typeof",prefix:!0,beforeExpr:!0},void:{keyword:"void",prefix:!0,beforeExpr:!0},delete:{keyword:"delete",prefix:!0,beforeExpr:!0}},nt={type:"[",beforeExpr:!0},rt={type:"]"},st={type:"{",beforeExpr:!0},at={type:"}"},ot={type:"(",beforeExpr:!0},ht={type:")"},ct={type:",",beforeExpr:!0},lt={type:";",beforeExpr:!0},ut={type:":",beforeExpr:!0},ft={type:"."},dt={type:"?",beforeExpr:!0},pt={binop:10,beforeExpr:!0},gt={isAssign:!0,beforeExpr:!0},vt={isAssign:!0,beforeExpr:!0},_t={postfix:!0,prefix:!0,isUpdate:!0},mt={prefix:!0,beforeExpr:!0},yt={binop:1,beforeExpr:!0},xt={binop:2,beforeExpr:!0},bt={binop:3,beforeExpr:!0},wt={binop:4,beforeExpr:!0},Ct={binop:5,beforeExpr:!0},St={binop:6,beforeExpr:!0},Tt={binop:7,beforeExpr:!0},kt={binop:8,beforeExpr:!0},Ot={binop:9,prefix:!0,beforeExpr:!0},At={binop:10,beforeExpr:!0};for(var Pt in t.tokTypes={bracketL:nt,bracketR:rt,braceL:st,braceR:at,parenL:ot,parenR:ht,comma:ct,semi:lt,colon:ut,dot:ft,question:dt,slash:pt,eq:gt,name:P,eof:E,num:k,regexp:O,string:A},it)t.tokTypes["_"+Pt]=it[Pt];function Et(t){t=t.split(" ");var e="",i=[];t:for(var n=0;n<t.length;++n){for(var r=0;r<i.length;++r)if(i[r][0].length==t[n].length){i[r].push(t[n]);continue t}i.push([t[n]])}function s(t){if(1==t.length)return e+="return str === "+JSON.stringify(t[0])+";";e+="switch(str){";for(var i=0;i<t.length;++i)e+="case "+JSON.stringify(t[i])+":";e+="return true}return false;"}if(i.length>3){i.sort(function(t,e){return e.length-t.length}),e+="switch(str.length){";for(n=0;n<i.length;++n){var a=i[n];e+="case "+a[0].length+":",s(a)}e+="}"}else s(t);return new Function("str",e)}var Mt,It=Et("abstract boolean byte char class double enum export extends final float goto implements import int interface long native package private protected public short static super synchronized throws transient volatile"),Lt=Et("class enum extends super const export import"),Dt=Et("implements interface let package private protected public static yield"),jt=Et("eval arguments"),Ft=Et("break case catch continue debugger default do else finally for function if return switch throw try var while with null true false instanceof typeof void delete new in this"),Rt=/[\u1680\u180e\u2000-\u200a\u202f\u205f\u3000\ufeff]/,Bt="------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------",Nt=new RegExp("["+Bt+"]"),zt=new RegExp("["+Bt+"------------------------------------------------------------------------------------------------------------------------------------------]"),Vt=/[\n\r\u2028\u2029]/,Ut=/\r\n|[\n\r\u2028\u2029]/g,Wt=t.isIdentifierStart=function(t){return t<65?36===t:t<91||(t<97?95===t:t<123||t>=170&&Nt.test(String.fromCharCode(t)))},Xt=t.isIdentifierChar=function(t){return t<48?36===t:t<58||!(t<65)&&(t<91||(t<97?95===t:t<123||t>=170&&zt.test(String.fromCharCode(t))))};function Gt(){this.line=g,this.column=o-v}function Ht(){g=1,o=v=0,p=!0,Zt()}function Yt(t,i){c=o,e.locations&&(u=new Gt),f=t,Zt(),d=i,p=t.beforeExpr}function qt(){var t,n=e.onComment&&e.locations&&new Gt,r=o,s=i.indexOf("*/",o+=2);if(-1===s&&S(o-2,"Unterminated comment"),o=s+2,e.locations)for(Ut.lastIndex=r;(t=Ut.exec(i))&&t.index<o;)++g,v=t.index+t[0].length;e.onComment&&e.onComment(!0,i.slice(r+2,s),r,o,n,e.locations&&new Gt)}function Kt(){for(var t=o,r=e.onComment&&e.locations&&new Gt,s=i.charCodeAt(o+=2);o<n&&10!==s&&13!==s&&8232!==s&&8233!==s;)++o,s=i.charCodeAt(o);e.onComment&&e.onComment(!1,i.slice(t+2,o),t,o,r,e.locations&&new Gt)}function Zt(){for(;o<n;){var t=i.charCodeAt(o);if(32===t)++o;else if(13===t){++o,10===(r=i.charCodeAt(o))&&++o,e.locations&&(++g,v=o)}else if(10===t||8232===t||8233===t)++o,e.locations&&(++g,v=o);else if(t>8&&t<14)++o;else if(47===t){var r;if(42===(r=i.charCodeAt(o+1)))qt();else{if(47!==r)break;Kt()}}else if(160===t)++o;else{if(!(t>=5760&&Rt.test(String.fromCharCode(t))))break;++o}}}function $t(t){switch(t){case 46:return function(){var t=i.charCodeAt(o+1);return t>=48&&t<=57?ie(!0):(++o,Yt(ft))}();case 40:return++o,Yt(ot);case 41:return++o,Yt(ht);case 59:return++o,Yt(lt);case 44:return++o,Yt(ct);case 91:return++o,Yt(nt);case 93:return++o,Yt(rt);case 123:return++o,Yt(st);case 125:return++o,Yt(at);case 58:return++o,Yt(ut);case 63:return++o,Yt(dt);case 48:var r=i.charCodeAt(o+1);if(120===r||88===r)return function(){o+=2;var t=ee(16);null==t&&S(h+2,"Expected hexadecimal number");Wt(i.charCodeAt(o))&&S(o,"Identifier directly after number");return Yt(k,t)}();case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return ie(!1);case 34:case 39:return function(t){o++;for(var r="";;){o>=n&&S(h,"Unterminated string constant");var s=i.charCodeAt(o);if(s===t)return++o,Yt(A,r);if(92===s){s=i.charCodeAt(++o);var a=/^[0-7]+/.exec(i.slice(o,o+3));for(a&&(a=a[0]);a&&parseInt(a,8)>255;)a=a.slice(0,-1);if("0"===a&&(a=null),++o,a)w&&S(o-2,"Octal literal in strict mode"),r+=String.fromCharCode(parseInt(a,8)),o+=a.length-1;else switch(s){case 110:r+="\n";break;case 114:r+="\r";break;case 120:r+=String.fromCharCode(ne(2));break;case 117:r+=String.fromCharCode(ne(4));break;case 85:r+=String.fromCharCode(ne(8));break;case 116:r+="\t";break;case 98:r+="\b";break;case 118:r+="\v";break;case 102:r+="\f";break;case 48:r+="\0";break;case 13:10===i.charCodeAt(o)&&++o;case 10:e.locations&&(v=o,++g);break;default:r+=String.fromCharCode(s)}}else 13!==s&&10!==s&&8232!==s&&8233!==s||S(h,"Unterminated string constant"),r+=String.fromCharCode(s),++o}}(t);case 47:return function(){var t=i.charCodeAt(o+1);return p?(++o,te()):61===t?Qt(vt,2):Qt(pt,1)}();case 37:case 42:return 61===i.charCodeAt(o+1)?Qt(vt,2):Qt(At,1);case 124:case 38:return function(t){var e=i.charCodeAt(o+1);return e===t?Qt(124===t?yt:xt,2):61===e?Qt(vt,2):Qt(124===t?bt:Ct,1)}(t);case 94:return 61===i.charCodeAt(o+1)?Qt(vt,2):Qt(wt,1);case 43:case 45:return function(t){var e=i.charCodeAt(o+1);return e===t?45==e&&62==i.charCodeAt(o+2)&&Vt.test(i.slice(m,o))?(o+=3,Kt(),Zt(),Jt()):Qt(_t,2):61===e?Qt(vt,2):Qt(Ot,1)}(t);case 60:case 62:return function(t){var e=i.charCodeAt(o+1),n=1;return e===t?(n=62===t&&62===i.charCodeAt(o+2)?3:2,61===i.charCodeAt(o+n)?Qt(vt,n+1):Qt(kt,n)):33==e&&60==t&&45==i.charCodeAt(o+2)&&45==i.charCodeAt(o+3)?(o+=4,Kt(),Zt(),Jt()):(61===e&&(n=61===i.charCodeAt(o+2)?3:2),Qt(Tt,n))}(t);case 61:case 33:return function(t){return 61===i.charCodeAt(o+1)?Qt(St,61===i.charCodeAt(o+2)?3:2):Qt(61===t?gt:mt,1)}(t);case 126:return Qt(mt,1)}return!1}function Jt(t){if(t?o=h+1:h=o,e.locations&&(l=new Gt),t)return te();if(o>=n)return Yt(E);var r=i.charCodeAt(o);if(Wt(r)||92===r)return se();var s=$t(r);if(!1===s){var a=String.fromCharCode(r);if("\\"===a||Nt.test(a))return se();S(o,"Unexpected character '"+a+"'")}return s}function Qt(t,e){var n=i.slice(o,o+e);o+=e,Yt(t,n)}function te(){for(var t,e,r=o;;){o>=n&&S(r,"Unterminated regular expression");var s=i.charAt(o);if(Vt.test(s)&&S(r,"Unterminated regular expression"),t)t=!1;else{if("["===s)e=!0;else if("]"===s&&e)e=!1;else if("/"===s&&!e)break;t="\\"===s}++o}var a=i.slice(r,o);++o;var h=re();h&&!/^[gmsiy]*$/.test(h)&&S(r,"Invalid regexp flag");try{var c=new RegExp(a,h)}catch(t){t instanceof SyntaxError&&S(r,t.message),S(t)}return Yt(O,c)}function ee(t,e){for(var n=o,r=0,s=0,a=null==e?1/0:e;s<a;++s){var h,c=i.charCodeAt(o);if((h=c>=97?c-97+10:c>=65?c-65+10:c>=48&&c<=57?c-48:1/0)>=t)break;++o,r=r*t+h}return o===n||null!=e&&o-n!==e?null:r}function ie(t){var e=o,n=!1,r=48===i.charCodeAt(o);t||null!==ee(10)||S(e,"Invalid number"),46===i.charCodeAt(o)&&(++o,ee(10),n=!0);var s=i.charCodeAt(o);69!==s&&101!==s||(43!==(s=i.charCodeAt(++o))&&45!==s||++o,null===ee(10)&&S(e,"Invalid number"),n=!0),Wt(i.charCodeAt(o))&&S(o,"Identifier directly after number");var a,h=i.slice(e,o);return n?a=parseFloat(h):r&&1!==h.length?/[89]/.test(h)||w?S(e,"Invalid number"):a=parseInt(h,8):a=parseInt(h,10),Yt(k,a)}function ne(t){var e=ee(16,t);return null===e&&S(h,"Bad character escape sequence"),e}function re(){Mt=!1;for(var t,e=!0,n=o;;){var r=i.charCodeAt(o);if(Xt(r))Mt&&(t+=i.charAt(o)),++o;else{if(92!==r)break;Mt||(t=i.slice(n,o)),Mt=!0,117!=i.charCodeAt(++o)&&S(o,"Expecting Unicode escape sequence \\uXXXX"),++o;var s=ne(4),a=String.fromCharCode(s);a||S(o-1,"Invalid Unicode escape"),(e?Wt(s):Xt(s))||S(o-4,"Invalid Unicode escape"),t+=a}e=!1}return Mt?t:i.slice(n,o)}function se(){var t=re(),e=P;return!Mt&&Ft(t)&&(e=it[t]),Yt(e,t)}function ae(){_=h,m=c,y=u,Jt()}function oe(t){if(w=t,o=h,e.locations)for(;o<v;)v=i.lastIndexOf("\n",v-2)+1,--g;Zt(),Jt()}function he(){this.type=null,this.start=h,this.end=null}function ce(){this.start=l,this.end=null,null!==r&&(this.source=r)}function le(){var t=new he;return e.locations&&(t.loc=new ce),e.directSourceFile&&(t.sourceFile=e.directSourceFile),e.ranges&&(t.range=[h,0]),t}function ue(t){var i=new he;return i.start=t.start,e.locations&&(i.loc=new ce,i.loc.start=t.loc.start),e.ranges&&(i.range=[t.range[0],0]),i}function fe(t,i){return t.type=i,t.end=m,e.locations&&(t.loc.end=y),e.ranges&&(t.range[1]=m),t}function de(t){return e.ecmaVersion>=5&&"ExpressionStatement"===t.type&&"Literal"===t.expression.type&&"use strict"===t.expression.value}function pe(t){if(f===t)return ae(),!0}function ge(){return!e.strictSemicolons&&(f===E||f===at||Vt.test(i.slice(m,h)))}function ve(){pe(lt)||ge()||me()}function _e(t){f===t?ae():me()}function me(){S(h,"Unexpected token")}function ye(t){"Identifier"!==t.type&&"MemberExpression"!==t.type&&S(t.start,"Assigning to rvalue"),w&&"Identifier"===t.type&&jt(t.name)&&S(t.start,"Assigning to "+t.name+" in strict mode")}var xe={kind:"loop"},be={kind:"switch"};function we(){(f===pt||f===vt&&"/="==d)&&Jt(!0);var t=f,n=le();switch(t){case M:case D:ae();var r=t===M;pe(lt)||ge()?n.label=null:f!==P?me():(n.label=Fe(),ve());for(var s=0;s<b.length;++s){var a=b[s];if(null==n.label||a.name===n.label.name){if(null!=a.kind&&(r||"loop"===a.kind))break;if(n.label&&r)break}}return s===b.length&&S(n.start,"Unsyntactic "+t.keyword),fe(n,r?"BreakStatement":"ContinueStatement");case j:return ae(),ve(),fe(n,"DebuggerStatement");case R:return ae(),b.push(xe),n.body=we(),b.pop(),_e(q),n.test=Ce(),ve(),fe(n,"DoWhileStatement");case z:if(ae(),b.push(xe),_e(ot),f===lt)return Te(n,null);if(f===Y){var o=le();return ae(),Oe(o,!0),fe(o,"VariableDeclaration"),1===o.declarations.length&&pe(et)?ke(n,o):Te(n,o)}o=Ae(!1,!0);return pe(et)?(ye(o),ke(n,o)):Te(n,o);case V:return ae(),De(n,!0);case U:return ae(),n.test=Ce(),n.consequent=we(),n.alternate=pe(B)?we():null,fe(n,"IfStatement");case W:return x||e.allowReturnOutsideFunction||S(h,"'return' outside of function"),ae(),pe(lt)||ge()?n.argument=null:(n.argument=Ae(),ve()),fe(n,"ReturnStatement");case X:ae(),n.discriminant=Ce(),n.cases=[],_e(st),b.push(be);for(var c,l;f!=at;)if(f===I||f===F){var u=f===I;c&&fe(c,"SwitchCase"),n.cases.push(c=le()),c.consequent=[],ae(),u?c.test=Ae():(l&&S(_,"Multiple default clauses"),l=!0,c.test=null),_e(ut)}else c||me(),c.consequent.push(we());return c&&fe(c,"SwitchCase"),ae(),b.pop(),fe(n,"SwitchStatement");case G:return ae(),Vt.test(i.slice(m,h))&&S(m,"Illegal newline after throw"),n.argument=Ae(),ve(),fe(n,"ThrowStatement");case H:if(ae(),n.block=Se(),n.handler=null,f===L){var p=le();ae(),_e(ot),p.param=Fe(),w&&jt(p.param.name)&&S(p.param.start,"Binding "+p.param.name+" in strict mode"),_e(ht),p.guard=null,p.body=Se(),n.handler=fe(p,"CatchClause")}return n.guardedHandlers=T,n.finalizer=pe(N)?Se():null,n.handler||n.finalizer||S(n.start,"Missing catch or finally clause"),fe(n,"TryStatement");case Y:return ae(),Oe(n),ve(),fe(n,"VariableDeclaration");case q:return ae(),n.test=Ce(),b.push(xe),n.body=we(),b.pop(),fe(n,"WhileStatement");case K:return w&&S(h,"'with' in strict mode"),ae(),n.object=Ce(),n.body=we(),fe(n,"WithStatement");case st:return Se();case lt:return ae(),fe(n,"EmptyStatement");default:var g=d,v=Ae();if(t===P&&"Identifier"===v.type&&pe(ut)){for(s=0;s<b.length;++s)b[s].name===g&&S(v.start,"Label '"+g+"' is already declared");var y=f.isLoop?"loop":f===X?"switch":null;return b.push({name:g,kind:y}),n.body=we(),b.pop(),n.label=v,fe(n,"LabeledStatement")}return n.expression=v,ve(),fe(n,"ExpressionStatement")}}function Ce(){_e(ot);var t=Ae();return _e(ht),t}function Se(t){var e,i=le(),n=!0,r=!1;for(i.body=[],_e(st);!pe(at);){var s=we();i.body.push(s),n&&t&&de(s)&&(e=r,oe(r=!0)),n=!1}return r&&!e&&oe(!1),fe(i,"BlockStatement")}function Te(t,e){return t.init=e,_e(lt),t.test=f===lt?null:Ae(),_e(lt),t.update=f===ht?null:Ae(),_e(ht),t.body=we(),b.pop(),fe(t,"ForStatement")}function ke(t,e){return t.left=e,t.right=Ae(),_e(ht),t.body=we(),b.pop(),fe(t,"ForInStatement")}function Oe(t,e){for(t.declarations=[],t.kind="var";;){var i=le();if(i.id=Fe(),w&&jt(i.id.name)&&S(i.id.start,"Binding "+i.id.name+" in strict mode"),i.init=pe(gt)?Ae(!0,e):null,t.declarations.push(fe(i,"VariableDeclarator")),!pe(ct))break}return t}function Ae(t,e){var i=Pe(e);if(!t&&f===ct){var n=ue(i);for(n.expressions=[i];pe(ct);)n.expressions.push(Pe(e));return fe(n,"SequenceExpression")}return i}function Pe(t){var e=function(t){var e=function(t){return function t(e,i,n){var r=f.binop;if(null!=r&&(!n||f!==et)&&r>i){var s=ue(e);s.left=e,s.operator=d;var a=f;ae(),s.right=t(Ee(),r,n);var o=fe(s,a===yt||a===xt?"LogicalExpression":"BinaryExpression");return t(o,i,n)}return e}(Ee(),-1,t)}(t);if(pe(dt)){var i=ue(e);return i.test=e,i.consequent=Ae(!0),_e(ut),i.alternate=Ae(!0,t),fe(i,"ConditionalExpression")}return e}(t);if(f.isAssign){var i=ue(e);return i.operator=d,i.left=e,ae(),i.right=Pe(t),ye(e),fe(i,"AssignmentExpression")}return e}function Ee(){if(f.prefix){var t=le(),e=f.isUpdate;return t.operator=d,t.prefix=!0,p=!0,ae(),t.argument=Ee(),e?ye(t.argument):w&&"delete"===t.operator&&"Identifier"===t.argument.type&&S(t.start,"Deleting local variable in strict mode"),fe(t,e?"UpdateExpression":"UnaryExpression")}for(var i=Me(Ie());f.postfix&&!ge();){(t=ue(i)).operator=d,t.prefix=!1,t.argument=i,ye(i),ae(),i=fe(t,"UpdateExpression")}return i}function Me(t,e){var i;return pe(ft)?((i=ue(t)).object=t,i.property=Fe(!0),i.computed=!1,Me(fe(i,"MemberExpression"),e)):pe(nt)?((i=ue(t)).object=t,i.property=Ae(),i.computed=!0,_e(rt),Me(fe(i,"MemberExpression"),e)):!e&&pe(ot)?((i=ue(t)).callee=t,i.arguments=je(ht,!1),Me(fe(i,"CallExpression"),e)):t}function Ie(){switch(f){case $:var t=le();return ae(),fe(t,"ThisExpression");case P:return Fe();case k:case A:case O:return(t=le()).value=d,t.raw=i.slice(h,c),ae(),fe(t,"Literal");case J:case Q:case tt:return(t=le()).value=f.atomValue,t.raw=f.keyword,ae(),fe(t,"Literal");case ot:var n=l,r=h;ae();var s=Ae();return s.start=r,s.end=c,e.locations&&(s.loc.start=n,s.loc.end=u),e.ranges&&(s.range=[r,c]),_e(ht),s;case nt:t=le();return ae(),t.elements=je(rt,!0,!0),fe(t,"ArrayExpression");case st:return function(){var t=le(),i=!0,n=!1;t.properties=[],ae();for(;!pe(at);){if(i)i=!1;else if(_e(ct),e.allowTrailingCommas&&pe(at))break;var r,s={key:Le()},a=!1;if(pe(ut)?(s.value=Ae(!0),r=s.kind="init"):e.ecmaVersion>=5&&"Identifier"===s.key.type&&("get"===s.key.name||"set"===s.key.name)?(a=n=!0,r=s.kind=s.key.name,s.key=Le(),f!==ot&&me(),s.value=De(le(),!1)):me(),"Identifier"===s.key.type&&(w||n))for(var o=0;o<t.properties.length;++o){var h=t.properties[o];if(h.key.name===s.key.name){var c=r==h.kind||a&&"init"===h.kind||"init"===r&&("get"===h.kind||"set"===h.kind);c&&!w&&"init"===r&&"init"===h.kind&&(c=!1),c&&S(s.key.start,"Redefinition of property")}}t.properties.push(s)}return fe(t,"ObjectExpression")}();case V:t=le();return ae(),De(t,!1);case Z:return function(){var t=le();ae(),t.callee=Me(Ie(),!0),pe(ot)?t.arguments=je(ht,!1):t.arguments=T;return fe(t,"NewExpression")}();default:me()}}function Le(){return f===k||f===A?Ie():Fe(!0)}function De(t,e){f===P?t.id=Fe():e?me():t.id=null,t.params=[];var i=!0;for(_e(ot);!pe(ht);)i?i=!1:_e(ct),t.params.push(Fe());var n=x,r=b;if(x=!0,b=[],t.body=Se(!0),x=n,b=r,w||t.body.body.length&&de(t.body.body[0]))for(var s=t.id?-1:0;s<t.params.length;++s){var a=s<0?t.id:t.params[s];if((Dt(a.name)||jt(a.name))&&S(a.start,"Defining '"+a.name+"' in strict mode"),s>=0)for(var o=0;o<s;++o)a.name===t.params[o].name&&S(a.start,"Argument name clash in strict mode")}return fe(t,e?"FunctionDeclaration":"FunctionExpression")}function je(t,i,n){for(var r=[],s=!0;!pe(t);){if(s)s=!1;else if(_e(ct),i&&e.allowTrailingCommas&&pe(t))break;n&&f===ct?r.push(null):r.push(Ae(!0))}return r}function Fe(t){var n=le();return t&&"everywhere"==e.forbidReserved&&(t=!1),f===P?(!t&&(e.forbidReserved&&(3===e.ecmaVersion?It:Lt)(d)||w&&Dt(d))&&-1==i.slice(h,c).indexOf("\\")&&S(h,"The keyword '"+d+"' is reserved"),n.name=d):t&&f.keyword?n.name=f.keyword:me(),p=!1,ae(),fe(n,"Identifier")}},"object"==typeof t&&"object"==typeof e?u(t):(n=[t],(s="function"==typeof(r=u)?r.apply(t,n):r)===o||(e.exports=s)),p.version||(p=null));function g(t,e){return(d.acorn||p).parse(t,e)}var v={"+":"__add","-":"__subtract","*":"__multiply","/":"__divide","%":"__modulo","==":"__equals","!=":"__equals"},m={"-":"__negate","+":"__self"},x=l.each(["add","subtract","multiply","divide","modulo","equals","negate"],function(t){this["__"+t]="#"+t},{__self:function(){return this}});function b(t,e,i){var n=v[e];if(t&&t[n]){var r=t[n](i);return"!="===e?!r:r}switch(e){case"+":return t+i;case"-":return t-i;case"*":return t*i;case"/":return t/i;case"%":return t%i;case"==":return t==i;case"!=":return t!=i}}function w(t,e){var i=m[t];if(e&&e[i])return e[i]();switch(t){case"+":return+e;case"-":return-e}}function C(t,e){if(!t)return"";var i=[];function n(t){for(var e=0,n=i.length;e<n;e++){var r=i[e];if(r[0]>=t)break;t+=r[1]}return t}function r(e){return t.substring(n(e.range[0]),n(e.range[1]))}function s(e,r){for(var s=n(e.range[0]),a=n(e.range[1]),o=0,h=i.length-1;h>=0;h--)if(s>i[h][0]){o=h+1;break}i.splice(o,0,[s,r.length-a+s]),t=t.substring(0,s)+r+t.substring(a)}var o,l=(e=e||{}).url||"",u=lt.agent,f=u.versionNumber,d=!1,p=e.sourceMaps,_=e.source||t,y=/\r\n|\n|\r/gm,x=e.offset||0;if(p&&(u.chrome&&f>=30||u.webkit&&f>=537.76||u.firefox&&f>=23||u.node)){if(u.node)x-=2;else if(h&&l&&!h.location.href.indexOf(l)){var b=c.getElementsByTagName("html")[0].innerHTML;x=b.substr(0,b.indexOf(t)+1).match(y).length+1}var w=["AA"+function(t){var e="";for(t=(Math.abs(t)<<1)+(t<0?1:0);t||!e;){var i=31&t;(t>>=5)&&(i|=32),e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[i]}return e}((d=x>0&&!(u.chrome&&f>=36||u.safari&&f>=600||u.firefox&&f>=40||u.node))?0:x)+"A"];w.length=(t.match(y)||[]).length+1+(d?x:0),o={version:3,file:l,names:[],mappings:w.join(";AACA"),sourceRoot:"",sources:[l],sourcesContent:[_]}}return function e(i,a){if(i){for(var o in i)if("range"!==o&&"loc"!==o){var h=i[o];if(Array.isArray(h))for(var c=0,l=h.length;c<l;c++)e(h[c],i);else h&&"object"==typeof h&&e(h,i)}switch(i.type){case"UnaryExpression":if(i.operator in m&&"Literal"!==i.argument.type){var u=r(i.argument);s(i,'$__("'+i.operator+'", '+u+")")}break;case"BinaryExpression":if(i.operator in v&&"Literal"!==i.left.type){var f=r(i.left),d=r(i.right),p=function(e,i){return t.substring(n(e.range[1]),n(i.range[0]))}(i.left,i.right),g=i.operator;s(i,"__$__("+f+","+p.replace(new RegExp("\\"+g),'"'+g+'"')+", "+d+")")}break;case"UpdateExpression":case"AssignmentExpression":var _=a&&a.type;if(!("ForStatement"===_||"BinaryExpression"===_&&/^[=!<>]/.test(a.operator)||"MemberExpression"===_&&a.computed))if("UpdateExpression"===i.type){var y=(u=r(i.argument))+" = "+(x="__$__("+u+', "'+i.operator[0]+'", 1)');i.prefix||"AssignmentExpression"!==_&&"VariableDeclarator"!==_||(r(a.left||a.id)===u&&(y=x),y=u+"; "+y),s(i,y)}else if(/^.=$/.test(i.operator)&&"Literal"!==i.left.type){f=r(i.left),d=r(i.right);var x=f+" = __$__("+f+', "'+i.operator[0]+'", '+d+")";s(i,/^\(.*\)$/.test(r(i))?"("+x+")":x)}break;case"ExportDefaultDeclaration":s({range:[i.start,i.declaration.start]},"module.exports = ");break;case"ExportNamedDeclaration":var b=i.declaration,w=i.specifiers;if(b){var C=b.declarations;C&&(C.forEach(function(t){s(t,"module.exports."+r(t))}),s({range:[i.start,b.start+b.kind.length]},""))}else if(w){var S=w.map(function(t){var e=r(t);return"module.exports."+e+" = "+e+"; "}).join("");S&&s(i,S)}}}}(g(t,{ranges:!0,preserveParens:!0,sourceType:"module"})),o&&(d&&(t=new Array(x+1).join("\n")+t),/^(inline|both)$/.test(p)&&(t+="\n//# sourceMappingURL=data:application/json;base64,"+a.btoa(unescape(encodeURIComponent(JSON.stringify(o))))),t+="\n//# sourceURL="+(l||"paperscript")),{url:l,source:_,code:t,map:o}}function S(t,e,i){lt=e;var n,r=e.getView(),s=/\btool\.\w+|\s+on(?:Key|Mouse)(?:Up|Down|Move|Drag)\b/.test(t)&&!/\bnew\s+Tool\b/.test(t)?new rt:null,a=s?s._events:[],o=["onFrame","onResize"].concat(a),h=[],u=[],f="object"==typeof t?t:C(t,i);function d(e,i){for(var n in e)!i&&/^_/.test(n)||!new RegExp("([\\b\\s\\W]|^)"+n.replace(/\$/g,"\\$")+"\\b").test(t)||(h.push(n),u.push(e[n]))}t=f.code,d({__$__:b,$__:w,paper:e,view:r,tool:s},!0),d(e),t="var module = { exports: {} }; "+t,(m=l.each(o,function(e){new RegExp("\\s+"+e+"\\b").test(t)&&(h.push(e),this.push("module.exports."+e+" = "+e+";"))},[]).join("\n"))&&(t+="\n"+m),t+="\nreturn module.exports;";var p=lt.agent;if(c&&(p.chrome||p.firefox&&p.versionNumber<40)){var g=c.createElement("script"),v=c.head||c.getElementsByTagName("head")[0];p.firefox&&(t="\n"+t),g.appendChild(c.createTextNode("document.__paperscript__ = function("+h+") {"+t+"\n}")),v.appendChild(g),n=c.__paperscript__,delete c.__paperscript__,v.removeChild(g)}else n=Function(h,t);var m,y=(m=n&&n.apply(e,u))||{};return l.each(a,function(t){var e=y[t];e&&(s[t]=e)}),r&&(y.onResize&&r.setOnResize(y.onResize),r.emit("resize",{size:r.size,delta:new _}),y.onFrame&&r.setOnFrame(y.onFrame),r.requestUpdate()),m}function T(t){if(/^text\/(?:x-|)paperscript$/.test(t.type)&&"true"!==f.getAttribute(t,"ignore")){var e=f.getAttribute(t,"canvas"),i=c.getElementById(e),n=t.src||t.getAttribute("data-src"),r=f.hasAttribute(t,"async");if(!i)throw new Error('Unable to find canvas with id "'+e+'"');var s=f.get(i.getAttribute("data-paper-scope"))||(new f).setup(i);return i.setAttribute("data-paper-scope",s._id),n?st.request({url:n,async:r,mimeType:"text/plain",onLoad:function(t){S(t,s,n)}}):S(t.innerHTML,s,t.baseURI),t.setAttribute("data-paper-ignore","true"),s}}function k(){l.each(c&&c.getElementsByTagName("script"),T)}return _.inject(x),y.inject(x),G.inject(x),h&&("complete"===c.readyState?setTimeout(k):Z.add(h,{load:k})),{compile:C,execute:S,load:function(t){return t?T(t):k()},parse:g}}.call(this);var lt=new(f.inject(l.exports,{Base:l,Numerical:g,Key:et,DomEvent:Z,DomElement:K,document:c,window:h,Symbol:I,PlacedSymbol:M}));return lt.agent.node&&i(682)(lt),(s="function"==typeof(r=lt)?r.call(e,i,e,t):r)===o||(t.exports=s),lt}).call(this,"object"==typeof self?self:null)},681:function(t,e,i){"use strict";i.r(e),i.d(e,"version",function(){return Tt}),i.d(e,"parse",function(){return kt}),i.d(e,"parseExpressionAt",function(){return Ot}),i.d(e,"tokenizer",function(){return At}),i.d(e,"parse_dammit",function(){return wt}),i.d(e,"LooseParser",function(){return Ct}),i.d(e,"pluginsLoose",function(){return St}),i.d(e,"addLooseExports",function(){return Pt}),i.d(e,"Parser",function(){return z}),i.d(e,"plugins",function(){return B}),i.d(e,"defaultOptions",function(){return F}),i.d(e,"Position",function(){return L}),i.d(e,"SourceLocation",function(){return D}),i.d(e,"getLineInfo",function(){return j}),i.d(e,"Node",function(){return tt}),i.d(e,"TokenType",function(){return v}),i.d(e,"tokTypes",function(){return w}),i.d(e,"keywordTypes",function(){return x}),i.d(e,"TokContext",function(){return nt}),i.d(e,"tokContexts",function(){return rt}),i.d(e,"isIdentifierChar",function(){return g}),i.d(e,"isIdentifierStart",function(){return p}),i.d(e,"Token",function(){return mt}),i.d(e,"isNewLine",function(){return T}),i.d(e,"lineBreak",function(){return C}),i.d(e,"lineBreakG",function(){return S}),i.d(e,"nonASCIIwhitespace",function(){return k});var n={3:"abstract boolean byte char class double enum export extends final float goto implements import int interface long native package private protected public short static super synchronized throws transient volatile",5:"class enum extends super const export import",6:"enum",strict:"implements interface let package private protected public static yield",strictBind:"eval arguments"},r="break case catch continue debugger default do else finally for function if return switch throw try var while with null true false instanceof typeof void delete new in this",s={5:r,6:r+" const class extends export import super"},a=/^in(stanceof)?$/,o="---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------",h="---------------------------------------------------------------------------------------------------------------------------------------------------",c=new RegExp("["+o+"]"),l=new RegExp("["+o+h+"]");o=h=null;var u=[0,11,2,25,2,18,2,1,2,14,3,13,35,122,70,52,268,28,4,48,48,31,14,29,6,37,11,29,3,35,5,7,2,4,43,157,19,35,5,35,5,39,9,51,157,310,10,21,11,7,153,5,3,0,2,43,2,1,4,0,3,22,11,22,10,30,66,18,2,1,11,21,11,25,71,55,7,1,65,0,16,3,2,2,2,28,43,28,4,28,36,7,2,27,28,53,11,21,11,18,14,17,111,72,56,50,14,50,14,35,477,28,11,0,9,21,190,52,76,44,33,24,27,35,30,0,12,34,4,0,13,47,15,3,22,0,2,0,36,17,2,24,85,6,2,0,2,3,2,14,2,9,8,46,39,7,3,1,3,21,2,6,2,1,2,4,4,0,19,0,13,4,159,52,19,3,54,47,21,1,2,0,185,46,42,3,37,47,21,0,60,42,86,26,230,43,117,63,32,0,257,0,11,39,8,0,22,0,12,39,3,3,20,0,35,56,264,8,2,36,18,0,50,29,113,6,2,1,2,37,22,0,26,5,2,1,2,31,15,0,328,18,270,921,103,110,18,195,2749,1070,4050,582,8634,568,8,30,114,29,19,47,17,3,32,20,6,18,689,63,129,68,12,0,67,12,65,1,31,6129,15,754,9486,286,82,395,2309,106,6,12,4,8,8,9,5991,84,2,70,2,1,3,0,3,1,3,3,2,11,2,0,2,6,2,64,2,3,3,7,2,6,2,27,2,3,2,4,2,0,4,6,2,339,3,24,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,7,4149,196,60,67,1213,3,2,26,2,1,2,0,3,0,2,9,2,3,2,0,2,0,7,0,5,0,2,0,2,0,2,2,2,1,2,0,3,0,2,0,2,0,2,0,2,0,2,1,2,0,3,3,2,6,2,3,2,3,2,0,2,9,2,16,6,2,2,4,2,16,4421,42710,42,4148,12,221,3,5761,15,7472,3104,541],f=[509,0,227,0,150,4,294,9,1368,2,2,1,6,3,41,2,5,0,166,1,574,3,9,9,525,10,176,2,54,14,32,9,16,3,46,10,54,9,7,2,37,13,2,9,6,1,45,0,13,2,49,13,9,3,4,9,83,11,7,0,161,11,6,9,7,3,56,1,2,6,3,1,3,2,10,0,11,1,3,6,4,4,193,17,10,9,5,0,82,19,13,9,214,6,3,8,28,1,83,16,16,9,82,12,9,9,84,14,5,9,243,14,166,9,280,9,41,6,2,3,9,0,10,10,47,15,406,7,2,7,17,9,57,21,2,13,123,5,4,0,2,1,2,6,2,0,9,9,49,4,2,1,2,4,9,9,330,3,19306,9,135,4,60,6,26,9,1016,45,17,3,19723,1,5319,4,4,5,9,7,3,6,31,3,149,2,1418,49,513,54,5,49,9,0,15,0,23,4,2,14,1361,6,2,16,3,6,2,1,2,4,2214,6,110,6,6,9,792487,239];function d(t,e){for(var i=65536,n=0;n<e.length;n+=2){if((i+=e[n])>t)return!1;if((i+=e[n+1])>=t)return!0}}function p(t,e){return t<65?36===t:t<91||(t<97?95===t:t<123||(t<=65535?t>=170&&c.test(String.fromCharCode(t)):!1!==e&&d(t,u)))}function g(t,e){return t<48?36===t:t<58||!(t<65)&&(t<91||(t<97?95===t:t<123||(t<=65535?t>=170&&l.test(String.fromCharCode(t)):!1!==e&&(d(t,u)||d(t,f)))))}var v=function(t,e){void 0===e&&(e={}),this.label=t,this.keyword=e.keyword,this.beforeExpr=!!e.beforeExpr,this.startsExpr=!!e.startsExpr,this.isLoop=!!e.isLoop,this.isAssign=!!e.isAssign,this.prefix=!!e.prefix,this.postfix=!!e.postfix,this.binop=e.binop||null,this.updateContext=null};function _(t,e){return new v(t,{beforeExpr:!0,binop:e})}var m={beforeExpr:!0},y={startsExpr:!0},x={};function b(t,e){return void 0===e&&(e={}),e.keyword=t,x[t]=new v(t,e)}var w={num:new v("num",y),regexp:new v("regexp",y),string:new v("string",y),name:new v("name",y),eof:new v("eof"),bracketL:new v("[",{beforeExpr:!0,startsExpr:!0}),bracketR:new v("]"),braceL:new v("{",{beforeExpr:!0,startsExpr:!0}),braceR:new v("}"),parenL:new v("(",{beforeExpr:!0,startsExpr:!0}),parenR:new v(")"),comma:new v(",",m),semi:new v(";",m),colon:new v(":",m),dot:new v("."),question:new v("?",m),arrow:new v("=>",m),template:new v("template"),invalidTemplate:new v("invalidTemplate"),ellipsis:new v("...",m),backQuote:new v("`",y),dollarBraceL:new v("${",{beforeExpr:!0,startsExpr:!0}),eq:new v("=",{beforeExpr:!0,isAssign:!0}),assign:new v("_=",{beforeExpr:!0,isAssign:!0}),incDec:new v("++/--",{prefix:!0,postfix:!0,startsExpr:!0}),prefix:new v("!/~",{beforeExpr:!0,prefix:!0,startsExpr:!0}),logicalOR:_("||",1),logicalAND:_("&&",2),bitwiseOR:_("|",3),bitwiseXOR:_("^",4),bitwiseAND:_("&",5),equality:_("==/!=/===/!==",6),relational:_("</>/<=/>=",7),bitShift:_("<</>>/>>>",8),plusMin:new v("+/-",{beforeExpr:!0,binop:9,prefix:!0,startsExpr:!0}),modulo:_("%",10),star:_("*",10),slash:_("/",10),starstar:new v("**",{beforeExpr:!0}),_break:b("break"),_case:b("case",m),_catch:b("catch"),_continue:b("continue"),_debugger:b("debugger"),_default:b("default",m),_do:b("do",{isLoop:!0,beforeExpr:!0}),_else:b("else",m),_finally:b("finally"),_for:b("for",{isLoop:!0}),_function:b("function",y),_if:b("if"),_return:b("return",m),_switch:b("switch"),_throw:b("throw",m),_try:b("try"),_var:b("var"),_const:b("const"),_while:b("while",{isLoop:!0}),_with:b("with"),_new:b("new",{beforeExpr:!0,startsExpr:!0}),_this:b("this",y),_super:b("super",y),_class:b("class",y),_extends:b("extends",m),_export:b("export"),_import:b("import"),_null:b("null",y),_true:b("true",y),_false:b("false",y),_in:b("in",{beforeExpr:!0,binop:7}),_instanceof:b("instanceof",{beforeExpr:!0,binop:7}),_typeof:b("typeof",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_void:b("void",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_delete:b("delete",{beforeExpr:!0,prefix:!0,startsExpr:!0})},C=/\r\n?|\n|\u2028|\u2029/,S=new RegExp(C.source,"g");function T(t,e){return 10===t||13===t||!e&&(8232===t||8233===t)}var k=/[\u1680\u180e\u2000-\u200a\u202f\u205f\u3000\ufeff]/,O=/(?:\s|\/\/.*|\/\*[^]*?\*\/)*/g,A=Object.prototype,P=A.hasOwnProperty,E=A.toString;function M(t,e){return P.call(t,e)}var I=Array.isArray||function(t){return"[object Array]"===E.call(t)},L=function(t,e){this.line=t,this.column=e};L.prototype.offset=function(t){return new L(this.line,this.column+t)};var D=function(t,e,i){this.start=e,this.end=i,null!==t.sourceFile&&(this.source=t.sourceFile)};function j(t,e){for(var i=1,n=0;;){S.lastIndex=n;var r=S.exec(t);if(!(r&&r.index<e))return new L(i,e-n);++i,n=r.index+r[0].length}}var F={ecmaVersion:7,sourceType:"script",onInsertedSemicolon:null,onTrailingComma:null,allowReserved:null,allowReturnOutsideFunction:!1,allowImportExportEverywhere:!1,allowAwaitOutsideFunction:!1,allowHashBang:!1,locations:!1,onToken:null,onComment:null,ranges:!1,program:null,sourceFile:null,directSourceFile:null,preserveParens:!1,plugins:{}};function R(t){var e={};for(var i in F)e[i]=t&&M(t,i)?t[i]:F[i];if(e.ecmaVersion>=2015&&(e.ecmaVersion-=2009),null==e.allowReserved&&(e.allowReserved=e.ecmaVersion<5),I(e.onToken)){var n=e.onToken;e.onToken=function(t){return n.push(t)}}return I(e.onComment)&&(e.onComment=function(t,e){return function(i,n,r,s,a,o){var h={type:i?"Block":"Line",value:n,start:r,end:s};t.locations&&(h.loc=new D(this,a,o)),t.ranges&&(h.range=[r,s]),e.push(h)}}(e,e.onComment)),e}var B={};function N(t){return new RegExp("^(?:"+t.replace(/ /g,"|")+")$")}var z=function(t,e,i){this.options=t=R(t),this.sourceFile=t.sourceFile,this.keywords=N(s[t.ecmaVersion>=6?6:5]);var r="";if(!t.allowReserved){for(var a=t.ecmaVersion;!(r=n[a]);a--);"module"===t.sourceType&&(r+=" await")}this.reservedWords=N(r);var o=(r?r+" ":"")+n.strict;this.reservedWordsStrict=N(o),this.reservedWordsStrictBind=N(o+" "+n.strictBind),this.input=String(e),this.containsEsc=!1,this.loadPlugins(t.plugins),i?(this.pos=i,this.lineStart=this.input.lastIndexOf("\n",i-1)+1,this.curLine=this.input.slice(0,this.lineStart).split(C).length):(this.pos=this.lineStart=0,this.curLine=1),this.type=w.eof,this.value=null,this.start=this.end=this.pos,this.startLoc=this.endLoc=this.curPosition(),this.lastTokEndLoc=this.lastTokStartLoc=null,this.lastTokStart=this.lastTokEnd=this.pos,this.context=this.initialContext(),this.exprAllowed=!0,this.inModule="module"===t.sourceType,this.strict=this.inModule||this.strictDirective(this.pos),this.potentialArrowAt=-1,this.inFunction=this.inGenerator=this.inAsync=!1,this.yieldPos=this.awaitPos=0,this.labels=[],0===this.pos&&t.allowHashBang&&"#!"===this.input.slice(0,2)&&this.skipLineComment(2),this.scopeStack=[],this.enterFunctionScope(),this.regexpState=null};z.prototype.isKeyword=function(t){return this.keywords.test(t)},z.prototype.isReservedWord=function(t){return this.reservedWords.test(t)},z.prototype.extend=function(t,e){this[t]=e(this[t])},z.prototype.loadPlugins=function(t){for(var e in t){var i=B[e];if(!i)throw new Error("Plugin '"+e+"' not found");i(this,t[e])}},z.prototype.parse=function(){var t=this.options.program||this.startNode();return this.nextToken(),this.parseTopLevel(t)};var V=z.prototype,U=/^(?:'((?:\\.|[^'])*?)'|"((?:\\.|[^"])*?)"|;)/;function W(){this.shorthandAssign=this.trailingComma=this.parenthesizedAssign=this.parenthesizedBind=this.doubleProto=-1}V.strictDirective=function(t){for(;;){O.lastIndex=t,t+=O.exec(this.input)[0].length;var e=U.exec(this.input.slice(t));if(!e)return!1;if("use strict"===(e[1]||e[2]))return!0;t+=e[0].length}},V.eat=function(t){return this.type===t&&(this.next(),!0)},V.isContextual=function(t){return this.type===w.name&&this.value===t&&!this.containsEsc},V.eatContextual=function(t){return!!this.isContextual(t)&&(this.next(),!0)},V.expectContextual=function(t){this.eatContextual(t)||this.unexpected()},V.canInsertSemicolon=function(){return this.type===w.eof||this.type===w.braceR||C.test(this.input.slice(this.lastTokEnd,this.start))},V.insertSemicolon=function(){if(this.canInsertSemicolon())return this.options.onInsertedSemicolon&&this.options.onInsertedSemicolon(this.lastTokEnd,this.lastTokEndLoc),!0},V.semicolon=function(){this.eat(w.semi)||this.insertSemicolon()||this.unexpected()},V.afterTrailingComma=function(t,e){if(this.type===t)return this.options.onTrailingComma&&this.options.onTrailingComma(this.lastTokStart,this.lastTokStartLoc),e||this.next(),!0},V.expect=function(t){this.eat(t)||this.unexpected()},V.unexpected=function(t){this.raise(null!=t?t:this.start,"Unexpected token")},V.checkPatternErrors=function(t,e){if(t){t.trailingComma>-1&&this.raiseRecoverable(t.trailingComma,"Comma is not permitted after the rest element");var i=e?t.parenthesizedAssign:t.parenthesizedBind;i>-1&&this.raiseRecoverable(i,"Parenthesized pattern")}},V.checkExpressionErrors=function(t,e){if(!t)return!1;var i=t.shorthandAssign,n=t.doubleProto;if(!e)return i>=0||n>=0;i>=0&&this.raise(i,"Shorthand property assignments are valid only in destructuring patterns"),n>=0&&this.raiseRecoverable(n,"Redefinition of __proto__ property")},V.checkYieldAwaitInDefaultParams=function(){this.yieldPos&&(!this.awaitPos||this.yieldPos<this.awaitPos)&&this.raise(this.yieldPos,"Yield expression cannot be a default value"),this.awaitPos&&this.raise(this.awaitPos,"Await expression cannot be a default value")},V.isSimpleAssignTarget=function(t){return"ParenthesizedExpression"===t.type?this.isSimpleAssignTarget(t.expression):"Identifier"===t.type||"MemberExpression"===t.type};var X=z.prototype;X.parseTopLevel=function(t){var e={};for(t.body||(t.body=[]);this.type!==w.eof;){var i=this.parseStatement(!0,!0,e);t.body.push(i)}return this.adaptDirectivePrologue(t.body),this.next(),this.options.ecmaVersion>=6&&(t.sourceType=this.options.sourceType),this.finishNode(t,"Program")};var G={kind:"loop"},H={kind:"switch"};X.isLet=function(){if(this.options.ecmaVersion<6||!this.isContextual("let"))return!1;O.lastIndex=this.pos;var t=O.exec(this.input),e=this.pos+t[0].length,i=this.input.charCodeAt(e);if(91===i||123===i)return!0;if(p(i,!0)){for(var n=e+1;g(this.input.charCodeAt(n),!0);)++n;var r=this.input.slice(e,n);if(!a.test(r))return!0}return!1},X.isAsyncFunction=function(){if(this.options.ecmaVersion<8||!this.isContextual("async"))return!1;O.lastIndex=this.pos;var t=O.exec(this.input),e=this.pos+t[0].length;return!(C.test(this.input.slice(this.pos,e))||"function"!==this.input.slice(e,e+8)||e+8!==this.input.length&&g(this.input.charAt(e+8)))},X.parseStatement=function(t,e,i){var n,r=this.type,s=this.startNode();switch(this.isLet()&&(r=w._var,n="let"),r){case w._break:case w._continue:return this.parseBreakContinueStatement(s,r.keyword);case w._debugger:return this.parseDebuggerStatement(s);case w._do:return this.parseDoStatement(s);case w._for:return this.parseForStatement(s);case w._function:return!t&&this.options.ecmaVersion>=6&&this.unexpected(),this.parseFunctionStatement(s,!1);case w._class:return t||this.unexpected(),this.parseClass(s,!0);case w._if:return this.parseIfStatement(s);case w._return:return this.parseReturnStatement(s);case w._switch:return this.parseSwitchStatement(s);case w._throw:return this.parseThrowStatement(s);case w._try:return this.parseTryStatement(s);case w._const:case w._var:return n=n||this.value,t||"var"===n||this.unexpected(),this.parseVarStatement(s,n);case w._while:return this.parseWhileStatement(s);case w._with:return this.parseWithStatement(s);case w.braceL:return this.parseBlock();case w.semi:return this.parseEmptyStatement(s);case w._export:case w._import:return this.options.allowImportExportEverywhere||(e||this.raise(this.start,"'import' and 'export' may only appear at the top level"),this.inModule||this.raise(this.start,"'import' and 'export' may appear only with 'sourceType: module'")),r===w._import?this.parseImport(s):this.parseExport(s,i);default:if(this.isAsyncFunction())return t||this.unexpected(),this.next(),this.parseFunctionStatement(s,!0);var a=this.value,o=this.parseExpression();return r===w.name&&"Identifier"===o.type&&this.eat(w.colon)?this.parseLabeledStatement(s,a,o):this.parseExpressionStatement(s,o)}},X.parseBreakContinueStatement=function(t,e){var i="break"===e;this.next(),this.eat(w.semi)||this.insertSemicolon()?t.label=null:this.type!==w.name?this.unexpected():(t.label=this.parseIdent(),this.semicolon());for(var n=0;n<this.labels.length;++n){var r=this.labels[n];if(null==t.label||r.name===t.label.name){if(null!=r.kind&&(i||"loop"===r.kind))break;if(t.label&&i)break}}return n===this.labels.length&&this.raise(t.start,"Unsyntactic "+e),this.finishNode(t,i?"BreakStatement":"ContinueStatement")},X.parseDebuggerStatement=function(t){return this.next(),this.semicolon(),this.finishNode(t,"DebuggerStatement")},X.parseDoStatement=function(t){return this.next(),this.labels.push(G),t.body=this.parseStatement(!1),this.labels.pop(),this.expect(w._while),t.test=this.parseParenExpression(),this.options.ecmaVersion>=6?this.eat(w.semi):this.semicolon(),this.finishNode(t,"DoWhileStatement")},X.parseForStatement=function(t){this.next();var e=this.options.ecmaVersion>=9&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction)&&this.eatContextual("await")?this.lastTokStart:-1;if(this.labels.push(G),this.enterLexicalScope(),this.expect(w.parenL),this.type===w.semi)return e>-1&&this.unexpected(e),this.parseFor(t,null);var i=this.isLet();if(this.type===w._var||this.type===w._const||i){var n=this.startNode(),r=i?"let":this.value;return this.next(),this.parseVar(n,!0,r),this.finishNode(n,"VariableDeclaration"),!(this.type===w._in||this.options.ecmaVersion>=6&&this.isContextual("of"))||1!==n.declarations.length||"var"!==r&&n.declarations[0].init?(e>-1&&this.unexpected(e),this.parseFor(t,n)):(this.options.ecmaVersion>=9&&(this.type===w._in?e>-1&&this.unexpected(e):t.await=e>-1),this.parseForIn(t,n))}var s=new W,a=this.parseExpression(!0,s);return this.type===w._in||this.options.ecmaVersion>=6&&this.isContextual("of")?(this.options.ecmaVersion>=9&&(this.type===w._in?e>-1&&this.unexpected(e):t.await=e>-1),this.toAssignable(a,!1,s),this.checkLVal(a),this.parseForIn(t,a)):(this.checkExpressionErrors(s,!0),e>-1&&this.unexpected(e),this.parseFor(t,a))},X.parseFunctionStatement=function(t,e){return this.next(),this.parseFunction(t,!0,!1,e)},X.parseIfStatement=function(t){return this.next(),t.test=this.parseParenExpression(),t.consequent=this.parseStatement(!this.strict&&this.type===w._function),t.alternate=this.eat(w._else)?this.parseStatement(!this.strict&&this.type===w._function):null,this.finishNode(t,"IfStatement")},X.parseReturnStatement=function(t){return this.inFunction||this.options.allowReturnOutsideFunction||this.raise(this.start,"'return' outside of function"),this.next(),this.eat(w.semi)||this.insertSemicolon()?t.argument=null:(t.argument=this.parseExpression(),this.semicolon()),this.finishNode(t,"ReturnStatement")},X.parseSwitchStatement=function(t){var e;this.next(),t.discriminant=this.parseParenExpression(),t.cases=[],this.expect(w.braceL),this.labels.push(H),this.enterLexicalScope();for(var i=!1;this.type!==w.braceR;)if(this.type===w._case||this.type===w._default){var n=this.type===w._case;e&&this.finishNode(e,"SwitchCase"),t.cases.push(e=this.startNode()),e.consequent=[],this.next(),n?e.test=this.parseExpression():(i&&this.raiseRecoverable(this.lastTokStart,"Multiple default clauses"),i=!0,e.test=null),this.expect(w.colon)}else e||this.unexpected(),e.consequent.push(this.parseStatement(!0));return this.exitLexicalScope(),e&&this.finishNode(e,"SwitchCase"),this.next(),this.labels.pop(),this.finishNode(t,"SwitchStatement")},X.parseThrowStatement=function(t){return this.next(),C.test(this.input.slice(this.lastTokEnd,this.start))&&this.raise(this.lastTokEnd,"Illegal newline after throw"),t.argument=this.parseExpression(),this.semicolon(),this.finishNode(t,"ThrowStatement")};var Y=[];X.parseTryStatement=function(t){if(this.next(),t.block=this.parseBlock(),t.handler=null,this.type===w._catch){var e=this.startNode();this.next(),this.eat(w.parenL)?(e.param=this.parseBindingAtom(),this.enterLexicalScope(),this.checkLVal(e.param,"let"),this.expect(w.parenR)):(this.options.ecmaVersion<10&&this.unexpected(),e.param=null,this.enterLexicalScope()),e.body=this.parseBlock(!1),this.exitLexicalScope(),t.handler=this.finishNode(e,"CatchClause")}return t.finalizer=this.eat(w._finally)?this.parseBlock():null,t.handler||t.finalizer||this.raise(t.start,"Missing catch or finally clause"),this.finishNode(t,"TryStatement")},X.parseVarStatement=function(t,e){return this.next(),this.parseVar(t,!1,e),this.semicolon(),this.finishNode(t,"VariableDeclaration")},X.parseWhileStatement=function(t){return this.next(),t.test=this.parseParenExpression(),this.labels.push(G),t.body=this.parseStatement(!1),this.labels.pop(),this.finishNode(t,"WhileStatement")},X.parseWithStatement=function(t){return this.strict&&this.raise(this.start,"'with' in strict mode"),this.next(),t.object=this.parseParenExpression(),t.body=this.parseStatement(!1),this.finishNode(t,"WithStatement")},X.parseEmptyStatement=function(t){return this.next(),this.finishNode(t,"EmptyStatement")},X.parseLabeledStatement=function(t,e,i){for(var n=0,r=this.labels;n<r.length;n+=1){r[n].name===e&&this.raise(i.start,"Label '"+e+"' is already declared")}for(var s=this.type.isLoop?"loop":this.type===w._switch?"switch":null,a=this.labels.length-1;a>=0;a--){var o=this.labels[a];if(o.statementStart!==t.start)break;o.statementStart=this.start,o.kind=s}return this.labels.push({name:e,kind:s,statementStart:this.start}),t.body=this.parseStatement(!0),("ClassDeclaration"===t.body.type||"VariableDeclaration"===t.body.type&&"var"!==t.body.kind||"FunctionDeclaration"===t.body.type&&(this.strict||t.body.generator||t.body.async))&&this.raiseRecoverable(t.body.start,"Invalid labeled declaration"),this.labels.pop(),t.label=i,this.finishNode(t,"LabeledStatement")},X.parseExpressionStatement=function(t,e){return t.expression=e,this.semicolon(),this.finishNode(t,"ExpressionStatement")},X.parseBlock=function(t){void 0===t&&(t=!0);var e=this.startNode();for(e.body=[],this.expect(w.braceL),t&&this.enterLexicalScope();!this.eat(w.braceR);){var i=this.parseStatement(!0);e.body.push(i)}return t&&this.exitLexicalScope(),this.finishNode(e,"BlockStatement")},X.parseFor=function(t,e){return t.init=e,this.expect(w.semi),t.test=this.type===w.semi?null:this.parseExpression(),this.expect(w.semi),t.update=this.type===w.parenR?null:this.parseExpression(),this.expect(w.parenR),this.exitLexicalScope(),t.body=this.parseStatement(!1),this.labels.pop(),this.finishNode(t,"ForStatement")},X.parseForIn=function(t,e){var i=this.type===w._in?"ForInStatement":"ForOfStatement";return this.next(),"ForInStatement"===i&&("AssignmentPattern"===e.type||"VariableDeclaration"===e.type&&null!=e.declarations[0].init&&(this.strict||"Identifier"!==e.declarations[0].id.type))&&this.raise(e.start,"Invalid assignment in for-in loop head"),t.left=e,t.right="ForInStatement"===i?this.parseExpression():this.parseMaybeAssign(),this.expect(w.parenR),this.exitLexicalScope(),t.body=this.parseStatement(!1),this.labels.pop(),this.finishNode(t,i)},X.parseVar=function(t,e,i){for(t.declarations=[],t.kind=i;;){var n=this.startNode();if(this.parseVarId(n,i),this.eat(w.eq)?n.init=this.parseMaybeAssign(e):"const"!==i||this.type===w._in||this.options.ecmaVersion>=6&&this.isContextual("of")?"Identifier"===n.id.type||e&&(this.type===w._in||this.isContextual("of"))?n.init=null:this.raise(this.lastTokEnd,"Complex binding patterns require an initialization value"):this.unexpected(),t.declarations.push(this.finishNode(n,"VariableDeclarator")),!this.eat(w.comma))break}return t},X.parseVarId=function(t,e){t.id=this.parseBindingAtom(e),this.checkLVal(t.id,e,!1)},X.parseFunction=function(t,e,i,n){this.initFunction(t),(this.options.ecmaVersion>=9||this.options.ecmaVersion>=6&&!n)&&(t.generator=this.eat(w.star)),this.options.ecmaVersion>=8&&(t.async=!!n),e&&(t.id="nullableID"===e&&this.type!==w.name?null:this.parseIdent(),t.id&&this.checkLVal(t.id,this.inModule&&!this.inFunction?"let":"var"));var r=this.inGenerator,s=this.inAsync,a=this.yieldPos,o=this.awaitPos,h=this.inFunction;return this.inGenerator=t.generator,this.inAsync=t.async,this.yieldPos=0,this.awaitPos=0,this.inFunction=!0,this.enterFunctionScope(),e||(t.id=this.type===w.name?this.parseIdent():null),this.parseFunctionParams(t),this.parseFunctionBody(t,i),this.inGenerator=r,this.inAsync=s,this.yieldPos=a,this.awaitPos=o,this.inFunction=h,this.finishNode(t,e?"FunctionDeclaration":"FunctionExpression")},X.parseFunctionParams=function(t){this.expect(w.parenL),t.params=this.parseBindingList(w.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams()},X.parseClass=function(t,e){this.next(),this.parseClassId(t,e),this.parseClassSuper(t);var i=this.startNode(),n=!1;for(i.body=[],this.expect(w.braceL);!this.eat(w.braceR);){var r=this.parseClassMember(i);r&&"MethodDefinition"===r.type&&"constructor"===r.kind&&(n&&this.raise(r.start,"Duplicate constructor in the same class"),n=!0)}return t.body=this.finishNode(i,"ClassBody"),this.finishNode(t,e?"ClassDeclaration":"ClassExpression")},X.parseClassMember=function(t){var e=this;if(this.eat(w.semi))return null;var i=this.startNode(),n=function(t,n){void 0===n&&(n=!1);var r=e.start,s=e.startLoc;return!!e.eatContextual(t)&&(!(e.type===w.parenL||n&&e.canInsertSemicolon())||(i.key&&e.unexpected(),i.computed=!1,i.key=e.startNodeAt(r,s),i.key.name=t,e.finishNode(i.key,"Identifier"),!1))};i.kind="method",i.static=n("static");var r=this.eat(w.star),s=!1;r||(this.options.ecmaVersion>=8&&n("async",!0)?(s=!0,r=this.options.ecmaVersion>=9&&this.eat(w.star)):n("get")?i.kind="get":n("set")&&(i.kind="set")),i.key||this.parsePropertyName(i);var a=i.key;return i.computed||i.static||!("Identifier"===a.type&&"constructor"===a.name||"Literal"===a.type&&"constructor"===a.value)?i.static&&"Identifier"===a.type&&"prototype"===a.name&&this.raise(a.start,"Classes may not have a static property named prototype"):("method"!==i.kind&&this.raise(a.start,"Constructor can't have get/set modifier"),r&&this.raise(a.start,"Constructor can't be a generator"),s&&this.raise(a.start,"Constructor can't be an async method"),i.kind="constructor"),this.parseClassMethod(t,i,r,s),"get"===i.kind&&0!==i.value.params.length&&this.raiseRecoverable(i.value.start,"getter should have no params"),"set"===i.kind&&1!==i.value.params.length&&this.raiseRecoverable(i.value.start,"setter should have exactly one param"),"set"===i.kind&&"RestElement"===i.value.params[0].type&&this.raiseRecoverable(i.value.params[0].start,"Setter cannot use rest params"),i},X.parseClassMethod=function(t,e,i,n){e.value=this.parseMethod(i,n),t.body.push(this.finishNode(e,"MethodDefinition"))},X.parseClassId=function(t,e){t.id=this.type===w.name?this.parseIdent():!0===e?this.unexpected():null},X.parseClassSuper=function(t){t.superClass=this.eat(w._extends)?this.parseExprSubscripts():null},X.parseExport=function(t,e){if(this.next(),this.eat(w.star))return this.expectContextual("from"),this.type!==w.string&&this.unexpected(),t.source=this.parseExprAtom(),this.semicolon(),this.finishNode(t,"ExportAllDeclaration");if(this.eat(w._default)){var i;if(this.checkExport(e,"default",this.lastTokStart),this.type===w._function||(i=this.isAsyncFunction())){var n=this.startNode();this.next(),i&&this.next(),t.declaration=this.parseFunction(n,"nullableID",!1,i)}else if(this.type===w._class){var r=this.startNode();t.declaration=this.parseClass(r,"nullableID")}else t.declaration=this.parseMaybeAssign(),this.semicolon();return this.finishNode(t,"ExportDefaultDeclaration")}if(this.shouldParseExportStatement())t.declaration=this.parseStatement(!0),"VariableDeclaration"===t.declaration.type?this.checkVariableExport(e,t.declaration.declarations):this.checkExport(e,t.declaration.id.name,t.declaration.id.start),t.specifiers=[],t.source=null;else{if(t.declaration=null,t.specifiers=this.parseExportSpecifiers(e),this.eatContextual("from"))this.type!==w.string&&this.unexpected(),t.source=this.parseExprAtom();else{for(var s=0,a=t.specifiers;s<a.length;s+=1){var o=a[s];this.checkUnreserved(o.local)}t.source=null}this.semicolon()}return this.finishNode(t,"ExportNamedDeclaration")},X.checkExport=function(t,e,i){t&&(M(t,e)&&this.raiseRecoverable(i,"Duplicate export '"+e+"'"),t[e]=!0)},X.checkPatternExport=function(t,e){var i=e.type;if("Identifier"===i)this.checkExport(t,e.name,e.start);else if("ObjectPattern"===i)for(var n=0,r=e.properties;n<r.length;n+=1){var s=r[n];this.checkPatternExport(t,s)}else if("ArrayPattern"===i)for(var a=0,o=e.elements;a<o.length;a+=1){var h=o[a];h&&this.checkPatternExport(t,h)}else"Property"===i?this.checkPatternExport(t,e.value):"AssignmentPattern"===i?this.checkPatternExport(t,e.left):"RestElement"===i?this.checkPatternExport(t,e.argument):"ParenthesizedExpression"===i&&this.checkPatternExport(t,e.expression)},X.checkVariableExport=function(t,e){if(t)for(var i=0,n=e;i<n.length;i+=1){var r=n[i];this.checkPatternExport(t,r.id)}},X.shouldParseExportStatement=function(){return"var"===this.type.keyword||"const"===this.type.keyword||"class"===this.type.keyword||"function"===this.type.keyword||this.isLet()||this.isAsyncFunction()},X.parseExportSpecifiers=function(t){var e=[],i=!0;for(this.expect(w.braceL);!this.eat(w.braceR);){if(i)i=!1;else if(this.expect(w.comma),this.afterTrailingComma(w.braceR))break;var n=this.startNode();n.local=this.parseIdent(!0),n.exported=this.eatContextual("as")?this.parseIdent(!0):n.local,this.checkExport(t,n.exported.name,n.exported.start),e.push(this.finishNode(n,"ExportSpecifier"))}return e},X.parseImport=function(t){return this.next(),this.type===w.string?(t.specifiers=Y,t.source=this.parseExprAtom()):(t.specifiers=this.parseImportSpecifiers(),this.expectContextual("from"),t.source=this.type===w.string?this.parseExprAtom():this.unexpected()),this.semicolon(),this.finishNode(t,"ImportDeclaration")},X.parseImportSpecifiers=function(){var t=[],e=!0;if(this.type===w.name){var i=this.startNode();if(i.local=this.parseIdent(),this.checkLVal(i.local,"let"),t.push(this.finishNode(i,"ImportDefaultSpecifier")),!this.eat(w.comma))return t}if(this.type===w.star){var n=this.startNode();return this.next(),this.expectContextual("as"),n.local=this.parseIdent(),this.checkLVal(n.local,"let"),t.push(this.finishNode(n,"ImportNamespaceSpecifier")),t}for(this.expect(w.braceL);!this.eat(w.braceR);){if(e)e=!1;else if(this.expect(w.comma),this.afterTrailingComma(w.braceR))break;var r=this.startNode();r.imported=this.parseIdent(!0),this.eatContextual("as")?r.local=this.parseIdent():(this.checkUnreserved(r.imported),r.local=r.imported),this.checkLVal(r.local,"let"),t.push(this.finishNode(r,"ImportSpecifier"))}return t},X.adaptDirectivePrologue=function(t){for(var e=0;e<t.length&&this.isDirectiveCandidate(t[e]);++e)t[e].directive=t[e].expression.raw.slice(1,-1)},X.isDirectiveCandidate=function(t){return"ExpressionStatement"===t.type&&"Literal"===t.expression.type&&"string"==typeof t.expression.value&&('"'===this.input[t.start]||"'"===this.input[t.start])};var q=z.prototype;q.toAssignable=function(t,e,i){if(this.options.ecmaVersion>=6&&t)switch(t.type){case"Identifier":this.inAsync&&"await"===t.name&&this.raise(t.start,"Can not use 'await' as identifier inside an async function");break;case"ObjectPattern":case"ArrayPattern":case"RestElement":break;case"ObjectExpression":t.type="ObjectPattern",i&&this.checkPatternErrors(i,!0);for(var n=0,r=t.properties;n<r.length;n+=1){var s=r[n];this.toAssignable(s,e),"RestElement"!==s.type||"ArrayPattern"!==s.argument.type&&"ObjectPattern"!==s.argument.type||this.raise(s.argument.start,"Unexpected token")}break;case"Property":"init"!==t.kind&&this.raise(t.key.start,"Object pattern can't contain getter or setter"),this.toAssignable(t.value,e);break;case"ArrayExpression":t.type="ArrayPattern",i&&this.checkPatternErrors(i,!0),this.toAssignableList(t.elements,e);break;case"SpreadElement":t.type="RestElement",this.toAssignable(t.argument,e),"AssignmentPattern"===t.argument.type&&this.raise(t.argument.start,"Rest elements cannot have a default value");break;case"AssignmentExpression":"="!==t.operator&&this.raise(t.left.end,"Only '=' operator can be used for specifying default value."),t.type="AssignmentPattern",delete t.operator,this.toAssignable(t.left,e);case"AssignmentPattern":break;case"ParenthesizedExpression":this.toAssignable(t.expression,e);break;case"MemberExpression":if(!e)break;default:this.raise(t.start,"Assigning to rvalue")}else i&&this.checkPatternErrors(i,!0);return t},q.toAssignableList=function(t,e){for(var i=t.length,n=0;n<i;n++){var r=t[n];r&&this.toAssignable(r,e)}if(i){var s=t[i-1];6===this.options.ecmaVersion&&e&&s&&"RestElement"===s.type&&"Identifier"!==s.argument.type&&this.unexpected(s.argument.start)}return t},q.parseSpread=function(t){var e=this.startNode();return this.next(),e.argument=this.parseMaybeAssign(!1,t),this.finishNode(e,"SpreadElement")},q.parseRestBinding=function(){var t=this.startNode();return this.next(),6===this.options.ecmaVersion&&this.type!==w.name&&this.unexpected(),t.argument=this.parseBindingAtom(),this.finishNode(t,"RestElement")},q.parseBindingAtom=function(){if(this.options.ecmaVersion>=6)switch(this.type){case w.bracketL:var t=this.startNode();return this.next(),t.elements=this.parseBindingList(w.bracketR,!0,!0),this.finishNode(t,"ArrayPattern");case w.braceL:return this.parseObj(!0)}return this.parseIdent()},q.parseBindingList=function(t,e,i){for(var n=[],r=!0;!this.eat(t);)if(r?r=!1:this.expect(w.comma),e&&this.type===w.comma)n.push(null);else{if(i&&this.afterTrailingComma(t))break;if(this.type===w.ellipsis){var s=this.parseRestBinding();this.parseBindingListItem(s),n.push(s),this.type===w.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.expect(t);break}var a=this.parseMaybeDefault(this.start,this.startLoc);this.parseBindingListItem(a),n.push(a)}return n},q.parseBindingListItem=function(t){return t},q.parseMaybeDefault=function(t,e,i){if(i=i||this.parseBindingAtom(),this.options.ecmaVersion<6||!this.eat(w.eq))return i;var n=this.startNodeAt(t,e);return n.left=i,n.right=this.parseMaybeAssign(),this.finishNode(n,"AssignmentPattern")},q.checkLVal=function(t,e,i){switch(t.type){case"Identifier":this.strict&&this.reservedWordsStrictBind.test(t.name)&&this.raiseRecoverable(t.start,(e?"Binding ":"Assigning to ")+t.name+" in strict mode"),i&&(M(i,t.name)&&this.raiseRecoverable(t.start,"Argument name clash"),i[t.name]=!0),e&&"none"!==e&&(("var"===e&&!this.canDeclareVarName(t.name)||"var"!==e&&!this.canDeclareLexicalName(t.name))&&this.raiseRecoverable(t.start,"Identifier '"+t.name+"' has already been declared"),"var"===e?this.declareVarName(t.name):this.declareLexicalName(t.name));break;case"MemberExpression":e&&this.raiseRecoverable(t.start,"Binding member expression");break;case"ObjectPattern":for(var n=0,r=t.properties;n<r.length;n+=1){var s=r[n];this.checkLVal(s,e,i)}break;case"Property":this.checkLVal(t.value,e,i);break;case"ArrayPattern":for(var a=0,o=t.elements;a<o.length;a+=1){var h=o[a];h&&this.checkLVal(h,e,i)}break;case"AssignmentPattern":this.checkLVal(t.left,e,i);break;case"RestElement":this.checkLVal(t.argument,e,i);break;case"ParenthesizedExpression":this.checkLVal(t.expression,e,i);break;default:this.raise(t.start,(e?"Binding":"Assigning to")+" rvalue")}};var K=z.prototype;K.checkPropClash=function(t,e,i){if(!(this.options.ecmaVersion>=9&&"SpreadElement"===t.type||this.options.ecmaVersion>=6&&(t.computed||t.method||t.shorthand))){var n,r=t.key;switch(r.type){case"Identifier":n=r.name;break;case"Literal":n=String(r.value);break;default:return}var s=t.kind;if(this.options.ecmaVersion>=6)"__proto__"===n&&"init"===s&&(e.proto&&(i&&i.doubleProto<0?i.doubleProto=r.start:this.raiseRecoverable(r.start,"Redefinition of __proto__ property")),e.proto=!0);else{var a=e[n="$"+n];if(a)("init"===s?this.strict&&a.init||a.get||a.set:a.init||a[s])&&this.raiseRecoverable(r.start,"Redefinition of property");else a=e[n]={init:!1,get:!1,set:!1};a[s]=!0}}},K.parseExpression=function(t,e){var i=this.start,n=this.startLoc,r=this.parseMaybeAssign(t,e);if(this.type===w.comma){var s=this.startNodeAt(i,n);for(s.expressions=[r];this.eat(w.comma);)s.expressions.push(this.parseMaybeAssign(t,e));return this.finishNode(s,"SequenceExpression")}return r},K.parseMaybeAssign=function(t,e,i){if(this.inGenerator&&this.isContextual("yield"))return this.parseYield();var n=!1,r=-1,s=-1;e?(r=e.parenthesizedAssign,s=e.trailingComma,e.parenthesizedAssign=e.trailingComma=-1):(e=new W,n=!0);var a=this.start,o=this.startLoc;this.type!==w.parenL&&this.type!==w.name||(this.potentialArrowAt=this.start);var h=this.parseMaybeConditional(t,e);if(i&&(h=i.call(this,h,a,o)),this.type.isAssign){var c=this.startNodeAt(a,o);return c.operator=this.value,c.left=this.type===w.eq?this.toAssignable(h,!1,e):h,n||W.call(e),e.shorthandAssign=-1,this.checkLVal(h),this.next(),c.right=this.parseMaybeAssign(t),this.finishNode(c,"AssignmentExpression")}return n&&this.checkExpressionErrors(e,!0),r>-1&&(e.parenthesizedAssign=r),s>-1&&(e.trailingComma=s),h},K.parseMaybeConditional=function(t,e){var i=this.start,n=this.startLoc,r=this.parseExprOps(t,e);if(this.checkExpressionErrors(e))return r;if(this.eat(w.question)){var s=this.startNodeAt(i,n);return s.test=r,s.consequent=this.parseMaybeAssign(),this.expect(w.colon),s.alternate=this.parseMaybeAssign(t),this.finishNode(s,"ConditionalExpression")}return r},K.parseExprOps=function(t,e){var i=this.start,n=this.startLoc,r=this.parseMaybeUnary(e,!1);return this.checkExpressionErrors(e)?r:r.start===i&&"ArrowFunctionExpression"===r.type?r:this.parseExprOp(r,i,n,-1,t)},K.parseExprOp=function(t,e,i,n,r){var s=this.type.binop;if(null!=s&&(!r||this.type!==w._in)&&s>n){var a=this.type===w.logicalOR||this.type===w.logicalAND,o=this.value;this.next();var h=this.start,c=this.startLoc,l=this.parseExprOp(this.parseMaybeUnary(null,!1),h,c,s,r),u=this.buildBinary(e,i,t,l,o,a);return this.parseExprOp(u,e,i,n,r)}return t},K.buildBinary=function(t,e,i,n,r,s){var a=this.startNodeAt(t,e);return a.left=i,a.operator=r,a.right=n,this.finishNode(a,s?"LogicalExpression":"BinaryExpression")},K.parseMaybeUnary=function(t,e){var i,n=this.start,r=this.startLoc;if(this.isContextual("await")&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction))i=this.parseAwait(),e=!0;else if(this.type.prefix){var s=this.startNode(),a=this.type===w.incDec;s.operator=this.value,s.prefix=!0,this.next(),s.argument=this.parseMaybeUnary(null,!0),this.checkExpressionErrors(t,!0),a?this.checkLVal(s.argument):this.strict&&"delete"===s.operator&&"Identifier"===s.argument.type?this.raiseRecoverable(s.start,"Deleting local variable in strict mode"):e=!0,i=this.finishNode(s,a?"UpdateExpression":"UnaryExpression")}else{if(i=this.parseExprSubscripts(t),this.checkExpressionErrors(t))return i;for(;this.type.postfix&&!this.canInsertSemicolon();){var o=this.startNodeAt(n,r);o.operator=this.value,o.prefix=!1,o.argument=i,this.checkLVal(i),this.next(),i=this.finishNode(o,"UpdateExpression")}}return!e&&this.eat(w.starstar)?this.buildBinary(n,r,i,this.parseMaybeUnary(null,!1),"**",!1):i},K.parseExprSubscripts=function(t){var e=this.start,i=this.startLoc,n=this.parseExprAtom(t),r="ArrowFunctionExpression"===n.type&&")"!==this.input.slice(this.lastTokStart,this.lastTokEnd);if(this.checkExpressionErrors(t)||r)return n;var s=this.parseSubscripts(n,e,i);return t&&"MemberExpression"===s.type&&(t.parenthesizedAssign>=s.start&&(t.parenthesizedAssign=-1),t.parenthesizedBind>=s.start&&(t.parenthesizedBind=-1)),s},K.parseSubscripts=function(t,e,i,n){for(var r=this.options.ecmaVersion>=8&&"Identifier"===t.type&&"async"===t.name&&this.lastTokEnd===t.end&&!this.canInsertSemicolon()&&"async"===this.input.slice(t.start,t.end),s=void 0;;)if((s=this.eat(w.bracketL))||this.eat(w.dot)){var a=this.startNodeAt(e,i);a.object=t,a.property=s?this.parseExpression():this.parseIdent(!0),a.computed=!!s,s&&this.expect(w.bracketR),t=this.finishNode(a,"MemberExpression")}else if(!n&&this.eat(w.parenL)){var o=new W,h=this.yieldPos,c=this.awaitPos;this.yieldPos=0,this.awaitPos=0;var l=this.parseExprList(w.parenR,this.options.ecmaVersion>=8,!1,o);if(r&&!this.canInsertSemicolon()&&this.eat(w.arrow))return this.checkPatternErrors(o,!1),this.checkYieldAwaitInDefaultParams(),this.yieldPos=h,this.awaitPos=c,this.parseArrowExpression(this.startNodeAt(e,i),l,!0);this.checkExpressionErrors(o,!0),this.yieldPos=h||this.yieldPos,this.awaitPos=c||this.awaitPos;var u=this.startNodeAt(e,i);u.callee=t,u.arguments=l,t=this.finishNode(u,"CallExpression")}else{if(this.type!==w.backQuote)return t;var f=this.startNodeAt(e,i);f.tag=t,f.quasi=this.parseTemplate({isTagged:!0}),t=this.finishNode(f,"TaggedTemplateExpression")}},K.parseExprAtom=function(t){var e,i=this.potentialArrowAt===this.start;switch(this.type){case w._super:return this.inFunction||this.raise(this.start,"'super' outside of function or class"),e=this.startNode(),this.next(),this.type!==w.dot&&this.type!==w.bracketL&&this.type!==w.parenL&&this.unexpected(),this.finishNode(e,"Super");case w._this:return e=this.startNode(),this.next(),this.finishNode(e,"ThisExpression");case w.name:var n=this.start,r=this.startLoc,s=this.containsEsc,a=this.parseIdent(this.type!==w.name);if(this.options.ecmaVersion>=8&&!s&&"async"===a.name&&!this.canInsertSemicolon()&&this.eat(w._function))return this.parseFunction(this.startNodeAt(n,r),!1,!1,!0);if(i&&!this.canInsertSemicolon()){if(this.eat(w.arrow))return this.parseArrowExpression(this.startNodeAt(n,r),[a],!1);if(this.options.ecmaVersion>=8&&"async"===a.name&&this.type===w.name&&!s)return a=this.parseIdent(),!this.canInsertSemicolon()&&this.eat(w.arrow)||this.unexpected(),this.parseArrowExpression(this.startNodeAt(n,r),[a],!0)}return a;case w.regexp:var o=this.value;return(e=this.parseLiteral(o.value)).regex={pattern:o.pattern,flags:o.flags},e;case w.num:case w.string:return this.parseLiteral(this.value);case w._null:case w._true:case w._false:return(e=this.startNode()).value=this.type===w._null?null:this.type===w._true,e.raw=this.type.keyword,this.next(),this.finishNode(e,"Literal");case w.parenL:var h=this.start,c=this.parseParenAndDistinguishExpression(i);return t&&(t.parenthesizedAssign<0&&!this.isSimpleAssignTarget(c)&&(t.parenthesizedAssign=h),t.parenthesizedBind<0&&(t.parenthesizedBind=h)),c;case w.bracketL:return e=this.startNode(),this.next(),e.elements=this.parseExprList(w.bracketR,!0,!0,t),this.finishNode(e,"ArrayExpression");case w.braceL:return this.parseObj(!1,t);case w._function:return e=this.startNode(),this.next(),this.parseFunction(e,!1);case w._class:return this.parseClass(this.startNode(),!1);case w._new:return this.parseNew();case w.backQuote:return this.parseTemplate();default:this.unexpected()}},K.parseLiteral=function(t){var e=this.startNode();return e.value=t,e.raw=this.input.slice(this.start,this.end),this.next(),this.finishNode(e,"Literal")},K.parseParenExpression=function(){this.expect(w.parenL);var t=this.parseExpression();return this.expect(w.parenR),t},K.parseParenAndDistinguishExpression=function(t){var e,i=this.start,n=this.startLoc,r=this.options.ecmaVersion>=8;if(this.options.ecmaVersion>=6){this.next();var s,a=this.start,o=this.startLoc,h=[],c=!0,l=!1,u=new W,f=this.yieldPos,d=this.awaitPos;for(this.yieldPos=0,this.awaitPos=0;this.type!==w.parenR;){if(c?c=!1:this.expect(w.comma),r&&this.afterTrailingComma(w.parenR,!0)){l=!0;break}if(this.type===w.ellipsis){s=this.start,h.push(this.parseParenItem(this.parseRestBinding())),this.type===w.comma&&this.raise(this.start,"Comma is not permitted after the rest element");break}h.push(this.parseMaybeAssign(!1,u,this.parseParenItem))}var p=this.start,g=this.startLoc;if(this.expect(w.parenR),t&&!this.canInsertSemicolon()&&this.eat(w.arrow))return this.checkPatternErrors(u,!1),this.checkYieldAwaitInDefaultParams(),this.yieldPos=f,this.awaitPos=d,this.parseParenArrowList(i,n,h);h.length&&!l||this.unexpected(this.lastTokStart),s&&this.unexpected(s),this.checkExpressionErrors(u,!0),this.yieldPos=f||this.yieldPos,this.awaitPos=d||this.awaitPos,h.length>1?((e=this.startNodeAt(a,o)).expressions=h,this.finishNodeAt(e,"SequenceExpression",p,g)):e=h[0]}else e=this.parseParenExpression();if(this.options.preserveParens){var v=this.startNodeAt(i,n);return v.expression=e,this.finishNode(v,"ParenthesizedExpression")}return e},K.parseParenItem=function(t){return t},K.parseParenArrowList=function(t,e,i){return this.parseArrowExpression(this.startNodeAt(t,e),i)};var Z=[];K.parseNew=function(){var t=this.startNode(),e=this.parseIdent(!0);if(this.options.ecmaVersion>=6&&this.eat(w.dot)){t.meta=e;var i=this.containsEsc;return t.property=this.parseIdent(!0),("target"!==t.property.name||i)&&this.raiseRecoverable(t.property.start,"The only valid meta property for new is new.target"),this.inFunction||this.raiseRecoverable(t.start,"new.target can only be used in functions"),this.finishNode(t,"MetaProperty")}var n=this.start,r=this.startLoc;return t.callee=this.parseSubscripts(this.parseExprAtom(),n,r,!0),this.eat(w.parenL)?t.arguments=this.parseExprList(w.parenR,this.options.ecmaVersion>=8,!1):t.arguments=Z,this.finishNode(t,"NewExpression")},K.parseTemplateElement=function(t){var e=t.isTagged,i=this.startNode();return this.type===w.invalidTemplate?(e||this.raiseRecoverable(this.start,"Bad escape sequence in untagged template literal"),i.value={raw:this.value,cooked:null}):i.value={raw:this.input.slice(this.start,this.end).replace(/\r\n?/g,"\n"),cooked:this.value},this.next(),i.tail=this.type===w.backQuote,this.finishNode(i,"TemplateElement")},K.parseTemplate=function(t){void 0===t&&(t={});var e=t.isTagged;void 0===e&&(e=!1);var i=this.startNode();this.next(),i.expressions=[];var n=this.parseTemplateElement({isTagged:e});for(i.quasis=[n];!n.tail;)this.type===w.eof&&this.raise(this.pos,"Unterminated template literal"),this.expect(w.dollarBraceL),i.expressions.push(this.parseExpression()),this.expect(w.braceR),i.quasis.push(n=this.parseTemplateElement({isTagged:e}));return this.next(),this.finishNode(i,"TemplateLiteral")},K.isAsyncProp=function(t){return!t.computed&&"Identifier"===t.key.type&&"async"===t.key.name&&(this.type===w.name||this.type===w.num||this.type===w.string||this.type===w.bracketL||this.type.keyword||this.options.ecmaVersion>=9&&this.type===w.star)&&!C.test(this.input.slice(this.lastTokEnd,this.start))},K.parseObj=function(t,e){var i=this.startNode(),n=!0,r={};for(i.properties=[],this.next();!this.eat(w.braceR);){if(n)n=!1;else if(this.expect(w.comma),this.afterTrailingComma(w.braceR))break;var s=this.parseProperty(t,e);t||this.checkPropClash(s,r,e),i.properties.push(s)}return this.finishNode(i,t?"ObjectPattern":"ObjectExpression")},K.parseProperty=function(t,e){var i,n,r,s,a=this.startNode();if(this.options.ecmaVersion>=9&&this.eat(w.ellipsis))return t?(a.argument=this.parseIdent(!1),this.type===w.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.finishNode(a,"RestElement")):(this.type===w.parenL&&e&&(e.parenthesizedAssign<0&&(e.parenthesizedAssign=this.start),e.parenthesizedBind<0&&(e.parenthesizedBind=this.start)),a.argument=this.parseMaybeAssign(!1,e),this.type===w.comma&&e&&e.trailingComma<0&&(e.trailingComma=this.start),this.finishNode(a,"SpreadElement"));this.options.ecmaVersion>=6&&(a.method=!1,a.shorthand=!1,(t||e)&&(r=this.start,s=this.startLoc),t||(i=this.eat(w.star)));var o=this.containsEsc;return this.parsePropertyName(a),!t&&!o&&this.options.ecmaVersion>=8&&!i&&this.isAsyncProp(a)?(n=!0,i=this.options.ecmaVersion>=9&&this.eat(w.star),this.parsePropertyName(a,e)):n=!1,this.parsePropertyValue(a,t,i,n,r,s,e,o),this.finishNode(a,"Property")},K.parsePropertyValue=function(t,e,i,n,r,s,a,o){if((i||n)&&this.type===w.colon&&this.unexpected(),this.eat(w.colon))t.value=e?this.parseMaybeDefault(this.start,this.startLoc):this.parseMaybeAssign(!1,a),t.kind="init";else if(this.options.ecmaVersion>=6&&this.type===w.parenL)e&&this.unexpected(),t.kind="init",t.method=!0,t.value=this.parseMethod(i,n);else if(e||o||!(this.options.ecmaVersion>=5)||t.computed||"Identifier"!==t.key.type||"get"!==t.key.name&&"set"!==t.key.name||this.type===w.comma||this.type===w.braceR)this.options.ecmaVersion>=6&&!t.computed&&"Identifier"===t.key.type?(this.checkUnreserved(t.key),t.kind="init",e?t.value=this.parseMaybeDefault(r,s,t.key):this.type===w.eq&&a?(a.shorthandAssign<0&&(a.shorthandAssign=this.start),t.value=this.parseMaybeDefault(r,s,t.key)):t.value=t.key,t.shorthand=!0):this.unexpected();else{(i||n)&&this.unexpected(),t.kind=t.key.name,this.parsePropertyName(t),t.value=this.parseMethod(!1);var h="get"===t.kind?0:1;if(t.value.params.length!==h){var c=t.value.start;"get"===t.kind?this.raiseRecoverable(c,"getter should have no params"):this.raiseRecoverable(c,"setter should have exactly one param")}else"set"===t.kind&&"RestElement"===t.value.params[0].type&&this.raiseRecoverable(t.value.params[0].start,"Setter cannot use rest params")}},K.parsePropertyName=function(t){if(this.options.ecmaVersion>=6){if(this.eat(w.bracketL))return t.computed=!0,t.key=this.parseMaybeAssign(),this.expect(w.bracketR),t.key;t.computed=!1}return t.key=this.type===w.num||this.type===w.string?this.parseExprAtom():this.parseIdent(!0)},K.initFunction=function(t){t.id=null,this.options.ecmaVersion>=6&&(t.generator=!1,t.expression=!1),this.options.ecmaVersion>=8&&(t.async=!1)},K.parseMethod=function(t,e){var i=this.startNode(),n=this.inGenerator,r=this.inAsync,s=this.yieldPos,a=this.awaitPos,o=this.inFunction;return this.initFunction(i),this.options.ecmaVersion>=6&&(i.generator=t),this.options.ecmaVersion>=8&&(i.async=!!e),this.inGenerator=i.generator,this.inAsync=i.async,this.yieldPos=0,this.awaitPos=0,this.inFunction=!0,this.enterFunctionScope(),this.expect(w.parenL),i.params=this.parseBindingList(w.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams(),this.parseFunctionBody(i,!1),this.inGenerator=n,this.inAsync=r,this.yieldPos=s,this.awaitPos=a,this.inFunction=o,this.finishNode(i,"FunctionExpression")},K.parseArrowExpression=function(t,e,i){var n=this.inGenerator,r=this.inAsync,s=this.yieldPos,a=this.awaitPos,o=this.inFunction;return this.enterFunctionScope(),this.initFunction(t),this.options.ecmaVersion>=8&&(t.async=!!i),this.inGenerator=!1,this.inAsync=t.async,this.yieldPos=0,this.awaitPos=0,this.inFunction=!0,t.params=this.toAssignableList(e,!0),this.parseFunctionBody(t,!0),this.inGenerator=n,this.inAsync=r,this.yieldPos=s,this.awaitPos=a,this.inFunction=o,this.finishNode(t,"ArrowFunctionExpression")},K.parseFunctionBody=function(t,e){var i=e&&this.type!==w.braceL,n=this.strict,r=!1;if(i)t.body=this.parseMaybeAssign(),t.expression=!0,this.checkParams(t,!1);else{var s=this.options.ecmaVersion>=7&&!this.isSimpleParamList(t.params);n&&!s||(r=this.strictDirective(this.end))&&s&&this.raiseRecoverable(t.start,"Illegal 'use strict' directive in function with non-simple parameter list");var a=this.labels;this.labels=[],r&&(this.strict=!0),this.checkParams(t,!n&&!r&&!e&&this.isSimpleParamList(t.params)),t.body=this.parseBlock(!1),t.expression=!1,this.adaptDirectivePrologue(t.body.body),this.labels=a}this.exitFunctionScope(),this.strict&&t.id&&this.checkLVal(t.id,"none"),this.strict=n},K.isSimpleParamList=function(t){for(var e=0,i=t;e<i.length;e+=1){if("Identifier"!==i[e].type)return!1}return!0},K.checkParams=function(t,e){for(var i={},n=0,r=t.params;n<r.length;n+=1){var s=r[n];this.checkLVal(s,"var",e?null:i)}},K.parseExprList=function(t,e,i,n){for(var r=[],s=!0;!this.eat(t);){if(s)s=!1;else if(this.expect(w.comma),e&&this.afterTrailingComma(t))break;var a=void 0;i&&this.type===w.comma?a=null:this.type===w.ellipsis?(a=this.parseSpread(n),n&&this.type===w.comma&&n.trailingComma<0&&(n.trailingComma=this.start)):a=this.parseMaybeAssign(!1,n),r.push(a)}return r},K.checkUnreserved=function(t){var e=t.start,i=t.end,n=t.name;(this.inGenerator&&"yield"===n&&this.raiseRecoverable(e,"Can not use 'yield' as identifier inside a generator"),this.inAsync&&"await"===n&&this.raiseRecoverable(e,"Can not use 'await' as identifier inside an async function"),this.isKeyword(n)&&this.raise(e,"Unexpected keyword '"+n+"'"),this.options.ecmaVersion<6&&-1!==this.input.slice(e,i).indexOf("\\"))||(this.strict?this.reservedWordsStrict:this.reservedWords).test(n)&&(this.inAsync||"await"!==n||this.raiseRecoverable(e,"Can not use keyword 'await' outside an async function"),this.raiseRecoverable(e,"The keyword '"+n+"' is reserved"))},K.parseIdent=function(t,e){var i=this.startNode();return t&&"never"===this.options.allowReserved&&(t=!1),this.type===w.name?i.name=this.value:this.type.keyword?(i.name=this.type.keyword,"class"!==i.name&&"function"!==i.name||this.lastTokEnd===this.lastTokStart+1&&46===this.input.charCodeAt(this.lastTokStart)||this.context.pop()):this.unexpected(),this.next(),this.finishNode(i,"Identifier"),t||this.checkUnreserved(i),i},K.parseYield=function(){this.yieldPos||(this.yieldPos=this.start);var t=this.startNode();return this.next(),this.type===w.semi||this.canInsertSemicolon()||this.type!==w.star&&!this.type.startsExpr?(t.delegate=!1,t.argument=null):(t.delegate=this.eat(w.star),t.argument=this.parseMaybeAssign()),this.finishNode(t,"YieldExpression")},K.parseAwait=function(){this.awaitPos||(this.awaitPos=this.start);var t=this.startNode();return this.next(),t.argument=this.parseMaybeUnary(null,!0),this.finishNode(t,"AwaitExpression")};var $=z.prototype;$.raise=function(t,e){var i=j(this.input,t);e+=" ("+i.line+":"+i.column+")";var n=new SyntaxError(e);throw n.pos=t,n.loc=i,n.raisedAt=this.pos,n},$.raiseRecoverable=$.raise,$.curPosition=function(){if(this.options.locations)return new L(this.curLine,this.pos-this.lineStart)};var J=z.prototype,Q=Object.assign||function(t){for(var e=[],i=arguments.length-1;i-- >0;)e[i]=arguments[i+1];for(var n=0,r=e;n<r.length;n+=1){var s=r[n];for(var a in s)M(s,a)&&(t[a]=s[a])}return t};J.enterFunctionScope=function(){this.scopeStack.push({var:{},lexical:{},childVar:{},parentLexical:{}})},J.exitFunctionScope=function(){this.scopeStack.pop()},J.enterLexicalScope=function(){var t=this.scopeStack[this.scopeStack.length-1],e={var:{},lexical:{},childVar:{},parentLexical:{}};this.scopeStack.push(e),Q(e.parentLexical,t.lexical,t.parentLexical)},J.exitLexicalScope=function(){var t=this.scopeStack.pop(),e=this.scopeStack[this.scopeStack.length-1];Q(e.childVar,t.var,t.childVar)},J.canDeclareVarName=function(t){var e=this.scopeStack[this.scopeStack.length-1];return!M(e.lexical,t)&&!M(e.parentLexical,t)},J.canDeclareLexicalName=function(t){var e=this.scopeStack[this.scopeStack.length-1];return!M(e.lexical,t)&&!M(e.var,t)&&!M(e.childVar,t)},J.declareVarName=function(t){this.scopeStack[this.scopeStack.length-1].var[t]=!0},J.declareLexicalName=function(t){this.scopeStack[this.scopeStack.length-1].lexical[t]=!0};var tt=function(t,e,i){this.type="",this.start=e,this.end=0,t.options.locations&&(this.loc=new D(t,i)),t.options.directSourceFile&&(this.sourceFile=t.options.directSourceFile),t.options.ranges&&(this.range=[e,0])},et=z.prototype;function it(t,e,i,n){return t.type=e,t.end=i,this.options.locations&&(t.loc.end=n),this.options.ranges&&(t.range[1]=i),t}et.startNode=function(){return new tt(this,this.start,this.startLoc)},et.startNodeAt=function(t,e){return new tt(this,t,e)},et.finishNode=function(t,e){return it.call(this,t,e,this.lastTokEnd,this.lastTokEndLoc)},et.finishNodeAt=function(t,e,i,n){return it.call(this,t,e,i,n)};var nt=function(t,e,i,n,r){this.token=t,this.isExpr=!!e,this.preserveSpace=!!i,this.override=n,this.generator=!!r},rt={b_stat:new nt("{",!1),b_expr:new nt("{",!0),b_tmpl:new nt("${",!1),p_stat:new nt("(",!1),p_expr:new nt("(",!0),q_tmpl:new nt("`",!0,!0,function(t){return t.tryReadTemplateToken()}),f_stat:new nt("function",!1),f_expr:new nt("function",!0),f_expr_gen:new nt("function",!0,!1,null,!0),f_gen:new nt("function",!1,!1,null,!0)},st=z.prototype;st.initialContext=function(){return[rt.b_stat]},st.braceIsBlock=function(t){var e=this.curContext();return e===rt.f_expr||e===rt.f_stat||(t!==w.colon||e!==rt.b_stat&&e!==rt.b_expr?t===w._return||t===w.name&&this.exprAllowed?C.test(this.input.slice(this.lastTokEnd,this.start)):t===w._else||t===w.semi||t===w.eof||t===w.parenR||t===w.arrow||(t===w.braceL?e===rt.b_stat:t!==w._var&&t!==w.name&&!this.exprAllowed):!e.isExpr)},st.inGeneratorContext=function(){for(var t=this.context.length-1;t>=1;t--){var e=this.context[t];if("function"===e.token)return e.generator}return!1},st.updateContext=function(t){var e,i=this.type;i.keyword&&t===w.dot?this.exprAllowed=!1:(e=i.updateContext)?e.call(this,t):this.exprAllowed=i.beforeExpr},w.parenR.updateContext=w.braceR.updateContext=function(){if(1!==this.context.length){var t=this.context.pop();t===rt.b_stat&&"function"===this.curContext().token&&(t=this.context.pop()),this.exprAllowed=!t.isExpr}else this.exprAllowed=!0},w.braceL.updateContext=function(t){this.context.push(this.braceIsBlock(t)?rt.b_stat:rt.b_expr),this.exprAllowed=!0},w.dollarBraceL.updateContext=function(){this.context.push(rt.b_tmpl),this.exprAllowed=!0},w.parenL.updateContext=function(t){var e=t===w._if||t===w._for||t===w._with||t===w._while;this.context.push(e?rt.p_stat:rt.p_expr),this.exprAllowed=!0},w.incDec.updateContext=function(){},w._function.updateContext=w._class.updateContext=function(t){t.beforeExpr&&t!==w.semi&&t!==w._else&&(t!==w.colon&&t!==w.braceL||this.curContext()!==rt.b_stat)?this.context.push(rt.f_expr):this.context.push(rt.f_stat),this.exprAllowed=!1},w.backQuote.updateContext=function(){this.curContext()===rt.q_tmpl?this.context.pop():this.context.push(rt.q_tmpl),this.exprAllowed=!1},w.star.updateContext=function(t){if(t===w._function){var e=this.context.length-1;this.context[e]===rt.f_expr?this.context[e]=rt.f_expr_gen:this.context[e]=rt.f_gen}this.exprAllowed=!0},w.name.updateContext=function(t){var e=!1;this.options.ecmaVersion>=6&&t!==w.dot&&("of"===this.value&&!this.exprAllowed||"yield"===this.value&&this.inGeneratorContext())&&(e=!0),this.exprAllowed=e};var at={$LONE:["ASCII","ASCII_Hex_Digit","AHex","Alphabetic","Alpha","Any","Assigned","Bidi_Control","Bidi_C","Bidi_Mirrored","Bidi_M","Case_Ignorable","CI","Cased","Changes_When_Casefolded","CWCF","Changes_When_Casemapped","CWCM","Changes_When_Lowercased","CWL","Changes_When_NFKC_Casefolded","CWKCF","Changes_When_Titlecased","CWT","Changes_When_Uppercased","CWU","Dash","Default_Ignorable_Code_Point","DI","Deprecated","Dep","Diacritic","Dia","Emoji","Emoji_Component","Emoji_Modifier","Emoji_Modifier_Base","Emoji_Presentation","Extender","Ext","Grapheme_Base","Gr_Base","Grapheme_Extend","Gr_Ext","Hex_Digit","Hex","IDS_Binary_Operator","IDSB","IDS_Trinary_Operator","IDST","ID_Continue","IDC","ID_Start","IDS","Ideographic","Ideo","Join_Control","Join_C","Logical_Order_Exception","LOE","Lowercase","Lower","Math","Noncharacter_Code_Point","NChar","Pattern_Syntax","Pat_Syn","Pattern_White_Space","Pat_WS","Quotation_Mark","QMark","Radical","Regional_Indicator","RI","Sentence_Terminal","STerm","Soft_Dotted","SD","Terminal_Punctuation","Term","Unified_Ideograph","UIdeo","Uppercase","Upper","Variation_Selector","VS","White_Space","space","XID_Continue","XIDC","XID_Start","XIDS"],General_Category:["Cased_Letter","LC","Close_Punctuation","Pe","Connector_Punctuation","Pc","Control","Cc","cntrl","Currency_Symbol","Sc","Dash_Punctuation","Pd","Decimal_Number","Nd","digit","Enclosing_Mark","Me","Final_Punctuation","Pf","Format","Cf","Initial_Punctuation","Pi","Letter","L","Letter_Number","Nl","Line_Separator","Zl","Lowercase_Letter","Ll","Mark","M","Combining_Mark","Math_Symbol","Sm","Modifier_Letter","Lm","Modifier_Symbol","Sk","Nonspacing_Mark","Mn","Number","N","Open_Punctuation","Ps","Other","C","Other_Letter","Lo","Other_Number","No","Other_Punctuation","Po","Other_Symbol","So","Paragraph_Separator","Zp","Private_Use","Co","Punctuation","P","punct","Separator","Z","Space_Separator","Zs","Spacing_Mark","Mc","Surrogate","Cs","Symbol","S","Titlecase_Letter","Lt","Unassigned","Cn","Uppercase_Letter","Lu"],Script:["Adlam","Adlm","Ahom","Anatolian_Hieroglyphs","Hluw","Arabic","Arab","Armenian","Armn","Avestan","Avst","Balinese","Bali","Bamum","Bamu","Bassa_Vah","Bass","Batak","Batk","Bengali","Beng","Bhaiksuki","Bhks","Bopomofo","Bopo","Brahmi","Brah","Braille","Brai","Buginese","Bugi","Buhid","Buhd","Canadian_Aboriginal","Cans","Carian","Cari","Caucasian_Albanian","Aghb","Chakma","Cakm","Cham","Cherokee","Cher","Common","Zyyy","Coptic","Copt","Qaac","Cuneiform","Xsux","Cypriot","Cprt","Cyrillic","Cyrl","Deseret","Dsrt","Devanagari","Deva","Duployan","Dupl","Egyptian_Hieroglyphs","Egyp","Elbasan","Elba","Ethiopic","Ethi","Georgian","Geor","Glagolitic","Glag","Gothic","Goth","Grantha","Gran","Greek","Grek","Gujarati","Gujr","Gurmukhi","Guru","Han","Hani","Hangul","Hang","Hanunoo","Hano","Hatran","Hatr","Hebrew","Hebr","Hiragana","Hira","Imperial_Aramaic","Armi","Inherited","Zinh","Qaai","Inscriptional_Pahlavi","Phli","Inscriptional_Parthian","Prti","Javanese","Java","Kaithi","Kthi","Kannada","Knda","Katakana","Kana","Kayah_Li","Kali","Kharoshthi","Khar","Khmer","Khmr","Khojki","Khoj","Khudawadi","Sind","Lao","Laoo","Latin","Latn","Lepcha","Lepc","Limbu","Limb","Linear_A","Lina","Linear_B","Linb","Lisu","Lycian","Lyci","Lydian","Lydi","Mahajani","Mahj","Malayalam","Mlym","Mandaic","Mand","Manichaean","Mani","Marchen","Marc","Masaram_Gondi","Gonm","Meetei_Mayek","Mtei","Mende_Kikakui","Mend","Meroitic_Cursive","Merc","Meroitic_Hieroglyphs","Mero","Miao","Plrd","Modi","Mongolian","Mong","Mro","Mroo","Multani","Mult","Myanmar","Mymr","Nabataean","Nbat","New_Tai_Lue","Talu","Newa","Nko","Nkoo","Nushu","Nshu","Ogham","Ogam","Ol_Chiki","Olck","Old_Hungarian","Hung","Old_Italic","Ital","Old_North_Arabian","Narb","Old_Permic","Perm","Old_Persian","Xpeo","Old_South_Arabian","Sarb","Old_Turkic","Orkh","Oriya","Orya","Osage","Osge","Osmanya","Osma","Pahawh_Hmong","Hmng","Palmyrene","Palm","Pau_Cin_Hau","Pauc","Phags_Pa","Phag","Phoenician","Phnx","Psalter_Pahlavi","Phlp","Rejang","Rjng","Runic","Runr","Samaritan","Samr","Saurashtra","Saur","Sharada","Shrd","Shavian","Shaw","Siddham","Sidd","SignWriting","Sgnw","Sinhala","Sinh","Sora_Sompeng","Sora","Soyombo","Soyo","Sundanese","Sund","Syloti_Nagri","Sylo","Syriac","Syrc","Tagalog","Tglg","Tagbanwa","Tagb","Tai_Le","Tale","Tai_Tham","Lana","Tai_Viet","Tavt","Takri","Takr","Tamil","Taml","Tangut","Tang","Telugu","Telu","Thaana","Thaa","Thai","Tibetan","Tibt","Tifinagh","Tfng","Tirhuta","Tirh","Ugaritic","Ugar","Vai","Vaii","Warang_Citi","Wara","Yi","Yiii","Zanabazar_Square","Zanb"]};Array.prototype.push.apply(at.$LONE,at.General_Category),at.gc=at.General_Category,at.sc=at.Script_Extensions=at.scx=at.Script;var ot=z.prototype,ht=function(t){this.parser=t,this.validFlags="gim"+(t.options.ecmaVersion>=6?"uy":"")+(t.options.ecmaVersion>=9?"s":""),this.source="",this.flags="",this.start=0,this.switchU=!1,this.switchN=!1,this.pos=0,this.lastIntValue=0,this.lastStringValue="",this.lastAssertionIsQuantifiable=!1,this.numCapturingParens=0,this.maxBackReference=0,this.groupNames=[],this.backReferenceNames=[]};function ct(t){return t<=65535?String.fromCharCode(t):(t-=65536,String.fromCharCode(55296+(t>>10),56320+(1023&t)))}function lt(t){return 36===t||t>=40&&t<=43||46===t||63===t||t>=91&&t<=94||t>=123&&t<=125}function ut(t){return t>=65&&t<=90||t>=97&&t<=122}function ft(t){return ut(t)||95===t}function dt(t){return ft(t)||pt(t)}function pt(t){return t>=48&&t<=57}function gt(t){return t>=48&&t<=57||t>=65&&t<=70||t>=97&&t<=102}function vt(t){return t>=65&&t<=70?t-65+10:t>=97&&t<=102?t-97+10:t-48}function _t(t){return t>=48&&t<=55}ht.prototype.reset=function(t,e,i){var n=-1!==i.indexOf("u");this.start=0|t,this.source=e+"",this.flags=i,this.switchU=n&&this.parser.options.ecmaVersion>=6,this.switchN=n&&this.parser.options.ecmaVersion>=9},ht.prototype.raise=function(t){this.parser.raiseRecoverable(this.start,"Invalid regular expression: /"+this.source+"/: "+t)},ht.prototype.at=function(t){var e=this.source,i=e.length;if(t>=i)return-1;var n=e.charCodeAt(t);return!this.switchU||n<=55295||n>=57344||t+1>=i?n:(n<<10)+e.charCodeAt(t+1)-56613888},ht.prototype.nextIndex=function(t){var e=this.source,i=e.length;if(t>=i)return i;var n=e.charCodeAt(t);return!this.switchU||n<=55295||n>=57344||t+1>=i?t+1:t+2},ht.prototype.current=function(){return this.at(this.pos)},ht.prototype.lookahead=function(){return this.at(this.nextIndex(this.pos))},ht.prototype.advance=function(){this.pos=this.nextIndex(this.pos)},ht.prototype.eat=function(t){return this.current()===t&&(this.advance(),!0)},ot.validateRegExpFlags=function(t){for(var e=t.validFlags,i=t.flags,n=0;n<i.length;n++){var r=i.charAt(n);-1===e.indexOf(r)&&this.raise(t.start,"Invalid regular expression flag"),i.indexOf(r,n+1)>-1&&this.raise(t.start,"Duplicate regular expression flag")}},ot.validateRegExpPattern=function(t){this.regexp_pattern(t),!t.switchN&&this.options.ecmaVersion>=9&&t.groupNames.length>0&&(t.switchN=!0,this.regexp_pattern(t))},ot.regexp_pattern=function(t){t.pos=0,t.lastIntValue=0,t.lastStringValue="",t.lastAssertionIsQuantifiable=!1,t.numCapturingParens=0,t.maxBackReference=0,t.groupNames.length=0,t.backReferenceNames.length=0,this.regexp_disjunction(t),t.pos!==t.source.length&&(t.eat(41)&&t.raise("Unmatched ')'"),(t.eat(93)||t.eat(125))&&t.raise("Lone quantifier brackets")),t.maxBackReference>t.numCapturingParens&&t.raise("Invalid escape");for(var e=0,i=t.backReferenceNames;e<i.length;e+=1){var n=i[e];-1===t.groupNames.indexOf(n)&&t.raise("Invalid named capture referenced")}},ot.regexp_disjunction=function(t){for(this.regexp_alternative(t);t.eat(124);)this.regexp_alternative(t);this.regexp_eatQuantifier(t,!0)&&t.raise("Nothing to repeat"),t.eat(123)&&t.raise("Lone quantifier brackets")},ot.regexp_alternative=function(t){for(;t.pos<t.source.length&&this.regexp_eatTerm(t););},ot.regexp_eatTerm=function(t){return this.regexp_eatAssertion(t)?(t.lastAssertionIsQuantifiable&&this.regexp_eatQuantifier(t)&&t.switchU&&t.raise("Invalid quantifier"),!0):!(t.switchU?!this.regexp_eatAtom(t):!this.regexp_eatExtendedAtom(t))&&(this.regexp_eatQuantifier(t),!0)},ot.regexp_eatAssertion=function(t){var e=t.pos;if(t.lastAssertionIsQuantifiable=!1,t.eat(94)||t.eat(36))return!0;if(t.eat(92)){if(t.eat(66)||t.eat(98))return!0;t.pos=e}if(t.eat(40)&&t.eat(63)){var i=!1;if(this.options.ecmaVersion>=9&&(i=t.eat(60)),t.eat(61)||t.eat(33))return this.regexp_disjunction(t),t.eat(41)||t.raise("Unterminated group"),t.lastAssertionIsQuantifiable=!i,!0}return t.pos=e,!1},ot.regexp_eatQuantifier=function(t,e){return void 0===e&&(e=!1),!!this.regexp_eatQuantifierPrefix(t,e)&&(t.eat(63),!0)},ot.regexp_eatQuantifierPrefix=function(t,e){return t.eat(42)||t.eat(43)||t.eat(63)||this.regexp_eatBracedQuantifier(t,e)},ot.regexp_eatBracedQuantifier=function(t,e){var i=t.pos;if(t.eat(123)){var n=0,r=-1;if(this.regexp_eatDecimalDigits(t)&&(n=t.lastIntValue,t.eat(44)&&this.regexp_eatDecimalDigits(t)&&(r=t.lastIntValue),t.eat(125)))return-1!==r&&r<n&&!e&&t.raise("numbers out of order in {} quantifier"),!0;t.switchU&&!e&&t.raise("Incomplete quantifier"),t.pos=i}return!1},ot.regexp_eatAtom=function(t){return this.regexp_eatPatternCharacters(t)||t.eat(46)||this.regexp_eatReverseSolidusAtomEscape(t)||this.regexp_eatCharacterClass(t)||this.regexp_eatUncapturingGroup(t)||this.regexp_eatCapturingGroup(t)},ot.regexp_eatReverseSolidusAtomEscape=function(t){var e=t.pos;if(t.eat(92)){if(this.regexp_eatAtomEscape(t))return!0;t.pos=e}return!1},ot.regexp_eatUncapturingGroup=function(t){var e=t.pos;if(t.eat(40)){if(t.eat(63)&&t.eat(58)){if(this.regexp_disjunction(t),t.eat(41))return!0;t.raise("Unterminated group")}t.pos=e}return!1},ot.regexp_eatCapturingGroup=function(t){if(t.eat(40)){if(this.options.ecmaVersion>=9?this.regexp_groupSpecifier(t):63===t.current()&&t.raise("Invalid group"),this.regexp_disjunction(t),t.eat(41))return t.numCapturingParens+=1,!0;t.raise("Unterminated group")}return!1},ot.regexp_eatExtendedAtom=function(t){return t.eat(46)||this.regexp_eatReverseSolidusAtomEscape(t)||this.regexp_eatCharacterClass(t)||this.regexp_eatUncapturingGroup(t)||this.regexp_eatCapturingGroup(t)||this.regexp_eatInvalidBracedQuantifier(t)||this.regexp_eatExtendedPatternCharacter(t)},ot.regexp_eatInvalidBracedQuantifier=function(t){return this.regexp_eatBracedQuantifier(t,!0)&&t.raise("Nothing to repeat"),!1},ot.regexp_eatSyntaxCharacter=function(t){var e=t.current();return!!lt(e)&&(t.lastIntValue=e,t.advance(),!0)},ot.regexp_eatPatternCharacters=function(t){for(var e=t.pos,i=0;-1!==(i=t.current())&&!lt(i);)t.advance();return t.pos!==e},ot.regexp_eatExtendedPatternCharacter=function(t){var e=t.current();return!(-1===e||36===e||e>=40&&e<=43||46===e||63===e||91===e||94===e||124===e)&&(t.advance(),!0)},ot.regexp_groupSpecifier=function(t){if(t.eat(63)){if(this.regexp_eatGroupName(t))return-1!==t.groupNames.indexOf(t.lastStringValue)&&t.raise("Duplicate capture group name"),void t.groupNames.push(t.lastStringValue);t.raise("Invalid group")}},ot.regexp_eatGroupName=function(t){if(t.lastStringValue="",t.eat(60)){if(this.regexp_eatRegExpIdentifierName(t)&&t.eat(62))return!0;t.raise("Invalid capture group name")}return!1},ot.regexp_eatRegExpIdentifierName=function(t){if(t.lastStringValue="",this.regexp_eatRegExpIdentifierStart(t)){for(t.lastStringValue+=ct(t.lastIntValue);this.regexp_eatRegExpIdentifierPart(t);)t.lastStringValue+=ct(t.lastIntValue);return!0}return!1},ot.regexp_eatRegExpIdentifierStart=function(t){var e=t.pos,i=t.current();return t.advance(),92===i&&this.regexp_eatRegExpUnicodeEscapeSequence(t)&&(i=t.lastIntValue),function(t){return p(t,!0)||36===t||95===t}(i)?(t.lastIntValue=i,!0):(t.pos=e,!1)},ot.regexp_eatRegExpIdentifierPart=function(t){var e=t.pos,i=t.current();return t.advance(),92===i&&this.regexp_eatRegExpUnicodeEscapeSequence(t)&&(i=t.lastIntValue),function(t){return g(t,!0)||36===t||95===t||8204===t||8205===t}(i)?(t.lastIntValue=i,!0):(t.pos=e,!1)},ot.regexp_eatAtomEscape=function(t){return!!(this.regexp_eatBackReference(t)||this.regexp_eatCharacterClassEscape(t)||this.regexp_eatCharacterEscape(t)||t.switchN&&this.regexp_eatKGroupName(t))||(t.switchU&&(99===t.current()&&t.raise("Invalid unicode escape"),t.raise("Invalid escape")),!1)},ot.regexp_eatBackReference=function(t){var e=t.pos;if(this.regexp_eatDecimalEscape(t)){var i=t.lastIntValue;if(t.switchU)return i>t.maxBackReference&&(t.maxBackReference=i),!0;if(i<=t.numCapturingParens)return!0;t.pos=e}return!1},ot.regexp_eatKGroupName=function(t){if(t.eat(107)){if(this.regexp_eatGroupName(t))return t.backReferenceNames.push(t.lastStringValue),!0;t.raise("Invalid named reference")}return!1},ot.regexp_eatCharacterEscape=function(t){return this.regexp_eatControlEscape(t)||this.regexp_eatCControlLetter(t)||this.regexp_eatZero(t)||this.regexp_eatHexEscapeSequence(t)||this.regexp_eatRegExpUnicodeEscapeSequence(t)||!t.switchU&&this.regexp_eatLegacyOctalEscapeSequence(t)||this.regexp_eatIdentityEscape(t)},ot.regexp_eatCControlLetter=function(t){var e=t.pos;if(t.eat(99)){if(this.regexp_eatControlLetter(t))return!0;t.pos=e}return!1},ot.regexp_eatZero=function(t){return 48===t.current()&&!pt(t.lookahead())&&(t.lastIntValue=0,t.advance(),!0)},ot.regexp_eatControlEscape=function(t){var e=t.current();return 116===e?(t.lastIntValue=9,t.advance(),!0):110===e?(t.lastIntValue=10,t.advance(),!0):118===e?(t.lastIntValue=11,t.advance(),!0):102===e?(t.lastIntValue=12,t.advance(),!0):114===e&&(t.lastIntValue=13,t.advance(),!0)},ot.regexp_eatControlLetter=function(t){var e=t.current();return!!ut(e)&&(t.lastIntValue=e%32,t.advance(),!0)},ot.regexp_eatRegExpUnicodeEscapeSequence=function(t){var e,i=t.pos;if(t.eat(117)){if(this.regexp_eatFixedHexDigits(t,4)){var n=t.lastIntValue;if(t.switchU&&n>=55296&&n<=56319){var r=t.pos;if(t.eat(92)&&t.eat(117)&&this.regexp_eatFixedHexDigits(t,4)){var s=t.lastIntValue;if(s>=56320&&s<=57343)return t.lastIntValue=1024*(n-55296)+(s-56320)+65536,!0}t.pos=r,t.lastIntValue=n}return!0}if(t.switchU&&t.eat(123)&&this.regexp_eatHexDigits(t)&&t.eat(125)&&((e=t.lastIntValue)>=0&&e<=1114111))return!0;t.switchU&&t.raise("Invalid unicode escape"),t.pos=i}return!1},ot.regexp_eatIdentityEscape=function(t){if(t.switchU)return!!this.regexp_eatSyntaxCharacter(t)||!!t.eat(47)&&(t.lastIntValue=47,!0);var e=t.current();return!(99===e||t.switchN&&107===e)&&(t.lastIntValue=e,t.advance(),!0)},ot.regexp_eatDecimalEscape=function(t){t.lastIntValue=0;var e=t.current();if(e>=49&&e<=57){do{t.lastIntValue=10*t.lastIntValue+(e-48),t.advance()}while((e=t.current())>=48&&e<=57);return!0}return!1},ot.regexp_eatCharacterClassEscape=function(t){var e=t.current();if(function(t){return 100===t||68===t||115===t||83===t||119===t||87===t}(e))return t.lastIntValue=-1,t.advance(),!0;if(t.switchU&&this.options.ecmaVersion>=9&&(80===e||112===e)){if(t.lastIntValue=-1,t.advance(),t.eat(123)&&this.regexp_eatUnicodePropertyValueExpression(t)&&t.eat(125))return!0;t.raise("Invalid property name")}return!1},ot.regexp_eatUnicodePropertyValueExpression=function(t){var e=t.pos;if(this.regexp_eatUnicodePropertyName(t)&&t.eat(61)){var i=t.lastStringValue;if(this.regexp_eatUnicodePropertyValue(t)){var n=t.lastStringValue;return this.regexp_validateUnicodePropertyNameAndValue(t,i,n),!0}}if(t.pos=e,this.regexp_eatLoneUnicodePropertyNameOrValue(t)){var r=t.lastStringValue;return this.regexp_validateUnicodePropertyNameOrValue(t,r),!0}return!1},ot.regexp_validateUnicodePropertyNameAndValue=function(t,e,i){at.hasOwnProperty(e)&&-1!==at[e].indexOf(i)||t.raise("Invalid property name")},ot.regexp_validateUnicodePropertyNameOrValue=function(t,e){-1===at.$LONE.indexOf(e)&&t.raise("Invalid property name")},ot.regexp_eatUnicodePropertyName=function(t){var e=0;for(t.lastStringValue="";ft(e=t.current());)t.lastStringValue+=ct(e),t.advance();return""!==t.lastStringValue},ot.regexp_eatUnicodePropertyValue=function(t){var e=0;for(t.lastStringValue="";dt(e=t.current());)t.lastStringValue+=ct(e),t.advance();return""!==t.lastStringValue},ot.regexp_eatLoneUnicodePropertyNameOrValue=function(t){return this.regexp_eatUnicodePropertyValue(t)},ot.regexp_eatCharacterClass=function(t){if(t.eat(91)){if(t.eat(94),this.regexp_classRanges(t),t.eat(93))return!0;t.raise("Unterminated character class")}return!1},ot.regexp_classRanges=function(t){for(;this.regexp_eatClassAtom(t);){var e=t.lastIntValue;if(t.eat(45)&&this.regexp_eatClassAtom(t)){var i=t.lastIntValue;!t.switchU||-1!==e&&-1!==i||t.raise("Invalid character class"),-1!==e&&-1!==i&&e>i&&t.raise("Range out of order in character class")}}},ot.regexp_eatClassAtom=function(t){var e=t.pos;if(t.eat(92)){if(this.regexp_eatClassEscape(t))return!0;if(t.switchU){var i=t.current();(99===i||_t(i))&&t.raise("Invalid class escape"),t.raise("Invalid escape")}t.pos=e}var n=t.current();return 93!==n&&(t.lastIntValue=n,t.advance(),!0)},ot.regexp_eatClassEscape=function(t){var e=t.pos;if(t.eat(98))return t.lastIntValue=8,!0;if(t.switchU&&t.eat(45))return t.lastIntValue=45,!0;if(!t.switchU&&t.eat(99)){if(this.regexp_eatClassControlLetter(t))return!0;t.pos=e}return this.regexp_eatCharacterClassEscape(t)||this.regexp_eatCharacterEscape(t)},ot.regexp_eatClassControlLetter=function(t){var e=t.current();return!(!pt(e)&&95!==e)&&(t.lastIntValue=e%32,t.advance(),!0)},ot.regexp_eatHexEscapeSequence=function(t){var e=t.pos;if(t.eat(120)){if(this.regexp_eatFixedHexDigits(t,2))return!0;t.switchU&&t.raise("Invalid escape"),t.pos=e}return!1},ot.regexp_eatDecimalDigits=function(t){var e=t.pos,i=0;for(t.lastIntValue=0;pt(i=t.current());)t.lastIntValue=10*t.lastIntValue+(i-48),t.advance();return t.pos!==e},ot.regexp_eatHexDigits=function(t){var e=t.pos,i=0;for(t.lastIntValue=0;gt(i=t.current());)t.lastIntValue=16*t.lastIntValue+vt(i),t.advance();return t.pos!==e},ot.regexp_eatLegacyOctalEscapeSequence=function(t){if(this.regexp_eatOctalDigit(t)){var e=t.lastIntValue;if(this.regexp_eatOctalDigit(t)){var i=t.lastIntValue;e<=3&&this.regexp_eatOctalDigit(t)?t.lastIntValue=64*e+8*i+t.lastIntValue:t.lastIntValue=8*e+i}else t.lastIntValue=e;return!0}return!1},ot.regexp_eatOctalDigit=function(t){var e=t.current();return _t(e)?(t.lastIntValue=e-48,t.advance(),!0):(t.lastIntValue=0,!1)},ot.regexp_eatFixedHexDigits=function(t,e){var i=t.pos;t.lastIntValue=0;for(var n=0;n<e;++n){var r=t.current();if(!gt(r))return t.pos=i,!1;t.lastIntValue=16*t.lastIntValue+vt(r),t.advance()}return!0};var mt=function(t){this.type=t.type,this.value=t.value,this.start=t.start,this.end=t.end,t.options.locations&&(this.loc=new D(t,t.startLoc,t.endLoc)),t.options.ranges&&(this.range=[t.start,t.end])},yt=z.prototype;function xt(t){return t<=65535?String.fromCharCode(t):(t-=65536,String.fromCharCode(55296+(t>>10),56320+(1023&t)))}yt.next=function(){this.options.onToken&&this.options.onToken(new mt(this)),this.lastTokEnd=this.end,this.lastTokStart=this.start,this.lastTokEndLoc=this.endLoc,this.lastTokStartLoc=this.startLoc,this.nextToken()},yt.getToken=function(){return this.next(),new mt(this)},"undefined"!=typeof Symbol&&(yt[Symbol.iterator]=function(){var t=this;return{next:function(){var e=t.getToken();return{done:e.type===w.eof,value:e}}}}),yt.curContext=function(){return this.context[this.context.length-1]},yt.nextToken=function(){var t=this.curContext();return t&&t.preserveSpace||this.skipSpace(),this.start=this.pos,this.options.locations&&(this.startLoc=this.curPosition()),this.pos>=this.input.length?this.finishToken(w.eof):t.override?t.override(this):void this.readToken(this.fullCharCodeAtPos())},yt.readToken=function(t){return p(t,this.options.ecmaVersion>=6)||92===t?this.readWord():this.getTokenFromCode(t)},yt.fullCharCodeAtPos=function(){var t=this.input.charCodeAt(this.pos);return t<=55295||t>=57344?t:(t<<10)+this.input.charCodeAt(this.pos+1)-56613888},yt.skipBlockComment=function(){var t,e=this.options.onComment&&this.curPosition(),i=this.pos,n=this.input.indexOf("*/",this.pos+=2);if(-1===n&&this.raise(this.pos-2,"Unterminated comment"),this.pos=n+2,this.options.locations)for(S.lastIndex=i;(t=S.exec(this.input))&&t.index<this.pos;)++this.curLine,this.lineStart=t.index+t[0].length;this.options.onComment&&this.options.onComment(!0,this.input.slice(i+2,n),i,this.pos,e,this.curPosition())},yt.skipLineComment=function(t){for(var e=this.pos,i=this.options.onComment&&this.curPosition(),n=this.input.charCodeAt(this.pos+=t);this.pos<this.input.length&&!T(n);)n=this.input.charCodeAt(++this.pos);this.options.onComment&&this.options.onComment(!1,this.input.slice(e+t,this.pos),e,this.pos,i,this.curPosition())},yt.skipSpace=function(){t:for(;this.pos<this.input.length;){var t=this.input.charCodeAt(this.pos);switch(t){case 32:case 160:++this.pos;break;case 13:10===this.input.charCodeAt(this.pos+1)&&++this.pos;case 10:case 8232:case 8233:++this.pos,this.options.locations&&(++this.curLine,this.lineStart=this.pos);break;case 47:switch(this.input.charCodeAt(this.pos+1)){case 42:this.skipBlockComment();break;case 47:this.skipLineComment(2);break;default:break t}break;default:if(!(t>8&&t<14||t>=5760&&k.test(String.fromCharCode(t))))break t;++this.pos}}},yt.finishToken=function(t,e){this.end=this.pos,this.options.locations&&(this.endLoc=this.curPosition());var i=this.type;this.type=t,this.value=e,this.updateContext(i)},yt.readToken_dot=function(){var t=this.input.charCodeAt(this.pos+1);if(t>=48&&t<=57)return this.readNumber(!0);var e=this.input.charCodeAt(this.pos+2);return this.options.ecmaVersion>=6&&46===t&&46===e?(this.pos+=3,this.finishToken(w.ellipsis)):(++this.pos,this.finishToken(w.dot))},yt.readToken_slash=function(){var t=this.input.charCodeAt(this.pos+1);return this.exprAllowed?(++this.pos,this.readRegexp()):61===t?this.finishOp(w.assign,2):this.finishOp(w.slash,1)},yt.readToken_mult_modulo_exp=function(t){var e=this.input.charCodeAt(this.pos+1),i=1,n=42===t?w.star:w.modulo;return this.options.ecmaVersion>=7&&42===t&&42===e&&(++i,n=w.starstar,e=this.input.charCodeAt(this.pos+2)),61===e?this.finishOp(w.assign,i+1):this.finishOp(n,i)},yt.readToken_pipe_amp=function(t){var e=this.input.charCodeAt(this.pos+1);return e===t?this.finishOp(124===t?w.logicalOR:w.logicalAND,2):61===e?this.finishOp(w.assign,2):this.finishOp(124===t?w.bitwiseOR:w.bitwiseAND,1)},yt.readToken_caret=function(){return 61===this.input.charCodeAt(this.pos+1)?this.finishOp(w.assign,2):this.finishOp(w.bitwiseXOR,1)},yt.readToken_plus_min=function(t){var e=this.input.charCodeAt(this.pos+1);return e===t?45!==e||this.inModule||62!==this.input.charCodeAt(this.pos+2)||0!==this.lastTokEnd&&!C.test(this.input.slice(this.lastTokEnd,this.pos))?this.finishOp(w.incDec,2):(this.skipLineComment(3),this.skipSpace(),this.nextToken()):61===e?this.finishOp(w.assign,2):this.finishOp(w.plusMin,1)},yt.readToken_lt_gt=function(t){var e=this.input.charCodeAt(this.pos+1),i=1;return e===t?(i=62===t&&62===this.input.charCodeAt(this.pos+2)?3:2,61===this.input.charCodeAt(this.pos+i)?this.finishOp(w.assign,i+1):this.finishOp(w.bitShift,i)):33!==e||60!==t||this.inModule||45!==this.input.charCodeAt(this.pos+2)||45!==this.input.charCodeAt(this.pos+3)?(61===e&&(i=2),this.finishOp(w.relational,i)):(this.skipLineComment(4),this.skipSpace(),this.nextToken())},yt.readToken_eq_excl=function(t){var e=this.input.charCodeAt(this.pos+1);return 61===e?this.finishOp(w.equality,61===this.input.charCodeAt(this.pos+2)?3:2):61===t&&62===e&&this.options.ecmaVersion>=6?(this.pos+=2,this.finishToken(w.arrow)):this.finishOp(61===t?w.eq:w.prefix,1)},yt.getTokenFromCode=function(t){switch(t){case 46:return this.readToken_dot();case 40:return++this.pos,this.finishToken(w.parenL);case 41:return++this.pos,this.finishToken(w.parenR);case 59:return++this.pos,this.finishToken(w.semi);case 44:return++this.pos,this.finishToken(w.comma);case 91:return++this.pos,this.finishToken(w.bracketL);case 93:return++this.pos,this.finishToken(w.bracketR);case 123:return++this.pos,this.finishToken(w.braceL);case 125:return++this.pos,this.finishToken(w.braceR);case 58:return++this.pos,this.finishToken(w.colon);case 63:return++this.pos,this.finishToken(w.question);case 96:if(this.options.ecmaVersion<6)break;return++this.pos,this.finishToken(w.backQuote);case 48:var e=this.input.charCodeAt(this.pos+1);if(120===e||88===e)return this.readRadixNumber(16);if(this.options.ecmaVersion>=6){if(111===e||79===e)return this.readRadixNumber(8);if(98===e||66===e)return this.readRadixNumber(2)}case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return this.readNumber(!1);case 34:case 39:return this.readString(t);case 47:return this.readToken_slash();case 37:case 42:return this.readToken_mult_modulo_exp(t);case 124:case 38:return this.readToken_pipe_amp(t);case 94:return this.readToken_caret();case 43:case 45:return this.readToken_plus_min(t);case 60:case 62:return this.readToken_lt_gt(t);case 61:case 33:return this.readToken_eq_excl(t);case 126:return this.finishOp(w.prefix,1)}this.raise(this.pos,"Unexpected character '"+xt(t)+"'")},yt.finishOp=function(t,e){var i=this.input.slice(this.pos,this.pos+e);return this.pos+=e,this.finishToken(t,i)},yt.readRegexp=function(){for(var t,e,i=this.pos;;){this.pos>=this.input.length&&this.raise(i,"Unterminated regular expression");var n=this.input.charAt(this.pos);if(C.test(n)&&this.raise(i,"Unterminated regular expression"),t)t=!1;else{if("["===n)e=!0;else if("]"===n&&e)e=!1;else if("/"===n&&!e)break;t="\\"===n}++this.pos}var r=this.input.slice(i,this.pos);++this.pos;var s=this.pos,a=this.readWord1();this.containsEsc&&this.unexpected(s);var o=this.regexpState||(this.regexpState=new ht(this));o.reset(i,r,a),this.validateRegExpFlags(o),this.validateRegExpPattern(o);var h=null;try{h=new RegExp(r,a)}catch(t){}return this.finishToken(w.regexp,{pattern:r,flags:a,value:h})},yt.readInt=function(t,e){for(var i=this.pos,n=0,r=0,s=null==e?1/0:e;r<s;++r){var a=this.input.charCodeAt(this.pos),o=void 0;if((o=a>=97?a-97+10:a>=65?a-65+10:a>=48&&a<=57?a-48:1/0)>=t)break;++this.pos,n=n*t+o}return this.pos===i||null!=e&&this.pos-i!==e?null:n},yt.readRadixNumber=function(t){this.pos+=2;var e=this.readInt(t);return null==e&&this.raise(this.start+2,"Expected number in radix "+t),p(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(w.num,e)},yt.readNumber=function(t){var e=this.pos;t||null!==this.readInt(10)||this.raise(e,"Invalid number");var i=this.pos-e>=2&&48===this.input.charCodeAt(e);i&&this.strict&&this.raise(e,"Invalid number"),i&&/[89]/.test(this.input.slice(e,this.pos))&&(i=!1);var n=this.input.charCodeAt(this.pos);46!==n||i||(++this.pos,this.readInt(10),n=this.input.charCodeAt(this.pos)),69!==n&&101!==n||i||(43!==(n=this.input.charCodeAt(++this.pos))&&45!==n||++this.pos,null===this.readInt(10)&&this.raise(e,"Invalid number")),p(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number");var r=this.input.slice(e,this.pos),s=i?parseInt(r,8):parseFloat(r);return this.finishToken(w.num,s)},yt.readCodePoint=function(){var t;if(123===this.input.charCodeAt(this.pos)){this.options.ecmaVersion<6&&this.unexpected();var e=++this.pos;t=this.readHexChar(this.input.indexOf("}",this.pos)-this.pos),++this.pos,t>1114111&&this.invalidStringToken(e,"Code point out of bounds")}else t=this.readHexChar(4);return t},yt.readString=function(t){for(var e="",i=++this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated string constant");var n=this.input.charCodeAt(this.pos);if(n===t)break;92===n?(e+=this.input.slice(i,this.pos),e+=this.readEscapedChar(!1),i=this.pos):(T(n,this.options.ecmaVersion>=10)&&this.raise(this.start,"Unterminated string constant"),++this.pos)}return e+=this.input.slice(i,this.pos++),this.finishToken(w.string,e)};var bt={};yt.tryReadTemplateToken=function(){this.inTemplateElement=!0;try{this.readTmplToken()}catch(t){if(t!==bt)throw t;this.readInvalidTemplateToken()}this.inTemplateElement=!1},yt.invalidStringToken=function(t,e){if(this.inTemplateElement&&this.options.ecmaVersion>=9)throw bt;this.raise(t,e)},yt.readTmplToken=function(){for(var t="",e=this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated template");var i=this.input.charCodeAt(this.pos);if(96===i||36===i&&123===this.input.charCodeAt(this.pos+1))return this.pos!==this.start||this.type!==w.template&&this.type!==w.invalidTemplate?(t+=this.input.slice(e,this.pos),this.finishToken(w.template,t)):36===i?(this.pos+=2,this.finishToken(w.dollarBraceL)):(++this.pos,this.finishToken(w.backQuote));if(92===i)t+=this.input.slice(e,this.pos),t+=this.readEscapedChar(!0),e=this.pos;else if(T(i)){switch(t+=this.input.slice(e,this.pos),++this.pos,i){case 13:10===this.input.charCodeAt(this.pos)&&++this.pos;case 10:t+="\n";break;default:t+=String.fromCharCode(i)}this.options.locations&&(++this.curLine,this.lineStart=this.pos),e=this.pos}else++this.pos}},yt.readInvalidTemplateToken=function(){for(;this.pos<this.input.length;this.pos++)switch(this.input[this.pos]){case"\\":++this.pos;break;case"$":if("{"!==this.input[this.pos+1])break;case"`":return this.finishToken(w.invalidTemplate,this.input.slice(this.start,this.pos))}this.raise(this.start,"Unterminated template")},yt.readEscapedChar=function(t){var e=this.input.charCodeAt(++this.pos);switch(++this.pos,e){case 110:return"\n";case 114:return"\r";case 120:return String.fromCharCode(this.readHexChar(2));case 117:return xt(this.readCodePoint());case 116:return"\t";case 98:return"\b";case 118:return"\v";case 102:return"\f";case 13:10===this.input.charCodeAt(this.pos)&&++this.pos;case 10:return this.options.locations&&(this.lineStart=this.pos,++this.curLine),"";default:if(e>=48&&e<=55){var i=this.input.substr(this.pos-1,3).match(/^[0-7]+/)[0],n=parseInt(i,8);return n>255&&(i=i.slice(0,-1),n=parseInt(i,8)),this.pos+=i.length-1,e=this.input.charCodeAt(this.pos),"0"===i&&56!==e&&57!==e||!this.strict&&!t||this.invalidStringToken(this.pos-1-i.length,t?"Octal literal in template string":"Octal literal in strict mode"),String.fromCharCode(n)}return String.fromCharCode(e)}},yt.readHexChar=function(t){var e=this.pos,i=this.readInt(16,t);return null===i&&this.invalidStringToken(e,"Bad character escape sequence"),i},yt.readWord1=function(){this.containsEsc=!1;for(var t="",e=!0,i=this.pos,n=this.options.ecmaVersion>=6;this.pos<this.input.length;){var r=this.fullCharCodeAtPos();if(g(r,n))this.pos+=r<=65535?1:2;else{if(92!==r)break;this.containsEsc=!0,t+=this.input.slice(i,this.pos);var s=this.pos;117!==this.input.charCodeAt(++this.pos)&&this.invalidStringToken(this.pos,"Expecting Unicode escape sequence \\uXXXX"),++this.pos;var a=this.readCodePoint();(e?p:g)(a,n)||this.invalidStringToken(s,"Invalid Unicode escape"),t+=xt(a),i=this.pos}e=!1}return t+this.input.slice(i,this.pos)},yt.readWord=function(){var t=this.readWord1(),e=w.name;return this.keywords.test(t)&&(this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword "+t),e=x[t]),this.finishToken(e,t)};var wt,Ct,St,Tt="5.7.3";function kt(t,e){return new z(e,t).parse()}function Ot(t,e,i){var n=new z(i,t,e);return n.nextToken(),n.parseExpression()}function At(t,e){return new z(e,t)}function Pt(t,e,i){wt=t,Ct=e,St=i}},683:function(t,e,i){(function(t){var n,r,s,a,o,h,c,l,u,f,d,p,g,v,_,m,y,x,b=b||{version:"2.4.3"};function w(t,e){var i=t.canvas,n=e.targetCanvas,r=n.getContext("2d");r.translate(0,n.height),r.scale(1,-1);var s=i.height-n.height;r.drawImage(i,0,s,n.width,n.height,0,0,n.width,n.height)}function C(t,e){var i=e.targetCanvas.getContext("2d"),n=e.destinationWidth,r=e.destinationHeight,s=n*r*4,a=new Uint8Array(this.imageBuffer,0,s),o=new Uint8ClampedArray(this.imageBuffer,0,s);t.readPixels(0,0,n,r,t.RGBA,t.UNSIGNED_BYTE,a);var h=new ImageData(o,n,r);i.putImageData(h,0,0)}e.fabric=b,"undefined"!=typeof document&&"undefined"!=typeof window?(b.document=document,b.window=window):(b.document=i(684).jsdom(decodeURIComponent("%3C!DOCTYPE%20html%3E%3Chtml%3E%3Chead%3E%3C%2Fhead%3E%3Cbody%3E%3C%2Fbody%3E%3C%2Fhtml%3E"),{features:{FetchExternalResources:["img"]}}),b.jsdomImplForWrapper=i(685).implForWrapper,b.nodeCanvas=i(686).Canvas,b.window=b.document.defaultView,DOMParser=i(687).DOMParser),b.isTouchSupported="ontouchstart"in b.window,b.isLikelyNode=void 0!==t&&"undefined"==typeof window,b.SHARED_ATTRIBUTES=["display","transform","fill","fill-opacity","fill-rule","opacity","stroke","stroke-dasharray","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","id","paint-order","instantiated_by_use","clip-path"],b.DPI=96,b.reNum="(?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:e[-+]?\\d+)?)",b.fontPaths={},b.iMatrix=[1,0,0,1,0,0],b.canvasModule="canvas",b.perfLimitSizeTotal=2097152,b.maxCacheSideLimit=4096,b.minCacheSideLimit=256,b.charWidthsCache={},b.textureSize=2048,b.enableGLFiltering=!0,b.devicePixelRatio=b.window.devicePixelRatio||b.window.webkitDevicePixelRatio||b.window.mozDevicePixelRatio||1,b.browserShadowBlurConstant=1,b.arcToSegmentsCache={},b.boundsOfCurveCache={},b.cachesBoundsOfCurve=!0,b.initFilterBackend=function(){return b.enableGLFiltering&&b.isWebglSupported&&b.isWebglSupported(b.textureSize)?(console.log("max texture size: "+b.maxTextureSize),new b.WebglFilterBackend({tileSize:b.textureSize})):b.Canvas2dFilterBackend?new b.Canvas2dFilterBackend:void 0},"undefined"!=typeof document&&"undefined"!=typeof window&&(window.fabric=b),function(){function t(t,e){if(this.__eventListeners[t]){var i=this.__eventListeners[t];e?i[i.indexOf(e)]=!1:b.util.array.fill(i,!1)}}function e(t,e){if(this.__eventListeners||(this.__eventListeners={}),1===arguments.length)for(var i in t)this.on(i,t[i]);else this.__eventListeners[t]||(this.__eventListeners[t]=[]),this.__eventListeners[t].push(e);return this}function i(e,i){if(this.__eventListeners){if(0===arguments.length)for(e in this.__eventListeners)t.call(this,e);else if(1===arguments.length&&"object"==typeof arguments[0])for(var n in e)t.call(this,n,e[n]);else t.call(this,e,i);return this}}function n(t,e){if(this.__eventListeners){var i=this.__eventListeners[t];if(i){for(var n=0,r=i.length;n<r;n++)i[n]&&i[n].call(this,e||{});return this.__eventListeners[t]=i.filter(function(t){return!1!==t}),this}}}b.Observable={observe:e,stopObserving:i,fire:n,on:e,off:i,trigger:n}}(),b.Collection={_objects:[],add:function(){if(this._objects.push.apply(this._objects,arguments),this._onObjectAdded)for(var t=0,e=arguments.length;t<e;t++)this._onObjectAdded(arguments[t]);return this.renderOnAddRemove&&this.requestRenderAll(),this},insertAt:function(t,e,i){var n=this._objects;return i?n[e]=t:n.splice(e,0,t),this._onObjectAdded&&this._onObjectAdded(t),this.renderOnAddRemove&&this.requestRenderAll(),this},remove:function(){for(var t,e=this._objects,i=!1,n=0,r=arguments.length;n<r;n++)-1!==(t=e.indexOf(arguments[n]))&&(i=!0,e.splice(t,1),this._onObjectRemoved&&this._onObjectRemoved(arguments[n]));return this.renderOnAddRemove&&i&&this.requestRenderAll(),this},forEachObject:function(t,e){for(var i=this.getObjects(),n=0,r=i.length;n<r;n++)t.call(e,i[n],n,i);return this},getObjects:function(t){return void 0===t?this._objects.concat():this._objects.filter(function(e){return e.type===t})},item:function(t){return this._objects[t]},isEmpty:function(){return 0===this._objects.length},size:function(){return this._objects.length},contains:function(t){return this._objects.indexOf(t)>-1},complexity:function(){return this._objects.reduce(function(t,e){return t+=e.complexity?e.complexity():0},0)}},b.CommonMethods={_setOptions:function(t){for(var e in t)this.set(e,t[e])},_initGradient:function(t,e){!t||!t.colorStops||t instanceof b.Gradient||this.set(e,new b.Gradient(t))},_initPattern:function(t,e,i){!t||!t.source||t instanceof b.Pattern?i&&i():this.set(e,new b.Pattern(t,i))},_initClipping:function(t){if(t.clipTo&&"string"==typeof t.clipTo){var e=b.util.getFunctionBody(t.clipTo);void 0!==e&&(this.clipTo=new Function("ctx",e))}},_setObject:function(t){for(var e in t)this._set(e,t[e])},set:function(t,e){return"object"==typeof t?this._setObject(t):"function"==typeof e&&"clipTo"!==t?this._set(t,e(this.get(t))):this._set(t,e),this},_set:function(t,e){this[t]=e},toggle:function(t){var e=this.get(t);return"boolean"==typeof e&&this.set(t,!e),this},get:function(t){return this[t]}},n=e,r=Math.sqrt,s=Math.atan2,a=Math.pow,o=Math.abs,h=Math.PI/180,c=Math.PI/2,b.util={cos:function(t){if(0===t)return 1;switch(t<0&&(t=-t),t/c){case 1:case 3:return 0;case 2:return-1}return Math.cos(t)},sin:function(t){if(0===t)return 0;var e=1;switch(t<0&&(e=-1),t/c){case 1:return e;case 2:return 0;case 3:return-e}return Math.sin(t)},removeFromArray:function(t,e){var i=t.indexOf(e);return-1!==i&&t.splice(i,1),t},getRandomInt:function(t,e){return Math.floor(Math.random()*(e-t+1))+t},degreesToRadians:function(t){return t*h},radiansToDegrees:function(t){return t/h},rotatePoint:function(t,e,i){t.subtractEquals(e);var n=b.util.rotateVector(t,i);return new b.Point(n.x,n.y).addEquals(e)},rotateVector:function(t,e){var i=b.util.sin(e),n=b.util.cos(e);return{x:t.x*n-t.y*i,y:t.x*i+t.y*n}},transformPoint:function(t,e,i){return i?new b.Point(e[0]*t.x+e[2]*t.y,e[1]*t.x+e[3]*t.y):new b.Point(e[0]*t.x+e[2]*t.y+e[4],e[1]*t.x+e[3]*t.y+e[5])},makeBoundingBoxFromPoints:function(t){var e=[t[0].x,t[1].x,t[2].x,t[3].x],i=b.util.array.min(e),n=b.util.array.max(e)-i,r=[t[0].y,t[1].y,t[2].y,t[3].y],s=b.util.array.min(r);return{left:i,top:s,width:n,height:b.util.array.max(r)-s}},invertTransform:function(t){var e=1/(t[0]*t[3]-t[1]*t[2]),i=[e*t[3],-e*t[1],-e*t[2],e*t[0]],n=b.util.transformPoint({x:t[4],y:t[5]},i,!0);return i[4]=-n.x,i[5]=-n.y,i},toFixed:function(t,e){return parseFloat(Number(t).toFixed(e))},parseUnit:function(t,e){var i=/\D{0,2}$/.exec(t),n=parseFloat(t);switch(e||(e=b.Text.DEFAULT_SVG_FONT_SIZE),i[0]){case"mm":return n*b.DPI/25.4;case"cm":return n*b.DPI/2.54;case"in":return n*b.DPI;case"pt":return n*b.DPI/72;case"pc":return n*b.DPI/72*12;case"em":return n*e;default:return n}},falseFunction:function(){return!1},getKlass:function(t,e){return t=b.util.string.camelize(t.charAt(0).toUpperCase()+t.slice(1)),b.util.resolveNamespace(e)[t]},getSvgAttributes:function(t){var e=["instantiated_by_use","style","id","class"];switch(t){case"linearGradient":e=e.concat(["x1","y1","x2","y2","gradientUnits","gradientTransform"]);break;case"radialGradient":e=e.concat(["gradientUnits","gradientTransform","cx","cy","r","fx","fy","fr"]);break;case"stop":e=e.concat(["offset","stop-color","stop-opacity"])}return e},resolveNamespace:function(t){if(!t)return b;var e,i=t.split("."),r=i.length,s=n||b.window;for(e=0;e<r;++e)s=s[i[e]];return s},loadImage:function(t,e,i,n){if(t){var r=b.util.createImage(),s=function(){e&&e.call(i,r),r=r.onload=r.onerror=null};r.onload=s,r.onerror=function(){b.log("Error loading "+r.src),e&&e.call(i,null,!0),r=r.onload=r.onerror=null},0!==t.indexOf("data")&&n&&(r.crossOrigin=n),"data:image/svg"===t.substring(0,14)&&(r.onload=null,b.util.loadImageInDom(r,s)),r.src=t}else e&&e.call(i,t)},loadImageInDom:function(t,e){var i=b.document.createElement("div");i.style.width=i.style.height="1px",i.style.left=i.style.top="-100%",i.style.position="absolute",i.appendChild(t),b.document.querySelector("body").appendChild(i),t.onload=function(){e(),i.parentNode.removeChild(i),i=null}},enlivenObjects:function(t,e,i,n){function r(){++a===o&&e&&e(s)}var s=[],a=0,o=(t=t||[]).length;o?t.forEach(function(t,e){t&&t.type?b.util.getKlass(t.type,i).fromObject(t,function(i,a){a||(s[e]=i),n&&n(t,i,a),r()}):r()}):e&&e(s)},enlivenPatterns:function(t,e){function i(){++r===s&&e&&e(n)}var n=[],r=0,s=(t=t||[]).length;s?t.forEach(function(t,e){t&&t.source?new b.Pattern(t,function(t){n[e]=t,i()}):(n[e]=t,i())}):e&&e(n)},groupSVGElements:function(t,e,i){var n;return t&&1===t.length?t[0]:(e&&(e.width&&e.height?e.centerPoint={x:e.width/2,y:e.height/2}:(delete e.width,delete e.height)),n=new b.Group(t,e),void 0!==i&&(n.sourcePath=i),n)},populateWithProperties:function(t,e,i){if(i&&"[object Array]"===Object.prototype.toString.call(i))for(var n=0,r=i.length;n<r;n++)i[n]in t&&(e[i[n]]=t[i[n]])},drawDashedLine:function(t,e,i,n,a,o){var h=n-e,c=a-i,l=r(h*h+c*c),u=s(c,h),f=o.length,d=0,p=!0;for(t.save(),t.translate(e,i),t.moveTo(0,0),t.rotate(u),e=0;l>e;)(e+=o[d++%f])>l&&(e=l),t[p?"lineTo":"moveTo"](e,0),p=!p;t.restore()},createCanvasElement:function(){return b.document.createElement("canvas")},copyCanvasElement:function(t){var e=b.util.createCanvasElement();return e.width=t.width,e.height=t.height,e.getContext("2d").drawImage(t,0,0),e},createImage:function(){return b.document.createElement("img")},clipContext:function(t,e){e.save(),e.beginPath(),t.clipTo(e),e.clip()},multiplyTransformMatrices:function(t,e,i){return[t[0]*e[0]+t[2]*e[1],t[1]*e[0]+t[3]*e[1],t[0]*e[2]+t[2]*e[3],t[1]*e[2]+t[3]*e[3],i?0:t[0]*e[4]+t[2]*e[5]+t[4],i?0:t[1]*e[4]+t[3]*e[5]+t[5]]},qrDecompose:function(t){var e=s(t[1],t[0]),i=a(t[0],2)+a(t[1],2),n=r(i),o=(t[0]*t[3]-t[2]*t[1])/n,c=s(t[0]*t[2]+t[1]*t[3],i);return{angle:e/h,scaleX:n,scaleY:o,skewX:c/h,skewY:0,translateX:t[4],translateY:t[5]}},customTransformMatrix:function(t,e,i){var n=[1,0,o(Math.tan(i*h)),1],r=[o(t),0,0,o(e)];return b.util.multiplyTransformMatrices(r,n,!0)},resetObjectTransform:function(t){t.scaleX=1,t.scaleY=1,t.skewX=0,t.skewY=0,t.flipX=!1,t.flipY=!1,t.rotate(0)},saveObjectTransform:function(t){return{scaleX:t.scaleX,scaleY:t.scaleY,skewX:t.skewX,skewY:t.skewY,angle:t.angle,left:t.left,flipX:t.flipX,flipY:t.flipY,top:t.top}},getFunctionBody:function(t){return(String(t).match(/function[^{]*\{([\s\S]*)\}/)||{})[1]},isTransparent:function(t,e,i,n){n>0&&(e>n?e-=n:e=0,i>n?i-=n:i=0);var r,s=!0,a=t.getImageData(e,i,2*n||1,2*n||1),o=a.data.length;for(r=3;r<o&&!1!=(s=a.data[r]<=0);r+=4);return a=null,s},parsePreserveAspectRatioAttribute:function(t){var e,i="meet",n=t.split(" ");return n&&n.length&&("meet"!==(i=n.pop())&&"slice"!==i?(e=i,i="meet"):n.length&&(e=n.pop())),{meetOrSlice:i,alignX:"none"!==e?e.slice(1,4):"none",alignY:"none"!==e?e.slice(5,8):"none"}},clearFabricFontCache:function(t){(t=(t||"").toLowerCase())?b.charWidthsCache[t]&&delete b.charWidthsCache[t]:b.charWidthsCache={}},limitDimsByArea:function(t,e){var i=Math.sqrt(e*t),n=Math.floor(e/i);return{x:Math.floor(i),y:n}},capValue:function(t,e,i){return Math.max(t,Math.min(e,i))},findScaleToFit:function(t,e){return Math.min(e.width/t.width,e.height/t.height)},findScaleToCover:function(t,e){return Math.max(e.width/t.width,e.height/t.height)}},function(){var t=Array.prototype.join;function e(e,r,s,a,o,h,c){var l=t.call(arguments);if(b.arcToSegmentsCache[l])return b.arcToSegmentsCache[l];var u=Math.PI,f=c*u/180,d=b.util.sin(f),p=b.util.cos(f),g=0,v=0,_=-p*e*.5-d*r*.5,m=-p*r*.5+d*e*.5,y=(s=Math.abs(s))*s,x=(a=Math.abs(a))*a,w=m*m,C=_*_,S=y*x-y*w-x*C,T=0;if(S<0){var k=Math.sqrt(1-S/(y*x));s*=k,a*=k}else T=(o===h?-1:1)*Math.sqrt(S/(y*w+x*C));var O=T*s*m/a,A=-T*a*_/s,P=p*O-d*A+.5*e,E=d*O+p*A+.5*r,M=n(1,0,(_-O)/s,(m-A)/a),I=n((_-O)/s,(m-A)/a,(-_-O)/s,(-m-A)/a);0===h&&I>0?I-=2*u:1===h&&I<0&&(I+=2*u);for(var L=Math.ceil(Math.abs(I/u*2)),D=[],j=I/L,F=8/3*Math.sin(j/4)*Math.sin(j/4)/Math.sin(j/2),R=M+j,B=0;B<L;B++)D[B]=i(M,R,p,d,s,a,P,E,F,g,v),g=D[B][4],v=D[B][5],M=R,R+=j;return b.arcToSegmentsCache[l]=D,D}function i(t,e,i,n,r,s,a,o,h,c,l){var u=b.util.cos(t),f=b.util.sin(t),d=b.util.cos(e),p=b.util.sin(e),g=i*r*d-n*s*p+a,v=n*r*d+i*s*p+o;return[c+h*(-i*r*f-n*s*u),l+h*(-n*r*f+i*s*u),g+h*(i*r*p+n*s*d),v+h*(n*r*p-i*s*d),g,v]}function n(t,e,i,n){var r=Math.atan2(e,t),s=Math.atan2(n,i);return s>=r?s-r:2*Math.PI-(r-s)}function r(e,i,n,r,s,a,o,h){var c;if(b.cachesBoundsOfCurve&&(c=t.call(arguments),b.boundsOfCurveCache[c]))return b.boundsOfCurveCache[c];var l,u,f,d,p,g,v,_,m=Math.sqrt,y=Math.min,x=Math.max,w=Math.abs,C=[],S=[[],[]];u=6*e-12*n+6*s,l=-3*e+9*n-9*s+3*o,f=3*n-3*e;for(var T=0;T<2;++T)if(T>0&&(u=6*i-12*r+6*a,l=-3*i+9*r-9*a+3*h,f=3*r-3*i),w(l)<1e-12){if(w(u)<1e-12)continue;0<(d=-f/u)&&d<1&&C.push(d)}else(v=u*u-4*f*l)<0||(0<(p=(-u+(_=m(v)))/(2*l))&&p<1&&C.push(p),0<(g=(-u-_)/(2*l))&&g<1&&C.push(g));for(var k,O,A,P=C.length,E=P;P--;)k=(A=1-(d=C[P]))*A*A*e+3*A*A*d*n+3*A*d*d*s+d*d*d*o,S[0][P]=k,O=A*A*A*i+3*A*A*d*r+3*A*d*d*a+d*d*d*h,S[1][P]=O;S[0][E]=e,S[1][E]=i,S[0][E+1]=o,S[1][E+1]=h;var M=[{x:y.apply(null,S[0]),y:y.apply(null,S[1])},{x:x.apply(null,S[0]),y:x.apply(null,S[1])}];return b.cachesBoundsOfCurve&&(b.boundsOfCurveCache[c]=M),M}b.util.drawArc=function(t,i,n,r){for(var s=r[0],a=r[1],o=r[2],h=r[3],c=r[4],l=[[],[],[],[]],u=e(r[5]-i,r[6]-n,s,a,h,c,o),f=0,d=u.length;f<d;f++)l[f][0]=u[f][0]+i,l[f][1]=u[f][1]+n,l[f][2]=u[f][2]+i,l[f][3]=u[f][3]+n,l[f][4]=u[f][4]+i,l[f][5]=u[f][5]+n,t.bezierCurveTo.apply(t,l[f])},b.util.getBoundsOfArc=function(t,i,n,s,a,o,h,c,l){for(var u,f=0,d=0,p=[],g=e(c-t,l-i,n,s,o,h,a),v=0,_=g.length;v<_;v++)u=r(f,d,g[v][0],g[v][1],g[v][2],g[v][3],g[v][4],g[v][5]),p.push({x:u[0].x+t,y:u[0].y+i}),p.push({x:u[1].x+t,y:u[1].y+i}),f=g[v][4],d=g[v][5];return p},b.util.getBoundsOfCurve=r}(),function(){var t=Array.prototype.slice;function e(t,e,i){if(t&&0!==t.length){var n=t.length-1,r=e?t[n][e]:t[n];if(e)for(;n--;)i(t[n][e],r)&&(r=t[n][e]);else for(;n--;)i(t[n],r)&&(r=t[n]);return r}}b.util.array={fill:function(t,e){for(var i=t.length;i--;)t[i]=e;return t},invoke:function(e,i){for(var n=t.call(arguments,2),r=[],s=0,a=e.length;s<a;s++)r[s]=n.length?e[s][i].apply(e[s],n):e[s][i].call(e[s]);return r},min:function(t,i){return e(t,i,function(t,e){return t<e})},max:function(t,i){return e(t,i,function(t,e){return t>=e})}}}(),function(){function t(e,i,n){if(n)if(!b.isLikelyNode&&i instanceof Element)e=i;else if(i instanceof Array){e=[];for(var r=0,s=i.length;r<s;r++)e[r]=t({},i[r],n)}else if(i&&"object"==typeof i)for(var a in i)i.hasOwnProperty(a)&&(e[a]=t({},i[a],n));else e=i;else for(var a in i)e[a]=i[a];return e}b.util.object={extend:t,clone:function(e,i){return t({},e,i)}},b.util.object.extend(b.util,b.Observable)}(),function(){function t(t,e){var i=t.charCodeAt(e);if(isNaN(i))return"";if(i<55296||i>57343)return t.charAt(e);if(55296<=i&&i<=56319){if(t.length<=e+1)throw"High surrogate without following low surrogate";var n=t.charCodeAt(e+1);if(56320>n||n>57343)throw"High surrogate without following low surrogate";return t.charAt(e)+t.charAt(e+1)}if(0===e)throw"Low surrogate without preceding high surrogate";var r=t.charCodeAt(e-1);if(55296>r||r>56319)throw"Low surrogate without preceding high surrogate";return!1}b.util.string={camelize:function(t){return t.replace(/-+(.)?/g,function(t,e){return e?e.toUpperCase():""})},capitalize:function(t,e){return t.charAt(0).toUpperCase()+(e?t.slice(1):t.slice(1).toLowerCase())},escapeXml:function(t){return t.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},graphemeSplit:function(e){var i,n=0,r=[];for(n=0;n<e.length;n++)!1!==(i=t(e,n))&&r.push(i);return r}}}(),function(){var t=Array.prototype.slice,e=function(){},i=function(){for(var t in{toString:1})if("toString"===t)return!1;return!0}(),n=function(t,e,n){for(var r in e)r in t.prototype&&"function"==typeof t.prototype[r]&&(e[r]+"").indexOf("callSuper")>-1?t.prototype[r]=function(t){return function(){var i=this.constructor.superclass;this.constructor.superclass=n;var r=e[t].apply(this,arguments);if(this.constructor.superclass=i,"initialize"!==t)return r}}(r):t.prototype[r]=e[r],i&&(e.toString!==Object.prototype.toString&&(t.prototype.toString=e.toString),e.valueOf!==Object.prototype.valueOf&&(t.prototype.valueOf=e.valueOf))};function r(){}function s(e){for(var i=null,n=this;n.constructor.superclass;){var r=n.constructor.superclass.prototype[e];if(n[e]!==r){i=r;break}n=n.constructor.superclass.prototype}return i?arguments.length>1?i.apply(this,t.call(arguments,1)):i.call(this):console.log("tried to callSuper "+e+", method not found in prototype chain",this)}b.util.createClass=function(){var i=null,a=t.call(arguments,0);function o(){this.initialize.apply(this,arguments)}"function"==typeof a[0]&&(i=a.shift()),o.superclass=i,o.subclasses=[],i&&(r.prototype=i.prototype,o.prototype=new r,i.subclasses.push(o));for(var h=0,c=a.length;h<c;h++)n(o,a[h],i);return o.prototype.initialize||(o.prototype.initialize=e),o.prototype.constructor=o,o.prototype.callSuper=s,o}}(),function(){var t="unknown";function e(t){var e,i,n=Array.prototype.slice.call(arguments,1),r=n.length;for(i=0;i<r;i++)if(e=typeof t[n[i]],!/^(?:function|object|unknown)$/.test(e))return!1;return!0}var i,n,r,s,a=(r=0,function(t){return t.__uniqueID||(t.__uniqueID="uniqueID__"+r++)});function o(t,e){return{handler:e,wrappedHandler:function(t,e){return function(n){e.call(i(t),n||b.window.event)}}(t,e)}}s={},i=function(t){return s[t]},n=function(t,e){s[t]=e};var h,c,l=e(b.document.documentElement,"addEventListener","removeEventListener")&&e(b.window,"addEventListener","removeEventListener"),u=e(b.document.documentElement,"attachEvent","detachEvent")&&e(b.window,"attachEvent","detachEvent"),f={},d={};l?(h=function(t,e,i,n){t&&t.addEventListener(e,i,!u&&n)},c=function(t,e,i,n){t&&t.removeEventListener(e,i,!u&&n)}):u?(h=function(t,e,i){if(t){var r=a(t);n(r,t),f[r]||(f[r]={}),f[r][e]||(f[r][e]=[]);var s=o(r,i);f[r][e].push(s),t.attachEvent("on"+e,s.wrappedHandler)}},c=function(t,e,i){if(t){var n,r=a(t);if(f[r]&&f[r][e])for(var s=0,o=f[r][e].length;s<o;s++)(n=f[r][e][s])&&n.handler===i&&(t.detachEvent("on"+e,n.wrappedHandler),f[r][e][s]=null)}}):(h=function(t,e,i){if(t){var n=a(t);if(d[n]||(d[n]={}),!d[n][e]){d[n][e]=[];var r=t["on"+e];r&&d[n][e].push(r),t["on"+e]=function(t,e){return function(i){if(d[t]&&d[t][e])for(var n=d[t][e],r=0,s=n.length;r<s;r++)n[r].call(this,i||b.window.event)}}(n,e)}d[n][e].push(i)}},c=function(t,e,i){if(t){var n=a(t);if(d[n]&&d[n][e])for(var r=d[n][e],s=0,o=r.length;s<o;s++)r[s]===i&&r.splice(s,1)}}),b.util.addListener=h,b.util.removeListener=c;var p=function(t){return t.clientX},g=function(t){return t.clientY};function v(t,e,i){var n,r=t["touchend"===t.type?"changedTouches":"touches"];return r&&r[0]&&(n=r[0][i]),void 0===n&&(n=t[i]),n}b.isTouchSupported&&(p=function(t){return v(t,0,"clientX")},g=function(t){return v(t,0,"clientY")}),b.util.getPointer=function(e){e||(e=b.window.event);var i=e.target||(typeof e.srcElement!==t?e.srcElement:null),n=b.util.getScrollLeftTop(i);return{x:p(e)+n.left,y:g(e)+n.top}}}(),function(){var t=b.document.createElement("div"),e="string"==typeof t.style.opacity,i="string"==typeof t.style.filter,n=/alpha\s*\(\s*opacity\s*=\s*([^\)]+)\)/,r=function(t){return t};e?r=function(t,e){return t.style.opacity=e,t}:i&&(r=function(t,e){var i=t.style;return t.currentStyle&&!t.currentStyle.hasLayout&&(i.zoom=1),n.test(i.filter)?(e=e>=.9999?"":"alpha(opacity="+100*e+")",i.filter=i.filter.replace(n,e)):i.filter+=" alpha(opacity="+100*e+")",t}),b.util.setStyle=function(t,e){var i=t.style;if(!i)return t;if("string"==typeof e)return t.style.cssText+=";"+e,e.indexOf("opacity")>-1?r(t,e.match(/opacity:\s*(\d?\.?\d*)/)[1]):t;for(var n in e)"opacity"===n?r(t,e[n]):i["float"===n||"cssFloat"===n?void 0===i.styleFloat?"cssFloat":"styleFloat":n]=e[n];return t}}(),function(){var t=Array.prototype.slice;var e,i,n=function(e){return t.call(e,0)};try{e=n(b.document.childNodes)instanceof Array}catch(t){}function r(t,e){var i=b.document.createElement(t);for(var n in e)"class"===n?i.className=e[n]:"for"===n?i.htmlFor=e[n]:i.setAttribute(n,e[n]);return i}function s(t){for(var e=0,i=0,n=b.document.documentElement,r=b.document.body||{scrollLeft:0,scrollTop:0};t&&(t.parentNode||t.host)&&((t=t.parentNode||t.host)===b.document?(e=r.scrollLeft||n.scrollLeft||0,i=r.scrollTop||n.scrollTop||0):(e+=t.scrollLeft||0,i+=t.scrollTop||0),1!==t.nodeType||"fixed"!==t.style.position););return{left:e,top:i}}e||(n=function(t){for(var e=new Array(t.length),i=t.length;i--;)e[i]=t[i];return e}),i=b.document.defaultView&&b.document.defaultView.getComputedStyle?function(t,e){var i=b.document.defaultView.getComputedStyle(t,null);return i?i[e]:void 0}:function(t,e){var i=t.style[e];return!i&&t.currentStyle&&(i=t.currentStyle[e]),i},function(){var t=b.document.documentElement.style,e="userSelect"in t?"userSelect":"MozUserSelect"in t?"MozUserSelect":"WebkitUserSelect"in t?"WebkitUserSelect":"KhtmlUserSelect"in t?"KhtmlUserSelect":"";b.util.makeElementUnselectable=function(t){return void 0!==t.onselectstart&&(t.onselectstart=b.util.falseFunction),e?t.style[e]="none":"string"==typeof t.unselectable&&(t.unselectable="on"),t},b.util.makeElementSelectable=function(t){return void 0!==t.onselectstart&&(t.onselectstart=null),e?t.style[e]="":"string"==typeof t.unselectable&&(t.unselectable=""),t}}(),function(){b.util.getScript=function(t,e){var i=b.document.getElementsByTagName("head")[0],n=b.document.createElement("script"),r=!0;n.onload=n.onreadystatechange=function(t){if(r){if("string"==typeof this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState)return;r=!1,e(t||b.window.event),n=n.onload=n.onreadystatechange=null}},n.src=t,i.appendChild(n)}}(),b.util.getById=function(t){return"string"==typeof t?b.document.getElementById(t):t},b.util.toArray=n,b.util.makeElement=r,b.util.addClass=function(t,e){t&&-1===(" "+t.className+" ").indexOf(" "+e+" ")&&(t.className+=(t.className?" ":"")+e)},b.util.wrapElement=function(t,e,i){return"string"==typeof e&&(e=r(e,i)),t.parentNode&&t.parentNode.replaceChild(e,t),e.appendChild(t),e},b.util.getScrollLeftTop=s,b.util.getElementOffset=function(t){var e,n,r=t&&t.ownerDocument,a={left:0,top:0},o={left:0,top:0},h={borderLeftWidth:"left",borderTopWidth:"top",paddingLeft:"left",paddingTop:"top"};if(!r)return o;for(var c in h)o[h[c]]+=parseInt(i(t,c),10)||0;return e=r.documentElement,void 0!==t.getBoundingClientRect&&(a=t.getBoundingClientRect()),n=s(t),{left:a.left+n.left-(e.clientLeft||0)+o.left,top:a.top+n.top-(e.clientTop||0)+o.top}},b.util.getElementStyle=i,b.util.getNodeCanvas=function(t){var e=b.jsdomImplForWrapper(t);return e._canvas||e._image},b.util.cleanUpJsdomNode=function(t){if(b.isLikelyNode){var e=b.jsdomImplForWrapper(t);e&&(e._image=null,e._canvas=null,e._currentSrc=null,e._attributes=null,e._classList=null)}}}(),function(){function t(){}b.util.request=function(e,i){i||(i={});var n=i.method?i.method.toUpperCase():"GET",r=i.onComplete||function(){},s=new b.window.XMLHttpRequest,a=i.body||i.parameters;return s.onreadystatechange=function(){4===s.readyState&&(r(s),s.onreadystatechange=t)},"GET"===n&&(a=null,"string"==typeof i.parameters&&(e=function(t,e){return t+(/\?/.test(t)?"&":"?")+e}(e,i.parameters))),s.open(n,e,!0),"POST"!==n&&"PUT"!==n||s.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),s.send(a),s}}(),b.log=function(){},b.warn=function(){},"undefined"!=typeof console&&["log","warn"].forEach(function(t){void 0!==console[t]&&"function"==typeof console[t].apply&&(b[t]=function(){return console[t].apply(console,arguments)})}),function(){function t(){return!1}var e=b.window.requestAnimationFrame||b.window.webkitRequestAnimationFrame||b.window.mozRequestAnimationFrame||b.window.oRequestAnimationFrame||b.window.msRequestAnimationFrame||function(t){return b.window.setTimeout(t,1e3/60)},i=b.window.cancelAnimationFrame||b.window.clearTimeout;function n(){return e.apply(b.window,arguments)}b.util.animate=function(e){n(function(i){e||(e={});var r,s=i||+new Date,a=e.duration||500,o=s+a,h=e.onChange||t,c=e.abort||t,l=e.onComplete||t,u=e.easing||function(t,e,i,n){return-i*Math.cos(t/n*(Math.PI/2))+i+e},f="startValue"in e?e.startValue:0,d="endValue"in e?e.endValue:100,p=e.byValue||d-f;e.onStart&&e.onStart(),function t(i){if(c())l(d,1,1);else{var g=(r=i||+new Date)>o?a:r-s,v=g/a,_=u(g,f,p,a),m=Math.abs((_-f)/p);h(_,m,v),r>o?e.onComplete&&e.onComplete():n(t)}}(s)})},b.util.requestAnimFrame=n,b.util.cancelAnimFrame=function(){return i.apply(b.window,arguments)}}(),function(){b.util.animateColor=function(t,e,i,n){var r=new b.Color(t).getSource(),s=new b.Color(e).getSource();n=n||{},b.util.animate(b.util.object.extend(n,{duration:i||500,startValue:r,endValue:s,byValue:s,easing:function(t,e,i,r){var s,a,o,h,c=n.colorEasing?n.colorEasing(t,r):1-Math.cos(t/r*(Math.PI/2));return s=e,a=i,o=c,h="rgba("+parseInt(s[0]+o*(a[0]-s[0]),10)+","+parseInt(s[1]+o*(a[1]-s[1]),10)+","+parseInt(s[2]+o*(a[2]-s[2]),10),h+=","+(s&&a?parseFloat(s[3]+o*(a[3]-s[3])):1),h+=")"}}))}}(),function(){function t(t,e,i,n){return t<Math.abs(e)?(t=e,n=i/4):n=0===e&&0===t?i/(2*Math.PI)*Math.asin(1):i/(2*Math.PI)*Math.asin(e/t),{a:t,c:e,p:i,s:n}}function e(t,e,i){return t.a*Math.pow(2,10*(e-=1))*Math.sin((e*i-t.s)*(2*Math.PI)/t.p)}function i(t,e,i,r){return i-n(r-t,0,i,r)+e}function n(t,e,i,n){return(t/=n)<1/2.75?i*(7.5625*t*t)+e:t<2/2.75?i*(7.5625*(t-=1.5/2.75)*t+.75)+e:t<2.5/2.75?i*(7.5625*(t-=2.25/2.75)*t+.9375)+e:i*(7.5625*(t-=2.625/2.75)*t+.984375)+e}b.util.ease={easeInQuad:function(t,e,i,n){return i*(t/=n)*t+e},easeOutQuad:function(t,e,i,n){return-i*(t/=n)*(t-2)+e},easeInOutQuad:function(t,e,i,n){return(t/=n/2)<1?i/2*t*t+e:-i/2*(--t*(t-2)-1)+e},easeInCubic:function(t,e,i,n){return i*(t/=n)*t*t+e},easeOutCubic:function(t,e,i,n){return i*((t=t/n-1)*t*t+1)+e},easeInOutCubic:function(t,e,i,n){return(t/=n/2)<1?i/2*t*t*t+e:i/2*((t-=2)*t*t+2)+e},easeInQuart:function(t,e,i,n){return i*(t/=n)*t*t*t+e},easeOutQuart:function(t,e,i,n){return-i*((t=t/n-1)*t*t*t-1)+e},easeInOutQuart:function(t,e,i,n){return(t/=n/2)<1?i/2*t*t*t*t+e:-i/2*((t-=2)*t*t*t-2)+e},easeInQuint:function(t,e,i,n){return i*(t/=n)*t*t*t*t+e},easeOutQuint:function(t,e,i,n){return i*((t=t/n-1)*t*t*t*t+1)+e},easeInOutQuint:function(t,e,i,n){return(t/=n/2)<1?i/2*t*t*t*t*t+e:i/2*((t-=2)*t*t*t*t+2)+e},easeInSine:function(t,e,i,n){return-i*Math.cos(t/n*(Math.PI/2))+i+e},easeOutSine:function(t,e,i,n){return i*Math.sin(t/n*(Math.PI/2))+e},easeInOutSine:function(t,e,i,n){return-i/2*(Math.cos(Math.PI*t/n)-1)+e},easeInExpo:function(t,e,i,n){return 0===t?e:i*Math.pow(2,10*(t/n-1))+e},easeOutExpo:function(t,e,i,n){return t===n?e+i:i*(1-Math.pow(2,-10*t/n))+e},easeInOutExpo:function(t,e,i,n){return 0===t?e:t===n?e+i:(t/=n/2)<1?i/2*Math.pow(2,10*(t-1))+e:i/2*(2-Math.pow(2,-10*--t))+e},easeInCirc:function(t,e,i,n){return-i*(Math.sqrt(1-(t/=n)*t)-1)+e},easeOutCirc:function(t,e,i,n){return i*Math.sqrt(1-(t=t/n-1)*t)+e},easeInOutCirc:function(t,e,i,n){return(t/=n/2)<1?-i/2*(Math.sqrt(1-t*t)-1)+e:i/2*(Math.sqrt(1-(t-=2)*t)+1)+e},easeInElastic:function(i,n,r,s){var a=0;return 0===i?n:1==(i/=s)?n+r:(a||(a=.3*s),-e(t(r,r,a,1.70158),i,s)+n)},easeOutElastic:function(e,i,n,r){var s=0;if(0===e)return i;if(1==(e/=r))return i+n;s||(s=.3*r);var a=t(n,n,s,1.70158);return a.a*Math.pow(2,-10*e)*Math.sin((e*r-a.s)*(2*Math.PI)/a.p)+a.c+i},easeInOutElastic:function(i,n,r,s){var a=0;if(0===i)return n;if(2==(i/=s/2))return n+r;a||(a=s*(.3*1.5));var o=t(r,r,a,1.70158);return i<1?-.5*e(o,i,s)+n:o.a*Math.pow(2,-10*(i-=1))*Math.sin((i*s-o.s)*(2*Math.PI)/o.p)*.5+o.c+n},easeInBack:function(t,e,i,n,r){return void 0===r&&(r=1.70158),i*(t/=n)*t*((r+1)*t-r)+e},easeOutBack:function(t,e,i,n,r){return void 0===r&&(r=1.70158),i*((t=t/n-1)*t*((r+1)*t+r)+1)+e},easeInOutBack:function(t,e,i,n,r){return void 0===r&&(r=1.70158),(t/=n/2)<1?i/2*(t*t*((1+(r*=1.525))*t-r))+e:i/2*((t-=2)*t*((1+(r*=1.525))*t+r)+2)+e},easeInBounce:i,easeOutBounce:n,easeInOutBounce:function(t,e,r,s){return t<s/2?.5*i(2*t,0,r,s)+e:.5*n(2*t-s,0,r,s)+.5*r+e}}}(),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.extend,n=e.util.object.clone,r=e.util.toFixed,s=e.util.parseUnit,a=e.util.multiplyTransformMatrices,o={cx:"left",x:"left",r:"radius",cy:"top",y:"top",display:"visible",visibility:"visible",transform:"transformMatrix","fill-opacity":"fillOpacity","fill-rule":"fillRule","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight","letter-spacing":"charSpacing","paint-order":"paintFirst","stroke-dasharray":"strokeDashArray","stroke-linecap":"strokeLineCap","stroke-linejoin":"strokeLineJoin","stroke-miterlimit":"strokeMiterLimit","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","text-decoration":"textDecoration","text-anchor":"textAnchor",opacity:"opacity","clip-path":"clipPath","clip-rule":"clipRule"},h={stroke:"strokeOpacity",fill:"fillOpacity"};function c(t){return t in o?o[t]:t}function l(t,i,n,r){var o,h="[object Array]"===Object.prototype.toString.call(i);if("fill"!==t&&"stroke"!==t||"none"!==i)if("strokeDashArray"===t)i="none"===i?null:i.replace(/,/g," ").split(/\s+/).map(function(t){return parseFloat(t)});else if("transformMatrix"===t)i=n&&n.transformMatrix?a(n.transformMatrix,e.parseTransformAttribute(i)):e.parseTransformAttribute(i);else if("visible"===t)i="none"!==i&&"hidden"!==i,n&&!1===n.visible&&(i=!1);else if("opacity"===t)i=parseFloat(i),n&&void 0!==n.opacity&&(i*=n.opacity);else if("textAnchor"===t)i="start"===i?"left":"end"===i?"right":"center";else if("charSpacing"===t)o=s(i,r)/r*1e3;else if("paintFirst"===t){var c=i.indexOf("fill"),l=i.indexOf("stroke");i="fill";c>-1&&l>-1&&l<c?i="stroke":-1===c&&l>-1&&(i="stroke")}else o=h?i.map(s):s(i,r);else i="";return!h&&isNaN(o)?i:o}function u(t){return new RegExp("^("+t.join("|")+")\\b","i")}function f(t,e){var i,n,r,s,a=[];for(r=0,s=e.length;r<s;r++)i=e[r],n=t.getElementsByTagName(i),a=a.concat(Array.prototype.slice.call(n));return a}function d(t,e){var i,n=!0;return(i=p(t,e.pop()))&&e.length&&(n=function(t,e){var i,n=!0;for(;t.parentNode&&1===t.parentNode.nodeType&&e.length;)n&&(i=e.pop()),t=t.parentNode,n=p(t,i);return 0===e.length}(t,e)),i&&n&&0===e.length}function p(t,e){var i,n,r=t.nodeName,s=t.getAttribute("class"),a=t.getAttribute("id");if(i=new RegExp("^"+r,"i"),e=e.replace(i,""),a&&e.length&&(i=new RegExp("#"+a+"(?![a-zA-Z\\-]+)","i"),e=e.replace(i,"")),s&&e.length)for(n=(s=s.split(" ")).length;n--;)i=new RegExp("\\."+s[n]+"(?![a-zA-Z\\-]+)","i"),e=e.replace(i,"");return 0===e.length}function g(t,e){var i;if(t.getElementById&&(i=t.getElementById(e)),i)return i;var n,r,s,a=t.getElementsByTagName("*");for(r=0,s=a.length;r<s;r++)if(e===(n=a[r]).getAttribute("id"))return n}e.svgValidTagNamesRegEx=u(["path","circle","polygon","polyline","ellipse","rect","line","image","text"]),e.svgViewBoxElementsRegEx=u(["symbol","image","marker","pattern","view","svg"]),e.svgInvalidAncestorsRegEx=u(["pattern","defs","symbol","metadata","clipPath","mask","desc"]),e.svgValidParentsRegEx=u(["symbol","g","a","svg","clipPath","defs"]),e.cssRules={},e.gradientDefs={},e.clipPaths={},e.parseTransformAttribute=function(){function t(t,i,n){t[n]=Math.tan(e.util.degreesToRadians(i[0]))}var i=[1,0,0,1,0,0],n=e.reNum,r="(?:\\s+,?\\s*|,\\s*)",s="(?:"+("(?:(matrix)\\s*\\(\\s*("+n+")"+r+"("+n+")"+r+"("+n+")"+r+"("+n+")"+r+"("+n+")"+r+"("+n+")\\s*\\))")+"|"+("(?:(translate)\\s*\\(\\s*("+n+")(?:"+r+"("+n+"))?\\s*\\))")+"|"+("(?:(scale)\\s*\\(\\s*("+n+")(?:"+r+"("+n+"))?\\s*\\))")+"|"+("(?:(rotate)\\s*\\(\\s*("+n+")(?:"+r+"("+n+")"+r+"("+n+"))?\\s*\\))")+"|"+("(?:(skewX)\\s*\\(\\s*("+n+")\\s*\\))")+"|"+("(?:(skewY)\\s*\\(\\s*("+n+")\\s*\\))")+")",a=new RegExp("^\\s*(?:"+("(?:"+s+"(?:"+r+"*"+s+")*)")+"?)\\s*$"),o=new RegExp(s,"g");return function(n){var r=i.concat(),h=[];if(!n||n&&!a.test(n))return r;n.replace(o,function(n){var a=new RegExp(s).exec(n).filter(function(t){return!!t}),o=a[1],c=a.slice(2).map(parseFloat);switch(o){case"translate":!function(t,e){t[4]=e[0],2===e.length&&(t[5]=e[1])}(r,c);break;case"rotate":c[0]=e.util.degreesToRadians(c[0]),function(t,i){var n=e.util.cos(i[0]),r=e.util.sin(i[0]),s=0,a=0;3===i.length&&(s=i[1],a=i[2]),t[0]=n,t[1]=r,t[2]=-r,t[3]=n,t[4]=s-(n*s-r*a),t[5]=a-(r*s+n*a)}(r,c);break;case"scale":!function(t,e){var i=e[0],n=2===e.length?e[1]:e[0];t[0]=i,t[3]=n}(r,c);break;case"skewX":t(r,c,2);break;case"skewY":t(r,c,1);break;case"matrix":r=c}h.push(r.concat()),r=i.concat()});for(var c=h[0];h.length>1;)h.shift(),c=e.util.multiplyTransformMatrices(c,h[0]);return c}}();var v=new RegExp("^\\s*("+e.reNum+"+)\\s*,?\\s*("+e.reNum+"+)\\s*,?\\s*("+e.reNum+"+)\\s*,?\\s*("+e.reNum+"+)\\s*$");function _(t){var i,n,r,a,o,h,c=t.getAttribute("viewBox"),l=1,u=1,f=t.getAttribute("width"),d=t.getAttribute("height"),p=t.getAttribute("x")||0,g=t.getAttribute("y")||0,_=t.getAttribute("preserveAspectRatio")||"",m=!c||!e.svgViewBoxElementsRegEx.test(t.nodeName)||!(c=c.match(v)),y=!f||!d||"100%"===f||"100%"===d,x=m&&y,b={},w="",C=0,S=0;if(b.width=0,b.height=0,b.toBeParsed=x,x)return b;if(m)return b.width=s(f),b.height=s(d),b;if(i=-parseFloat(c[1]),n=-parseFloat(c[2]),r=parseFloat(c[3]),a=parseFloat(c[4]),y?(b.width=r,b.height=a):(b.width=s(f),b.height=s(d),l=b.width/r,u=b.height/a),"none"!==(_=e.util.parsePreserveAspectRatioAttribute(_)).alignX&&("meet"===_.meetOrSlice&&(u=l=l>u?u:l),"slice"===_.meetOrSlice&&(u=l=l>u?l:u),C=b.width-r*l,S=b.height-a*l,"Mid"===_.alignX&&(C/=2),"Mid"===_.alignY&&(S/=2),"Min"===_.alignX&&(C=0),"Min"===_.alignY&&(S=0)),1===l&&1===u&&0===i&&0===n&&0===p&&0===g)return b;if((p||g)&&(w=" translate("+s(p)+" "+s(g)+") "),o=w+" matrix("+l+" 0 0 "+u+" "+(i*l+C)+" "+(n*u+S)+") ",b.viewboxTransform=e.parseTransformAttribute(o),"svg"===t.nodeName){for(h=t.ownerDocument.createElement("g");t.firstChild;)h.appendChild(t.firstChild);t.appendChild(h)}else o=(h=t).getAttribute("transform")+o;return h.setAttribute("transform",o),b}e.parseSVGDocument=function(t,i,r,s){if(t){!function(t){for(var e=f(t,["use","svg:use"]),i=0;e.length&&i<e.length;){var n,r,s,a,o=e[i],h=(o.getAttribute("xlink:href")||o.getAttribute("href")).substr(1),c=o.getAttribute("x")||0,l=o.getAttribute("y")||0,u=g(t,h).cloneNode(!0),d=(u.getAttribute("transform")||"")+" translate("+c+", "+l+")",p=e.length;if(_(u),/^svg$/i.test(u.nodeName)){var v=u.ownerDocument.createElement("g");for(r=0,a=(s=u.attributes).length;r<a;r++)n=s.item(r),v.setAttribute(n.nodeName,n.nodeValue);for(;u.firstChild;)v.appendChild(u.firstChild);u=v}for(r=0,a=(s=o.attributes).length;r<a;r++)"x"!==(n=s.item(r)).nodeName&&"y"!==n.nodeName&&"xlink:href"!==n.nodeName&&"href"!==n.nodeName&&("transform"===n.nodeName?d=n.nodeValue+" "+d:u.setAttribute(n.nodeName,n.nodeValue));u.setAttribute("transform",d),u.setAttribute("instantiated_by_use","1"),u.removeAttribute("id"),o.parentNode.replaceChild(u,o),e.length===p&&i++}}(t);var a,o,h=e.Object.__uid++,c=_(t),l=e.util.toArray(t.getElementsByTagName("*"));if(c.crossOrigin=s&&s.crossOrigin,c.svgUid=h,0===l.length&&e.isLikelyNode){var u=[];for(a=0,o=(l=t.selectNodes('//*[name(.)!="svg"]')).length;a<o;a++)u[a]=l[a];l=u}var d=l.filter(function(t){return _(t),e.svgValidTagNamesRegEx.test(t.nodeName.replace("svg:",""))&&!function(t,e){for(;t&&(t=t.parentNode);)if(t.nodeName&&e.test(t.nodeName.replace("svg:",""))&&!t.getAttribute("instantiated_by_use"))return!0;return!1}(t,e.svgInvalidAncestorsRegEx)});if(!d||d&&!d.length)i&&i([],{});else{var p={};l.filter(function(t){return"clipPath"===t.nodeName.replace("svg:","")}).forEach(function(t){var i=t.getAttribute("id");p[i]=e.util.toArray(t.getElementsByTagName("*")).filter(function(t){return e.svgValidTagNamesRegEx.test(t.nodeName.replace("svg:",""))})}),e.gradientDefs[h]=e.getGradientDefs(t),e.cssRules[h]=e.getCSSRules(t),e.clipPaths[h]=p,e.parseElements(d,function(t,n){i&&(i(t,c,n,l),delete e.gradientDefs[h],delete e.cssRules[h],delete e.clipPaths[h])},n(c),r,s)}}};var m=new RegExp("(normal|italic)?\\s*(normal|small-caps)?\\s*(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\\s*("+e.reNum+"(?:px|cm|mm|em|pt|pc|in)*)(?:\\/(normal|"+e.reNum+"))?\\s+(.*)");i(e,{parseFontDeclaration:function(t,e){var i=t.match(m);if(i){var n=i[1],r=i[3],a=i[4],o=i[5],h=i[6];n&&(e.fontStyle=n),r&&(e.fontWeight=isNaN(parseFloat(r))?r:parseFloat(r)),a&&(e.fontSize=s(a)),h&&(e.fontFamily=h),o&&(e.lineHeight="normal"===o?1:o)}},getGradientDefs:function(t){var e,i,n,r=f(t,["linearGradient","radialGradient","svg:linearGradient","svg:radialGradient"]),s=0,a={},o={};for(s=r.length;s--;)n=(e=r[s]).getAttribute("xlink:href"),i=e.getAttribute("id"),n&&(o[i]=n.substr(1)),a[i]=e;for(i in o){var h=a[o[i]].cloneNode(!0);for(e=a[i];h.firstChild;)e.appendChild(h.firstChild)}return a},parseAttributes:function(t,n,s){if(t){var a,o,u={};void 0===s&&(s=t.getAttribute("svgUid")),t.parentNode&&e.svgValidParentsRegEx.test(t.parentNode.nodeName)&&(u=e.parseAttributes(t.parentNode,n,s));var f=n.reduce(function(e,i){return(a=t.getAttribute(i))&&(e[i]=a),e},{});f=i(f,i(function(t,i){var n={};for(var r in e.cssRules[i])if(d(t,r.split(" ")))for(var s in e.cssRules[i][r])n[s]=e.cssRules[i][r][s];return n}(t,s),e.parseStyleAttribute(t))),o=u&&u.fontSize||f["font-size"]||e.Text.DEFAULT_SVG_FONT_SIZE;var p,g,v={};for(var _ in f)g=l(p=c(_),f[_],u,o),v[p]=g;v&&v.font&&e.parseFontDeclaration(v.font,v);var m=i(u,v);return e.svgValidParentsRegEx.test(t.nodeName)?m:function(t){for(var i in h)if(void 0!==t[h[i]]&&""!==t[i]){if(void 0===t[i]){if(!e.Object.prototype[i])continue;t[i]=e.Object.prototype[i]}if(0!==t[i].indexOf("url(")){var n=new e.Color(t[i]);t[i]=n.setAlpha(r(n.getAlpha()*t[h[i]],2)).toRgba()}}return t}(m)}},parseElements:function(t,i,n,r,s){new e.ElementsParser(t,i,n,r,s).parse()},parseStyleAttribute:function(t){var e={},i=t.getAttribute("style");return i?("string"==typeof i?function(t,e){var i,n;t.replace(/;\s*$/,"").split(";").forEach(function(t){var r=t.split(":");i=r[0].trim().toLowerCase(),n=r[1].trim(),e[i]=n})}(i,e):function(t,e){var i,n;for(var r in t)void 0!==t[r]&&(i=r.toLowerCase(),n=t[r],e[i]=n)}(i,e),e):e},parsePointsAttribute:function(t){if(!t)return null;var e,i,n=[];for(e=0,i=(t=(t=t.replace(/,/g," ").trim()).split(/\s+/)).length;e<i;e+=2)n.push({x:parseFloat(t[e]),y:parseFloat(t[e+1])});return n},getCSSRules:function(t){var i,n,r=t.getElementsByTagName("style"),s={};for(i=0,n=r.length;i<n;i++){var a=r[i].textContent||r[i].text;""!==(a=a.replace(/\/\*[\s\S]*?\*\//g,"")).trim()&&a.match(/[^{]*\{[\s\S]*?\}/g).map(function(t){return t.trim()}).forEach(function(t){var r=t.match(/([\s\S]*?)\s*\{([^}]*)\}/),a={},o=r[2].trim().replace(/;$/,"").split(/\s*;\s*/);for(i=0,n=o.length;i<n;i++){var h=o[i].split(/\s*:\s*/),c=h[0],l=h[1];a[c]=l}(t=r[1]).split(",").forEach(function(t){""!==(t=t.replace(/^svg/i,"").trim())&&(s[t]?e.util.object.extend(s[t],a):s[t]=e.util.object.clone(a))})})}return s},loadSVGFromURL:function(t,i,n,r){t=t.replace(/^\n\s*/,"").trim(),new e.util.request(t,{method:"get",onComplete:function(t){var s=t.responseXML;s&&!s.documentElement&&e.window.ActiveXObject&&t.responseText&&((s=new ActiveXObject("Microsoft.XMLDOM")).async="false",s.loadXML(t.responseText.replace(/<!DOCTYPE[\s\S]*?(\[[\s\S]*\])*?>/i,"")));if(!s||!s.documentElement)return i&&i(null),!1;e.parseSVGDocument(s.documentElement,function(t,e,n,r){i&&i(t,e,n,r)},n,r)}})},loadSVGFromString:function(t,i,n,r){var s;if(t=t.trim(),"undefined"!=typeof DOMParser){var a=new DOMParser;a&&a.parseFromString&&(s=a.parseFromString(t,"text/xml"))}else e.window.ActiveXObject&&((s=new ActiveXObject("Microsoft.XMLDOM")).async="false",s.loadXML(t.replace(/<!DOCTYPE[\s\S]*?(\[[\s\S]*\])*?>/i,"")));e.parseSVGDocument(s.documentElement,function(t,e,n,r){i(t,e,n,r)},n,r)}})}(e),b.ElementsParser=function(t,e,i,n,r){this.elements=t,this.callback=e,this.options=i,this.reviver=n,this.svgUid=i&&i.svgUid||0,this.parsingOptions=r,this.regexUrl=/^url\(['"]?#([^'"]+)['"]?\)/g},(l=b.ElementsParser.prototype).parse=function(){this.instances=new Array(this.elements.length),this.numElements=this.elements.length,this.createObjects()},l.createObjects=function(){var t=this;this.elements.forEach(function(e,i){e.setAttribute("svgUid",t.svgUid),t.createObject(e,i)})},l.findTag=function(t){return b[b.util.string.capitalize(t.tagName.replace("svg:",""))]},l.createObject=function(t,e){var i=this.findTag(t);if(i&&i.fromElement)try{i.fromElement(t,this.createCallback(e,t),this.options)}catch(t){b.log(t)}else this.checkIfDone()},l.createCallback=function(t,e){var i=this;return function(n){var r;i.resolveGradient(n,"fill"),i.resolveGradient(n,"stroke"),n instanceof b.Image&&(r=n.parsePreserveAspectRatioAttribute(e)),n._removeTransformMatrix(r),i.resolveClipPath(n),i.reviver&&i.reviver(e,n),i.instances[t]=n,i.checkIfDone()}},l.extractPropertyDefinition=function(t,e,i){var n=t[e];if(/^url\(/.test(n)){var r=this.regexUrl.exec(n)[1];return this.regexUrl.lastIndex=0,b[i][this.svgUid][r]}},l.resolveGradient=function(t,e){var i=this.extractPropertyDefinition(t,e,"gradientDefs");i&&t.set(e,b.Gradient.fromElement(i,t))},l.createClipPathCallback=function(t,e){return function(t){t._removeTransformMatrix(),t.fillRule=t.clipRule,e.push(t)}},l.resolveClipPath=function(t){var e,i,n,r,s=this.extractPropertyDefinition(t,"clipPath","clipPaths");if(s){n=[],i=b.util.invertTransform(t.calcTransformMatrix());for(var a=0;a<s.length;a++)e=s[a],this.findTag(e).fromElement(e,this.createClipPathCallback(t,n),this.options);s=1===n.length?n[0]:new b.Group(n),r=b.util.multiplyTransformMatrices(i,s.calcTransformMatrix());var o=b.util.qrDecompose(r);s.flipX=!1,s.flipY=!1,s.set("scaleX",o.scaleX),s.set("scaleY",o.scaleY),s.angle=o.angle,s.skewX=o.skewX,s.skewY=0,s.setPositionByOrigin({x:o.translateX,y:o.translateY},"center","center"),t.clipPath=s}},l.checkIfDone=function(){0==--this.numElements&&(this.instances=this.instances.filter(function(t){return null!=t}),this.callback(this.instances,this.elements))},function(t){"use strict";var e=t.fabric||(t.fabric={});function i(t,e){this.x=t,this.y=e}e.Point?e.warn("fabric.Point is already defined"):(e.Point=i,i.prototype={type:"point",constructor:i,add:function(t){return new i(this.x+t.x,this.y+t.y)},addEquals:function(t){return this.x+=t.x,this.y+=t.y,this},scalarAdd:function(t){return new i(this.x+t,this.y+t)},scalarAddEquals:function(t){return this.x+=t,this.y+=t,this},subtract:function(t){return new i(this.x-t.x,this.y-t.y)},subtractEquals:function(t){return this.x-=t.x,this.y-=t.y,this},scalarSubtract:function(t){return new i(this.x-t,this.y-t)},scalarSubtractEquals:function(t){return this.x-=t,this.y-=t,this},multiply:function(t){return new i(this.x*t,this.y*t)},multiplyEquals:function(t){return this.x*=t,this.y*=t,this},divide:function(t){return new i(this.x/t,this.y/t)},divideEquals:function(t){return this.x/=t,this.y/=t,this},eq:function(t){return this.x===t.x&&this.y===t.y},lt:function(t){return this.x<t.x&&this.y<t.y},lte:function(t){return this.x<=t.x&&this.y<=t.y},gt:function(t){return this.x>t.x&&this.y>t.y},gte:function(t){return this.x>=t.x&&this.y>=t.y},lerp:function(t,e){return void 0===e&&(e=.5),e=Math.max(Math.min(1,e),0),new i(this.x+(t.x-this.x)*e,this.y+(t.y-this.y)*e)},distanceFrom:function(t){var e=this.x-t.x,i=this.y-t.y;return Math.sqrt(e*e+i*i)},midPointFrom:function(t){return this.lerp(t)},min:function(t){return new i(Math.min(this.x,t.x),Math.min(this.y,t.y))},max:function(t){return new i(Math.max(this.x,t.x),Math.max(this.y,t.y))},toString:function(){return this.x+","+this.y},setXY:function(t,e){return this.x=t,this.y=e,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setFromPoint:function(t){return this.x=t.x,this.y=t.y,this},swap:function(t){var e=this.x,i=this.y;this.x=t.x,this.y=t.y,t.x=e,t.y=i},clone:function(){return new i(this.x,this.y)}})}(e),function(t){"use strict";var e=t.fabric||(t.fabric={});function i(t){this.status=t,this.points=[]}e.Intersection?e.warn("fabric.Intersection is already defined"):(e.Intersection=i,e.Intersection.prototype={constructor:i,appendPoint:function(t){return this.points.push(t),this},appendPoints:function(t){return this.points=this.points.concat(t),this}},e.Intersection.intersectLineLine=function(t,n,r,s){var a,o=(s.x-r.x)*(t.y-r.y)-(s.y-r.y)*(t.x-r.x),h=(n.x-t.x)*(t.y-r.y)-(n.y-t.y)*(t.x-r.x),c=(s.y-r.y)*(n.x-t.x)-(s.x-r.x)*(n.y-t.y);if(0!==c){var l=o/c,u=h/c;0<=l&&l<=1&&0<=u&&u<=1?(a=new i("Intersection")).appendPoint(new e.Point(t.x+l*(n.x-t.x),t.y+l*(n.y-t.y))):a=new i}else a=new i(0===o||0===h?"Coincident":"Parallel");return a},e.Intersection.intersectLinePolygon=function(t,e,n){var r,s,a,o,h=new i,c=n.length;for(o=0;o<c;o++)r=n[o],s=n[(o+1)%c],a=i.intersectLineLine(t,e,r,s),h.appendPoints(a.points);return h.points.length>0&&(h.status="Intersection"),h},e.Intersection.intersectPolygonPolygon=function(t,e){var n,r=new i,s=t.length;for(n=0;n<s;n++){var a=t[n],o=t[(n+1)%s],h=i.intersectLinePolygon(a,o,e);r.appendPoints(h.points)}return r.points.length>0&&(r.status="Intersection"),r},e.Intersection.intersectPolygonRectangle=function(t,n,r){var s=n.min(r),a=n.max(r),o=new e.Point(a.x,s.y),h=new e.Point(s.x,a.y),c=i.intersectLinePolygon(s,o,t),l=i.intersectLinePolygon(o,a,t),u=i.intersectLinePolygon(a,h,t),f=i.intersectLinePolygon(h,s,t),d=new i;return d.appendPoints(c.points),d.appendPoints(l.points),d.appendPoints(u.points),d.appendPoints(f.points),d.points.length>0&&(d.status="Intersection"),d})}(e),function(t){"use strict";var e=t.fabric||(t.fabric={});function i(t){t?this._tryParsingColor(t):this.setSource([0,0,0,1])}function n(t,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?t+6*(e-t)*i:i<.5?e:i<2/3?t+(e-t)*(2/3-i)*6:t}e.Color?e.warn("fabric.Color is already defined."):(e.Color=i,e.Color.prototype={_tryParsingColor:function(t){var e;t in i.colorNameMap&&(t=i.colorNameMap[t]),"transparent"===t&&(e=[255,255,255,0]),e||(e=i.sourceFromHex(t)),e||(e=i.sourceFromRgb(t)),e||(e=i.sourceFromHsl(t)),e||(e=[0,0,0,1]),e&&this.setSource(e)},_rgbToHsl:function(t,i,n){t/=255,i/=255,n/=255;var r,s,a,o=e.util.array.max([t,i,n]),h=e.util.array.min([t,i,n]);if(a=(o+h)/2,o===h)r=s=0;else{var c=o-h;switch(s=a>.5?c/(2-o-h):c/(o+h),o){case t:r=(i-n)/c+(i<n?6:0);break;case i:r=(n-t)/c+2;break;case n:r=(t-i)/c+4}r/=6}return[Math.round(360*r),Math.round(100*s),Math.round(100*a)]},getSource:function(){return this._source},setSource:function(t){this._source=t},toRgb:function(){var t=this.getSource();return"rgb("+t[0]+","+t[1]+","+t[2]+")"},toRgba:function(){var t=this.getSource();return"rgba("+t[0]+","+t[1]+","+t[2]+","+t[3]+")"},toHsl:function(){var t=this.getSource(),e=this._rgbToHsl(t[0],t[1],t[2]);return"hsl("+e[0]+","+e[1]+"%,"+e[2]+"%)"},toHsla:function(){var t=this.getSource(),e=this._rgbToHsl(t[0],t[1],t[2]);return"hsla("+e[0]+","+e[1]+"%,"+e[2]+"%,"+t[3]+")"},toHex:function(){var t,e,i,n=this.getSource();return t=1===(t=n[0].toString(16)).length?"0"+t:t,e=1===(e=n[1].toString(16)).length?"0"+e:e,i=1===(i=n[2].toString(16)).length?"0"+i:i,t.toUpperCase()+e.toUpperCase()+i.toUpperCase()},toHexa:function(){var t,e=this.getSource();return t=1===(t=(t=Math.round(255*e[3])).toString(16)).length?"0"+t:t,this.toHex()+t.toUpperCase()},getAlpha:function(){return this.getSource()[3]},setAlpha:function(t){var e=this.getSource();return e[3]=t,this.setSource(e),this},toGrayscale:function(){var t=this.getSource(),e=parseInt((.3*t[0]+.59*t[1]+.11*t[2]).toFixed(0),10),i=t[3];return this.setSource([e,e,e,i]),this},toBlackWhite:function(t){var e=this.getSource(),i=(.3*e[0]+.59*e[1]+.11*e[2]).toFixed(0),n=e[3];return t=t||127,i=Number(i)<Number(t)?0:255,this.setSource([i,i,i,n]),this},overlayWith:function(t){t instanceof i||(t=new i(t));var e,n=[],r=this.getAlpha(),s=this.getSource(),a=t.getSource();for(e=0;e<3;e++)n.push(Math.round(.5*s[e]+.5*a[e]));return n[3]=r,this.setSource(n),this}},e.Color.reRGBa=/^rgba?\(\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*(?:\s*,\s*((?:\d*\.?\d+)?)\s*)?\)$/i,e.Color.reHSLa=/^hsla?\(\s*(\d{1,3})\s*,\s*(\d{1,3}\%)\s*,\s*(\d{1,3}\%)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/i,e.Color.reHex=/^#?([0-9a-f]{8}|[0-9a-f]{6}|[0-9a-f]{4}|[0-9a-f]{3})$/i,e.Color.colorNameMap={aliceblue:"#F0F8FF",antiquewhite:"#FAEBD7",aqua:"#00FFFF",aquamarine:"#7FFFD4",azure:"#F0FFFF",beige:"#F5F5DC",bisque:"#FFE4C4",black:"#000000",blanchedalmond:"#FFEBCD",blue:"#0000FF",blueviolet:"#8A2BE2",brown:"#A52A2A",burlywood:"#DEB887",cadetblue:"#5F9EA0",chartreuse:"#7FFF00",chocolate:"#D2691E",coral:"#FF7F50",cornflowerblue:"#6495ED",cornsilk:"#FFF8DC",crimson:"#DC143C",cyan:"#00FFFF",darkblue:"#00008B",darkcyan:"#008B8B",darkgoldenrod:"#B8860B",darkgray:"#A9A9A9",darkgrey:"#A9A9A9",darkgreen:"#006400",darkkhaki:"#BDB76B",darkmagenta:"#8B008B",darkolivegreen:"#556B2F",darkorange:"#FF8C00",darkorchid:"#9932CC",darkred:"#8B0000",darksalmon:"#E9967A",darkseagreen:"#8FBC8F",darkslateblue:"#483D8B",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",darkturquoise:"#00CED1",darkviolet:"#9400D3",deeppink:"#FF1493",deepskyblue:"#00BFFF",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1E90FF",firebrick:"#B22222",floralwhite:"#FFFAF0",forestgreen:"#228B22",fuchsia:"#FF00FF",gainsboro:"#DCDCDC",ghostwhite:"#F8F8FF",gold:"#FFD700",goldenrod:"#DAA520",gray:"#808080",grey:"#808080",green:"#008000",greenyellow:"#ADFF2F",honeydew:"#F0FFF0",hotpink:"#FF69B4",indianred:"#CD5C5C",indigo:"#4B0082",ivory:"#FFFFF0",khaki:"#F0E68C",lavender:"#E6E6FA",lavenderblush:"#FFF0F5",lawngreen:"#7CFC00",lemonchiffon:"#FFFACD",lightblue:"#ADD8E6",lightcoral:"#F08080",lightcyan:"#E0FFFF",lightgoldenrodyellow:"#FAFAD2",lightgray:"#D3D3D3",lightgrey:"#D3D3D3",lightgreen:"#90EE90",lightpink:"#FFB6C1",lightsalmon:"#FFA07A",lightseagreen:"#20B2AA",lightskyblue:"#87CEFA",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#B0C4DE",lightyellow:"#FFFFE0",lime:"#00FF00",limegreen:"#32CD32",linen:"#FAF0E6",magenta:"#FF00FF",maroon:"#800000",mediumaquamarine:"#66CDAA",mediumblue:"#0000CD",mediumorchid:"#BA55D3",mediumpurple:"#9370DB",mediumseagreen:"#3CB371",mediumslateblue:"#7B68EE",mediumspringgreen:"#00FA9A",mediumturquoise:"#48D1CC",mediumvioletred:"#C71585",midnightblue:"#191970",mintcream:"#F5FFFA",mistyrose:"#FFE4E1",moccasin:"#FFE4B5",navajowhite:"#FFDEAD",navy:"#000080",oldlace:"#FDF5E6",olive:"#808000",olivedrab:"#6B8E23",orange:"#FFA500",orangered:"#FF4500",orchid:"#DA70D6",palegoldenrod:"#EEE8AA",palegreen:"#98FB98",paleturquoise:"#AFEEEE",palevioletred:"#DB7093",papayawhip:"#FFEFD5",peachpuff:"#FFDAB9",peru:"#CD853F",pink:"#FFC0CB",plum:"#DDA0DD",powderblue:"#B0E0E6",purple:"#800080",rebeccapurple:"#663399",red:"#FF0000",rosybrown:"#BC8F8F",royalblue:"#4169E1",saddlebrown:"#8B4513",salmon:"#FA8072",sandybrown:"#F4A460",seagreen:"#2E8B57",seashell:"#FFF5EE",sienna:"#A0522D",silver:"#C0C0C0",skyblue:"#87CEEB",slateblue:"#6A5ACD",slategray:"#708090",slategrey:"#708090",snow:"#FFFAFA",springgreen:"#00FF7F",steelblue:"#4682B4",tan:"#D2B48C",teal:"#008080",thistle:"#D8BFD8",tomato:"#FF6347",turquoise:"#40E0D0",violet:"#EE82EE",wheat:"#F5DEB3",white:"#FFFFFF",whitesmoke:"#F5F5F5",yellow:"#FFFF00",yellowgreen:"#9ACD32"},e.Color.fromRgb=function(t){return i.fromSource(i.sourceFromRgb(t))},e.Color.sourceFromRgb=function(t){var e=t.match(i.reRGBa);if(e){var n=parseInt(e[1],10)/(/%$/.test(e[1])?100:1)*(/%$/.test(e[1])?255:1),r=parseInt(e[2],10)/(/%$/.test(e[2])?100:1)*(/%$/.test(e[2])?255:1),s=parseInt(e[3],10)/(/%$/.test(e[3])?100:1)*(/%$/.test(e[3])?255:1);return[parseInt(n,10),parseInt(r,10),parseInt(s,10),e[4]?parseFloat(e[4]):1]}},e.Color.fromRgba=i.fromRgb,e.Color.fromHsl=function(t){return i.fromSource(i.sourceFromHsl(t))},e.Color.sourceFromHsl=function(t){var e=t.match(i.reHSLa);if(e){var r,s,a,o=(parseFloat(e[1])%360+360)%360/360,h=parseFloat(e[2])/(/%$/.test(e[2])?100:1),c=parseFloat(e[3])/(/%$/.test(e[3])?100:1);if(0===h)r=s=a=c;else{var l=c<=.5?c*(h+1):c+h-c*h,u=2*c-l;r=n(u,l,o+1/3),s=n(u,l,o),a=n(u,l,o-1/3)}return[Math.round(255*r),Math.round(255*s),Math.round(255*a),e[4]?parseFloat(e[4]):1]}},e.Color.fromHsla=i.fromHsl,e.Color.fromHex=function(t){return i.fromSource(i.sourceFromHex(t))},e.Color.sourceFromHex=function(t){if(t.match(i.reHex)){var e=t.slice(t.indexOf("#")+1),n=3===e.length||4===e.length,r=8===e.length||4===e.length,s=n?e.charAt(0)+e.charAt(0):e.substring(0,2),a=n?e.charAt(1)+e.charAt(1):e.substring(2,4),o=n?e.charAt(2)+e.charAt(2):e.substring(4,6),h=r?n?e.charAt(3)+e.charAt(3):e.substring(6,8):"FF";return[parseInt(s,16),parseInt(a,16),parseInt(o,16),parseFloat((parseInt(h,16)/255).toFixed(2))]}},e.Color.fromSource=function(t){var e=new i;return e.setSource(t),e})}(e),function(){function t(t){var e,i,n,r,s=t.getAttribute("style"),a=t.getAttribute("offset")||0;if(a=(a=parseFloat(a)/(/%$/.test(a)?100:1))<0?0:a>1?1:a,s){var o=s.split(/\s*;\s*/);for(""===o[o.length-1]&&o.pop(),r=o.length;r--;){var h=o[r].split(/\s*:\s*/),c=h[0].trim(),l=h[1].trim();"stop-color"===c?e=l:"stop-opacity"===c&&(n=l)}}return e||(e=t.getAttribute("stop-color")||"rgb(0,0,0)"),n||(n=t.getAttribute("stop-opacity")),i=(e=new b.Color(e)).getAlpha(),n=isNaN(parseFloat(n))?1:parseFloat(n),n*=i,{offset:a,color:e.toRgb(),opacity:n}}var e=b.util.object.clone;function i(t,e,i){var n,r=0,s=1,a="";for(var o in e)"Infinity"===e[o]?e[o]=1:"-Infinity"===e[o]&&(e[o]=0),n=parseFloat(e[o],10),s="string"==typeof e[o]&&/^(\d+\.\d+)%|(\d+)%$/.test(e[o])?.01:1,"x1"===o||"x2"===o||"r2"===o?(s*="objectBoundingBox"===i?t.width:1,r="objectBoundingBox"===i&&t.left||0):"y1"!==o&&"y2"!==o||(s*="objectBoundingBox"===i?t.height:1,r="objectBoundingBox"===i&&t.top||0),e[o]=n*s+r;if("ellipse"===t.type&&null!==e.r2&&"objectBoundingBox"===i&&t.rx!==t.ry){var h=t.ry/t.rx;a=" scale(1, "+h+")",e.y1&&(e.y1/=h),e.y2&&(e.y2/=h)}return a}b.Gradient=b.util.createClass({offsetX:0,offsetY:0,initialize:function(t){t||(t={});var e={};this.id=b.Object.__uid++,this.type=t.type||"linear",e={x1:t.coords.x1||0,y1:t.coords.y1||0,x2:t.coords.x2||0,y2:t.coords.y2||0},"radial"===this.type&&(e.r1=t.coords.r1||0,e.r2=t.coords.r2||0),this.coords=e,this.colorStops=t.colorStops.slice(),t.gradientTransform&&(this.gradientTransform=t.gradientTransform),this.offsetX=t.offsetX||this.offsetX,this.offsetY=t.offsetY||this.offsetY},addColorStop:function(t){for(var e in t){var i=new b.Color(t[e]);this.colorStops.push({offset:parseFloat(e),color:i.toRgb(),opacity:i.getAlpha()})}return this},toObject:function(t){var e={type:this.type,coords:this.coords,colorStops:this.colorStops,offsetX:this.offsetX,offsetY:this.offsetY,gradientTransform:this.gradientTransform?this.gradientTransform.concat():this.gradientTransform};return b.util.populateWithProperties(this,e,t),e},toSVG:function(t){var i,n,r,s,a=e(this.coords,!0),o=e(this.colorStops,!0),h=a.r1>a.r2,c=t.width/2,l=t.height/2;for(var u in o.sort(function(t,e){return t.offset-e.offset}),"path"===t.type&&(c-=t.pathOffset.x,l-=t.pathOffset.y),a)"x1"===u||"x2"===u?a[u]+=this.offsetX-c:"y1"!==u&&"y2"!==u||(a[u]+=this.offsetY-l);if(s='id="SVGID_'+this.id+'" gradientUnits="userSpaceOnUse"',this.gradientTransform&&(s+=' gradientTransform="matrix('+this.gradientTransform.join(" ")+')" '),"linear"===this.type?r=["<linearGradient ",s,' x1="',a.x1,'" y1="',a.y1,'" x2="',a.x2,'" y2="',a.y2,'">\n']:"radial"===this.type&&(r=["<radialGradient ",s,' cx="',h?a.x1:a.x2,'" cy="',h?a.y1:a.y2,'" r="',h?a.r1:a.r2,'" fx="',h?a.x2:a.x1,'" fy="',h?a.y2:a.y1,'">\n']),"radial"===this.type){if(h)for((o=o.concat()).reverse(),i=0,n=o.length;i<n;i++)o[i].offset=1-o[i].offset;var f=Math.min(a.r1,a.r2);if(f>0){var d=f/Math.max(a.r1,a.r2);for(i=0,n=o.length;i<n;i++)o[i].offset+=d*(1-o[i].offset)}}for(i=0,n=o.length;i<n;i++){var p=o[i];r.push("<stop ",'offset="',100*p.offset+"%",'" style="stop-color:',p.color,void 0!==p.opacity?";stop-opacity: "+p.opacity:";",'"/>\n')}return r.push("linear"===this.type?"</linearGradient>\n":"</radialGradient>\n"),r.join("")},toLive:function(t){var e,i,n,r=b.util.object.clone(this.coords);if(this.type){for("linear"===this.type?e=t.createLinearGradient(r.x1,r.y1,r.x2,r.y2):"radial"===this.type&&(e=t.createRadialGradient(r.x1,r.y1,r.r1,r.x2,r.y2,r.r2)),i=0,n=this.colorStops.length;i<n;i++){var s=this.colorStops[i].color,a=this.colorStops[i].opacity,o=this.colorStops[i].offset;void 0!==a&&(s=new b.Color(s).setAlpha(a).toRgba()),e.addColorStop(o,s)}return e}}}),b.util.object.extend(b.Gradient,{fromElement:function(e,n){var r,s,a,o,h=e.getElementsByTagName("stop"),c=e.getAttribute("gradientUnits")||"objectBoundingBox",l=e.getAttribute("gradientTransform"),u=[];for("linear"===(r="linearGradient"===e.nodeName||"LINEARGRADIENT"===e.nodeName?"linear":"radial")?s=function(t){return{x1:t.getAttribute("x1")||0,y1:t.getAttribute("y1")||0,x2:t.getAttribute("x2")||"100%",y2:t.getAttribute("y2")||0}}(e):"radial"===r&&(s=function(t){return{x1:t.getAttribute("fx")||t.getAttribute("cx")||"50%",y1:t.getAttribute("fy")||t.getAttribute("cy")||"50%",r1:0,x2:t.getAttribute("cx")||"50%",y2:t.getAttribute("cy")||"50%",r2:t.getAttribute("r")||"50%"}}(e)),o=h.length;o--;)u.push(t(h[o]));a=i(n,s,c);var f=new b.Gradient({type:r,coords:s,colorStops:u,offsetX:-n.left,offsetY:-n.top});return(l||""!==a)&&(f.gradientTransform=b.parseTransformAttribute((l||"")+a)),f},forObject:function(t,e){return e||(e={}),i(t,e.coords,"userSpaceOnUse"),new b.Gradient(e)}})}(),function(){"use strict";var t=b.util.toFixed;b.Pattern=b.util.createClass({repeat:"repeat",offsetX:0,offsetY:0,crossOrigin:"",patternTransform:null,initialize:function(t,e){if(t||(t={}),this.id=b.Object.__uid++,this.setOptions(t),!t.source||t.source&&"string"!=typeof t.source)e&&e(this);else if(void 0!==b.util.getFunctionBody(t.source))this.source=new Function(b.util.getFunctionBody(t.source)),e&&e(this);else{var i=this;this.source=b.util.createImage(),b.util.loadImage(t.source,function(t){i.source=t,e&&e(i)},null,this.crossOrigin)}},toObject:function(e){var i,n,r=b.Object.NUM_FRACTION_DIGITS;return"function"==typeof this.source?i=String(this.source):"string"==typeof this.source.src?i=this.source.src:"object"==typeof this.source&&this.source.toDataURL&&(i=this.source.toDataURL()),n={type:"pattern",source:i,repeat:this.repeat,crossOrigin:this.crossOrigin,offsetX:t(this.offsetX,r),offsetY:t(this.offsetY,r),patternTransform:this.patternTransform?this.patternTransform.concat():null},b.util.populateWithProperties(this,n,e),n},toSVG:function(t){var e="function"==typeof this.source?this.source():this.source,i=e.width/t.width,n=e.height/t.height,r=this.offsetX/t.width,s=this.offsetY/t.height,a="";return"repeat-x"!==this.repeat&&"no-repeat"!==this.repeat||(n=1,s&&(n+=Math.abs(s))),"repeat-y"!==this.repeat&&"no-repeat"!==this.repeat||(i=1,r&&(i+=Math.abs(r))),e.src?a=e.src:e.toDataURL&&(a=e.toDataURL()),'<pattern id="SVGID_'+this.id+'" x="'+r+'" y="'+s+'" width="'+i+'" height="'+n+'">\n<image x="0" y="0" width="'+e.width+'" height="'+e.height+'" xlink:href="'+a+'"></image>\n</pattern>\n'},setOptions:function(t){for(var e in t)this[e]=t[e]},toLive:function(t){var e="function"==typeof this.source?this.source():this.source;if(!e)return"";if(void 0!==e.src){if(!e.complete)return"";if(0===e.naturalWidth||0===e.naturalHeight)return""}return t.createPattern(e,this.repeat)}})}(),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.toFixed;e.Shadow?e.warn("fabric.Shadow is already defined."):(e.Shadow=e.util.createClass({color:"rgb(0,0,0)",blur:0,offsetX:0,offsetY:0,affectStroke:!1,includeDefaultValues:!0,initialize:function(t){for(var i in"string"==typeof t&&(t=this._parseShadow(t)),t)this[i]=t[i];this.id=e.Object.__uid++},_parseShadow:function(t){var i=t.trim(),n=e.Shadow.reOffsetsAndBlur.exec(i)||[];return{color:(i.replace(e.Shadow.reOffsetsAndBlur,"")||"rgb(0,0,0)").trim(),offsetX:parseInt(n[1],10)||0,offsetY:parseInt(n[2],10)||0,blur:parseInt(n[3],10)||0}},toString:function(){return[this.offsetX,this.offsetY,this.blur,this.color].join("px ")},toSVG:function(t){var n=40,r=40,s=e.Object.NUM_FRACTION_DIGITS,a=e.util.rotateVector({x:this.offsetX,y:this.offsetY},e.util.degreesToRadians(-t.angle)),o=new e.Color(this.color);return t.width&&t.height&&(n=100*i((Math.abs(a.x)+this.blur)/t.width,s)+20,r=100*i((Math.abs(a.y)+this.blur)/t.height,s)+20),t.flipX&&(a.x*=-1),t.flipY&&(a.y*=-1),'<filter id="SVGID_'+this.id+'" y="-'+r+'%" height="'+(100+2*r)+'%" x="-'+n+'%" width="'+(100+2*n)+'%" >\n\t<feGaussianBlur in="SourceAlpha" stdDeviation="'+i(this.blur?this.blur/2:0,s)+'"></feGaussianBlur>\n\t<feOffset dx="'+i(a.x,s)+'" dy="'+i(a.y,s)+'" result="oBlur" ></feOffset>\n\t<feFlood flood-color="'+o.toRgb()+'" flood-opacity="'+o.getAlpha()+'"/>\n\t<feComposite in2="oBlur" operator="in" />\n\t<feMerge>\n\t\t<feMergeNode></feMergeNode>\n\t\t<feMergeNode in="SourceGraphic"></feMergeNode>\n\t</feMerge>\n</filter>\n'},toObject:function(){if(this.includeDefaultValues)return{color:this.color,blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY,affectStroke:this.affectStroke};var t={},i=e.Shadow.prototype;return["color","blur","offsetX","offsetY","affectStroke"].forEach(function(e){this[e]!==i[e]&&(t[e]=this[e])},this),t}}),e.Shadow.reOffsetsAndBlur=/(?:\s|^)(-?\d+(?:px)?(?:\s?|$))?(-?\d+(?:px)?(?:\s?|$))?(\d+(?:px)?)?(?:\s?|$)(?:$|\s)/)}(e),function(){"use strict";if(b.StaticCanvas)b.warn("fabric.StaticCanvas is already defined.");else{var t=b.util.object.extend,e=b.util.getElementOffset,i=b.util.removeFromArray,n=b.util.toFixed,r=b.util.transformPoint,s=b.util.invertTransform,a=b.util.getNodeCanvas,o=b.util.createCanvasElement,h=new Error("Could not initialize `canvas` element");b.StaticCanvas=b.util.createClass(b.CommonMethods,{initialize:function(t,e){e||(e={}),this.renderAndResetBound=this.renderAndReset.bind(this),this.requestRenderAllBound=this.requestRenderAll.bind(this),this._initStatic(t,e)},backgroundColor:"",backgroundImage:null,overlayColor:"",overlayImage:null,includeDefaultValues:!0,stateful:!1,renderOnAddRemove:!0,clipTo:null,controlsAboveOverlay:!1,allowTouchScrolling:!1,imageSmoothingEnabled:!0,viewportTransform:b.iMatrix.concat(),backgroundVpt:!0,overlayVpt:!0,onBeforeScaleRotate:function(){},enableRetinaScaling:!0,vptCoords:{},skipOffscreen:!0,clipPath:void 0,_initStatic:function(t,e){var i=this.requestRenderAllBound;this._objects=[],this._createLowerCanvas(t),this._initOptions(e),this._setImageSmoothing(),this.interactive||this._initRetinaScaling(),e.overlayImage&&this.setOverlayImage(e.overlayImage,i),e.backgroundImage&&this.setBackgroundImage(e.backgroundImage,i),e.backgroundColor&&this.setBackgroundColor(e.backgroundColor,i),e.overlayColor&&this.setOverlayColor(e.overlayColor,i),this.calcOffset()},_isRetinaScaling:function(){return 1!==b.devicePixelRatio&&this.enableRetinaScaling},getRetinaScaling:function(){return this._isRetinaScaling()?b.devicePixelRatio:1},_initRetinaScaling:function(){this._isRetinaScaling()&&(this.lowerCanvasEl.setAttribute("width",this.width*b.devicePixelRatio),this.lowerCanvasEl.setAttribute("height",this.height*b.devicePixelRatio),this.contextContainer.scale(b.devicePixelRatio,b.devicePixelRatio))},calcOffset:function(){return this._offset=e(this.lowerCanvasEl),this},setOverlayImage:function(t,e,i){return this.__setBgOverlayImage("overlayImage",t,e,i)},setBackgroundImage:function(t,e,i){return this.__setBgOverlayImage("backgroundImage",t,e,i)},setOverlayColor:function(t,e){return this.__setBgOverlayColor("overlayColor",t,e)},setBackgroundColor:function(t,e){return this.__setBgOverlayColor("backgroundColor",t,e)},_setImageSmoothing:function(){var t=this.getContext();t.imageSmoothingEnabled=t.imageSmoothingEnabled||t.webkitImageSmoothingEnabled||t.mozImageSmoothingEnabled||t.msImageSmoothingEnabled||t.oImageSmoothingEnabled,t.imageSmoothingEnabled=this.imageSmoothingEnabled},__setBgOverlayImage:function(t,e,i,n){return"string"==typeof e?b.util.loadImage(e,function(e){if(e){var r=new b.Image(e,n);this[t]=r,r.canvas=this}i&&i(e)},this,n&&n.crossOrigin):(n&&e.setOptions(n),this[t]=e,e&&(e.canvas=this),i&&i(e)),this},__setBgOverlayColor:function(t,e,i){return this[t]=e,this._initGradient(e,t),this._initPattern(e,t,i),this},_createCanvasElement:function(){var t=o();if(!t)throw h;if(t.style||(t.style={}),void 0===t.getContext)throw h;return t},_initOptions:function(t){var e=this.lowerCanvasEl;this._setOptions(t),this.width=this.width||parseInt(e.width,10)||0,this.height=this.height||parseInt(e.height,10)||0,this.lowerCanvasEl.style&&(e.width=this.width,e.height=this.height,e.style.width=this.width+"px",e.style.height=this.height+"px",this.viewportTransform=this.viewportTransform.slice())},_createLowerCanvas:function(t){t&&t.getContext?this.lowerCanvasEl=t:this.lowerCanvasEl=b.util.getById(t)||this._createCanvasElement(),b.util.addClass(this.lowerCanvasEl,"lower-canvas"),this.interactive&&this._applyCanvasStyle(this.lowerCanvasEl),this.contextContainer=this.lowerCanvasEl.getContext("2d")},getWidth:function(){return this.width},getHeight:function(){return this.height},setWidth:function(t,e){return this.setDimensions({width:t},e)},setHeight:function(t,e){return this.setDimensions({height:t},e)},setDimensions:function(t,e){var i;for(var n in e=e||{},t)i=t[n],e.cssOnly||(this._setBackstoreDimension(n,t[n]),i+="px",this.hasLostContext=!0),e.backstoreOnly||this._setCssDimension(n,i);return this._isCurrentlyDrawing&&this.freeDrawingBrush&&this.freeDrawingBrush._setBrushStyles(),this._initRetinaScaling(),this._setImageSmoothing(),this.calcOffset(),e.cssOnly||this.requestRenderAll(),this},_setBackstoreDimension:function(t,e){return this.lowerCanvasEl[t]=e,this.upperCanvasEl&&(this.upperCanvasEl[t]=e),this.cacheCanvasEl&&(this.cacheCanvasEl[t]=e),this[t]=e,this},_setCssDimension:function(t,e){return this.lowerCanvasEl.style[t]=e,this.upperCanvasEl&&(this.upperCanvasEl.style[t]=e),this.wrapperEl&&(this.wrapperEl.style[t]=e),this},getZoom:function(){return this.viewportTransform[0]},setViewportTransform:function(t){var e,i,n,r=this._activeObject;for(this.viewportTransform=t,i=0,n=this._objects.length;i<n;i++)(e=this._objects[i]).group||e.setCoords(!1,!0);return r&&"activeSelection"===r.type&&r.setCoords(!1,!0),this.calcViewportBoundaries(),this.renderOnAddRemove&&this.requestRenderAll(),this},zoomToPoint:function(t,e){var i=t,n=this.viewportTransform.slice(0);t=r(t,s(this.viewportTransform)),n[0]=e,n[3]=e;var a=r(t,n);return n[4]+=i.x-a.x,n[5]+=i.y-a.y,this.setViewportTransform(n)},setZoom:function(t){return this.zoomToPoint(new b.Point(0,0),t),this},absolutePan:function(t){var e=this.viewportTransform.slice(0);return e[4]=-t.x,e[5]=-t.y,this.setViewportTransform(e)},relativePan:function(t){return this.absolutePan(new b.Point(-t.x-this.viewportTransform[4],-t.y-this.viewportTransform[5]))},getElement:function(){return this.lowerCanvasEl},_onObjectAdded:function(t){this.stateful&&t.setupState(),t._set("canvas",this),t.setCoords(),this.fire("object:added",{target:t}),t.fire("added")},_onObjectRemoved:function(t){this.fire("object:removed",{target:t}),t.fire("removed"),delete t.canvas},clearContext:function(t){return t.clearRect(0,0,this.width,this.height),this},getContext:function(){return this.contextContainer},clear:function(){return this._objects.length=0,this.backgroundImage=null,this.overlayImage=null,this.backgroundColor="",this.overlayColor="",this._hasITextHandlers&&(this.off("mouse:up",this._mouseUpITextHandler),this._iTextInstances=null,this._hasITextHandlers=!1),this.clearContext(this.contextContainer),this.fire("canvas:cleared"),this.renderOnAddRemove&&this.requestRenderAll(),this},renderAll:function(){var t=this.contextContainer;return this.renderCanvas(t,this._objects),this},renderAndReset:function(){this.isRendering=0,this.renderAll()},requestRenderAll:function(){return this.isRendering||(this.isRendering=b.util.requestAnimFrame(this.renderAndResetBound)),this},calcViewportBoundaries:function(){var t={},e=this.width,i=this.height,n=s(this.viewportTransform);return t.tl=r({x:0,y:0},n),t.br=r({x:e,y:i},n),t.tr=new b.Point(t.br.x,t.tl.y),t.bl=new b.Point(t.tl.x,t.br.y),this.vptCoords=t,t},cancelRequestedRender:function(){this.isRendering&&(b.util.cancelAnimFrame(this.isRendering),this.isRendering=0)},renderCanvas:function(t,e){var i=this.viewportTransform,n=this.clipPath;this.cancelRequestedRender(),this.calcViewportBoundaries(),this.clearContext(t),this.fire("before:render",{ctx:t}),this.clipTo&&b.util.clipContext(this,t),this._renderBackground(t),t.save(),t.transform(i[0],i[1],i[2],i[3],i[4],i[5]),this._renderObjects(t,e),t.restore(),!this.controlsAboveOverlay&&this.interactive&&this.drawControls(t),this.clipTo&&t.restore(),n&&(n.canvas=this,n.shouldCache(),n._transformDone=!0,n.renderCache({forClipping:!0}),this.drawClipPathOnCanvas(t)),this._renderOverlay(t),this.controlsAboveOverlay&&this.interactive&&this.drawControls(t),this.fire("after:render",{ctx:t})},drawClipPathOnCanvas:function(t){var e=this.viewportTransform,i=this.clipPath;t.save(),t.transform(e[0],e[1],e[2],e[3],e[4],e[5]),t.globalCompositeOperation="destination-in",i.transform(t),t.scale(1/i.zoomX,1/i.zoomY),t.drawImage(i._cacheCanvas,-i.cacheTranslationX,-i.cacheTranslationY),t.restore()},_renderObjects:function(t,e){var i,n;for(i=0,n=e.length;i<n;++i)e[i]&&e[i].render(t)},_renderBackgroundOrOverlay:function(t,e){var i,n=this[e+"Color"];n&&(t.fillStyle=n.toLive?n.toLive(t,this):n,t.fillRect(n.offsetX||0,n.offsetY||0,this.width,this.height)),(n=this[e+"Image"])&&(this[e+"Vpt"]&&(i=this.viewportTransform,t.save(),t.transform(i[0],i[1],i[2],i[3],i[4],i[5])),n.render(t),this[e+"Vpt"]&&t.restore())},_renderBackground:function(t){this._renderBackgroundOrOverlay(t,"background")},_renderOverlay:function(t){this._renderBackgroundOrOverlay(t,"overlay")},getCenter:function(){return{top:this.height/2,left:this.width/2}},centerObjectH:function(t){return this._centerObject(t,new b.Point(this.getCenter().left,t.getCenterPoint().y))},centerObjectV:function(t){return this._centerObject(t,new b.Point(t.getCenterPoint().x,this.getCenter().top))},centerObject:function(t){var e=this.getCenter();return this._centerObject(t,new b.Point(e.left,e.top))},viewportCenterObject:function(t){var e=this.getVpCenter();return this._centerObject(t,e)},viewportCenterObjectH:function(t){var e=this.getVpCenter();return this._centerObject(t,new b.Point(e.x,t.getCenterPoint().y)),this},viewportCenterObjectV:function(t){var e=this.getVpCenter();return this._centerObject(t,new b.Point(t.getCenterPoint().x,e.y))},getVpCenter:function(){var t=this.getCenter(),e=s(this.viewportTransform);return r({x:t.left,y:t.top},e)},_centerObject:function(t,e){return t.setPositionByOrigin(e,"center","center"),t.setCoords(),this.renderOnAddRemove&&this.requestRenderAll(),this},toDatalessJSON:function(t){return this.toDatalessObject(t)},toObject:function(t){return this._toObjectMethod("toObject",t)},toDatalessObject:function(t){return this._toObjectMethod("toDatalessObject",t)},_toObjectMethod:function(e,i){var n=this.clipPath,r={version:b.version,objects:this._toObjects(e,i)};return n&&(n=n.toObject(i)),t(r,this.__serializeBgOverlay(e,i)),b.util.populateWithProperties(this,r,i),r},_toObjects:function(t,e){return this._objects.filter(function(t){return!t.excludeFromExport}).map(function(i){return this._toObject(i,t,e)},this)},_toObject:function(t,e,i){var n;this.includeDefaultValues||(n=t.includeDefaultValues,t.includeDefaultValues=!1);var r=t[e](i);return this.includeDefaultValues||(t.includeDefaultValues=n),r},__serializeBgOverlay:function(t,e){var i={},n=this.backgroundImage,r=this.overlayImage;return this.backgroundColor&&(i.background=this.backgroundColor.toObject?this.backgroundColor.toObject(e):this.backgroundColor),this.overlayColor&&(i.overlay=this.overlayColor.toObject?this.overlayColor.toObject(e):this.overlayColor),n&&!n.excludeFromExport&&(i.backgroundImage=this._toObject(n,t,e)),r&&!r.excludeFromExport&&(i.overlayImage=this._toObject(r,t,e)),i},svgViewportTransformation:!0,toSVG:function(t,e){t||(t={}),t.reviver=e;var i=[];return this._setSVGPreamble(i,t),this._setSVGHeader(i,t),this._setSVGBgOverlayColor(i,"backgroundColor"),this._setSVGBgOverlayImage(i,"backgroundImage",e),this.clipPath&&i.push('<g clip-path="url(#'+this.clipPath.clipPathId+')" >\n'),this._setSVGObjects(i,e),this.clipPath&&i.push("</g>\n"),this._setSVGBgOverlayColor(i,"overlayColor"),this._setSVGBgOverlayImage(i,"overlayImage",e),i.push("</svg>"),i.join("")},_setSVGPreamble:function(t,e){e.suppressPreamble||t.push('<?xml version="1.0" encoding="',e.encoding||"UTF-8",'" standalone="no" ?>\n','<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ','"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\n')},_setSVGHeader:function(t,e){var i,r=e.width||this.width,s=e.height||this.height,a='viewBox="0 0 '+this.width+" "+this.height+'" ',o=b.Object.NUM_FRACTION_DIGITS;e.viewBox?a='viewBox="'+e.viewBox.x+" "+e.viewBox.y+" "+e.viewBox.width+" "+e.viewBox.height+'" ':this.svgViewportTransformation&&(i=this.viewportTransform,a='viewBox="'+n(-i[4]/i[0],o)+" "+n(-i[5]/i[3],o)+" "+n(this.width/i[0],o)+" "+n(this.height/i[3],o)+'" '),t.push("<svg ",'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',r,'" ','height="',s,'" ',a,'xml:space="preserve">\n',"<desc>Created with Fabric.js ",b.version,"</desc>\n","<defs>\n",this.createSVGFontFacesMarkup(),this.createSVGRefElementsMarkup(),this.createSVGClipPathMarkup(e),"</defs>\n")},createSVGClipPathMarkup:function(t){var e=this.clipPath;return e?(e.clipPathId="CLIPPATH_"+b.Object.__uid++,'<clipPath id="'+e.clipPathId+'" >\n'+this.clipPath.toClipPathSVG(t.reviver)+"</clipPath>\n"):""},createSVGRefElementsMarkup:function(){var t=this;return["backgroundColor","overlayColor"].map(function(e){var i=t[e];if(i&&i.toLive)return i.toSVG(t,!1)}).join("")},createSVGFontFacesMarkup:function(){var t,e,i,n,r,s,a,o,h="",c={},l=b.fontPaths,u=this._objects;for(a=0,o=u.length;a<o;a++)if(e=(t=u[a]).fontFamily,-1!==t.type.indexOf("text")&&!c[e]&&l[e]&&(c[e]=!0,t.styles))for(r in i=t.styles)for(s in n=i[r])!c[e=n[s].fontFamily]&&l[e]&&(c[e]=!0);for(var f in c)h+=["\t\t@font-face {\n","\t\t\tfont-family: '",f,"';\n","\t\t\tsrc: url('",l[f],"');\n","\t\t}\n"].join("");return h&&(h=['\t<style type="text/css">',"<![CDATA[\n",h,"]]>","</style>\n"].join("")),h},_setSVGObjects:function(t,e){var i,n,r,s=this._objects;for(n=0,r=s.length;n<r;n++)(i=s[n]).excludeFromExport||this._setSVGObject(t,i,e)},_setSVGObject:function(t,e,i){t.push(e.toSVG(i))},_setSVGBgOverlayImage:function(t,e,i){this[e]&&!this[e].excludeFromExport&&this[e].toSVG&&t.push(this[e].toSVG(i))},_setSVGBgOverlayColor:function(t,e){var i=this[e],n=this.viewportTransform,r=this.width/n[0],s=this.height/n[3];if(i)if(i.toLive){var a=i.repeat;t.push('<rect transform="translate(',r/2,",",s/2,')"',' x="',i.offsetX-r/2,'" y="',i.offsetY-s/2,'" ','width="',"repeat-y"===a||"no-repeat"===a?i.source.width:r,'" height="',"repeat-x"===a||"no-repeat"===a?i.source.height:s,'" fill="url(#SVGID_'+i.id+')"',"></rect>\n")}else t.push('<rect x="0" y="0" width="100%" height="100%" ','fill="',this[e],'"',"></rect>\n")},sendToBack:function(t){if(!t)return this;var e,n,r,s=this._activeObject;if(t===s&&"activeSelection"===t.type)for(e=(r=s._objects).length;e--;)n=r[e],i(this._objects,n),this._objects.unshift(n);else i(this._objects,t),this._objects.unshift(t);return this.renderOnAddRemove&&this.requestRenderAll(),this},bringToFront:function(t){if(!t)return this;var e,n,r,s=this._activeObject;if(t===s&&"activeSelection"===t.type)for(r=s._objects,e=0;e<r.length;e++)n=r[e],i(this._objects,n),this._objects.push(n);else i(this._objects,t),this._objects.push(t);return this.renderOnAddRemove&&this.requestRenderAll(),this},sendBackwards:function(t,e){if(!t)return this;var n,r,s,a,o,h=this._activeObject,c=0;if(t===h&&"activeSelection"===t.type)for(o=h._objects,n=0;n<o.length;n++)r=o[n],(s=this._objects.indexOf(r))>0+c&&(a=s-1,i(this._objects,r),this._objects.splice(a,0,r)),c++;else 0!==(s=this._objects.indexOf(t))&&(a=this._findNewLowerIndex(t,s,e),i(this._objects,t),this._objects.splice(a,0,t));return this.renderOnAddRemove&&this.requestRenderAll(),this},_findNewLowerIndex:function(t,e,i){var n,r;if(i)for(n=e,r=e-1;r>=0;--r){if(t.intersectsWithObject(this._objects[r])||t.isContainedWithinObject(this._objects[r])||this._objects[r].isContainedWithinObject(t)){n=r;break}}else n=e-1;return n},bringForward:function(t,e){if(!t)return this;var n,r,s,a,o,h=this._activeObject,c=0;if(t===h&&"activeSelection"===t.type)for(n=(o=h._objects).length;n--;)r=o[n],(s=this._objects.indexOf(r))<this._objects.length-1-c&&(a=s+1,i(this._objects,r),this._objects.splice(a,0,r)),c++;else(s=this._objects.indexOf(t))!==this._objects.length-1&&(a=this._findNewUpperIndex(t,s,e),i(this._objects,t),this._objects.splice(a,0,t));return this.renderOnAddRemove&&this.requestRenderAll(),this},_findNewUpperIndex:function(t,e,i){var n,r,s;if(i)for(n=e,r=e+1,s=this._objects.length;r<s;++r){if(t.intersectsWithObject(this._objects[r])||t.isContainedWithinObject(this._objects[r])||this._objects[r].isContainedWithinObject(t)){n=r;break}}else n=e+1;return n},moveTo:function(t,e){return i(this._objects,t),this._objects.splice(e,0,t),this.renderOnAddRemove&&this.requestRenderAll()},dispose:function(){return this.isRendering&&(b.util.cancelAnimFrame(this.isRendering),this.isRendering=0),this.forEachObject(function(t){t.dispose&&t.dispose()}),this._objects=[],this.backgroundImage&&this.backgroundImage.dispose&&this.backgroundImage.dispose(),this.backgroundImage=null,this.overlayImage&&this.overlayImage.dispose&&this.overlayImage.dispose(),this.overlayImage=null,this._iTextInstances=null,this.contextContainer=null,b.util.cleanUpJsdomNode(this.lowerCanvasEl),this.lowerCanvasEl=void 0,this},toString:function(){return"#<fabric.Canvas ("+this.complexity()+"): { objects: "+this._objects.length+" }>"}}),t(b.StaticCanvas.prototype,b.Observable),t(b.StaticCanvas.prototype,b.Collection),t(b.StaticCanvas.prototype,b.DataURLExporter),t(b.StaticCanvas,{EMPTY_JSON:'{"objects": [], "background": "white"}',supports:function(t){var e=o();if(!e||!e.getContext)return null;var i=e.getContext("2d");if(!i)return null;switch(t){case"getImageData":return void 0!==i.getImageData;case"setLineDash":return void 0!==i.setLineDash;case"toDataURL":return void 0!==e.toDataURL;case"toDataURLWithQuality":try{return e.toDataURL("image/jpeg",0),!0}catch(t){}return!1;default:return null}}}),b.StaticCanvas.prototype.toJSON=b.StaticCanvas.prototype.toObject,b.isLikelyNode&&(b.StaticCanvas.prototype.createPNGStream=function(){var t=a(this.lowerCanvasEl);return t&&t.createPNGStream()},b.StaticCanvas.prototype.createJPEGStream=function(t){var e=a(this.lowerCanvasEl);return e&&e.createJPEGStream(t)})}}(),b.BaseBrush=b.util.createClass({color:"rgb(0, 0, 0)",width:1,shadow:null,strokeLineCap:"round",strokeLineJoin:"round",strokeMiterLimit:10,strokeDashArray:null,setShadow:function(t){return this.shadow=new b.Shadow(t),this},_setBrushStyles:function(){var t=this.canvas.contextTop;t.strokeStyle=this.color,t.lineWidth=this.width,t.lineCap=this.strokeLineCap,t.miterLimit=this.strokeMiterLimit,t.lineJoin=this.strokeLineJoin,b.StaticCanvas.supports("setLineDash")&&t.setLineDash(this.strokeDashArray||[])},_saveAndTransform:function(t){var e=this.canvas.viewportTransform;t.save(),t.transform(e[0],e[1],e[2],e[3],e[4],e[5])},_setShadow:function(){if(this.shadow){var t=this.canvas.contextTop,e=this.canvas.getZoom();t.shadowColor=this.shadow.color,t.shadowBlur=this.shadow.blur*e,t.shadowOffsetX=this.shadow.offsetX*e,t.shadowOffsetY=this.shadow.offsetY*e}},_resetShadow:function(){var t=this.canvas.contextTop;t.shadowColor="",t.shadowBlur=t.shadowOffsetX=t.shadowOffsetY=0}}),b.PencilBrush=b.util.createClass(b.BaseBrush,{initialize:function(t){this.canvas=t,this._points=[]},_drawSegment:function(t,e,i){var n=e.midPointFrom(i);return t.quadraticCurveTo(e.x,e.y,n.x,n.y),n},onMouseDown:function(t){this._prepareForDrawing(t),this._captureDrawingPath(t),this._render()},onMouseMove:function(t){if(this._captureDrawingPath(t)&&this._points.length>1)if(this.needsFullRender)this.canvas.clearContext(this.canvas.contextTop),this._render();else{var e=this._points,i=e.length,n=this.canvas.contextTop;this._saveAndTransform(n),this.oldEnd&&(n.beginPath(),n.moveTo(this.oldEnd.x,this.oldEnd.y)),this.oldEnd=this._drawSegment(n,e[i-2],e[i-1],!0),n.stroke(),n.restore()}},onMouseUp:function(){this.oldEnd=void 0,this._finalizeAndAddPath()},_prepareForDrawing:function(t){var e=new b.Point(t.x,t.y);this._reset(),this._addPoint(e),this.canvas.contextTop.moveTo(e.x,e.y)},_addPoint:function(t){return!(this._points.length>1&&t.eq(this._points[this._points.length-1])||(this._points.push(t),0))},_reset:function(){this._points.length=0,this._setBrushStyles();var t=new b.Color(this.color);this.needsFullRender=t.getAlpha()<1,this._setShadow()},_captureDrawingPath:function(t){var e=new b.Point(t.x,t.y);return this._addPoint(e)},_render:function(){var t,e,i=this.canvas.contextTop,n=this._points[0],r=this._points[1];if(this._saveAndTransform(i),i.beginPath(),2===this._points.length&&n.x===r.x&&n.y===r.y){var s=this.width/1e3;n=new b.Point(n.x,n.y),r=new b.Point(r.x,r.y),n.x-=s,r.x+=s}for(i.moveTo(n.x,n.y),t=1,e=this._points.length;t<e;t++)this._drawSegment(i,n,r),n=this._points[t],r=this._points[t+1];i.lineTo(n.x,n.y),i.stroke(),i.restore()},convertPointsToSVGPath:function(t){var e,i=[],n=this.width/1e3,r=new b.Point(t[0].x,t[0].y),s=new b.Point(t[1].x,t[1].y),a=t.length,o=1,h=1,c=a>2;for(c&&(o=t[2].x<s.x?-1:t[2].x===s.x?0:1,h=t[2].y<s.y?-1:t[2].y===s.y?0:1),i.push("M ",r.x-o*n," ",r.y-h*n," "),e=1;e<a;e++){if(!r.eq(s)){var l=r.midPointFrom(s);i.push("Q ",r.x," ",r.y," ",l.x," ",l.y," ")}r=t[e],e+1<t.length&&(s=t[e+1])}return c&&(o=r.x>t[e-2].x?1:r.x===t[e-2].x?0:-1,h=r.y>t[e-2].y?1:r.y===t[e-2].y?0:-1),i.push("L ",r.x+o*n," ",r.y+h*n),i},createPath:function(t){var e=new b.Path(t,{fill:null,stroke:this.color,strokeWidth:this.width,strokeLineCap:this.strokeLineCap,strokeMiterLimit:this.strokeMiterLimit,strokeLineJoin:this.strokeLineJoin,strokeDashArray:this.strokeDashArray}),i=new b.Point(e.left+e.width/2,e.top+e.height/2);return i=e.translateToGivenOrigin(i,"center","center",e.originX,e.originY),e.top=i.y,e.left=i.x,this.shadow&&(this.shadow.affectStroke=!0,e.setShadow(this.shadow)),e},_finalizeAndAddPath:function(){this.canvas.contextTop.closePath();var t=this.convertPointsToSVGPath(this._points).join("");if("M 0 0 Q 0 0 0 0 L 0 0"!==t){var e=this.createPath(t);this.canvas.clearContext(this.canvas.contextTop),this.canvas.add(e),this.canvas.renderAll(),e.setCoords(),this._resetShadow(),this.canvas.fire("path:created",{path:e})}else this.canvas.requestRenderAll()}}),b.CircleBrush=b.util.createClass(b.BaseBrush,{width:10,initialize:function(t){this.canvas=t,this.points=[]},drawDot:function(t){var e=this.addPoint(t),i=this.canvas.contextTop;this._saveAndTransform(i),i.fillStyle=e.fill,i.beginPath(),i.arc(e.x,e.y,e.radius,0,2*Math.PI,!1),i.closePath(),i.fill(),i.restore()},onMouseDown:function(t){this.points.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.drawDot(t)},_render:function(){var t,e,i,n=this.canvas.contextTop,r=this.points;for(this._saveAndTransform(n),t=0,e=r.length;t<e;t++)i=r[t],n.fillStyle=i.fill,n.beginPath(),n.arc(i.x,i.y,i.radius,0,2*Math.PI,!1),n.closePath(),n.fill();n.restore()},onMouseMove:function(t){this.drawDot(t)},onMouseUp:function(){var t,e,i=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;var n=[];for(t=0,e=this.points.length;t<e;t++){var r=this.points[t],s=new b.Circle({radius:r.radius,left:r.x,top:r.y,originX:"center",originY:"center",fill:r.fill});this.shadow&&s.setShadow(this.shadow),n.push(s)}var a=new b.Group(n);a.canvas=this.canvas,this.canvas.add(a),this.canvas.fire("path:created",{path:a}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=i,this.canvas.requestRenderAll()},addPoint:function(t){var e=new b.Point(t.x,t.y),i=b.util.getRandomInt(Math.max(0,this.width-20),this.width+20)/2,n=new b.Color(this.color).setAlpha(b.util.getRandomInt(0,100)/100).toRgba();return e.radius=i,e.fill=n,this.points.push(e),e}}),b.SprayBrush=b.util.createClass(b.BaseBrush,{width:10,density:20,dotWidth:1,dotWidthVariance:1,randomOpacity:!1,optimizeOverlapping:!0,initialize:function(t){this.canvas=t,this.sprayChunks=[]},onMouseDown:function(t){this.sprayChunks.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.addSprayChunk(t),this.render(this.sprayChunkPoints)},onMouseMove:function(t){this.addSprayChunk(t),this.render(this.sprayChunkPoints)},onMouseUp:function(){var t=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;for(var e=[],i=0,n=this.sprayChunks.length;i<n;i++)for(var r=this.sprayChunks[i],s=0,a=r.length;s<a;s++){var o=new b.Rect({width:r[s].width,height:r[s].width,left:r[s].x+1,top:r[s].y+1,originX:"center",originY:"center",fill:this.color});e.push(o)}this.optimizeOverlapping&&(e=this._getOptimizedRects(e));var h=new b.Group(e);this.shadow&&h.setShadow(this.shadow),this.canvas.add(h),this.canvas.fire("path:created",{path:h}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=t,this.canvas.requestRenderAll()},_getOptimizedRects:function(t){var e,i,n,r={};for(i=0,n=t.length;i<n;i++)r[e=t[i].left+""+t[i].top]||(r[e]=t[i]);var s=[];for(e in r)s.push(r[e]);return s},render:function(t){var e,i,n=this.canvas.contextTop;for(n.fillStyle=this.color,this._saveAndTransform(n),e=0,i=t.length;e<i;e++){var r=t[e];void 0!==r.opacity&&(n.globalAlpha=r.opacity),n.fillRect(r.x,r.y,r.width,r.width)}n.restore()},_render:function(){var t,e,i=this.canvas.contextTop;for(i.fillStyle=this.color,this._saveAndTransform(i),t=0,e=this.sprayChunks.length;t<e;t++)this.render(this.sprayChunks[t]);i.restore()},addSprayChunk:function(t){this.sprayChunkPoints=[];var e,i,n,r,s=this.width/2;for(r=0;r<this.density;r++){e=b.util.getRandomInt(t.x-s,t.x+s),i=b.util.getRandomInt(t.y-s,t.y+s),n=this.dotWidthVariance?b.util.getRandomInt(Math.max(1,this.dotWidth-this.dotWidthVariance),this.dotWidth+this.dotWidthVariance):this.dotWidth;var a=new b.Point(e,i);a.width=n,this.randomOpacity&&(a.opacity=b.util.getRandomInt(0,100)/100),this.sprayChunkPoints.push(a)}this.sprayChunks.push(this.sprayChunkPoints)}}),b.PatternBrush=b.util.createClass(b.PencilBrush,{getPatternSrc:function(){var t=b.util.createCanvasElement(),e=t.getContext("2d");return t.width=t.height=25,e.fillStyle=this.color,e.beginPath(),e.arc(10,10,10,0,2*Math.PI,!1),e.closePath(),e.fill(),t},getPatternSrcFunction:function(){return String(this.getPatternSrc).replace("this.color",'"'+this.color+'"')},getPattern:function(){return this.canvas.contextTop.createPattern(this.source||this.getPatternSrc(),"repeat")},_setBrushStyles:function(){this.callSuper("_setBrushStyles"),this.canvas.contextTop.strokeStyle=this.getPattern()},createPath:function(t){var e=this.callSuper("createPath",t),i=e._getLeftTopCoords().scalarAdd(e.strokeWidth/2);return e.stroke=new b.Pattern({source:this.source||this.getPatternSrcFunction(),offsetX:-i.x,offsetY:-i.y}),e}}),function(){var t=b.util.getPointer,e=b.util.degreesToRadians,i=b.util.radiansToDegrees,n=Math.atan2,r=Math.abs,s=b.StaticCanvas.supports("setLineDash");for(var a in b.Canvas=b.util.createClass(b.StaticCanvas,{initialize:function(t,e){e||(e={}),this.renderAndResetBound=this.renderAndReset.bind(this),this.requestRenderAllBound=this.requestRenderAll.bind(this),this._initStatic(t,e),this._initInteractive(),this._createCacheCanvas()},uniScaleTransform:!1,uniScaleKey:"shiftKey",centeredScaling:!1,centeredRotation:!1,centeredKey:"altKey",altActionKey:"shiftKey",interactive:!0,selection:!0,selectionKey:"shiftKey",altSelectionKey:null,selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,selectionFullyContained:!1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",rotationCursor:"crosshair",notAllowedCursor:"not-allowed",containerClass:"canvas-container",perPixelTargetFind:!1,targetFindTolerance:0,skipTargetFind:!1,isDrawingMode:!1,preserveObjectStacking:!1,snapAngle:0,snapThreshold:null,stopContextMenu:!1,fireRightClick:!1,fireMiddleClick:!1,_initInteractive:function(){this._currentTransform=null,this._groupSelector=null,this._initWrapperElement(),this._createUpperCanvas(),this._initEventListeners(),this._initRetinaScaling(),this.freeDrawingBrush=b.PencilBrush&&new b.PencilBrush(this),this.calcOffset()},_chooseObjectsToRender:function(){var t,e,i,n=this.getActiveObjects();if(n.length>0&&!this.preserveObjectStacking){e=[],i=[];for(var r=0,s=this._objects.length;r<s;r++)t=this._objects[r],-1===n.indexOf(t)?e.push(t):i.push(t);n.length>1&&(this._activeObject._objects=i),e.push.apply(e,i)}else e=this._objects;return e},renderAll:function(){!this.contextTopDirty||this._groupSelector||this.isDrawingMode||(this.clearContext(this.contextTop),this.contextTopDirty=!1),this.hasLostContext&&this.renderTopLayer(this.contextTop);var t=this.contextContainer;return this.renderCanvas(t,this._chooseObjectsToRender()),this},renderTopLayer:function(t){this.isDrawingMode&&this._isCurrentlyDrawing&&(this.freeDrawingBrush&&this.freeDrawingBrush._render(),this.contextTopDirty=!0),this.selection&&this._groupSelector&&(this._drawSelection(t),this.contextTopDirty=!0)},renderTop:function(){var t=this.contextTop;return this.clearContext(t),this.renderTopLayer(t),this.fire("after:render"),this},_resetCurrentTransform:function(){var t=this._currentTransform;t.target.set({scaleX:t.original.scaleX,scaleY:t.original.scaleY,skewX:t.original.skewX,skewY:t.original.skewY,left:t.original.left,top:t.original.top}),this._shouldCenterTransform(t.target)?("center"!==t.originX&&("right"===t.originX?t.mouseXSign=-1:t.mouseXSign=1),"center"!==t.originY&&("bottom"===t.originY?t.mouseYSign=-1:t.mouseYSign=1),t.originX="center",t.originY="center"):(t.originX=t.original.originX,t.originY=t.original.originY)},containsPoint:function(t,e,i){var n,r=i||this.getPointer(t,!0);return n=e.group&&e.group===this._activeObject&&"activeSelection"===e.group.type?this._normalizePointer(e.group,r):{x:r.x,y:r.y},e.containsPoint(n)||e._findTargetCorner(r)},_normalizePointer:function(t,e){var i=t.calcTransformMatrix(),n=b.util.invertTransform(i),r=this.restorePointerVpt(e);return b.util.transformPoint(r,n)},isTargetTransparent:function(t,e,i){if(t.shouldCache()&&t._cacheCanvas){var n=this._normalizePointer(t,{x:e,y:i}),r=t.cacheTranslationX+n.x*t.zoomX,s=t.cacheTranslationY+n.y*t.zoomY;return b.util.isTransparent(t._cacheContext,r,s,this.targetFindTolerance)}var a=this.contextCache,o=t.selectionBackgroundColor,h=this.viewportTransform;return t.selectionBackgroundColor="",this.clearContext(a),a.save(),a.transform(h[0],h[1],h[2],h[3],h[4],h[5]),t.render(a),a.restore(),t===this._activeObject&&t._renderControls(a,{hasBorders:!1,transparentCorners:!1},{hasBorders:!1}),t.selectionBackgroundColor=o,b.util.isTransparent(a,e,i,this.targetFindTolerance)},_isSelectionKeyPressed:function(t){return"[object Array]"===Object.prototype.toString.call(this.selectionKey)?!!this.selectionKey.find(function(e){return!0===t[e]}):t[this.selectionKey]},_shouldClearSelection:function(t,e){var i=this.getActiveObjects(),n=this._activeObject;return!e||e&&n&&i.length>1&&-1===i.indexOf(e)&&n!==e&&!this._isSelectionKeyPressed(t)||e&&!e.evented||e&&!e.selectable&&n&&n!==e},_shouldCenterTransform:function(t){if(t){var e,i=this._currentTransform;return"scale"===i.action||"scaleX"===i.action||"scaleY"===i.action?e=this.centeredScaling||t.centeredScaling:"rotate"===i.action&&(e=this.centeredRotation||t.centeredRotation),e?!i.altKey:i.altKey}},_getOriginFromCorner:function(t,e){var i={x:t.originX,y:t.originY};return"ml"===e||"tl"===e||"bl"===e?i.x="right":"mr"!==e&&"tr"!==e&&"br"!==e||(i.x="left"),"tl"===e||"mt"===e||"tr"===e?i.y="bottom":"bl"!==e&&"mb"!==e&&"br"!==e||(i.y="top"),i},_getActionFromCorner:function(t,e,i){if(!e)return"drag";switch(e){case"mtr":return"rotate";case"ml":case"mr":return i[this.altActionKey]?"skewY":"scaleX";case"mt":case"mb":return i[this.altActionKey]?"skewX":"scaleY";default:return"scale"}},_setupCurrentTransform:function(t,i){if(i){var n=this.getPointer(t),r=i._findTargetCorner(this.getPointer(t,!0)),s=this._getActionFromCorner(i,r,t),a=this._getOriginFromCorner(i,r);this._currentTransform={target:i,action:s,corner:r,scaleX:i.scaleX,scaleY:i.scaleY,skewX:i.skewX,skewY:i.skewY,offsetX:n.x-i.left,offsetY:n.y-i.top,originX:a.x,originY:a.y,ex:n.x,ey:n.y,lastX:n.x,lastY:n.y,theta:e(i.angle),width:i.width*i.scaleX,mouseXSign:1,mouseYSign:1,shiftKey:t.shiftKey,altKey:t[this.centeredKey],original:b.util.saveObjectTransform(i)},this._currentTransform.original.originX=a.x,this._currentTransform.original.originY=a.y,this._resetCurrentTransform(),this._beforeTransform(t)}},_translateObject:function(t,e){var i=this._currentTransform,n=i.target,r=t-i.offsetX,s=e-i.offsetY,a=!n.get("lockMovementX")&&n.left!==r,o=!n.get("lockMovementY")&&n.top!==s;return a&&n.set("left",r),o&&n.set("top",s),a||o},_changeSkewTransformOrigin:function(t,e,i){var n="originX",r={0:"center"},s=e.target.skewX,a="left",o="right",h="mt"===e.corner||"ml"===e.corner?1:-1,c=1;t=t>0?1:-1,"y"===i&&(s=e.target.skewY,a="top",o="bottom",n="originY"),r[-1]=a,r[1]=o,e.target.flipX&&(c*=-1),e.target.flipY&&(c*=-1),0===s?(e.skewSign=-h*t*c,e[n]=r[-t]):(s=s>0?1:-1,e.skewSign=s,e[n]=r[s*h*c])},_skewObject:function(t,e,i){var n,r=this._currentTransform,s=r.target,a=s.get("lockSkewingX"),o=s.get("lockSkewingY");if(a&&"x"===i||o&&"y"===i)return!1;var h,c,l=s.getCenterPoint(),u=s.toLocalPoint(new b.Point(t,e),"center","center")[i],f=s.toLocalPoint(new b.Point(r.lastX,r.lastY),"center","center")[i],d=s._getTransformedDimensions();return this._changeSkewTransformOrigin(u-f,r,i),h=s.toLocalPoint(new b.Point(t,e),r.originX,r.originY)[i],c=s.translateToOriginPoint(l,r.originX,r.originY),n=this._setObjectSkew(h,r,i,d),r.lastX=t,r.lastY=e,s.setPositionByOrigin(c,r.originX,r.originY),n},_setObjectSkew:function(t,e,i,n){var r,s,a,o,h,c,l,u,f,d,p=e.target,g=e.skewSign;return"x"===i?(h="y",c="Y",l="X",f=0,d=p.skewY):(h="x",c="X",l="Y",f=p.skewX,d=0),o=p._getTransformedDimensions(f,d),(u=2*Math.abs(t)-o[i])<=2?r=0:(r=g*Math.atan(u/p["scale"+l]/(o[h]/p["scale"+c])),r=b.util.radiansToDegrees(r)),s=p["skew"+l]!==r,p.set("skew"+l,r),0!==p["skew"+c]&&(a=p._getTransformedDimensions(),r=n[h]/a[h]*p["scale"+c],p.set("scale"+c,r)),s},_scaleObject:function(t,e,i){var n=this._currentTransform,r=n.target,s=r.lockScalingX,a=r.lockScalingY,o=r.lockScalingFlip;if(s&&a)return!1;var h,c=r.translateToOriginPoint(r.getCenterPoint(),n.originX,n.originY),l=r.toLocalPoint(new b.Point(t,e),n.originX,n.originY),u=r._getTransformedDimensions();return this._setLocalMouse(l,n),h=this._setObjectScale(l,n,s,a,i,o,u),r.setPositionByOrigin(c,n.originX,n.originY),h},_setObjectScale:function(t,e,i,n,r,s,a){var o,h,c,l,u=e.target,f=!1,d=!1,p=!1;return c=t.x*u.scaleX/a.x,l=t.y*u.scaleY/a.y,o=u.scaleX!==c,h=u.scaleY!==l,s&&c<=0&&c<u.scaleX&&(f=!0,t.x=0),s&&l<=0&&l<u.scaleY&&(d=!0,t.y=0),"equally"!==r||i||n?r?"x"!==r||u.get("lockUniScaling")?"y"!==r||u.get("lockUniScaling")||d||n||u.set("scaleY",l)&&(p=p||h):f||i||u.set("scaleX",c)&&(p=p||o):(f||i||u.set("scaleX",c)&&(p=p||o),d||n||u.set("scaleY",l)&&(p=p||h)):p=this._scaleObjectEqually(t,u,e,a),e.newScaleX=c,e.newScaleY=l,f||d||this._flipObject(e,r),p},_scaleObjectEqually:function(t,e,i,n){var r,s=t.y+t.x,a=n.y*i.original.scaleY/e.scaleY+n.x*i.original.scaleX/e.scaleX,o=t.x<0?-1:1,h=t.y<0?-1:1;return i.newScaleX=o*Math.abs(i.original.scaleX*s/a),i.newScaleY=h*Math.abs(i.original.scaleY*s/a),r=i.newScaleX!==e.scaleX||i.newScaleY!==e.scaleY,e.set("scaleX",i.newScaleX),e.set("scaleY",i.newScaleY),r},_flipObject:function(t,e){t.newScaleX<0&&"y"!==e&&("left"===t.originX?t.originX="right":"right"===t.originX&&(t.originX="left")),t.newScaleY<0&&"x"!==e&&("top"===t.originY?t.originY="bottom":"bottom"===t.originY&&(t.originY="top"))},_setLocalMouse:function(t,e){var i=e.target,n=this.getZoom(),s=i.padding/n;"right"===e.originX?t.x*=-1:"center"===e.originX&&(t.x*=2*e.mouseXSign,t.x<0&&(e.mouseXSign=-e.mouseXSign)),"bottom"===e.originY?t.y*=-1:"center"===e.originY&&(t.y*=2*e.mouseYSign,t.y<0&&(e.mouseYSign=-e.mouseYSign)),r(t.x)>s?t.x<0?t.x+=s:t.x-=s:t.x=0,r(t.y)>s?t.y<0?t.y+=s:t.y-=s:t.y=0},_rotateObject:function(t,e){var r=this._currentTransform,s=r.target,a=s.translateToOriginPoint(s.getCenterPoint(),r.originX,r.originY);if(s.lockRotation)return!1;var o=n(r.ey-a.y,r.ex-a.x),h=n(e-a.y,t-a.x),c=i(h-o+r.theta),l=!0;if(s.snapAngle>0){var u=s.snapAngle,f=s.snapThreshold||u,d=Math.ceil(c/u)*u,p=Math.floor(c/u)*u;Math.abs(c-p)<f?c=p:Math.abs(c-d)<f&&(c=d)}return c<0&&(c=360+c),c%=360,s.angle===c?l=!1:(s.angle=c,s.setPositionByOrigin(a,r.originX,r.originY)),l},setCursor:function(t){this.upperCanvasEl.style.cursor=t},_drawSelection:function(t){var e=this._groupSelector,i=e.left,n=e.top,a=r(i),o=r(n);if(this.selectionColor&&(t.fillStyle=this.selectionColor,t.fillRect(e.ex-(i>0?0:-i),e.ey-(n>0?0:-n),a,o)),this.selectionLineWidth&&this.selectionBorderColor)if(t.lineWidth=this.selectionLineWidth,t.strokeStyle=this.selectionBorderColor,this.selectionDashArray.length>1&&!s){var h=e.ex+.5-(i>0?0:a),c=e.ey+.5-(n>0?0:o);t.beginPath(),b.util.drawDashedLine(t,h,c,h+a,c,this.selectionDashArray),b.util.drawDashedLine(t,h,c+o-1,h+a,c+o-1,this.selectionDashArray),b.util.drawDashedLine(t,h,c,h,c+o,this.selectionDashArray),b.util.drawDashedLine(t,h+a-1,c,h+a-1,c+o,this.selectionDashArray),t.closePath(),t.stroke()}else b.Object.prototype._setLineDash.call(this,t,this.selectionDashArray),t.strokeRect(e.ex+.5-(i>0?0:a),e.ey+.5-(n>0?0:o),a,o)},findTarget:function(t,e){if(!this.skipTargetFind){var i,n,r=this.getPointer(t,!0),s=this._activeObject,a=this.getActiveObjects();if(this.targets=[],a.length>1&&!e&&s===this._searchPossibleTargets([s],r))return s;if(1===a.length&&s._findTargetCorner(r))return s;if(1===a.length&&s===this._searchPossibleTargets([s],r)){if(!this.preserveObjectStacking)return s;i=s,n=this.targets,this.targets=[]}var o=this._searchPossibleTargets(this._objects,r);return t[this.altSelectionKey]&&o&&i&&o!==i&&(o=i,this.targets=n),o}},_checkTarget:function(t,e,i){if(e&&e.visible&&e.evented&&this.containsPoint(null,e,t)){if(!this.perPixelTargetFind&&!e.perPixelTargetFind||e.isEditing)return!0;if(!this.isTargetTransparent(e,i.x,i.y))return!0}},_searchPossibleTargets:function(t,e){for(var i,n,r=t.length;r--;){var s=t[r],a=s.group&&"activeSelection"!==s.group.type?this._normalizePointer(s.group,e):e;if(this._checkTarget(a,s,e)){(i=t[r]).subTargetCheck&&i instanceof b.Group&&(n=this._searchPossibleTargets(i._objects,e))&&this.targets.push(n);break}}return i},restorePointerVpt:function(t){return b.util.transformPoint(t,b.util.invertTransform(this.viewportTransform))},getPointer:function(e,i){if(this._absolutePointer&&!i)return this._absolutePointer;if(this._pointer&&i)return this._pointer;var n,r=t(e),s=this.upperCanvasEl,a=s.getBoundingClientRect(),o=a.width||0,h=a.height||0;return o&&h||("top"in a&&"bottom"in a&&(h=Math.abs(a.top-a.bottom)),"right"in a&&"left"in a&&(o=Math.abs(a.right-a.left))),this.calcOffset(),r.x=r.x-this._offset.left,r.y=r.y-this._offset.top,i||(r=this.restorePointerVpt(r)),n=0===o||0===h?{width:1,height:1}:{width:s.width/o,height:s.height/h},{x:r.x*n.width,y:r.y*n.height}},_createUpperCanvas:function(){var t=this.lowerCanvasEl.className.replace(/\s*lower-canvas\s*/,"");this.upperCanvasEl?this.upperCanvasEl.className="":this.upperCanvasEl=this._createCanvasElement(),b.util.addClass(this.upperCanvasEl,"upper-canvas "+t),this.wrapperEl.appendChild(this.upperCanvasEl),this._copyCanvasStyle(this.lowerCanvasEl,this.upperCanvasEl),this._applyCanvasStyle(this.upperCanvasEl),this.contextTop=this.upperCanvasEl.getContext("2d")},_createCacheCanvas:function(){this.cacheCanvasEl=this._createCanvasElement(),this.cacheCanvasEl.setAttribute("width",this.width),this.cacheCanvasEl.setAttribute("height",this.height),this.contextCache=this.cacheCanvasEl.getContext("2d")},_initWrapperElement:function(){this.wrapperEl=b.util.wrapElement(this.lowerCanvasEl,"div",{class:this.containerClass}),b.util.setStyle(this.wrapperEl,{width:this.width+"px",height:this.height+"px",position:"relative"}),b.util.makeElementUnselectable(this.wrapperEl)},_applyCanvasStyle:function(t){var e=this.width||t.width,i=this.height||t.height;b.util.setStyle(t,{position:"absolute",width:e+"px",height:i+"px",left:0,top:0,"touch-action":this.allowTouchScrolling?"manipulation":"none"}),t.width=e,t.height=i,b.util.makeElementUnselectable(t)},_copyCanvasStyle:function(t,e){e.style.cssText=t.style.cssText},getSelectionContext:function(){return this.contextTop},getSelectionElement:function(){return this.upperCanvasEl},getActiveObject:function(){return this._activeObject},getActiveObjects:function(){var t=this._activeObject;return t?"activeSelection"===t.type&&t._objects?t._objects.slice(0):[t]:[]},_onObjectRemoved:function(t){t===this._activeObject&&(this.fire("before:selection:cleared",{target:t}),this._discardActiveObject(),this.fire("selection:cleared",{target:t}),t.fire("deselected")),this._hoveredTarget===t&&(this._hoveredTarget=null),this.callSuper("_onObjectRemoved",t)},_fireSelectionEvents:function(t,e){var i=!1,n=this.getActiveObjects(),r=[],s=[],a={e:e};t.forEach(function(t){-1===n.indexOf(t)&&(i=!0,t.fire("deselected",a),s.push(t))}),n.forEach(function(e){-1===t.indexOf(e)&&(i=!0,e.fire("selected",a),r.push(e))}),t.length>0&&n.length>0?(a.selected=r,a.deselected=s,a.updated=r[0]||s[0],a.target=this._activeObject,i&&this.fire("selection:updated",a)):n.length>0?(1===n.length&&(a.target=r[0],this.fire("object:selected",a)),a.selected=r,a.target=this._activeObject,this.fire("selection:created",a)):t.length>0&&(a.deselected=s,this.fire("selection:cleared",a))},setActiveObject:function(t,e){var i=this.getActiveObjects();return this._setActiveObject(t,e),this._fireSelectionEvents(i,e),this},_setActiveObject:function(t,e){return this._activeObject!==t&&(!!this._discardActiveObject(e,t)&&(!t.onSelect({e:e})&&(this._activeObject=t,!0)))},_discardActiveObject:function(t,e){var i=this._activeObject;if(i){if(i.onDeselect({e:t,object:e}))return!1;this._activeObject=null}return!0},discardActiveObject:function(t){var e=this.getActiveObjects();return e.length&&this.fire("before:selection:cleared",{target:e[0],e:t}),this._discardActiveObject(t),this._fireSelectionEvents(e,t),this},dispose:function(){var t=this.wrapperEl;return this.removeListeners(),t.removeChild(this.upperCanvasEl),t.removeChild(this.lowerCanvasEl),this.contextCache=null,this.contextTop=null,["upperCanvasEl","cacheCanvasEl"].forEach(function(t){b.util.cleanUpJsdomNode(this[t]),this[t]=void 0}.bind(this)),t.parentNode&&t.parentNode.replaceChild(this.lowerCanvasEl,this.wrapperEl),delete this.wrapperEl,b.StaticCanvas.prototype.dispose.call(this),this},clear:function(){return this.discardActiveObject(),this.clearContext(this.contextTop),this.callSuper("clear")},drawControls:function(t){var e=this._activeObject;e&&e._renderControls(t)},_toObject:function(t,e,i){var n=this._realizeGroupTransformOnObject(t),r=this.callSuper("_toObject",t,e,i);return this._unwindGroupTransformOnObject(t,n),r},_realizeGroupTransformOnObject:function(t){if(t.group&&"activeSelection"===t.group.type&&this._activeObject===t.group){var e={};return["angle","flipX","flipY","left","scaleX","scaleY","skewX","skewY","top"].forEach(function(i){e[i]=t[i]}),this._activeObject.realizeTransform(t),e}return null},_unwindGroupTransformOnObject:function(t,e){e&&t.set(e)},_setSVGObject:function(t,e,i){var n=this._realizeGroupTransformOnObject(e);this.callSuper("_setSVGObject",t,e,i),this._unwindGroupTransformOnObject(e,n)},setViewportTransform:function(t){this.renderOnAddRemove&&this._activeObject&&this._activeObject.isEditing&&this._activeObject.clearContextTop(),b.StaticCanvas.prototype.setViewportTransform.call(this,t)}}),b.StaticCanvas)"prototype"!==a&&(b.Canvas[a]=b.StaticCanvas[a]);b.isTouchSupported&&(b.Canvas.prototype._setCursorFromEvent=function(){})}(),function(){var t={mt:0,tr:1,mr:2,br:3,mb:4,bl:5,ml:6,tl:7},e=b.util.addListener,i=b.util.removeListener,n={passive:!1};function r(t,e){return"which"in t?t.which===e:t.button===e-1}b.util.object.extend(b.Canvas.prototype,{cursorMap:["n-resize","ne-resize","e-resize","se-resize","s-resize","sw-resize","w-resize","nw-resize"],_initEventListeners:function(){this.removeListeners(),this._bindEvents(),this.addOrRemove(e,"add")},addOrRemove:function(t,e){t(b.window,"resize",this._onResize),t(this.upperCanvasEl,"mousedown",this._onMouseDown),t(this.upperCanvasEl,"mousemove",this._onMouseMove,n),t(this.upperCanvasEl,"mouseout",this._onMouseOut),t(this.upperCanvasEl,"mouseenter",this._onMouseEnter),t(this.upperCanvasEl,"wheel",this._onMouseWheel),t(this.upperCanvasEl,"contextmenu",this._onContextMenu),t(this.upperCanvasEl,"dblclick",this._onDoubleClick),t(this.upperCanvasEl,"touchstart",this._onMouseDown,n),t(this.upperCanvasEl,"touchmove",this._onMouseMove,n),t(this.upperCanvasEl,"dragover",this._onDragOver),t(this.upperCanvasEl,"dragenter",this._onDragEnter),t(this.upperCanvasEl,"dragleave",this._onDragLeave),t(this.upperCanvasEl,"drop",this._onDrop),"undefined"!=typeof eventjs&&e in eventjs&&(eventjs[e](this.upperCanvasEl,"gesture",this._onGesture),eventjs[e](this.upperCanvasEl,"drag",this._onDrag),eventjs[e](this.upperCanvasEl,"orientation",this._onOrientationChange),eventjs[e](this.upperCanvasEl,"shake",this._onShake),eventjs[e](this.upperCanvasEl,"longpress",this._onLongPress))},removeListeners:function(){this.addOrRemove(i,"remove"),i(b.document,"mouseup",this._onMouseUp),i(b.document,"touchend",this._onMouseUp,n),i(b.document,"mousemove",this._onMouseMove,n),i(b.document,"touchmove",this._onMouseMove,n)},_bindEvents:function(){this.eventsBound||(this._onMouseDown=this._onMouseDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onResize=this._onResize.bind(this),this._onGesture=this._onGesture.bind(this),this._onDrag=this._onDrag.bind(this),this._onShake=this._onShake.bind(this),this._onLongPress=this._onLongPress.bind(this),this._onOrientationChange=this._onOrientationChange.bind(this),this._onMouseWheel=this._onMouseWheel.bind(this),this._onMouseOut=this._onMouseOut.bind(this),this._onMouseEnter=this._onMouseEnter.bind(this),this._onContextMenu=this._onContextMenu.bind(this),this._onDoubleClick=this._onDoubleClick.bind(this),this._onDragOver=this._onDragOver.bind(this),this._onDragEnter=this._simpleEventHandler.bind(this,"dragenter"),this._onDragLeave=this._simpleEventHandler.bind(this,"dragleave"),this._onDrop=this._simpleEventHandler.bind(this,"drop"),this.eventsBound=!0)},_onGesture:function(t,e){this.__onTransformGesture&&this.__onTransformGesture(t,e)},_onDrag:function(t,e){this.__onDrag&&this.__onDrag(t,e)},_onMouseWheel:function(t){this.__onMouseWheel(t)},_onMouseOut:function(t){var e=this._hoveredTarget;this.fire("mouse:out",{target:e,e:t}),this._hoveredTarget=null,e&&e.fire("mouseout",{e:t}),this._iTextInstances&&this._iTextInstances.forEach(function(t){t.isEditing&&t.hiddenTextarea.focus()})},_onMouseEnter:function(t){this.findTarget(t)||(this.fire("mouse:over",{target:null,e:t}),this._hoveredTarget=null)},_onOrientationChange:function(t,e){this.__onOrientationChange&&this.__onOrientationChange(t,e)},_onShake:function(t,e){this.__onShake&&this.__onShake(t,e)},_onLongPress:function(t,e){this.__onLongPress&&this.__onLongPress(t,e)},_onDragOver:function(t){t.preventDefault();var e=this._simpleEventHandler("dragover",t);this._fireEnterLeaveEvents(e,t)},_onContextMenu:function(t){return this.stopContextMenu&&(t.stopPropagation(),t.preventDefault()),!1},_onDoubleClick:function(t){this._cacheTransformEventData(t),this._handleEvent(t,"dblclick"),this._resetTransformEventData(t)},_onMouseDown:function(t){this.__onMouseDown(t),this._resetTransformEventData(),e(b.document,"touchend",this._onMouseUp,n),e(b.document,"touchmove",this._onMouseMove,n),i(this.upperCanvasEl,"mousemove",this._onMouseMove,n),i(this.upperCanvasEl,"touchmove",this._onMouseMove,n),"touchstart"===t.type?i(this.upperCanvasEl,"mousedown",this._onMouseDown):(e(b.document,"mouseup",this._onMouseUp),e(b.document,"mousemove",this._onMouseMove,n))},_onMouseUp:function(t){if(this.__onMouseUp(t),this._resetTransformEventData(),i(b.document,"mouseup",this._onMouseUp),i(b.document,"touchend",this._onMouseUp,n),i(b.document,"mousemove",this._onMouseMove,n),i(b.document,"touchmove",this._onMouseMove,n),e(this.upperCanvasEl,"mousemove",this._onMouseMove,n),e(this.upperCanvasEl,"touchmove",this._onMouseMove,n),"touchend"===t.type){var r=this;setTimeout(function(){e(r.upperCanvasEl,"mousedown",r._onMouseDown)},400)}},_onMouseMove:function(t){!this.allowTouchScrolling&&t.preventDefault&&t.preventDefault(),this.__onMouseMove(t)},_onResize:function(){this.calcOffset()},_shouldRender:function(t){var e=this._activeObject;return!!(!!e!=!!t||e&&t&&e!==t)||(e&&e.isEditing,!1)},__onMouseUp:function(t){var e,i=this._currentTransform,n=this._groupSelector,s=!1,a=!n||0===n.left&&0===n.top;if(this._cacheTransformEventData(t),e=this._target,this._handleEvent(t,"up:before"),!r(t,3))return r(t,2)?(this.fireMiddleClick&&this._handleEvent(t,"up",2,a),void this._resetTransformEventData()):void(this.isDrawingMode&&this._isCurrentlyDrawing?this._onMouseUpInDrawingMode(t):(i&&(this._finalizeCurrentTransform(t),s=i.actionPerformed),a||(this._maybeGroupObjects(t),s||(s=this._shouldRender(e))),e&&(e.isMoving=!1),this._setCursorFromEvent(t,e),this._handleEvent(t,"up",1,a),this._groupSelector=null,this._currentTransform=null,e&&(e.__corner=0),s?this.requestRenderAll():a||this.renderTop()));this.fireRightClick&&this._handleEvent(t,"up",3,a)},_simpleEventHandler:function(t,e){var i=this.findTarget(e),n=this.targets,r={e:e,target:i,subTargets:n};if(this.fire(t,r),i&&i.fire(t,r),!n)return i;for(var s=0;s<n.length;s++)n[s].fire(t,r);return i},_handleEvent:function(t,e,i,n){var r=this._target,s=this.targets||[],a={e:t,target:r,subTargets:s,button:i||1,isClick:n||!1,pointer:this._pointer,absolutePointer:this._absolutePointer,transform:this._currentTransform};this.fire("mouse:"+e,a),r&&r.fire("mouse"+e,a);for(var o=0;o<s.length;o++)s[o].fire("mouse"+e,a)},_finalizeCurrentTransform:function(t){var e,i=this._currentTransform,n=i.target,r={e:t,target:n,transform:i};n._scaling&&(n._scaling=!1),n.setCoords(),(i.actionPerformed||this.stateful&&n.hasStateChanged())&&(i.actionPerformed&&(e=this._addEventOptions(r,i),this._fire(e,r)),this._fire("modified",r))},_addEventOptions:function(t,e){var i,n;switch(e.action){case"scaleX":i="scaled",n="x";break;case"scaleY":i="scaled",n="y";break;case"skewX":i="skewed",n="x";break;case"skewY":i="skewed",n="y";break;case"scale":i="scaled",n="equally";break;case"rotate":i="rotated";break;case"drag":i="moved"}return t.by=n,i},_onMouseDownInDrawingMode:function(t){this._isCurrentlyDrawing=!0,this.getActiveObject()&&this.discardActiveObject(t).requestRenderAll(),this.clipTo&&b.util.clipContext(this,this.contextTop);var e=this.getPointer(t);this.freeDrawingBrush.onMouseDown(e),this._handleEvent(t,"down")},_onMouseMoveInDrawingMode:function(t){if(this._isCurrentlyDrawing){var e=this.getPointer(t);this.freeDrawingBrush.onMouseMove(e)}this.setCursor(this.freeDrawingCursor),this._handleEvent(t,"move")},_onMouseUpInDrawingMode:function(t){this._isCurrentlyDrawing=!1,this.clipTo&&this.contextTop.restore(),this.freeDrawingBrush.onMouseUp(),this._handleEvent(t,"up")},__onMouseDown:function(t){this._cacheTransformEventData(t),this._handleEvent(t,"down:before");var e=this._target;if(r(t,3))this.fireRightClick&&this._handleEvent(t,"down",3);else if(r(t,2))this.fireMiddleClick&&this._handleEvent(t,"down",2);else if(this.isDrawingMode)this._onMouseDownInDrawingMode(t);else if(!this._currentTransform){var i=this._pointer;this._previousPointer=i;var n=this._shouldRender(e),s=this._shouldGroup(t,e);this._shouldClearSelection(t,e)?this.discardActiveObject(t):s&&(this._handleGrouping(t,e),e=this._activeObject),!this.selection||e&&(e.selectable||e.isEditing||e===this._activeObject)||(this._groupSelector={ex:i.x,ey:i.y,top:0,left:0}),e&&(e.selectable&&this.setActiveObject(e,t),e!==this._activeObject||!e.__corner&&s||this._setupCurrentTransform(t,e)),this._handleEvent(t,"down"),(n||s)&&this.requestRenderAll()}},_resetTransformEventData:function(){this._target=null,this._pointer=null,this._absolutePointer=null},_cacheTransformEventData:function(t){this._resetTransformEventData(),this._pointer=this.getPointer(t,!0),this._absolutePointer=this.restorePointerVpt(this._pointer),this._target=this._currentTransform?this._currentTransform.target:this.findTarget(t)||null},_beforeTransform:function(t){var e=this._currentTransform;this.stateful&&e.target.saveState(),this.fire("before:transform",{e:t,transform:e}),e.corner&&this.onBeforeScaleRotate(e.target)},__onMouseMove:function(t){var e,i;if(this._handleEvent(t,"move:before"),this._cacheTransformEventData(t),this.isDrawingMode)this._onMouseMoveInDrawingMode(t);else if(!(void 0!==t.touches&&t.touches.length>1)){var n=this._groupSelector;n?(i=this._pointer,n.left=i.x-n.ex,n.top=i.y-n.ey,this.renderTop()):this._currentTransform?this._transformObject(t):(e=this.findTarget(t)||null,this._setCursorFromEvent(t,e),this._fireOverOutEvents(e,t)),this._handleEvent(t,"move"),this._resetTransformEventData()}},_fireOverOutEvents:function(t,e){this.fireSynteticInOutEvents(t,e,{targetName:"_hoveredTarget",canvasEvtOut:"mouse:out",evtOut:"mouseout",canvasEvtIn:"mouse:over",evtIn:"mouseover"})},_fireEnterLeaveEvents:function(t,e){this.fireSynteticInOutEvents(t,e,{targetName:"_draggedoverTarget",evtOut:"dragleave",evtIn:"dragenter"})},fireSynteticInOutEvents:function(t,e,i){var n,r,s,a=this[i.targetName],o=a!==t,h=i.canvasEvtIn,c=i.canvasEvtOut;o&&(n={e:e,target:t,previousTarget:a},r={e:e,target:a,nextTarget:t},this[i.targetName]=t),s=t&&o,a&&o&&(c&&this.fire(c,r),a.fire(i.evtOut,r)),s&&(h&&this.fire(h,n),t.fire(i.evtIn,n))},__onMouseWheel:function(t){this._cacheTransformEventData(t),this._handleEvent(t,"wheel"),this._resetTransformEventData()},_transformObject:function(t){var e=this.getPointer(t),i=this._currentTransform;i.reset=!1,i.target.isMoving=!0,i.shiftKey=t.shiftKey,i.altKey=t[this.centeredKey],this._beforeScaleTransform(t,i),this._performTransformAction(t,i,e),i.actionPerformed&&this.requestRenderAll()},_performTransformAction:function(t,e,i){var n=i.x,r=i.y,s=e.action,a=!1,o={target:e.target,e:t,transform:e,pointer:i};"rotate"===s?(a=this._rotateObject(n,r))&&this._fire("rotating",o):"scale"===s?(a=this._onScale(t,e,n,r))&&this._fire("scaling",o):"scaleX"===s?(a=this._scaleObject(n,r,"x"))&&this._fire("scaling",o):"scaleY"===s?(a=this._scaleObject(n,r,"y"))&&this._fire("scaling",o):"skewX"===s?(a=this._skewObject(n,r,"x"))&&this._fire("skewing",o):"skewY"===s?(a=this._skewObject(n,r,"y"))&&this._fire("skewing",o):(a=this._translateObject(n,r))&&(this._fire("moving",o),this.setCursor(o.target.moveCursor||this.moveCursor)),e.actionPerformed=e.actionPerformed||a},_fire:function(t,e){this.fire("object:"+t,e),e.target.fire(t,e)},_beforeScaleTransform:function(t,e){if("scale"===e.action||"scaleX"===e.action||"scaleY"===e.action){var i=this._shouldCenterTransform(e.target);(i&&("center"!==e.originX||"center"!==e.originY)||!i&&"center"===e.originX&&"center"===e.originY)&&(this._resetCurrentTransform(),e.reset=!0)}},_onScale:function(t,e,i,n){return this._isUniscalePossible(t,e.target)?(e.currentAction="scale",this._scaleObject(i,n)):(e.reset||"scale"!==e.currentAction||this._resetCurrentTransform(),e.currentAction="scaleEqually",this._scaleObject(i,n,"equally"))},_isUniscalePossible:function(t,e){return(t[this.uniScaleKey]||this.uniScaleTransform)&&!e.get("lockUniScaling")},_setCursorFromEvent:function(t,e){if(!e)return this.setCursor(this.defaultCursor),!1;var i=e.hoverCursor||this.hoverCursor,n=this._activeObject&&"activeSelection"===this._activeObject.type?this._activeObject:null,r=(!n||!n.contains(e))&&e._findTargetCorner(this.getPointer(t,!0));r?this.setCursor(this.getCornerCursor(r,e,t)):this.setCursor(i)},getCornerCursor:function(e,i,n){return this.actionIsDisabled(e,i,n)?this.notAllowedCursor:e in t?this._getRotatedCornerCursor(e,i,n):"mtr"===e&&i.hasRotatingPoint?this.rotationCursor:this.defaultCursor},actionIsDisabled:function(t,e,i){return"mt"===t||"mb"===t?i[this.altActionKey]?e.lockSkewingX:e.lockScalingY:"ml"===t||"mr"===t?i[this.altActionKey]?e.lockSkewingY:e.lockScalingX:"mtr"===t?e.lockRotation:this._isUniscalePossible(i,e)?e.lockScalingX&&e.lockScalingY:e.lockScalingX||e.lockScalingY},_getRotatedCornerCursor:function(e,i,n){var r=Math.round(i.angle%360/45);return r<0&&(r+=8),r+=t[e],n[this.altActionKey]&&t[e]%2==0&&(r+=2),r%=8,this.cursorMap[r]}})}(),u=Math.min,f=Math.max,b.util.object.extend(b.Canvas.prototype,{_shouldGroup:function(t,e){var i=this._activeObject;return i&&this._isSelectionKeyPressed(t)&&e&&e.selectable&&this.selection&&(i!==e||"activeSelection"===i.type)&&!e.onSelect({e:t})},_handleGrouping:function(t,e){var i=this._activeObject;i.__corner||(e!==i||(e=this.findTarget(t,!0))&&e.selectable)&&(i&&"activeSelection"===i.type?this._updateActiveSelection(e,t):this._createActiveSelection(e,t))},_updateActiveSelection:function(t,e){var i=this._activeObject,n=i._objects.slice(0);i.contains(t)?(i.removeWithUpdate(t),this._hoveredTarget=t,1===i.size()&&this._setActiveObject(i.item(0),e)):(i.addWithUpdate(t),this._hoveredTarget=i),this._fireSelectionEvents(n,e)},_createActiveSelection:function(t,e){var i=this.getActiveObjects(),n=this._createGroup(t);this._hoveredTarget=n,this._setActiveObject(n,e),this._fireSelectionEvents(i,e)},_createGroup:function(t){var e=this._objects,i=e.indexOf(this._activeObject)<e.indexOf(t)?[this._activeObject,t]:[t,this._activeObject];return this._activeObject.isEditing&&this._activeObject.exitEditing(),new b.ActiveSelection(i,{canvas:this})},_groupSelectedObjects:function(t){var e,i=this._collectObjects(t);1===i.length?this.setActiveObject(i[0],t):i.length>1&&(e=new b.ActiveSelection(i.reverse(),{canvas:this}),this.setActiveObject(e,t))},_collectObjects:function(t){for(var e,i=[],n=this._groupSelector.ex,r=this._groupSelector.ey,s=n+this._groupSelector.left,a=r+this._groupSelector.top,o=new b.Point(u(n,s),u(r,a)),h=new b.Point(f(n,s),f(r,a)),c=!this.selectionFullyContained,l=n===s&&r===a,d=this._objects.length;d--&&!((e=this._objects[d])&&e.selectable&&e.visible&&!e.onSelect({e:t})&&(c&&e.intersectsWithRect(o,h)||e.isContainedWithinRect(o,h)||c&&e.containsPoint(o)||c&&e.containsPoint(h))&&(i.push(e),l)););return i},_maybeGroupObjects:function(t){this.selection&&this._groupSelector&&this._groupSelectedObjects(t),this.setCursor(this.defaultCursor),this._groupSelector=null}}),d=b.StaticCanvas.supports("toDataURLWithQuality"),b.util.object.extend(b.StaticCanvas.prototype,{toDataURL:function(t){t||(t={});var e=t.format||"png",i=t.quality||1,n=(t.multiplier||1)*(t.enableRetinaScaling?1:1/this.getRetinaScaling()),r={left:t.left||0,top:t.top||0,width:t.width||0,height:t.height||0};return this.__toDataURLWithMultiplier(e,i,r,n)},__toDataURLWithMultiplier:function(t,e,i,n){var r=this.width,s=this.height,a=(i.width||this.width)*n,o=(i.height||this.height)*n,h=this.getZoom()*n,c=this.viewportTransform,l=[h,0,0,h,(c[4]-i.left)*n,(c[5]-i.top)*n],u=this.interactive,f=this.skipOffscreen,d=r!==a||s!==o;this.viewportTransform=l,this.skipOffscreen=!1,this.interactive=!1,d&&this.setDimensions({width:a,height:o},{backstoreOnly:!0}),this.renderAll();var p=this.__toDataURL(t,e,i);return this.interactive=u,this.skipOffscreen=f,this.viewportTransform=c,d&&this.setDimensions({width:r,height:s},{backstoreOnly:!0}),this.renderAll(),p},__toDataURL:function(t,e){var i=this.contextContainer.canvas;return d?i.toDataURL("image/"+t,e):i.toDataURL("image/"+t)}}),b.util.object.extend(b.StaticCanvas.prototype,{loadFromDatalessJSON:function(t,e,i){return this.loadFromJSON(t,e,i)},loadFromJSON:function(t,e,i){if(t){var n="string"==typeof t?JSON.parse(t):b.util.object.clone(t),r=this,s=this.renderOnAddRemove;return this.renderOnAddRemove=!1,this._enlivenObjects(n.objects,function(t){r.clear(),r._setBgOverlay(n,function(){t.forEach(function(t,e){r.insertAt(t,e)}),r.renderOnAddRemove=s,delete n.objects,delete n.backgroundImage,delete n.overlayImage,delete n.background,delete n.overlay,r._setOptions(n),r.renderAll(),e&&e()})},i),this}},_setBgOverlay:function(t,e){var i={backgroundColor:!1,overlayColor:!1,backgroundImage:!1,overlayImage:!1};if(t.backgroundImage||t.overlayImage||t.background||t.overlay){var n=function(){i.backgroundImage&&i.overlayImage&&i.backgroundColor&&i.overlayColor&&e&&e()};this.__setBgOverlay("backgroundImage",t.backgroundImage,i,n),this.__setBgOverlay("overlayImage",t.overlayImage,i,n),this.__setBgOverlay("backgroundColor",t.background,i,n),this.__setBgOverlay("overlayColor",t.overlay,i,n)}else e&&e()},__setBgOverlay:function(t,e,i,n){var r=this;if(!e)return i[t]=!0,void(n&&n());"backgroundImage"===t||"overlayImage"===t?b.util.enlivenObjects([e],function(e){r[t]=e[0],i[t]=!0,n&&n()}):this["set"+b.util.string.capitalize(t,!0)](e,function(){i[t]=!0,n&&n()})},_enlivenObjects:function(t,e,i){t&&0!==t.length?b.util.enlivenObjects(t,function(t){e&&e(t)},null,i):e&&e([])},_toDataURL:function(t,e){this.clone(function(i){e(i.toDataURL(t))})},_toDataURLWithMultiplier:function(t,e,i){this.clone(function(n){i(n.toDataURLWithMultiplier(t,e))})},clone:function(t,e){var i=JSON.stringify(this.toJSON(e));this.cloneWithoutData(function(e){e.loadFromJSON(i,function(){t&&t(e)})})},cloneWithoutData:function(t){var e=b.util.createCanvasElement();e.width=this.width,e.height=this.height;var i=new b.Canvas(e);i.clipTo=this.clipTo,this.backgroundImage?(i.setBackgroundImage(this.backgroundImage.src,function(){i.renderAll(),t&&t(i)}),i.backgroundImageOpacity=this.backgroundImageOpacity,i.backgroundImageStretch=this.backgroundImageStretch):t&&t(i)}}),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.extend,n=e.util.object.clone,r=e.util.toFixed,s=e.util.string.capitalize,a=e.util.degreesToRadians,o=e.StaticCanvas.supports("setLineDash"),h=!e.isLikelyNode;e.Object||(e.Object=e.util.createClass(e.CommonMethods,{type:"object",originX:"left",originY:"top",top:0,left:0,width:0,height:0,scaleX:1,scaleY:1,flipX:!1,flipY:!1,opacity:1,angle:0,skewX:0,skewY:0,cornerSize:13,transparentCorners:!0,hoverCursor:null,moveCursor:null,padding:0,borderColor:"rgba(102,153,255,0.75)",borderDashArray:null,cornerColor:"rgba(102,153,255,0.5)",cornerStrokeColor:null,cornerStyle:"rect",cornerDashArray:null,centeredScaling:!1,centeredRotation:!0,fill:"rgb(0,0,0)",fillRule:"nonzero",globalCompositeOperation:"source-over",backgroundColor:"",selectionBackgroundColor:"",stroke:null,strokeWidth:1,strokeDashArray:null,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:4,shadow:null,borderOpacityWhenMoving:.4,borderScaleFactor:1,transformMatrix:null,minScaleLimit:0,selectable:!0,evented:!0,visible:!0,hasControls:!0,hasBorders:!0,hasRotatingPoint:!0,rotatingPointOffset:40,perPixelTargetFind:!1,includeDefaultValues:!0,clipTo:null,lockMovementX:!1,lockMovementY:!1,lockRotation:!1,lockScalingX:!1,lockScalingY:!1,lockUniScaling:!1,lockSkewingX:!1,lockSkewingY:!1,lockScalingFlip:!1,excludeFromExport:!1,objectCaching:h,statefullCache:!1,noScaleCache:!0,dirty:!0,__corner:0,paintFirst:"fill",stateProperties:"top left width height scaleX scaleY flipX flipY originX originY transformMatrix stroke strokeWidth strokeDashArray strokeLineCap strokeLineJoin strokeMiterLimit angle opacity fill globalCompositeOperation shadow clipTo visible backgroundColor skewX skewY fillRule paintFirst".split(" "),cacheProperties:"fill stroke strokeWidth strokeDashArray width height paintFirst strokeLineCap strokeLineJoin strokeMiterLimit backgroundColor".split(" "),clipPath:void 0,inverted:!1,absolutePositioned:!1,initialize:function(t){t&&this.setOptions(t)},_createCacheCanvas:function(){this._cacheProperties={},this._cacheCanvas=e.util.createCanvasElement(),this._cacheContext=this._cacheCanvas.getContext("2d"),this._updateCacheCanvas(),this.dirty=!0},_limitCacheSize:function(t){var i=e.perfLimitSizeTotal,n=t.width,r=t.height,s=e.maxCacheSideLimit,a=e.minCacheSideLimit;if(n<=s&&r<=s&&n*r<=i)return n<a&&(t.width=a),r<a&&(t.height=a),t;var o=n/r,h=e.util.limitDimsByArea(o,i),c=e.util.capValue,l=c(a,h.x,s),u=c(a,h.y,s);return n>l&&(t.zoomX/=n/l,t.width=l,t.capped=!0),r>u&&(t.zoomY/=r/u,t.height=u,t.capped=!0),t},_getCacheCanvasDimensions:function(){var t=this.getTotalObjectScaling(),e=this._getNonTransformedDimensions(),i=t.scaleX,n=t.scaleY;return{width:e.x*i+2,height:e.y*n+2,zoomX:i,zoomY:n,x:e.x,y:e.y}},_updateCacheCanvas:function(){var t=this.canvas;if(this.noScaleCache&&t&&t._currentTransform){var i=t._currentTransform.target,n=t._currentTransform.action;if(this===i&&n.slice&&"scale"===n.slice(0,5))return!1}var r,s,a=this._cacheCanvas,o=this._limitCacheSize(this._getCacheCanvasDimensions()),h=e.minCacheSideLimit,c=o.width,l=o.height,u=o.zoomX,f=o.zoomY,d=c!==this.cacheWidth||l!==this.cacheHeight,p=this.zoomX!==u||this.zoomY!==f,g=d||p,v=0,_=0,m=!1;if(d){var y=this._cacheCanvas.width,x=this._cacheCanvas.height,b=c>y||l>x;m=b||(c<.9*y||l<.9*x)&&y>h&&x>h,b&&!o.capped&&(c>h||l>h)&&(v=.1*c,_=.1*l)}return!!g&&(m?(a.width=Math.ceil(c+v),a.height=Math.ceil(l+_)):(this._cacheContext.setTransform(1,0,0,1,0,0),this._cacheContext.clearRect(0,0,a.width,a.height)),r=o.x*u/2,s=o.y*f/2,this.cacheTranslationX=Math.round(a.width/2-r)+r,this.cacheTranslationY=Math.round(a.height/2-s)+s,this.cacheWidth=c,this.cacheHeight=l,this._cacheContext.translate(this.cacheTranslationX,this.cacheTranslationY),this._cacheContext.scale(u,f),this.zoomX=u,this.zoomY=f,!0)},setOptions:function(t){this._setOptions(t),this._initGradient(t.fill,"fill"),this._initGradient(t.stroke,"stroke"),this._initClipping(t),this._initPattern(t.fill,"fill"),this._initPattern(t.stroke,"stroke")},transform:function(t){var e;e=this.group&&!this.group._transformDone?this.calcTransformMatrix():this.calcOwnMatrix(),t.transform(e[0],e[1],e[2],e[3],e[4],e[5])},toObject:function(t){var i=e.Object.NUM_FRACTION_DIGITS,n={type:this.type,version:e.version,originX:this.originX,originY:this.originY,left:r(this.left,i),top:r(this.top,i),width:r(this.width,i),height:r(this.height,i),fill:this.fill&&this.fill.toObject?this.fill.toObject():this.fill,stroke:this.stroke&&this.stroke.toObject?this.stroke.toObject():this.stroke,strokeWidth:r(this.strokeWidth,i),strokeDashArray:this.strokeDashArray?this.strokeDashArray.concat():this.strokeDashArray,strokeLineCap:this.strokeLineCap,strokeLineJoin:this.strokeLineJoin,strokeMiterLimit:r(this.strokeMiterLimit,i),scaleX:r(this.scaleX,i),scaleY:r(this.scaleY,i),angle:r(this.angle,i),flipX:this.flipX,flipY:this.flipY,opacity:r(this.opacity,i),shadow:this.shadow&&this.shadow.toObject?this.shadow.toObject():this.shadow,visible:this.visible,clipTo:this.clipTo&&String(this.clipTo),backgroundColor:this.backgroundColor,fillRule:this.fillRule,paintFirst:this.paintFirst,globalCompositeOperation:this.globalCompositeOperation,transformMatrix:this.transformMatrix?this.transformMatrix.concat():null,skewX:r(this.skewX,i),skewY:r(this.skewY,i)};return this.clipPath&&(n.clipPath=this.clipPath.toObject(t),n.clipPath.inverted=this.clipPath.inverted,n.clipPath.absolutePositioned=this.clipPath.absolutePositioned),e.util.populateWithProperties(this,n,t),this.includeDefaultValues||(n=this._removeDefaultValues(n)),n},toDatalessObject:function(t){return this.toObject(t)},_removeDefaultValues:function(t){var i=e.util.getKlass(t.type).prototype;return i.stateProperties.forEach(function(e){t[e]===i[e]&&delete t[e],"[object Array]"===Object.prototype.toString.call(t[e])&&"[object Array]"===Object.prototype.toString.call(i[e])&&0===t[e].length&&0===i[e].length&&delete t[e]}),t},toString:function(){return"#<fabric."+s(this.type)+">"},getObjectScaling:function(){var t=this.scaleX,e=this.scaleY;if(this.group){var i=this.group.getObjectScaling();t*=i.scaleX,e*=i.scaleY}return{scaleX:t,scaleY:e}},getTotalObjectScaling:function(){var t=this.getObjectScaling(),e=t.scaleX,i=t.scaleY;if(this.canvas){var n=this.canvas.getZoom(),r=this.canvas.getRetinaScaling();e*=n*r,i*=n*r}return{scaleX:e,scaleY:i}},getObjectOpacity:function(){var t=this.opacity;return this.group&&(t*=this.group.getObjectOpacity()),t},_set:function(t,i){var n="scaleX"===t||"scaleY"===t,r=this[t]!==i,s=!1;return n&&(i=this._constrainScale(i)),"scaleX"===t&&i<0?(this.flipX=!this.flipX,i*=-1):"scaleY"===t&&i<0?(this.flipY=!this.flipY,i*=-1):"shadow"!==t||!i||i instanceof e.Shadow?"dirty"===t&&this.group&&this.group.set("dirty",i):i=new e.Shadow(i),this[t]=i,r&&(s=this.group&&this.group.isOnACache(),this.cacheProperties.indexOf(t)>-1?(this.dirty=!0,s&&this.group.set("dirty",!0)):s&&this.stateProperties.indexOf(t)>-1&&this.group.set("dirty",!0)),this},setOnGroup:function(){},getViewportTransform:function(){return this.canvas&&this.canvas.viewportTransform?this.canvas.viewportTransform:e.iMatrix.concat()},isNotVisible:function(){return 0===this.opacity||0===this.width&&0===this.height||!this.visible},render:function(t){this.isNotVisible()||this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(t.save(),this._setupCompositeOperation(t),this.drawSelectionBackground(t),this.transform(t),this._setOpacity(t),this._setShadow(t,this),this.transformMatrix&&t.transform.apply(t,this.transformMatrix),this.clipTo&&e.util.clipContext(this,t),this.shouldCache()?(this.renderCache(),this.drawCacheOnCanvas(t)):(this._removeCacheCanvas(),this.dirty=!1,this.drawObject(t),this.objectCaching&&this.statefullCache&&this.saveState({propertySet:"cacheProperties"})),this.clipTo&&t.restore(),t.restore())},renderCache:function(t){t=t||{},this._cacheCanvas||this._createCacheCanvas(),this.isCacheDirty()&&(this.statefullCache&&this.saveState({propertySet:"cacheProperties"}),this.drawObject(this._cacheContext,t.forClipping),this.dirty=!1)},_removeCacheCanvas:function(){this._cacheCanvas=null,this.cacheWidth=0,this.cacheHeight=0},needsItsOwnCache:function(){return"stroke"===this.paintFirst&&"object"==typeof this.shadow||!!this.clipPath},shouldCache:function(){return this.ownCaching=this.objectCaching&&(!this.group||this.needsItsOwnCache()||!this.group.isOnACache()),this.ownCaching},willDrawShadow:function(){return!!this.shadow&&(0!==this.shadow.offsetX||0!==this.shadow.offsetY)},drawClipPathOnCache:function(t){var i=this.clipPath;if(t.save(),i.inverted?t.globalCompositeOperation="destination-out":t.globalCompositeOperation="destination-in",i.absolutePositioned){var n=e.util.invertTransform(this.calcTransformMatrix());t.transform(n[0],n[1],n[2],n[3],n[4],n[5])}i.transform(t),t.scale(1/i.zoomX,1/i.zoomY),t.drawImage(i._cacheCanvas,-i.cacheTranslationX,-i.cacheTranslationY),t.restore()},drawObject:function(t,e){e?this._setClippingProperties(t):(this._renderBackground(t),this._setStrokeStyles(t,this),this._setFillStyles(t,this)),this._render(t),this._drawClipPath(t)},_drawClipPath:function(t){var e=this.clipPath;e&&(e.canvas=this.canvas,e.shouldCache(),e._transformDone=!0,e.renderCache({forClipping:!0}),this.drawClipPathOnCache(t))},drawCacheOnCanvas:function(t){t.scale(1/this.zoomX,1/this.zoomY),t.drawImage(this._cacheCanvas,-this.cacheTranslationX,-this.cacheTranslationY)},isCacheDirty:function(t){if(this.isNotVisible())return!1;if(this._cacheCanvas&&!t&&this._updateCacheCanvas())return!0;if(this.dirty||this.clipPath&&this.clipPath.absolutePositioned||this.statefullCache&&this.hasStateChanged("cacheProperties")){if(this._cacheCanvas&&!t){var e=this.cacheWidth/this.zoomX,i=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-e/2,-i/2,e,i)}return!0}return!1},_renderBackground:function(t){if(this.backgroundColor){var e=this._getNonTransformedDimensions();t.fillStyle=this.backgroundColor,t.fillRect(-e.x/2,-e.y/2,e.x,e.y),this._removeShadow(t)}},_setOpacity:function(t){this.group&&!this.group._transformDone?t.globalAlpha=this.getObjectOpacity():t.globalAlpha*=this.opacity},_setStrokeStyles:function(t,e){e.stroke&&(t.lineWidth=e.strokeWidth,t.lineCap=e.strokeLineCap,t.lineJoin=e.strokeLineJoin,t.miterLimit=e.strokeMiterLimit,t.strokeStyle=e.stroke.toLive?e.stroke.toLive(t,this):e.stroke)},_setFillStyles:function(t,e){e.fill&&(t.fillStyle=e.fill.toLive?e.fill.toLive(t,this):e.fill)},_setClippingProperties:function(t){t.globalAlpha=1,t.strokeStyle="transparent",t.fillStyle="#000000"},_setLineDash:function(t,e,i){e&&(1&e.length&&e.push.apply(e,e),o?t.setLineDash(e):i&&i(t))},_renderControls:function(t,i){var n,r,s,o=this.getViewportTransform(),h=this.calcTransformMatrix();r=void 0!==(i=i||{}).hasBorders?i.hasBorders:this.hasBorders,s=void 0!==i.hasControls?i.hasControls:this.hasControls,h=e.util.multiplyTransformMatrices(o,h),n=e.util.qrDecompose(h),t.save(),t.translate(n.translateX,n.translateY),t.lineWidth=1*this.borderScaleFactor,this.group||(t.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1),i.forActiveSelection?(t.rotate(a(n.angle)),r&&this.drawBordersInGroup(t,n,i)):(t.rotate(a(this.angle)),r&&this.drawBorders(t,i)),s&&this.drawControls(t,i),t.restore()},_setShadow:function(t){if(this.shadow){var i=this.canvas&&this.canvas.viewportTransform[0]||1,n=this.canvas&&this.canvas.viewportTransform[3]||1,r=this.getObjectScaling();this.canvas&&this.canvas._isRetinaScaling()&&(i*=e.devicePixelRatio,n*=e.devicePixelRatio),t.shadowColor=this.shadow.color,t.shadowBlur=this.shadow.blur*e.browserShadowBlurConstant*(i+n)*(r.scaleX+r.scaleY)/4,t.shadowOffsetX=this.shadow.offsetX*i*r.scaleX,t.shadowOffsetY=this.shadow.offsetY*n*r.scaleY}},_removeShadow:function(t){this.shadow&&(t.shadowColor="",t.shadowBlur=t.shadowOffsetX=t.shadowOffsetY=0)},_applyPatternGradientTransform:function(t,e){if(!e||!e.toLive)return{offsetX:0,offsetY:0};var i=e.gradientTransform||e.patternTransform,n=-this.width/2+e.offsetX||0,r=-this.height/2+e.offsetY||0;return t.translate(n,r),i&&t.transform(i[0],i[1],i[2],i[3],i[4],i[5]),{offsetX:n,offsetY:r}},_renderPaintInOrder:function(t){"stroke"===this.paintFirst?(this._renderStroke(t),this._renderFill(t)):(this._renderFill(t),this._renderStroke(t))},_renderFill:function(t){this.fill&&(t.save(),this._applyPatternGradientTransform(t,this.fill),"evenodd"===this.fillRule?t.fill("evenodd"):t.fill(),t.restore())},_renderStroke:function(t){this.stroke&&0!==this.strokeWidth&&(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(t),t.save(),this._setLineDash(t,this.strokeDashArray,this._renderDashedStroke),this._applyPatternGradientTransform(t,this.stroke),t.stroke(),t.restore())},_findCenterFromElement:function(){return{x:this.left+this.width/2,y:this.top+this.height/2}},_assignTransformMatrixProps:function(){if(this.transformMatrix){var t=e.util.qrDecompose(this.transformMatrix);this.flipX=!1,this.flipY=!1,this.set("scaleX",t.scaleX),this.set("scaleY",t.scaleY),this.angle=t.angle,this.skewX=t.skewX,this.skewY=0}},_removeTransformMatrix:function(t){var i=this._findCenterFromElement();this.transformMatrix&&(this._assignTransformMatrixProps(),i=e.util.transformPoint(i,this.transformMatrix)),this.transformMatrix=null,t&&(this.scaleX*=t.scaleX,this.scaleY*=t.scaleY,this.cropX=t.cropX,this.cropY=t.cropY,i.x+=t.offsetLeft,i.y+=t.offsetTop,this.width=t.width,this.height=t.height),this.setPositionByOrigin(i,"center","center")},clone:function(t,i){var n=this.toObject(i);this.constructor.fromObject?this.constructor.fromObject(n,t):e.Object._fromObject("Object",n,t)},cloneAsImage:function(t,i){var n=this.toDataURL(i);return e.util.loadImage(n,function(i){t&&t(new e.Image(i))}),this},toDataURL:function(t){t||(t={});var i=e.util,n=i.saveObjectTransform(this),r=this.shadow,s=Math.abs;t.withoutTransform&&i.resetObjectTransform(this),t.withoutShadow&&(this.shadow=null);var a,o,h=e.util.createCanvasElement(),c=this.getBoundingRect(!0,!0),l=this.shadow,u={x:0,y:0};l&&(o=l.blur,a=this.getObjectScaling(),u.x=2*Math.round((s(l.offsetX)+o)*s(a.scaleX)),u.y=2*Math.round((s(l.offsetY)+o)*s(a.scaleY))),h.width=c.width+u.x,h.height=c.height+u.y,h.width+=h.width%2?2-h.width%2:0,h.height+=h.height%2?2-h.height%2:0;var f=new e.StaticCanvas(h,{enableRetinaScaling:t.enableRetinaScaling,renderOnAddRemove:!1,skipOffscreen:!1});"jpeg"===t.format&&(f.backgroundColor="#fff"),this.setPositionByOrigin(new e.Point(f.width/2,f.height/2),"center","center");var d=this.canvas;f.add(this);var p=f.toDataURL(t);return this.shadow=r,this.set(n).setCoords(),this.canvas=d,f._objects=[],f.dispose(),f=null,p},isType:function(t){return this.type===t},complexity:function(){return 1},toJSON:function(t){return this.toObject(t)},setGradient:function(t,i){i||(i={});var n={colorStops:[]};return n.type=i.type||(i.r1||i.r2?"radial":"linear"),n.coords={x1:i.x1,y1:i.y1,x2:i.x2,y2:i.y2},(i.r1||i.r2)&&(n.coords.r1=i.r1,n.coords.r2=i.r2),n.gradientTransform=i.gradientTransform,e.Gradient.prototype.addColorStop.call(n,i.colorStops),this.set(t,e.Gradient.forObject(this,n))},setPatternFill:function(t,i){return this.set("fill",new e.Pattern(t,i))},setShadow:function(t){return this.set("shadow",t?new e.Shadow(t):null)},setColor:function(t){return this.set("fill",t),this},rotate:function(t){var e=("center"!==this.originX||"center"!==this.originY)&&this.centeredRotation;return e&&this._setOriginToCenter(),this.set("angle",t),e&&this._resetOrigin(),this},centerH:function(){return this.canvas&&this.canvas.centerObjectH(this),this},viewportCenterH:function(){return this.canvas&&this.canvas.viewportCenterObjectH(this),this},centerV:function(){return this.canvas&&this.canvas.centerObjectV(this),this},viewportCenterV:function(){return this.canvas&&this.canvas.viewportCenterObjectV(this),this},center:function(){return this.canvas&&this.canvas.centerObject(this),this},viewportCenter:function(){return this.canvas&&this.canvas.viewportCenterObject(this),this},getLocalPointer:function(t,i){i=i||this.canvas.getPointer(t);var n=new e.Point(i.x,i.y),r=this._getLeftTopCoords();return this.angle&&(n=e.util.rotatePoint(n,r,a(-this.angle))),{x:n.x-r.x,y:n.y-r.y}},_setupCompositeOperation:function(t){this.globalCompositeOperation&&(t.globalCompositeOperation=this.globalCompositeOperation)}}),e.util.createAccessors&&e.util.createAccessors(e.Object),i(e.Object.prototype,e.Observable),e.Object.NUM_FRACTION_DIGITS=2,e.Object._fromObject=function(t,i,r,s){var a=e[t];i=n(i,!0),e.util.enlivenPatterns([i.fill,i.stroke],function(t){void 0!==t[0]&&(i.fill=t[0]),void 0!==t[1]&&(i.stroke=t[1]),e.util.enlivenObjects([i.clipPath],function(t){i.clipPath=t[0];var e=s?new a(i[s],i):new a(i);r&&r(e)})})},e.Object.__uid=0)}(e),p=b.util.degreesToRadians,g={left:-.5,center:0,right:.5},v={top:-.5,center:0,bottom:.5},b.util.object.extend(b.Object.prototype,{translateToGivenOrigin:function(t,e,i,n,r){var s,a,o,h=t.x,c=t.y;return"string"==typeof e?e=g[e]:e-=.5,"string"==typeof n?n=g[n]:n-=.5,"string"==typeof i?i=v[i]:i-=.5,"string"==typeof r?r=v[r]:r-=.5,a=r-i,((s=n-e)||a)&&(o=this._getTransformedDimensions(),h=t.x+s*o.x,c=t.y+a*o.y),new b.Point(h,c)},translateToCenterPoint:function(t,e,i){var n=this.translateToGivenOrigin(t,e,i,"center","center");return this.angle?b.util.rotatePoint(n,t,p(this.angle)):n},translateToOriginPoint:function(t,e,i){var n=this.translateToGivenOrigin(t,"center","center",e,i);return this.angle?b.util.rotatePoint(n,t,p(this.angle)):n},getCenterPoint:function(){var t=new b.Point(this.left,this.top);return this.translateToCenterPoint(t,this.originX,this.originY)},getPointByOrigin:function(t,e){var i=this.getCenterPoint();return this.translateToOriginPoint(i,t,e)},toLocalPoint:function(t,e,i){var n,r,s=this.getCenterPoint();return n=void 0!==e&&void 0!==i?this.translateToGivenOrigin(s,"center","center",e,i):new b.Point(this.left,this.top),r=new b.Point(t.x,t.y),this.angle&&(r=b.util.rotatePoint(r,s,-p(this.angle))),r.subtractEquals(n)},setPositionByOrigin:function(t,e,i){var n=this.translateToCenterPoint(t,e,i),r=this.translateToOriginPoint(n,this.originX,this.originY);this.set("left",r.x),this.set("top",r.y)},adjustPosition:function(t){var e,i,n=p(this.angle),r=this.getScaledWidth(),s=b.util.cos(n)*r,a=b.util.sin(n)*r;e="string"==typeof this.originX?g[this.originX]:this.originX-.5,i="string"==typeof t?g[t]:t-.5,this.left+=s*(i-e),this.top+=a*(i-e),this.setCoords(),this.originX=t},_setOriginToCenter:function(){this._originalOriginX=this.originX,this._originalOriginY=this.originY;var t=this.getCenterPoint();this.originX="center",this.originY="center",this.left=t.x,this.top=t.y},_resetOrigin:function(){var t=this.translateToOriginPoint(this.getCenterPoint(),this._originalOriginX,this._originalOriginY);this.originX=this._originalOriginX,this.originY=this._originalOriginY,this.left=t.x,this.top=t.y,this._originalOriginX=null,this._originalOriginY=null},_getLeftTopCoords:function(){return this.translateToOriginPoint(this.getCenterPoint(),"left","top")}}),function(){var t=b.util.degreesToRadians,e=b.util.multiplyTransformMatrices,i=b.util.transformPoint;b.util.object.extend(b.Object.prototype,{oCoords:null,aCoords:null,ownMatrixCache:null,matrixCache:null,getCoords:function(t,e){this.oCoords||this.setCoords();var i=t?this.aCoords:this.oCoords;return function(t){return[new b.Point(t.tl.x,t.tl.y),new b.Point(t.tr.x,t.tr.y),new b.Point(t.br.x,t.br.y),new b.Point(t.bl.x,t.bl.y)]}(e?this.calcCoords(t):i)},intersectsWithRect:function(t,e,i,n){var r=this.getCoords(i,n);return"Intersection"===b.Intersection.intersectPolygonRectangle(r,t,e).status},intersectsWithObject:function(t,e,i){return"Intersection"===b.Intersection.intersectPolygonPolygon(this.getCoords(e,i),t.getCoords(e,i)).status||t.isContainedWithinObject(this,e,i)||this.isContainedWithinObject(t,e,i)},isContainedWithinObject:function(t,e,i){for(var n=this.getCoords(e,i),r=0,s=t._getImageLines(i?t.calcCoords(e):e?t.aCoords:t.oCoords);r<4;r++)if(!t.containsPoint(n[r],s))return!1;return!0},isContainedWithinRect:function(t,e,i,n){var r=this.getBoundingRect(i,n);return r.left>=t.x&&r.left+r.width<=e.x&&r.top>=t.y&&r.top+r.height<=e.y},containsPoint:function(t,e,i,n){e=e||this._getImageLines(n?this.calcCoords(i):i?this.aCoords:this.oCoords);var r=this._findCrossPoints(t,e);return 0!==r&&r%2==1},isOnScreen:function(t){if(!this.canvas)return!1;for(var e,i=this.canvas.vptCoords.tl,n=this.canvas.vptCoords.br,r=this.getCoords(!0,t),s=0;s<4;s++)if((e=r[s]).x<=n.x&&e.x>=i.x&&e.y<=n.y&&e.y>=i.y)return!0;return!!this.intersectsWithRect(i,n,!0,t)||this._containsCenterOfCanvas(i,n,t)},_containsCenterOfCanvas:function(t,e,i){var n={x:(t.x+e.x)/2,y:(t.y+e.y)/2};return!!this.containsPoint(n,null,!0,i)},isPartiallyOnScreen:function(t){if(!this.canvas)return!1;var e=this.canvas.vptCoords.tl,i=this.canvas.vptCoords.br;return!!this.intersectsWithRect(e,i,!0,t)||this._containsCenterOfCanvas(e,i,t)},_getImageLines:function(t){return{topline:{o:t.tl,d:t.tr},rightline:{o:t.tr,d:t.br},bottomline:{o:t.br,d:t.bl},leftline:{o:t.bl,d:t.tl}}},_findCrossPoints:function(t,e){var i,n,r,s=0;for(var a in e)if(!((r=e[a]).o.y<t.y&&r.d.y<t.y||r.o.y>=t.y&&r.d.y>=t.y||(r.o.x===r.d.x&&r.o.x>=t.x?n=r.o.x:(0,i=(r.d.y-r.o.y)/(r.d.x-r.o.x),n=-(t.y-0*t.x-(r.o.y-i*r.o.x))/(0-i)),n>=t.x&&(s+=1),2!==s)))break;return s},getBoundingRect:function(t,e){var i=this.getCoords(t,e);return b.util.makeBoundingBoxFromPoints(i)},getScaledWidth:function(){return this._getTransformedDimensions().x},getScaledHeight:function(){return this._getTransformedDimensions().y},_constrainScale:function(t){return Math.abs(t)<this.minScaleLimit?t<0?-this.minScaleLimit:this.minScaleLimit:0===t?1e-4:t},scale:function(t){return this._set("scaleX",t),this._set("scaleY",t),this.setCoords()},scaleToWidth:function(t,e){var i=this.getBoundingRect(e).width/this.getScaledWidth();return this.scale(t/this.width/i)},scaleToHeight:function(t,e){var i=this.getBoundingRect(e).height/this.getScaledHeight();return this.scale(t/this.height/i)},calcCoords:function(n){var r=this._calcRotateMatrix(),s=this._calcTranslateMatrix(),a=e(s,r),o=this.getViewportTransform(),h=n?a:e(o,a),c=this._getTransformedDimensions(),l=c.x/2,u=c.y/2,f=i({x:-l,y:-u},h),d=i({x:l,y:-u},h),p=i({x:-l,y:u},h),g=i({x:l,y:u},h);if(!n){var v=this.padding,_=t(this.angle),m=b.util.cos(_),y=b.util.sin(_),x=m*v,w=y*v,C=x+w,S=x-w;v&&(f.x-=S,f.y-=C,d.x+=C,d.y-=S,p.x-=C,p.y+=S,g.x+=S,g.y+=C);var T=new b.Point((f.x+p.x)/2,(f.y+p.y)/2),k=new b.Point((d.x+f.x)/2,(d.y+f.y)/2),O=new b.Point((g.x+d.x)/2,(g.y+d.y)/2),A=new b.Point((g.x+p.x)/2,(g.y+p.y)/2),P=new b.Point(k.x+y*this.rotatingPointOffset,k.y-m*this.rotatingPointOffset)}var E={tl:f,tr:d,br:g,bl:p};return n||(E.ml=T,E.mt=k,E.mr=O,E.mb=A,E.mtr=P),E},setCoords:function(t,e){return this.oCoords=this.calcCoords(t),e||(this.aCoords=this.calcCoords(!0)),t||this._setCornerCoords&&this._setCornerCoords(),this},_calcRotateMatrix:function(){if(this.angle){var e=t(this.angle),i=b.util.cos(e),n=b.util.sin(e);return[i,n,-n,i,0,0]}return b.iMatrix.concat()},_calcTranslateMatrix:function(){var t=this.getCenterPoint();return[1,0,0,1,t.x,t.y]},transformMatrixKey:function(t){var e="";return!t&&this.group&&(e=this.group.transformMatrixKey(t)+"_"),e+this.top+"_"+this.left+"_"+this.scaleX+"_"+this.scaleY+"_"+this.skewX+"_"+this.skewY+"_"+this.angle+"_"+this.originX+"_"+this.originY+"_"+this.width+"_"+this.height+"_"+this.strokeWidth+this.flipX+this.flipY},calcTransformMatrix:function(t){if(t)return this.calcOwnMatrix();var i=this.transformMatrixKey(),n=this.matrixCache||(this.matrixCache={});if(n.key===i)return n.value;var r=this.calcOwnMatrix();return this.group&&(r=e(this.group.calcTransformMatrix(),r)),n.key=i,n.value=r,r},calcOwnMatrix:function(){var t=this.transformMatrixKey(!0),i=this.ownMatrixCache||(this.ownMatrixCache={});if(i.key===t)return i.value;var n,r=this._calcTranslateMatrix(),s=this._calcDimensionsTransformMatrix(this.skewX,this.skewY,!0);return this.angle&&(n=this._calcRotateMatrix(),r=e(r,n)),r=e(r,s),i.key=t,i.value=r,r},_calcDimensionsTransformMatrix:function(i,n,r){var s,a=[this.scaleX*(r&&this.flipX?-1:1),0,0,this.scaleY*(r&&this.flipY?-1:1),0,0];return i&&(s=[1,0,Math.tan(t(i)),1],a=e(a,s,!0)),n&&(s=[1,Math.tan(t(n)),0,1],a=e(a,s,!0)),a},_getNonTransformedDimensions:function(){var t=this.strokeWidth;return{x:this.width+t,y:this.height+t}},_getTransformedDimensions:function(t,e){void 0===t&&(t=this.skewX),void 0===e&&(e=this.skewY);var i=this._getNonTransformedDimensions();if(0===t&&0===e)return{x:i.x*this.scaleX,y:i.y*this.scaleY};var n,r,s=i.x/2,a=i.y/2,o=[{x:-s,y:-a},{x:s,y:-a},{x:-s,y:a},{x:s,y:a}],h=this._calcDimensionsTransformMatrix(t,e,!1);for(n=0;n<o.length;n++)o[n]=b.util.transformPoint(o[n],h);return{x:(r=b.util.makeBoundingBoxFromPoints(o)).width,y:r.height}},_calculateCurrentDimensions:function(){var t=this.getViewportTransform(),e=this._getTransformedDimensions();return b.util.transformPoint(e,t,!0).scalarAdd(2*this.padding)}})}(),b.util.object.extend(b.Object.prototype,{sendToBack:function(){return this.group?b.StaticCanvas.prototype.sendToBack.call(this.group,this):this.canvas.sendToBack(this),this},bringToFront:function(){return this.group?b.StaticCanvas.prototype.bringToFront.call(this.group,this):this.canvas.bringToFront(this),this},sendBackwards:function(t){return this.group?b.StaticCanvas.prototype.sendBackwards.call(this.group,this,t):this.canvas.sendBackwards(this,t),this},bringForward:function(t){return this.group?b.StaticCanvas.prototype.bringForward.call(this.group,this,t):this.canvas.bringForward(this,t),this},moveTo:function(t){return this.group&&"activeSelection"!==this.group.type?b.StaticCanvas.prototype.moveTo.call(this.group,this,t):this.canvas.moveTo(this,t),this}}),function(){function t(t,e){if(e){if(e.toLive)return t+": url(#SVGID_"+e.id+"); ";var i=new b.Color(e),n=t+": "+i.toRgb()+"; ",r=i.getAlpha();return 1!==r&&(n+=t+"-opacity: "+r.toString()+"; "),n}return t+": none; "}var e=b.util.toFixed;b.util.object.extend(b.Object.prototype,{getSvgStyles:function(e){var i=this.fillRule?this.fillRule:"nonzero",n=this.strokeWidth?this.strokeWidth:"0",r=this.strokeDashArray?this.strokeDashArray.join(" "):"none",s=this.strokeLineCap?this.strokeLineCap:"butt",a=this.strokeLineJoin?this.strokeLineJoin:"miter",o=this.strokeMiterLimit?this.strokeMiterLimit:"4",h=void 0!==this.opacity?this.opacity:"1",c=this.visible?"":" visibility: hidden;",l=e?"":this.getSvgFilter(),u=t("fill",this.fill);return[t("stroke",this.stroke),"stroke-width: ",n,"; ","stroke-dasharray: ",r,"; ","stroke-linecap: ",s,"; ","stroke-linejoin: ",a,"; ","stroke-miterlimit: ",o,"; ",u,"fill-rule: ",i,"; ","opacity: ",h,";",l,c].join("")},getSvgSpanStyles:function(e,i){var n=e.fontFamily?"font-family: "+(-1===e.fontFamily.indexOf("'")&&-1===e.fontFamily.indexOf('"')?"'"+e.fontFamily+"'":e.fontFamily)+"; ":"",r=e.strokeWidth?"stroke-width: "+e.strokeWidth+"; ":"",s=(n=n,e.fontSize?"font-size: "+e.fontSize+"px; ":""),a=e.fontStyle?"font-style: "+e.fontStyle+"; ":"",o=e.fontWeight?"font-weight: "+e.fontWeight+"; ":"",h=e.fill?t("fill",e.fill):"",c=e.stroke?t("stroke",e.stroke):"",l=this.getSvgTextDecoration(e);return l&&(l="text-decoration: "+l+"; "),[c,r,n,s,a,o,l,h,e.deltaY?"baseline-shift: "+-e.deltaY+"; ":"",i?"white-space: pre; ":""].join("")},getSvgTextDecoration:function(t){return"overline"in t||"underline"in t||"linethrough"in t?(t.overline?"overline ":"")+(t.underline?"underline ":"")+(t.linethrough?"line-through ":""):""},getSvgFilter:function(){return this.shadow?"filter: url(#SVGID_"+this.shadow.id+");":""},getSvgCommons:function(){return[this.id?'id="'+this.id+'" ':"",this.clipPath?'clip-path="url(#'+this.clipPath.clipPathId+')" ':""].join("")},getSvgTransform:function(t,i){return'transform="matrix('+(t?this.calcTransformMatrix():this.calcOwnMatrix()).map(function(t){return e(t,b.Object.NUM_FRACTION_DIGITS)}).join(" ")+")"+(i||"")+this.getSvgTransformMatrix()+'" '},getSvgTransformMatrix:function(){return this.transformMatrix?" matrix("+this.transformMatrix.join(" ")+")":""},_setSVGBg:function(t){if(this.backgroundColor){var i=b.Object.NUM_FRACTION_DIGITS;t.push("\t\t<rect ",this._getFillAttributes(this.backgroundColor),' x="',e(-this.width/2,i),'" y="',e(-this.height/2,i),'" width="',e(this.width,i),'" height="',e(this.height,i),'"></rect>\n')}},toSVG:function(t){return this._createBaseSVGMarkup(this._toSVG(),{reviver:t})},toClipPathSVG:function(t){return"\t"+this._createBaseClipPathSVGMarkup(this._toSVG(),{reviver:t})},_createBaseClipPathSVGMarkup:function(t,e){var i=(e=e||{}).reviver,n=e.additionalTransform||"",r=[this.getSvgTransform(!0,n),this.getSvgCommons()].join(""),s=t.indexOf("COMMON_PARTS");return t[s]=r,i?i(t.join("")):t.join("")},_createBaseSVGMarkup:function(t,e){var i,n,r=(e=e||{}).noStyle,s=e.withShadow,a=e.reviver,o=r?"":'style="'+this.getSvgStyles()+'" ',h=s?'style="'+this.getSvgFilter()+'" ':"",c=this.clipPath,l=this.clipPath&&this.clipPath.absolutePositioned,u=[],f=t.indexOf("COMMON_PARTS");return c&&(c.clipPathId="CLIPPATH_"+b.Object.__uid++,n='<clipPath id="'+c.clipPathId+'" >\n'+this.clipPath.toClipPathSVG(a)+"</clipPath>\n"),l&&u.push("<g ",h,this.getSvgCommons()," >\n"),u.push("<g ",this.getSvgTransform(!1),l?"":h+this.getSvgCommons()," >\n"),i=[o,r?"":this.addPaintOrder()," "].join(""),t[f]=i,this.fill&&this.fill.toLive&&u.push(this.fill.toSVG(this,!1)),this.stroke&&this.stroke.toLive&&u.push(this.stroke.toSVG(this,!1)),this.shadow&&u.push(this.shadow.toSVG(this)),c&&u.push(n),u.push(t.join("")),u.push("</g>\n"),l&&u.push("</g>\n"),a?a(u.join("")):u.join("")},addPaintOrder:function(){return"fill"!==this.paintFirst?' paint-order="'+this.paintFirst+'" ':""}})}(),function(){var t=b.util.object.extend;function e(e,i,n){var r={};n.forEach(function(t){r[t]=e[t]}),t(e[i],r,!0)}b.util.object.extend(b.Object.prototype,{hasStateChanged:function(t){var e="_"+(t=t||"stateProperties");return Object.keys(this[e]).length<this[t].length||!function t(e,i,n){if(e===i)return!0;if(Array.isArray(e)){if(!Array.isArray(i)||e.length!==i.length)return!1;for(var r=0,s=e.length;r<s;r++)if(!t(e[r],i[r]))return!1;return!0}if(e&&"object"==typeof e){var a,o=Object.keys(e);if(!i||"object"!=typeof i||!n&&o.length!==Object.keys(i).length)return!1;for(r=0,s=o.length;r<s;r++)if(!t(e[a=o[r]],i[a]))return!1;return!0}}(this[e],this,!0)},saveState:function(t){var i=t&&t.propertySet||"stateProperties",n="_"+i;return this[n]?(e(this,n,this[i]),t&&t.stateProperties&&e(this,n,t.stateProperties),this):this.setupState(t)},setupState:function(t){var e=(t=t||{}).propertySet||"stateProperties";return t.propertySet=e,this["_"+e]={},this.saveState(t),this}})}(),function(){var t=b.util.degreesToRadians;b.util.object.extend(b.Object.prototype,{_controlsVisibility:null,_findTargetCorner:function(t){if(!this.hasControls||this.group||!this.canvas||this.canvas._activeObject!==this)return!1;var e,i,n=t.x,r=t.y;for(var s in this.__corner=0,this.oCoords)if(this.isControlVisible(s)&&("mtr"!==s||this.hasRotatingPoint)&&(!this.get("lockUniScaling")||"mt"!==s&&"mr"!==s&&"mb"!==s&&"ml"!==s)&&(i=this._getImageLines(this.oCoords[s].corner),0!==(e=this._findCrossPoints({x:n,y:r},i))&&e%2==1))return this.__corner=s,s;return!1},_setCornerCoords:function(){var e,i,n=this.oCoords,r=t(45-this.angle),s=.707106*this.cornerSize,a=s*b.util.cos(r),o=s*b.util.sin(r);for(var h in n)e=n[h].x,i=n[h].y,n[h].corner={tl:{x:e-o,y:i-a},tr:{x:e+a,y:i-o},bl:{x:e-a,y:i+o},br:{x:e+o,y:i+a}}},drawSelectionBackground:function(e){if(!this.selectionBackgroundColor||this.canvas&&!this.canvas.interactive||this.canvas&&this.canvas._activeObject!==this)return this;e.save();var i=this.getCenterPoint(),n=this._calculateCurrentDimensions(),r=this.canvas.viewportTransform;return e.translate(i.x,i.y),e.scale(1/r[0],1/r[3]),e.rotate(t(this.angle)),e.fillStyle=this.selectionBackgroundColor,e.fillRect(-n.x/2,-n.y/2,n.x,n.y),e.restore(),this},drawBorders:function(t,e){e=e||{};var i=this._calculateCurrentDimensions(),n=1/this.borderScaleFactor,r=i.x+n,s=i.y+n,a=void 0!==e.hasRotatingPoint?e.hasRotatingPoint:this.hasRotatingPoint,o=void 0!==e.hasControls?e.hasControls:this.hasControls,h=void 0!==e.rotatingPointOffset?e.rotatingPointOffset:this.rotatingPointOffset;if(t.save(),t.strokeStyle=e.borderColor||this.borderColor,this._setLineDash(t,e.borderDashArray||this.borderDashArray,null),t.strokeRect(-r/2,-s/2,r,s),a&&this.isControlVisible("mtr")&&o){var c=-s/2;t.beginPath(),t.moveTo(0,c),t.lineTo(0,c-h),t.stroke()}return t.restore(),this},drawBordersInGroup:function(t,e,i){i=i||{};var n=this._getNonTransformedDimensions(),r=b.util.customTransformMatrix(e.scaleX,e.scaleY,e.skewX),s=b.util.transformPoint(n,r),a=1/this.borderScaleFactor,o=s.x+a,h=s.y+a;return t.save(),this._setLineDash(t,i.borderDashArray||this.borderDashArray,null),t.strokeStyle=i.borderColor||this.borderColor,t.strokeRect(-o/2,-h/2,o,h),t.restore(),this},drawControls:function(t,e){e=e||{};var i=this._calculateCurrentDimensions(),n=i.x,r=i.y,s=e.cornerSize||this.cornerSize,a=-(n+s)/2,o=-(r+s)/2,h=void 0!==e.transparentCorners?e.transparentCorners:this.transparentCorners,c=void 0!==e.hasRotatingPoint?e.hasRotatingPoint:this.hasRotatingPoint,l=h?"stroke":"fill";return t.save(),t.strokeStyle=t.fillStyle=e.cornerColor||this.cornerColor,this.transparentCorners||(t.strokeStyle=e.cornerStrokeColor||this.cornerStrokeColor),this._setLineDash(t,e.cornerDashArray||this.cornerDashArray,null),this._drawControl("tl",t,l,a,o,e),this._drawControl("tr",t,l,a+n,o,e),this._drawControl("bl",t,l,a,o+r,e),this._drawControl("br",t,l,a+n,o+r,e),this.get("lockUniScaling")||(this._drawControl("mt",t,l,a+n/2,o,e),this._drawControl("mb",t,l,a+n/2,o+r,e),this._drawControl("mr",t,l,a+n,o+r/2,e),this._drawControl("ml",t,l,a,o+r/2,e)),c&&this._drawControl("mtr",t,l,a+n/2,o-this.rotatingPointOffset,e),t.restore(),this},_drawControl:function(t,e,i,n,r,s){if(s=s||{},this.isControlVisible(t)){var a=this.cornerSize,o=!this.transparentCorners&&this.cornerStrokeColor;switch(s.cornerStyle||this.cornerStyle){case"circle":e.beginPath(),e.arc(n+a/2,r+a/2,a/2,0,2*Math.PI,!1),e[i](),o&&e.stroke();break;default:this.transparentCorners||e.clearRect(n,r,a,a),e[i+"Rect"](n,r,a,a),o&&e.strokeRect(n,r,a,a)}}},isControlVisible:function(t){return this._getControlsVisibility()[t]},setControlVisible:function(t,e){return this._getControlsVisibility()[t]=e,this},setControlsVisibility:function(t){for(var e in t||(t={}),t)this.setControlVisible(e,t[e]);return this},_getControlsVisibility:function(){return this._controlsVisibility||(this._controlsVisibility={tl:!0,tr:!0,br:!0,bl:!0,ml:!0,mt:!0,mr:!0,mb:!0,mtr:!0}),this._controlsVisibility},onDeselect:function(){},onSelect:function(){}})}(),b.util.object.extend(b.StaticCanvas.prototype,{FX_DURATION:500,fxCenterObjectH:function(t,e){var i=function(){},n=(e=e||{}).onComplete||i,r=e.onChange||i,s=this;return b.util.animate({startValue:t.left,endValue:this.getCenter().left,duration:this.FX_DURATION,onChange:function(e){t.set("left",e),s.requestRenderAll(),r()},onComplete:function(){t.setCoords(),n()}}),this},fxCenterObjectV:function(t,e){var i=function(){},n=(e=e||{}).onComplete||i,r=e.onChange||i,s=this;return b.util.animate({startValue:t.top,endValue:this.getCenter().top,duration:this.FX_DURATION,onChange:function(e){t.set("top",e),s.requestRenderAll(),r()},onComplete:function(){t.setCoords(),n()}}),this},fxRemove:function(t,e){var i=function(){},n=(e=e||{}).onComplete||i,r=e.onChange||i,s=this;return b.util.animate({startValue:t.opacity,endValue:0,duration:this.FX_DURATION,onChange:function(e){t.set("opacity",e),s.requestRenderAll(),r()},onComplete:function(){s.remove(t),n()}}),this}}),b.util.object.extend(b.Object.prototype,{animate:function(){if(arguments[0]&&"object"==typeof arguments[0]){var t,e,i=[];for(t in arguments[0])i.push(t);for(var n=0,r=i.length;n<r;n++)t=i[n],e=n!==r-1,this._animate(t,arguments[0][t],arguments[1],e)}else this._animate.apply(this,arguments);return this},_animate:function(t,e,i,n){var r,s=this;e=e.toString(),i=i?b.util.object.clone(i):{},~t.indexOf(".")&&(r=t.split("."));var a=r?this.get(r[0])[r[1]]:this.get(t);"from"in i||(i.from=a),e=~e.indexOf("=")?a+parseFloat(e.replace("=","")):parseFloat(e),b.util.animate({startValue:i.from,endValue:e,byValue:i.by,easing:i.easing,duration:i.duration,abort:i.abort&&function(){return i.abort.call(s)},onChange:function(e,a,o){r?s[r[0]][r[1]]=e:s.set(t,e),n||i.onChange&&i.onChange(e,a,o)},onComplete:function(t,e,r){n||(s.setCoords(),i.onComplete&&i.onComplete(t,e,r))}})}}),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.extend,n=e.util.object.clone,r={x1:1,x2:1,y1:1,y2:1},s=e.StaticCanvas.supports("setLineDash");function a(t,e){var i=t.origin,n=t.axis1,r=t.axis2,s=t.dimension,a=e.nearest,o=e.center,h=e.farthest;return function(){switch(this.get(i)){case a:return Math.min(this.get(n),this.get(r));case o:return Math.min(this.get(n),this.get(r))+.5*this.get(s);case h:return Math.max(this.get(n),this.get(r))}}}e.Line?e.warn("fabric.Line is already defined"):(e.Line=e.util.createClass(e.Object,{type:"line",x1:0,y1:0,x2:0,y2:0,cacheProperties:e.Object.prototype.cacheProperties.concat("x1","x2","y1","y2"),initialize:function(t,e){t||(t=[0,0,0,0]),this.callSuper("initialize",e),this.set("x1",t[0]),this.set("y1",t[1]),this.set("x2",t[2]),this.set("y2",t[3]),this._setWidthHeight(e)},_setWidthHeight:function(t){t||(t={}),this.width=Math.abs(this.x2-this.x1),this.height=Math.abs(this.y2-this.y1),this.left="left"in t?t.left:this._getLeftToOriginX(),this.top="top"in t?t.top:this._getTopToOriginY()},_set:function(t,e){return this.callSuper("_set",t,e),void 0!==r[t]&&this._setWidthHeight(),this},_getLeftToOriginX:a({origin:"originX",axis1:"x1",axis2:"x2",dimension:"width"},{nearest:"left",center:"center",farthest:"right"}),_getTopToOriginY:a({origin:"originY",axis1:"y1",axis2:"y2",dimension:"height"},{nearest:"top",center:"center",farthest:"bottom"}),_render:function(t){if(t.beginPath(),!this.strokeDashArray||this.strokeDashArray&&s){var e=this.calcLinePoints();t.moveTo(e.x1,e.y1),t.lineTo(e.x2,e.y2)}t.lineWidth=this.strokeWidth;var i=t.strokeStyle;t.strokeStyle=this.stroke||t.fillStyle,this.stroke&&this._renderStroke(t),t.strokeStyle=i},_renderDashedStroke:function(t){var i=this.calcLinePoints();t.beginPath(),e.util.drawDashedLine(t,i.x1,i.y1,i.x2,i.y2,this.strokeDashArray),t.closePath()},_findCenterFromElement:function(){return{x:(this.x1+this.x2)/2,y:(this.y1+this.y2)/2}},toObject:function(t){return i(this.callSuper("toObject",t),this.calcLinePoints())},_getNonTransformedDimensions:function(){var t=this.callSuper("_getNonTransformedDimensions");return"butt"===this.strokeLineCap&&(0===this.width&&(t.y-=this.strokeWidth),0===this.height&&(t.x-=this.strokeWidth)),t},calcLinePoints:function(){var t=this.x1<=this.x2?-1:1,e=this.y1<=this.y2?-1:1,i=t*this.width*.5,n=e*this.height*.5;return{x1:i,x2:t*this.width*-.5,y1:n,y2:e*this.height*-.5}},_toSVG:function(){var t=this.calcLinePoints();return["<line ","COMMON_PARTS",'x1="',t.x1,'" y1="',t.y1,'" x2="',t.x2,'" y2="',t.y2,'" />\n']}}),e.Line.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat("x1 y1 x2 y2".split(" ")),e.Line.fromElement=function(t,n,r){r=r||{};var s=e.parseAttributes(t,e.Line.ATTRIBUTE_NAMES),a=[s.x1||0,s.y1||0,s.x2||0,s.y2||0];n(new e.Line(a,i(s,r)))},e.Line.fromObject=function(t,i){var r=n(t,!0);r.points=[t.x1,t.y1,t.x2,t.y2],e.Object._fromObject("Line",r,function(t){delete t.points,i&&i(t)},"points")})}(e),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=Math.PI;e.Circle?e.warn("fabric.Circle is already defined."):(e.Circle=e.util.createClass(e.Object,{type:"circle",radius:0,startAngle:0,endAngle:2*i,cacheProperties:e.Object.prototype.cacheProperties.concat("radius","startAngle","endAngle"),_set:function(t,e){return this.callSuper("_set",t,e),"radius"===t&&this.setRadius(e),this},toObject:function(t){return this.callSuper("toObject",["radius","startAngle","endAngle"].concat(t))},_toSVG:function(){var t,n=(this.endAngle-this.startAngle)%(2*i);if(0===n)t=["<circle ","COMMON_PARTS",'cx="0" cy="0" ','r="',this.radius,'" />\n'];else{var r=e.util.cos(this.startAngle)*this.radius,s=e.util.sin(this.startAngle)*this.radius,a=e.util.cos(this.endAngle)*this.radius,o=e.util.sin(this.endAngle)*this.radius,h=n>i?"1":"0";t=['<path d="M '+r+" "+s," A "+this.radius+" "+this.radius," 0 ",+h+" 1"," "+a+" "+o,'"',"COMMON_PARTS"," />\n"]}return t},_render:function(t){t.beginPath(),t.arc(0,0,this.radius,this.startAngle,this.endAngle,!1),this._renderPaintInOrder(t)},getRadiusX:function(){return this.get("radius")*this.get("scaleX")},getRadiusY:function(){return this.get("radius")*this.get("scaleY")},setRadius:function(t){return this.radius=t,this.set("width",2*t).set("height",2*t)}}),e.Circle.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat("cx cy r".split(" ")),e.Circle.fromElement=function(t,i){var n,r=e.parseAttributes(t,e.Circle.ATTRIBUTE_NAMES);if(!("radius"in(n=r)&&n.radius>=0))throw new Error("value of `r` attribute is required and can not be negative");r.left=(r.left||0)-r.radius,r.top=(r.top||0)-r.radius,i(new e.Circle(r))},e.Circle.fromObject=function(t,i){return e.Object._fromObject("Circle",t,i)})}(e),function(t){"use strict";var e=t.fabric||(t.fabric={});e.Triangle?e.warn("fabric.Triangle is already defined"):(e.Triangle=e.util.createClass(e.Object,{type:"triangle",width:100,height:100,_render:function(t){var e=this.width/2,i=this.height/2;t.beginPath(),t.moveTo(-e,i),t.lineTo(0,-i),t.lineTo(e,i),t.closePath(),this._renderPaintInOrder(t)},_renderDashedStroke:function(t){var i=this.width/2,n=this.height/2;t.beginPath(),e.util.drawDashedLine(t,-i,n,0,-n,this.strokeDashArray),e.util.drawDashedLine(t,0,-n,i,n,this.strokeDashArray),e.util.drawDashedLine(t,i,n,-i,n,this.strokeDashArray),t.closePath()},_toSVG:function(){var t=this.width/2,e=this.height/2;return["<polygon ","COMMON_PARTS",'points="',[-t+" "+e,"0 "+-e,t+" "+e].join(","),'" />']}}),e.Triangle.fromObject=function(t,i){return e.Object._fromObject("Triangle",t,i)})}(e),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=2*Math.PI;e.Ellipse?e.warn("fabric.Ellipse is already defined."):(e.Ellipse=e.util.createClass(e.Object,{type:"ellipse",rx:0,ry:0,cacheProperties:e.Object.prototype.cacheProperties.concat("rx","ry"),initialize:function(t){this.callSuper("initialize",t),this.set("rx",t&&t.rx||0),this.set("ry",t&&t.ry||0)},_set:function(t,e){switch(this.callSuper("_set",t,e),t){case"rx":this.rx=e,this.set("width",2*e);break;case"ry":this.ry=e,this.set("height",2*e)}return this},getRx:function(){return this.get("rx")*this.get("scaleX")},getRy:function(){return this.get("ry")*this.get("scaleY")},toObject:function(t){return this.callSuper("toObject",["rx","ry"].concat(t))},_toSVG:function(){return["<ellipse ","COMMON_PARTS",'cx="0" cy="0" ','rx="',this.rx,'" ry="',this.ry,'" />\n']},_render:function(t){t.beginPath(),t.save(),t.transform(1,0,0,this.ry/this.rx,0,0),t.arc(0,0,this.rx,0,i,!1),t.restore(),this._renderPaintInOrder(t)}}),e.Ellipse.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat("cx cy rx ry".split(" ")),e.Ellipse.fromElement=function(t,i){var n=e.parseAttributes(t,e.Ellipse.ATTRIBUTE_NAMES);n.left=(n.left||0)-n.rx,n.top=(n.top||0)-n.ry,i(new e.Ellipse(n))},e.Ellipse.fromObject=function(t,i){return e.Object._fromObject("Ellipse",t,i)})}(e),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.extend;e.Rect?e.warn("fabric.Rect is already defined"):(e.Rect=e.util.createClass(e.Object,{stateProperties:e.Object.prototype.stateProperties.concat("rx","ry"),type:"rect",rx:0,ry:0,cacheProperties:e.Object.prototype.cacheProperties.concat("rx","ry"),initialize:function(t){this.callSuper("initialize",t),this._initRxRy()},_initRxRy:function(){this.rx&&!this.ry?this.ry=this.rx:this.ry&&!this.rx&&(this.rx=this.ry)},_render:function(t){var e=this.rx?Math.min(this.rx,this.width/2):0,i=this.ry?Math.min(this.ry,this.height/2):0,n=this.width,r=this.height,s=-this.width/2,a=-this.height/2,o=0!==e||0!==i,h=.4477152502;t.beginPath(),t.moveTo(s+e,a),t.lineTo(s+n-e,a),o&&t.bezierCurveTo(s+n-h*e,a,s+n,a+h*i,s+n,a+i),t.lineTo(s+n,a+r-i),o&&t.bezierCurveTo(s+n,a+r-h*i,s+n-h*e,a+r,s+n-e,a+r),t.lineTo(s+e,a+r),o&&t.bezierCurveTo(s+h*e,a+r,s,a+r-h*i,s,a+r-i),t.lineTo(s,a+i),o&&t.bezierCurveTo(s,a+h*i,s+h*e,a,s+e,a),t.closePath(),this._renderPaintInOrder(t)},_renderDashedStroke:function(t){var i=-this.width/2,n=-this.height/2,r=this.width,s=this.height;t.beginPath(),e.util.drawDashedLine(t,i,n,i+r,n,this.strokeDashArray),e.util.drawDashedLine(t,i+r,n,i+r,n+s,this.strokeDashArray),e.util.drawDashedLine(t,i+r,n+s,i,n+s,this.strokeDashArray),e.util.drawDashedLine(t,i,n+s,i,n,this.strokeDashArray),t.closePath()},toObject:function(t){return this.callSuper("toObject",["rx","ry"].concat(t))},_toSVG:function(){return["<rect ","COMMON_PARTS",'x="',-this.width/2,'" y="',-this.height/2,'" rx="',this.rx,'" ry="',this.ry,'" width="',this.width,'" height="',this.height,'" />\n']}}),e.Rect.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat("x y rx ry width height".split(" ")),e.Rect.fromElement=function(t,n,r){if(!t)return n(null);r=r||{};var s=e.parseAttributes(t,e.Rect.ATTRIBUTE_NAMES);s.left=s.left||0,s.top=s.top||0;var a=new e.Rect(i(r?e.util.object.clone(r):{},s));a.visible=a.visible&&a.width>0&&a.height>0,n(a)},e.Rect.fromObject=function(t,i){return e.Object._fromObject("Rect",t,i)})}(e),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.extend,n=e.util.array.min,r=e.util.array.max,s=e.util.toFixed;e.Polyline?e.warn("fabric.Polyline is already defined"):(e.Polyline=e.util.createClass(e.Object,{type:"polyline",points:null,cacheProperties:e.Object.prototype.cacheProperties.concat("points"),initialize:function(t,e){e=e||{},this.points=t||[],this.callSuper("initialize",e);var i=this._calcDimensions();void 0===e.left&&(this.left=i.left),void 0===e.top&&(this.top=i.top),this.width=i.width,this.height=i.height,this.pathOffset={x:i.left+this.width/2,y:i.top+this.height/2}},_calcDimensions:function(){var t=this.points,e=n(t,"x")||0,i=n(t,"y")||0;return{left:e,top:i,width:(r(t,"x")||0)-e,height:(r(t,"y")||0)-i}},toObject:function(t){return i(this.callSuper("toObject",t),{points:this.points.concat()})},_toSVG:function(){for(var t=[],i=this.pathOffset.x,n=this.pathOffset.y,r=e.Object.NUM_FRACTION_DIGITS,a=0,o=this.points.length;a<o;a++)t.push(s(this.points[a].x-i,r),",",s(this.points[a].y-n,r)," ");return["<"+this.type+" ","COMMON_PARTS",'points="',t.join(""),'" />\n']},commonRender:function(t){var e,i=this.points.length,n=this.pathOffset.x,r=this.pathOffset.y;if(!i||isNaN(this.points[i-1].y))return!1;t.beginPath(),t.moveTo(this.points[0].x-n,this.points[0].y-r);for(var s=0;s<i;s++)e=this.points[s],t.lineTo(e.x-n,e.y-r);return!0},_render:function(t){this.commonRender(t)&&this._renderPaintInOrder(t)},_renderDashedStroke:function(t){var i,n;t.beginPath();for(var r=0,s=this.points.length;r<s;r++)i=this.points[r],n=this.points[r+1]||i,e.util.drawDashedLine(t,i.x,i.y,n.x,n.y,this.strokeDashArray)},complexity:function(){return this.get("points").length}}),e.Polyline.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat(),e.Polyline.fromElement=function(t,i,n){if(!t)return i(null);n||(n={});var r=e.parsePointsAttribute(t.getAttribute("points")),s=e.parseAttributes(t,e.Polyline.ATTRIBUTE_NAMES);i(new e.Polyline(r,e.util.object.extend(s,n)))},e.Polyline.fromObject=function(t,i){return e.Object._fromObject("Polyline",t,i,"points")})}(e),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.extend;e.Polygon?e.warn("fabric.Polygon is already defined"):(e.Polygon=e.util.createClass(e.Polyline,{type:"polygon",_render:function(t){this.commonRender(t)&&(t.closePath(),this._renderPaintInOrder(t))},_renderDashedStroke:function(t){this.callSuper("_renderDashedStroke",t),t.closePath()}}),e.Polygon.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat(),e.Polygon.fromElement=function(t,n,r){if(!t)return n(null);r||(r={});var s=e.parsePointsAttribute(t.getAttribute("points")),a=e.parseAttributes(t,e.Polygon.ATTRIBUTE_NAMES);n(new e.Polygon(s,i(a,r)))},e.Polygon.fromObject=function(t,i){return e.Object._fromObject("Polygon",t,i,"points")})}(e),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.array.min,n=e.util.array.max,r=e.util.object.extend,s=Object.prototype.toString,a=e.util.drawArc,o=e.util.toFixed,h={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},c={m:"l",M:"L"};e.Path?e.warn("fabric.Path is already defined"):(e.Path=e.util.createClass(e.Object,{type:"path",path:null,cacheProperties:e.Object.prototype.cacheProperties.concat("path","fillRule"),stateProperties:e.Object.prototype.stateProperties.concat("path"),initialize:function(t,e){e=e||{},this.callSuper("initialize",e),t||(t=[]);var i="[object Array]"===s.call(t);this.path=i?t:t.match&&t.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi),this.path&&(i||(this.path=this._parsePath()),this._setPositionDimensions(e))},_setPositionDimensions:function(t){var e=this._parseDimensions();this.width=e.width,this.height=e.height,void 0===t.left&&(this.left=e.left),void 0===t.top&&(this.top=e.top),this.pathOffset=this.pathOffset||{x:e.left+this.width/2,y:e.top+this.height/2}},_renderPathCommands:function(t){var e,i,n,r=null,s=0,o=0,h=0,c=0,l=0,u=0,f=-this.pathOffset.x,d=-this.pathOffset.y;t.beginPath();for(var p=0,g=this.path.length;p<g;++p){switch((e=this.path[p])[0]){case"l":h+=e[1],c+=e[2],t.lineTo(h+f,c+d);break;case"L":h=e[1],c=e[2],t.lineTo(h+f,c+d);break;case"h":h+=e[1],t.lineTo(h+f,c+d);break;case"H":h=e[1],t.lineTo(h+f,c+d);break;case"v":c+=e[1],t.lineTo(h+f,c+d);break;case"V":c=e[1],t.lineTo(h+f,c+d);break;case"m":s=h+=e[1],o=c+=e[2],t.moveTo(h+f,c+d);break;case"M":s=h=e[1],o=c=e[2],t.moveTo(h+f,c+d);break;case"c":i=h+e[5],n=c+e[6],l=h+e[3],u=c+e[4],t.bezierCurveTo(h+e[1]+f,c+e[2]+d,l+f,u+d,i+f,n+d),h=i,c=n;break;case"C":h=e[5],c=e[6],l=e[3],u=e[4],t.bezierCurveTo(e[1]+f,e[2]+d,l+f,u+d,h+f,c+d);break;case"s":i=h+e[3],n=c+e[4],null===r[0].match(/[CcSs]/)?(l=h,u=c):(l=2*h-l,u=2*c-u),t.bezierCurveTo(l+f,u+d,h+e[1]+f,c+e[2]+d,i+f,n+d),l=h+e[1],u=c+e[2],h=i,c=n;break;case"S":i=e[3],n=e[4],null===r[0].match(/[CcSs]/)?(l=h,u=c):(l=2*h-l,u=2*c-u),t.bezierCurveTo(l+f,u+d,e[1]+f,e[2]+d,i+f,n+d),h=i,c=n,l=e[1],u=e[2];break;case"q":i=h+e[3],n=c+e[4],l=h+e[1],u=c+e[2],t.quadraticCurveTo(l+f,u+d,i+f,n+d),h=i,c=n;break;case"Q":i=e[3],n=e[4],t.quadraticCurveTo(e[1]+f,e[2]+d,i+f,n+d),h=i,c=n,l=e[1],u=e[2];break;case"t":i=h+e[1],n=c+e[2],null===r[0].match(/[QqTt]/)?(l=h,u=c):(l=2*h-l,u=2*c-u),t.quadraticCurveTo(l+f,u+d,i+f,n+d),h=i,c=n;break;case"T":i=e[1],n=e[2],null===r[0].match(/[QqTt]/)?(l=h,u=c):(l=2*h-l,u=2*c-u),t.quadraticCurveTo(l+f,u+d,i+f,n+d),h=i,c=n;break;case"a":a(t,h+f,c+d,[e[1],e[2],e[3],e[4],e[5],e[6]+h+f,e[7]+c+d]),h+=e[6],c+=e[7];break;case"A":a(t,h+f,c+d,[e[1],e[2],e[3],e[4],e[5],e[6]+f,e[7]+d]),h=e[6],c=e[7];break;case"z":case"Z":h=s,c=o,t.closePath()}r=e}},_render:function(t){this._renderPathCommands(t),this._renderPaintInOrder(t)},toString:function(){return"#<fabric.Path ("+this.complexity()+'): { "top": '+this.top+', "left": '+this.left+" }>"},toObject:function(t){return r(this.callSuper("toObject",t),{path:this.path.map(function(t){return t.slice()}),top:this.top,left:this.left})},toDatalessObject:function(t){var e=this.toObject(["sourcePath"].concat(t));return e.sourcePath&&delete e.path,e},_toSVG:function(){var t=this._getOffsetTransform();return["<path ","COMMON_PARTS",'d="',this.path.map(function(t){return t.join(" ")}).join(" "),'" stroke-linecap="round" ','transform="'+t+'" ',"/>\n"]},_getOffsetTransform:function(){var t=e.Object.NUM_FRACTION_DIGITS;return" translate("+o(-this.pathOffset.x,t)+", "+o(-this.pathOffset.y,t)+")"},toClipPathSVG:function(t){var e=this._getOffsetTransform();return"\t"+this._createBaseClipPathSVGMarkup(this._toSVG(),{reviver:t,additionalTransform:e})},complexity:function(){return this.path.length},_parsePath:function(){for(var t,e,i,n,r,s=[],a=[],o=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:e[-+]?\d+)?)/gi,l=0,u=this.path.length;l<u;l++){for(n=(t=this.path[l]).slice(1).trim(),a.length=0;i=o.exec(n);)a.push(i[0]);r=[t.charAt(0)];for(var f=0,d=a.length;f<d;f++)e=parseFloat(a[f]),isNaN(e)||r.push(e);var p=r[0],g=h[p.toLowerCase()],v=c[p]||p;if(r.length-1>g)for(var _=1,m=r.length;_<m;_+=g)s.push([p].concat(r.slice(_,_+g))),p=v;else s.push(r)}return s},_parseDimensions:function(){for(var t,r,s,a,o=[],h=[],c=null,l=0,u=0,f=0,d=0,p=0,g=0,v=0,_=this.path.length;v<_;++v){switch((t=this.path[v])[0]){case"l":f+=t[1],d+=t[2],a=[];break;case"L":f=t[1],d=t[2],a=[];break;case"h":f+=t[1],a=[];break;case"H":f=t[1],a=[];break;case"v":d+=t[1],a=[];break;case"V":d=t[1],a=[];break;case"m":l=f+=t[1],u=d+=t[2],a=[];break;case"M":l=f=t[1],u=d=t[2],a=[];break;case"c":r=f+t[5],s=d+t[6],p=f+t[3],g=d+t[4],a=e.util.getBoundsOfCurve(f,d,f+t[1],d+t[2],p,g,r,s),f=r,d=s;break;case"C":p=t[3],g=t[4],a=e.util.getBoundsOfCurve(f,d,t[1],t[2],p,g,t[5],t[6]),f=t[5],d=t[6];break;case"s":r=f+t[3],s=d+t[4],null===c[0].match(/[CcSs]/)?(p=f,g=d):(p=2*f-p,g=2*d-g),a=e.util.getBoundsOfCurve(f,d,p,g,f+t[1],d+t[2],r,s),p=f+t[1],g=d+t[2],f=r,d=s;break;case"S":r=t[3],s=t[4],null===c[0].match(/[CcSs]/)?(p=f,g=d):(p=2*f-p,g=2*d-g),a=e.util.getBoundsOfCurve(f,d,p,g,t[1],t[2],r,s),f=r,d=s,p=t[1],g=t[2];break;case"q":r=f+t[3],s=d+t[4],p=f+t[1],g=d+t[2],a=e.util.getBoundsOfCurve(f,d,p,g,p,g,r,s),f=r,d=s;break;case"Q":p=t[1],g=t[2],a=e.util.getBoundsOfCurve(f,d,p,g,p,g,t[3],t[4]),f=t[3],d=t[4];break;case"t":r=f+t[1],s=d+t[2],null===c[0].match(/[QqTt]/)?(p=f,g=d):(p=2*f-p,g=2*d-g),a=e.util.getBoundsOfCurve(f,d,p,g,p,g,r,s),f=r,d=s;break;case"T":r=t[1],s=t[2],null===c[0].match(/[QqTt]/)?(p=f,g=d):(p=2*f-p,g=2*d-g),a=e.util.getBoundsOfCurve(f,d,p,g,p,g,r,s),f=r,d=s;break;case"a":a=e.util.getBoundsOfArc(f,d,t[1],t[2],t[3],t[4],t[5],t[6]+f,t[7]+d),f+=t[6],d+=t[7];break;case"A":a=e.util.getBoundsOfArc(f,d,t[1],t[2],t[3],t[4],t[5],t[6],t[7]),f=t[6],d=t[7];break;case"z":case"Z":f=l,d=u}c=t,a.forEach(function(t){o.push(t.x),h.push(t.y)}),o.push(f),h.push(d)}var m=i(o)||0,y=i(h)||0;return{left:m,top:y,width:(n(o)||0)-m,height:(n(h)||0)-y}}}),e.Path.fromObject=function(t,i){if("string"==typeof t.sourcePath){var n=t.sourcePath;e.loadSVGFromURL(n,function(e){var n=e[0];n.setOptions(t),i&&i(n)})}else e.Object._fromObject("Path",t,i,"path")},e.Path.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat(["d"]),e.Path.fromElement=function(t,i,n){var s=e.parseAttributes(t,e.Path.ATTRIBUTE_NAMES);i(new e.Path(s.d,r(s,n)))})}(e),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.array.min,n=e.util.array.max;e.Group||(e.Group=e.util.createClass(e.Object,e.Collection,{type:"group",strokeWidth:0,subTargetCheck:!1,cacheProperties:[],useSetOnGroup:!1,initialize:function(t,e,i){e=e||{},this._objects=[],i&&this.callSuper("initialize",e),this._objects=t||[];for(var n=this._objects.length;n--;)this._objects[n].group=this;if(i)this._updateObjectsACoords();else{var r=e&&e.centerPoint;void 0!==e.originX&&(this.originX=e.originX),void 0!==e.originY&&(this.originY=e.originY),r||this._calcBounds(),this._updateObjectsCoords(r),delete e.centerPoint,this.callSuper("initialize",e)}this.setCoords()},_updateObjectsACoords:function(){for(var t=this._objects.length;t--;)this._objects[t].setCoords(!0,!0)},_updateObjectsCoords:function(t){t=t||this.getCenterPoint();for(var e=this._objects.length;e--;)this._updateObjectCoords(this._objects[e],t)},_updateObjectCoords:function(t,e){var i=t.left,n=t.top;t.set({left:i-e.x,top:n-e.y}),t.group=this,t.setCoords(!0,!0)},toString:function(){return"#<fabric.Group: ("+this.complexity()+")>"},addWithUpdate:function(t){return this._restoreObjectsState(),e.util.resetObjectTransform(this),t&&(this._objects.push(t),t.group=this,t._set("canvas",this.canvas)),this._calcBounds(),this._updateObjectsCoords(),this.setCoords(),this.dirty=!0,this},removeWithUpdate:function(t){return this._restoreObjectsState(),e.util.resetObjectTransform(this),this.remove(t),this._calcBounds(),this._updateObjectsCoords(),this.setCoords(),this.dirty=!0,this},_onObjectAdded:function(t){this.dirty=!0,t.group=this,t._set("canvas",this.canvas)},_onObjectRemoved:function(t){this.dirty=!0,delete t.group},_set:function(t,i){var n=this._objects.length;if(this.useSetOnGroup)for(;n--;)this._objects[n].setOnGroup(t,i);if("canvas"===t)for(;n--;)this._objects[n]._set(t,i);e.Object.prototype._set.call(this,t,i)},toObject:function(t){var i=this.includeDefaultValues,n=this._objects.map(function(e){var n=e.includeDefaultValues;e.includeDefaultValues=i;var r=e.toObject(t);return e.includeDefaultValues=n,r}),r=e.Object.prototype.toObject.call(this,t);return r.objects=n,r},toDatalessObject:function(t){var i,n=this.sourcePath;if(n)i=n;else{var r=this.includeDefaultValues;i=this._objects.map(function(e){var i=e.includeDefaultValues;e.includeDefaultValues=r;var n=e.toDatalessObject(t);return e.includeDefaultValues=i,n})}var s=e.Object.prototype.toDatalessObject.call(this,t);return s.objects=i,s},render:function(t){this._transformDone=!0,this.callSuper("render",t),this._transformDone=!1},shouldCache:function(){var t=this.objectCaching&&(!this.group||this.needsItsOwnCache()||!this.group.isOnACache());if(this.ownCaching=t,t)for(var e=0,i=this._objects.length;e<i;e++)if(this._objects[e].willDrawShadow())return this.ownCaching=!1,!1;return t},willDrawShadow:function(){if(this.shadow)return e.Object.prototype.willDrawShadow.call(this);for(var t=0,i=this._objects.length;t<i;t++)if(this._objects[t].willDrawShadow())return!0;return!1},isOnACache:function(){return this.ownCaching||this.group&&this.group.isOnACache()},drawObject:function(t){for(var e=0,i=this._objects.length;e<i;e++)this._objects[e].render(t);this._drawClipPath(t)},isCacheDirty:function(t){if(this.callSuper("isCacheDirty",t))return!0;if(!this.statefullCache)return!1;for(var e=0,i=this._objects.length;e<i;e++)if(this._objects[e].isCacheDirty(!0)){if(this._cacheCanvas){var n=this.cacheWidth/this.zoomX,r=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-n/2,-r/2,n,r)}return!0}return!1},_restoreObjectsState:function(){return this._objects.forEach(this._restoreObjectState,this),this},realizeTransform:function(t){var i=t.calcTransformMatrix(),n=e.util.qrDecompose(i),r=new e.Point(n.translateX,n.translateY);return t.flipX=!1,t.flipY=!1,t.set("scaleX",n.scaleX),t.set("scaleY",n.scaleY),t.skewX=n.skewX,t.skewY=n.skewY,t.angle=n.angle,t.setPositionByOrigin(r,"center","center"),t},_restoreObjectState:function(t){return this.realizeTransform(t),t.setCoords(),delete t.group,this},destroy:function(){return this._objects.forEach(function(t){t.set("dirty",!0)}),this._restoreObjectsState()},toActiveSelection:function(){if(this.canvas){var t=this._objects,i=this.canvas;this._objects=[];var n=this.toObject();delete n.objects;var r=new e.ActiveSelection([]);return r.set(n),r.type="activeSelection",i.remove(this),t.forEach(function(t){t.group=r,t.dirty=!0,i.add(t)}),r.canvas=i,r._objects=t,i._activeObject=r,r.setCoords(),r}},ungroupOnCanvas:function(){return this._restoreObjectsState()},setObjectsCoords:function(){return this.forEachObject(function(t){t.setCoords(!0,!0)}),this},_calcBounds:function(t){for(var e,i,n,r=[],s=[],a=["tr","br","bl","tl"],o=0,h=this._objects.length,c=a.length;o<h;++o)for((e=this._objects[o]).setCoords(!0),n=0;n<c;n++)i=a[n],r.push(e.oCoords[i].x),s.push(e.oCoords[i].y);this._getBounds(r,s,t)},_getBounds:function(t,r,s){var a=new e.Point(i(t),i(r)),o=new e.Point(n(t),n(r)),h=a.y||0,c=a.x||0,l=o.x-a.x||0,u=o.y-a.y||0;this.width=l,this.height=u,s||this.setPositionByOrigin({x:c,y:h},"left","top")},toSVG:function(t){for(var e=[],i=0,n=this._objects.length;i<n;i++)e.push("\t",this._objects[i].toSVG(t));return this._createBaseSVGMarkup(e,{reviver:t,noStyle:!0,withShadow:!0})},toClipPathSVG:function(t){for(var e=[],i=0,n=this._objects.length;i<n;i++)e.push("\t",this._objects[i].toClipPathSVG(t));return this._createBaseClipPathSVGMarkup(e,{reviver:t})}}),e.Group.fromObject=function(t,i){e.util.enlivenObjects(t.objects,function(n){e.util.enlivenObjects([t.clipPath],function(r){var s=e.util.object.clone(t,!0);s.clipPath=r[0],delete s.objects,i&&i(new e.Group(n,s,!0))})})})}(e),function(t){"use strict";var e=t.fabric||(t.fabric={});e.ActiveSelection||(e.ActiveSelection=e.util.createClass(e.Group,{type:"activeSelection",initialize:function(t,i){i=i||{},this._objects=t||[];for(var n=this._objects.length;n--;)this._objects[n].group=this;i.originX&&(this.originX=i.originX),i.originY&&(this.originY=i.originY),this._calcBounds(),this._updateObjectsCoords(),e.Object.prototype.initialize.call(this,i),this.setCoords()},toGroup:function(){var t=this._objects.concat();this._objects=[];var i=e.Object.prototype.toObject.call(this),n=new e.Group([]);if(delete i.type,n.set(i),t.forEach(function(t){t.canvas.remove(t),t.group=n}),n._objects=t,!this.canvas)return n;var r=this.canvas;return r.add(n),r._activeObject=n,n.setCoords(),n},onDeselect:function(){return this.destroy(),!1},toString:function(){return"#<fabric.ActiveSelection: ("+this.complexity()+")>"},shouldCache:function(){return!1},isOnACache:function(){return!1},_renderControls:function(t,e,i){t.save(),t.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1,this.callSuper("_renderControls",t,e),void 0===(i=i||{}).hasControls&&(i.hasControls=!1),void 0===i.hasRotatingPoint&&(i.hasRotatingPoint=!1),i.forActiveSelection=!0;for(var n=0,r=this._objects.length;n<r;n++)this._objects[n]._renderControls(t,i);t.restore()}}),e.ActiveSelection.fromObject=function(t,i){e.util.enlivenObjects(t.objects,function(n){delete t.objects,i&&i(new e.ActiveSelection(n,t,!0))})})}(e),function(t){"use strict";var e=b.util.object.extend;t.fabric||(t.fabric={}),t.fabric.Image?b.warn("fabric.Image is already defined."):(b.Image=b.util.createClass(b.Object,{type:"image",crossOrigin:"",strokeWidth:0,_lastScaleX:1,_lastScaleY:1,_filterScalingX:1,_filterScalingY:1,minimumScaleTrigger:.5,stateProperties:b.Object.prototype.stateProperties.concat("cropX","cropY"),cacheKey:"",cropX:0,cropY:0,initialize:function(t,e){e||(e={}),this.filters=[],this.cacheKey="texture"+b.Object.__uid++,this.callSuper("initialize",e),this._initElement(t,e)},getElement:function(){return this._element||{}},setElement:function(t,e){return this.removeTexture(this.cacheKey),this.removeTexture(this.cacheKey+"_filtered"),this._element=t,this._originalElement=t,this._initConfig(e),0!==this.filters.length&&this.applyFilters(),this.resizeFilter&&this.applyResizeFilters(),this},removeTexture:function(t){var e=b.filterBackend;e&&e.evictCachesForKey&&e.evictCachesForKey(t)},dispose:function(){this.removeTexture(this.cacheKey),this.removeTexture(this.cacheKey+"_filtered"),this._cacheContext=void 0,["_originalElement","_element","_filteredEl","_cacheCanvas"].forEach(function(t){b.util.cleanUpJsdomNode(this[t]),this[t]=void 0}.bind(this))},setCrossOrigin:function(t){return this.crossOrigin=t,this._element.crossOrigin=t,this},getOriginalSize:function(){var t=this.getElement();return{width:t.naturalWidth||t.width,height:t.naturalHeight||t.height}},_stroke:function(t){if(this.stroke&&0!==this.strokeWidth){var e=this.width/2,i=this.height/2;t.beginPath(),t.moveTo(-e,-i),t.lineTo(e,-i),t.lineTo(e,i),t.lineTo(-e,i),t.lineTo(-e,-i),t.closePath()}},_renderDashedStroke:function(t){var e=-this.width/2,i=-this.height/2,n=this.width,r=this.height;t.save(),this._setStrokeStyles(t,this),t.beginPath(),b.util.drawDashedLine(t,e,i,e+n,i,this.strokeDashArray),b.util.drawDashedLine(t,e+n,i,e+n,i+r,this.strokeDashArray),b.util.drawDashedLine(t,e+n,i+r,e,i+r,this.strokeDashArray),b.util.drawDashedLine(t,e,i+r,e,i,this.strokeDashArray),t.closePath(),t.restore()},toObject:function(t){var i=[];this.filters.forEach(function(t){t&&i.push(t.toObject())});var n=e(this.callSuper("toObject",["crossOrigin","cropX","cropY"].concat(t)),{src:this.getSrc(),filters:i});return this.resizeFilter&&(n.resizeFilter=this.resizeFilter.toObject()),n},hasCrop:function(){return this.cropX||this.cropY||this.width<this._element.width||this.height<this._element.height},_toSVG:function(){var t,e=[],i=[],n=-this.width/2,r=-this.height/2,s="";if(this.hasCrop()){var a=b.Object.__uid++;e.push('<clipPath id="imageCrop_'+a+'">\n','\t<rect x="'+n+'" y="'+r+'" width="'+this.width+'" height="'+this.height+'" />\n',"</clipPath>\n"),s=' clip-path="url(#imageCrop_'+a+')" '}if(i.push("\t<image ","COMMON_PARTS",'xlink:href="',this.getSvgSrc(!0),'" x="',n-this.cropX,'" y="',r-this.cropY,'" width="',this._element.width||this._element.naturalWidth,'" height="',this._element.height||this._element.height,'"',s,"></image>\n"),this.stroke||this.strokeDashArray){var o=this.fill;this.fill=null,t=["\t<rect ",'x="',n,'" y="',r,'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),'"/>\n'],this.fill=o}return e="fill"!==this.paintFirst?e.concat(t,i):e.concat(i,t)},getSrc:function(t){var e=t?this._element:this._originalElement;return e?e.toDataURL?e.toDataURL():e.src:this.src||""},setSrc:function(t,e,i){return b.util.loadImage(t,function(t){this.setElement(t,i),this._setWidthHeight(),e(this)},this,i&&i.crossOrigin),this},toString:function(){return'#<fabric.Image: { src: "'+this.getSrc()+'" }>'},applyResizeFilters:function(){var t=this.resizeFilter,e=this.minimumScaleTrigger,i=this.getTotalObjectScaling(),n=i.scaleX,r=i.scaleY,s=this._filteredEl||this._originalElement;if(this.group&&this.set("dirty",!0),!t||n>e&&r>e)return this._element=s,this._filterScalingX=1,this._filterScalingY=1,this._lastScaleX=n,void(this._lastScaleY=r);b.filterBackend||(b.filterBackend=b.initFilterBackend());var a=b.util.createCanvasElement(),o=this._filteredEl?this.cacheKey+"_filtered":this.cacheKey,h=s.width,c=s.height;a.width=h,a.height=c,this._element=a,this._lastScaleX=t.scaleX=n,this._lastScaleY=t.scaleY=r,b.filterBackend.applyFilters([t],s,h,c,this._element,o),this._filterScalingX=a.width/this._originalElement.width,this._filterScalingY=a.height/this._originalElement.height},applyFilters:function(t){if(t=(t=t||this.filters||[]).filter(function(t){return t&&!t.isNeutralState()}),this.set("dirty",!0),this.removeTexture(this.cacheKey+"_filtered"),0===t.length)return this._element=this._originalElement,this._filteredEl=null,this._filterScalingX=1,this._filterScalingY=1,this;var e=this._originalElement,i=e.naturalWidth||e.width,n=e.naturalHeight||e.height;if(this._element===this._originalElement){var r=b.util.createCanvasElement();r.width=i,r.height=n,this._element=r,this._filteredEl=r}else this._element=this._filteredEl,this._filteredEl.getContext("2d").clearRect(0,0,i,n),this._lastScaleX=1,this._lastScaleY=1;return b.filterBackend||(b.filterBackend=b.initFilterBackend()),b.filterBackend.applyFilters(t,this._originalElement,i,n,this._element,this.cacheKey),this._originalElement.width===this._element.width&&this._originalElement.height===this._element.height||(this._filterScalingX=this._element.width/this._originalElement.width,this._filterScalingY=this._element.height/this._originalElement.height),this},_render:function(t){!0!==this.isMoving&&this.resizeFilter&&this._needsResize()&&this.applyResizeFilters(),this._stroke(t),this._renderPaintInOrder(t)},shouldCache:function(){return this.ownCaching=this.objectCaching&&this.needsItsOwnCache(),this.ownCaching},_renderFill:function(t){var e=this.width,i=this.height,n=e*this._filterScalingX,r=i*this._filterScalingY,s=-e/2,a=-i/2,o=this._element;o&&t.drawImage(o,this.cropX*this._filterScalingX,this.cropY*this._filterScalingY,n,r,s,a,e,i)},_needsResize:function(){var t=this.getTotalObjectScaling();return t.scaleX!==this._lastScaleX||t.scaleY!==this._lastScaleY},_resetWidthHeight:function(){this.set(this.getOriginalSize())},_initElement:function(t,e){this.setElement(b.util.getById(t),e),b.util.addClass(this.getElement(),b.Image.CSS_CANVAS)},_initConfig:function(t){t||(t={}),this.setOptions(t),this._setWidthHeight(t),this._element&&this.crossOrigin&&(this._element.crossOrigin=this.crossOrigin)},_initFilters:function(t,e){t&&t.length?b.util.enlivenObjects(t,function(t){e&&e(t)},"fabric.Image.filters"):e&&e()},_setWidthHeight:function(t){t||(t={});var e=this.getElement();this.width=t.width||e.naturalWidth||e.width||0,this.height=t.height||e.naturalHeight||e.height||0},parsePreserveAspectRatioAttribute:function(){var t,e=b.util.parsePreserveAspectRatioAttribute(this.preserveAspectRatio||""),i=this._element.width,n=this._element.height,r=1,s=1,a=0,o=0,h=0,c=0,l=this.width,u=this.height,f={width:l,height:u};return!e||"none"===e.alignX&&"none"===e.alignY?(r=l/i,s=u/n):("meet"===e.meetOrSlice&&(t=(l-i*(r=s=b.util.findScaleToFit(this._element,f)))/2,"Min"===e.alignX&&(a=-t),"Max"===e.alignX&&(a=t),t=(u-n*s)/2,"Min"===e.alignY&&(o=-t),"Max"===e.alignY&&(o=t)),"slice"===e.meetOrSlice&&(t=i-l/(r=s=b.util.findScaleToCover(this._element,f)),"Mid"===e.alignX&&(h=t/2),"Max"===e.alignX&&(h=t),t=n-u/s,"Mid"===e.alignY&&(c=t/2),"Max"===e.alignY&&(c=t),i=l/r,n=u/s)),{width:i,height:n,scaleX:r,scaleY:s,offsetLeft:a,offsetTop:o,cropX:h,cropY:c}}}),b.Image.CSS_CANVAS="canvas-img",b.Image.prototype.getSvgSrc=b.Image.prototype.getSrc,b.Image.fromObject=function(t,e){var i=b.util.object.clone(t);b.util.loadImage(i.src,function(t,n){n?e&&e(null,n):b.Image.prototype._initFilters.call(i,i.filters,function(n){i.filters=n||[],b.Image.prototype._initFilters.call(i,[i.resizeFilter],function(n){i.resizeFilter=n[0],b.util.enlivenObjects([i.clipPath],function(n){i.clipPath=n[0];var r=new b.Image(t,i);e(r)})})})},null,i.crossOrigin)},b.Image.fromURL=function(t,e,i){b.util.loadImage(t,function(t){e&&e(new b.Image(t,i))},null,i&&i.crossOrigin)},b.Image.ATTRIBUTE_NAMES=b.SHARED_ATTRIBUTES.concat("x y width height preserveAspectRatio xlink:href crossOrigin".split(" ")),b.Image.fromElement=function(t,i,n){var r=b.parseAttributes(t,b.Image.ATTRIBUTE_NAMES);b.Image.fromURL(r["xlink:href"],i,e(n?b.util.object.clone(n):{},r))})}(e),b.util.object.extend(b.Object.prototype,{_getAngleValueForStraighten:function(){var t=this.angle%360;return t>0?90*Math.round((t-1)/90):90*Math.round(t/90)},straighten:function(){return this.rotate(this._getAngleValueForStraighten()),this},fxStraighten:function(t){var e=function(){},i=(t=t||{}).onComplete||e,n=t.onChange||e,r=this;return b.util.animate({startValue:this.get("angle"),endValue:this._getAngleValueForStraighten(),duration:this.FX_DURATION,onChange:function(t){r.rotate(t),n()},onComplete:function(){r.setCoords(),i()}}),this}}),b.util.object.extend(b.StaticCanvas.prototype,{straightenObject:function(t){return t.straighten(),this.requestRenderAll(),this},fxStraightenObject:function(t){return t.fxStraighten({onChange:this.requestRenderAllBound}),this}}),function(){"use strict";function t(t,e){var i="precision "+e+" float;\nvoid main(){}",n=t.createShader(t.FRAGMENT_SHADER);return t.shaderSource(n,i),t.compileShader(n),!!t.getShaderParameter(n,t.COMPILE_STATUS)}function e(t){t&&t.tileSize&&(this.tileSize=t.tileSize),this.setupGLContext(this.tileSize,this.tileSize),this.captureGPUInfo()}b.isWebglSupported=function(e){if(b.isLikelyNode)return!1;e=e||b.WebglFilterBackend.prototype.tileSize;var i=document.createElement("canvas"),n=i.getContext("webgl")||i.getContext("experimental-webgl"),r=!1;if(n){b.maxTextureSize=n.getParameter(n.MAX_TEXTURE_SIZE),r=b.maxTextureSize>=e;for(var s=["highp","mediump","lowp"],a=0;a<3;a++)if(t(n,s[a])){b.webGlPrecision=s[a];break}}return this.isSupported=r,r},b.WebglFilterBackend=e,e.prototype={tileSize:2048,resources:{},setupGLContext:function(t,e){this.dispose(),this.createWebGLCanvas(t,e),this.aPosition=new Float32Array([0,0,0,1,1,0,1,1]),this.chooseFastestCopyGLTo2DMethod(t,e)},chooseFastestCopyGLTo2DMethod:function(t,e){var i,n=void 0!==window.performance;try{new ImageData(1,1),i=!0}catch(t){i=!1}var r="undefined"!=typeof ArrayBuffer,s="undefined"!=typeof Uint8ClampedArray;if(n&&i&&r&&s){var a,o,h=b.util.createCanvasElement(),c=new ArrayBuffer(t*e*4),l={imageBuffer:c,destinationWidth:t,destinationHeight:e,targetCanvas:h};h.width=t,h.height=e,a=window.performance.now(),w.call(l,this.gl,l),o=window.performance.now()-a,a=window.performance.now(),C.call(l,this.gl,l),o>window.performance.now()-a?(this.imageBuffer=c,this.copyGLTo2D=C):this.copyGLTo2D=w}},createWebGLCanvas:function(t,e){var i=b.util.createCanvasElement();i.width=t,i.height=e;var n={alpha:!0,premultipliedAlpha:!1,depth:!1,stencil:!1,antialias:!1},r=i.getContext("webgl",n);r||(r=i.getContext("experimental-webgl",n)),r&&(r.clearColor(0,0,0,0),this.canvas=i,this.gl=r)},applyFilters:function(t,e,i,n,r,s){var a,o=this.gl;s&&(a=this.getCachedTexture(s,e));var h={originalWidth:e.width||e.originalWidth,originalHeight:e.height||e.originalHeight,sourceWidth:i,sourceHeight:n,destinationWidth:i,destinationHeight:n,context:o,sourceTexture:this.createTexture(o,i,n,!a&&e),targetTexture:this.createTexture(o,i,n),originalTexture:a||this.createTexture(o,i,n,!a&&e),passes:t.length,webgl:!0,aPosition:this.aPosition,programCache:this.programCache,pass:0,filterBackend:this,targetCanvas:r},c=o.createFramebuffer();return o.bindFramebuffer(o.FRAMEBUFFER,c),t.forEach(function(t){t&&t.applyTo(h)}),function(t){var e=t.targetCanvas,i=e.width,n=e.height,r=t.destinationWidth,s=t.destinationHeight;i===r&&n===s||(e.width=r,e.height=s)}(h),this.copyGLTo2D(o,h),o.bindTexture(o.TEXTURE_2D,null),o.deleteTexture(h.sourceTexture),o.deleteTexture(h.targetTexture),o.deleteFramebuffer(c),r.getContext("2d").setTransform(1,0,0,1,0,0),h},applyFiltersDebug:function(t,e,i,n,r,s){var a=this.gl,o=this.applyFilters(t,e,i,n,r,s),h=a.getError();if(h!==a.NO_ERROR){var c=this.glErrorToString(a,h),l=new Error("WebGL Error "+c);throw l.glErrorCode=h,l}return o},glErrorToString:function(t,e){if(!t)return"Context undefined for error code: "+e;if("number"!=typeof e)return"Error code is not a number";switch(e){case t.NO_ERROR:return"NO_ERROR";case t.INVALID_ENUM:return"INVALID_ENUM";case t.INVALID_VALUE:return"INVALID_VALUE";case t.INVALID_OPERATION:return"INVALID_OPERATION";case t.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case t.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case t.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"UNKNOWN_ERROR"}},dispose:function(){this.canvas&&(this.canvas=null,this.gl=null),this.clearWebGLCaches()},clearWebGLCaches:function(){this.programCache={},this.textureCache={}},createTexture:function(t,e,i,n){var r=t.createTexture();return t.bindTexture(t.TEXTURE_2D,r),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),n?t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,n):t.texImage2D(t.TEXTURE_2D,0,t.RGBA,e,i,0,t.RGBA,t.UNSIGNED_BYTE,null),r},getCachedTexture:function(t,e){if(this.textureCache[t])return this.textureCache[t];var i=this.createTexture(this.gl,e.width,e.height,e);return this.textureCache[t]=i,i},evictCachesForKey:function(t){this.textureCache[t]&&(this.gl.deleteTexture(this.textureCache[t]),delete this.textureCache[t])},copyGLTo2D:w,captureGPUInfo:function(){if(this.gpuInfo)return this.gpuInfo;var t=this.gl,e=t.getExtension("WEBGL_debug_renderer_info"),i={renderer:"",vendor:""};if(e){var n=t.getParameter(e.UNMASKED_RENDERER_WEBGL),r=t.getParameter(e.UNMASKED_VENDOR_WEBGL);n&&(i.renderer=n.toLowerCase()),r&&(i.vendor=r.toLowerCase())}return this.gpuInfo=i,i}}}(),function(){"use strict";var t=function(){};function e(){}b.Canvas2dFilterBackend=e,e.prototype={evictCachesForKey:t,dispose:t,clearWebGLCaches:t,resources:{},applyFilters:function(t,e,i,n,r){var s=r.getContext("2d");s.drawImage(e,0,0,i,n);var a={sourceWidth:i,sourceHeight:n,imageData:s.getImageData(0,0,i,n),originalEl:e,originalImageData:s.getImageData(0,0,i,n),canvasEl:r,ctx:s,filterBackend:this};return t.forEach(function(t){t.applyTo(a)}),a.imageData.width===i&&a.imageData.height===n||(r.width=a.imageData.width,r.height=a.imageData.height),s.putImageData(a.imageData,0,0),a}}}(),b.Image=b.Image||{},b.Image.filters=b.Image.filters||{},b.Image.filters.BaseFilter=b.util.createClass({type:"BaseFilter",vertexSource:"attribute vec2 aPosition;\nvarying vec2 vTexCoord;\nvoid main() {\nvTexCoord = aPosition;\ngl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);\n}",fragmentSource:"precision highp float;\nvarying vec2 vTexCoord;\nuniform sampler2D uTexture;\nvoid main() {\ngl_FragColor = texture2D(uTexture, vTexCoord);\n}",initialize:function(t){t&&this.setOptions(t)},setOptions:function(t){for(var e in t)this[e]=t[e]},createProgram:function(t,e,i){e=e||this.fragmentSource,i=i||this.vertexSource,"highp"!==b.webGlPrecision&&(e=e.replace(/precision highp float/g,"precision "+b.webGlPrecision+" float"));var n=t.createShader(t.VERTEX_SHADER);if(t.shaderSource(n,i),t.compileShader(n),!t.getShaderParameter(n,t.COMPILE_STATUS))throw new Error("Vertex shader compile error for "+this.type+": "+t.getShaderInfoLog(n));var r=t.createShader(t.FRAGMENT_SHADER);if(t.shaderSource(r,e),t.compileShader(r),!t.getShaderParameter(r,t.COMPILE_STATUS))throw new Error("Fragment shader compile error for "+this.type+": "+t.getShaderInfoLog(r));var s=t.createProgram();if(t.attachShader(s,n),t.attachShader(s,r),t.linkProgram(s),!t.getProgramParameter(s,t.LINK_STATUS))throw new Error('Shader link error for "${this.type}" '+t.getProgramInfoLog(s));var a=this.getAttributeLocations(t,s),o=this.getUniformLocations(t,s)||{};return o.uStepW=t.getUniformLocation(s,"uStepW"),o.uStepH=t.getUniformLocation(s,"uStepH"),{program:s,attributeLocations:a,uniformLocations:o}},getAttributeLocations:function(t,e){return{aPosition:t.getAttribLocation(e,"aPosition")}},getUniformLocations:function(){return{}},sendAttributeData:function(t,e,i){var n=e.aPosition,r=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,r),t.enableVertexAttribArray(n),t.vertexAttribPointer(n,2,t.FLOAT,!1,0,0),t.bufferData(t.ARRAY_BUFFER,i,t.STATIC_DRAW)},_setupFrameBuffer:function(t){var e,i,n=t.context;t.passes>1?(e=t.destinationWidth,i=t.destinationHeight,t.sourceWidth===e&&t.sourceHeight===i||(n.deleteTexture(t.targetTexture),t.targetTexture=t.filterBackend.createTexture(n,e,i)),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,t.targetTexture,0)):(n.bindFramebuffer(n.FRAMEBUFFER,null),n.finish())},_swapTextures:function(t){t.passes--,t.pass++;var e=t.targetTexture;t.targetTexture=t.sourceTexture,t.sourceTexture=e},isNeutralState:function(){var t=this.mainParameter,e=b.Image.filters[this.type].prototype;if(t){if(Array.isArray(e[t])){for(var i=e[t].length;i--;)if(this[t][i]!==e[t][i])return!1;return!0}return e[t]===this[t]}return!1},applyTo:function(t){t.webgl?(this._setupFrameBuffer(t),this.applyToWebGL(t),this._swapTextures(t)):this.applyTo2d(t)},retrieveShader:function(t){return t.programCache.hasOwnProperty(this.type)||(t.programCache[this.type]=this.createProgram(t.context)),t.programCache[this.type]},applyToWebGL:function(t){var e=t.context,i=this.retrieveShader(t);0===t.pass&&t.originalTexture?e.bindTexture(e.TEXTURE_2D,t.originalTexture):e.bindTexture(e.TEXTURE_2D,t.sourceTexture),e.useProgram(i.program),this.sendAttributeData(e,i.attributeLocations,t.aPosition),e.uniform1f(i.uniformLocations.uStepW,1/t.sourceWidth),e.uniform1f(i.uniformLocations.uStepH,1/t.sourceHeight),this.sendUniformData(e,i.uniformLocations),e.viewport(0,0,t.destinationWidth,t.destinationHeight),e.drawArrays(e.TRIANGLE_STRIP,0,4)},bindAdditionalTexture:function(t,e,i){t.activeTexture(i),t.bindTexture(t.TEXTURE_2D,e),t.activeTexture(t.TEXTURE0)},unbindAdditionalTexture:function(t,e){t.activeTexture(e),t.bindTexture(t.TEXTURE_2D,null),t.activeTexture(t.TEXTURE0)},getMainParameter:function(){return this[this.mainParameter]},setMainParameter:function(t){this[this.mainParameter]=t},sendUniformData:function(){},createHelpLayer:function(t){if(!t.helpLayer){var e=document.createElement("canvas");e.width=t.sourceWidth,e.height=t.sourceHeight,t.helpLayer=e}},toObject:function(){var t={type:this.type},e=this.mainParameter;return e&&(t[e]=this[e]),t},toJSON:function(){return this.toObject()}}),b.Image.filters.BaseFilter.fromObject=function(t,e){var i=new b.Image.filters[t.type](t);return e&&e(i),i},function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.Image.filters,n=e.util.createClass;i.ColorMatrix=n(i.BaseFilter,{type:"ColorMatrix",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nvarying vec2 vTexCoord;\nuniform mat4 uColorMatrix;\nuniform vec4 uConstants;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\ncolor *= uColorMatrix;\ncolor += uConstants;\ngl_FragColor = color;\n}",matrix:[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],mainParameter:"matrix",colorsOnly:!0,initialize:function(t){this.callSuper("initialize",t),this.matrix=this.matrix.slice(0)},applyTo2d:function(t){var e,i,n,r,s,a=t.imageData.data,o=a.length,h=this.matrix,c=this.colorsOnly;for(s=0;s<o;s+=4)e=a[s],i=a[s+1],n=a[s+2],c?(a[s]=e*h[0]+i*h[1]+n*h[2]+255*h[4],a[s+1]=e*h[5]+i*h[6]+n*h[7]+255*h[9],a[s+2]=e*h[10]+i*h[11]+n*h[12]+255*h[14]):(r=a[s+3],a[s]=e*h[0]+i*h[1]+n*h[2]+r*h[3]+255*h[4],a[s+1]=e*h[5]+i*h[6]+n*h[7]+r*h[8]+255*h[9],a[s+2]=e*h[10]+i*h[11]+n*h[12]+r*h[13]+255*h[14],a[s+3]=e*h[15]+i*h[16]+n*h[17]+r*h[18]+255*h[19])},getUniformLocations:function(t,e){return{uColorMatrix:t.getUniformLocation(e,"uColorMatrix"),uConstants:t.getUniformLocation(e,"uConstants")}},sendUniformData:function(t,e){var i=this.matrix,n=[i[0],i[1],i[2],i[3],i[5],i[6],i[7],i[8],i[10],i[11],i[12],i[13],i[15],i[16],i[17],i[18]],r=[i[4],i[9],i[14],i[19]];t.uniformMatrix4fv(e.uColorMatrix,!1,n),t.uniform4fv(e.uConstants,r)}}),e.Image.filters.ColorMatrix.fromObject=e.Image.filters.BaseFilter.fromObject}(e),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.Image.filters,n=e.util.createClass;i.Brightness=n(i.BaseFilter,{type:"Brightness",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uBrightness;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\ncolor.rgb += uBrightness;\ngl_FragColor = color;\n}",brightness:0,mainParameter:"brightness",applyTo2d:function(t){if(0!==this.brightness){var e,i=t.imageData.data,n=i.length,r=Math.round(255*this.brightness);for(e=0;e<n;e+=4)i[e]=i[e]+r,i[e+1]=i[e+1]+r,i[e+2]=i[e+2]+r}},getUniformLocations:function(t,e){return{uBrightness:t.getUniformLocation(e,"uBrightness")}},sendUniformData:function(t,e){t.uniform1f(e.uBrightness,this.brightness)}}),e.Image.filters.Brightness.fromObject=e.Image.filters.BaseFilter.fromObject}(e),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.extend,n=e.Image.filters,r=e.util.createClass;n.Convolute=r(n.BaseFilter,{type:"Convolute",opaque:!1,matrix:[0,0,0,0,1,0,0,0,0],fragmentSource:{Convolute_3_1:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[9];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 0);\nfor (float h = 0.0; h < 3.0; h+=1.0) {\nfor (float w = 0.0; w < 3.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 1), uStepH * (h - 1));\ncolor += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 3.0 + w)];\n}\n}\ngl_FragColor = color;\n}",Convolute_3_0:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[9];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 1);\nfor (float h = 0.0; h < 3.0; h+=1.0) {\nfor (float w = 0.0; w < 3.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 1.0), uStepH * (h - 1.0));\ncolor.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 3.0 + w)];\n}\n}\nfloat alpha = texture2D(uTexture, vTexCoord).a;\ngl_FragColor = color;\ngl_FragColor.a = alpha;\n}",Convolute_5_1:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[25];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 0);\nfor (float h = 0.0; h < 5.0; h+=1.0) {\nfor (float w = 0.0; w < 5.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));\ncolor += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 5.0 + w)];\n}\n}\ngl_FragColor = color;\n}",Convolute_5_0:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[25];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 1);\nfor (float h = 0.0; h < 5.0; h+=1.0) {\nfor (float w = 0.0; w < 5.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));\ncolor.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 5.0 + w)];\n}\n}\nfloat alpha = texture2D(uTexture, vTexCoord).a;\ngl_FragColor = color;\ngl_FragColor.a = alpha;\n}",Convolute_7_1:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[49];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 0);\nfor (float h = 0.0; h < 7.0; h+=1.0) {\nfor (float w = 0.0; w < 7.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));\ncolor += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 7.0 + w)];\n}\n}\ngl_FragColor = color;\n}",Convolute_7_0:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[49];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 1);\nfor (float h = 0.0; h < 7.0; h+=1.0) {\nfor (float w = 0.0; w < 7.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));\ncolor.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 7.0 + w)];\n}\n}\nfloat alpha = texture2D(uTexture, vTexCoord).a;\ngl_FragColor = color;\ngl_FragColor.a = alpha;\n}",Convolute_9_1:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[81];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 0);\nfor (float h = 0.0; h < 9.0; h+=1.0) {\nfor (float w = 0.0; w < 9.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));\ncolor += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 9.0 + w)];\n}\n}\ngl_FragColor = color;\n}",Convolute_9_0:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[81];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 1);\nfor (float h = 0.0; h < 9.0; h+=1.0) {\nfor (float w = 0.0; w < 9.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));\ncolor.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 9.0 + w)];\n}\n}\nfloat alpha = texture2D(uTexture, vTexCoord).a;\ngl_FragColor = color;\ngl_FragColor.a = alpha;\n}"},retrieveShader:function(t){var e=Math.sqrt(this.matrix.length),i=this.type+"_"+e+"_"+(this.opaque?1:0),n=this.fragmentSource[i];return t.programCache.hasOwnProperty(i)||(t.programCache[i]=this.createProgram(t.context,n)),t.programCache[i]},applyTo2d:function(t){var e,i,n,r,s,a,o,h,c,l,u,f,d,p=t.imageData,g=p.data,v=this.matrix,_=Math.round(Math.sqrt(v.length)),m=Math.floor(_/2),y=p.width,x=p.height,b=t.ctx.createImageData(y,x),w=b.data,C=this.opaque?1:0;for(u=0;u<x;u++)for(l=0;l<y;l++){for(s=4*(u*y+l),e=0,i=0,n=0,r=0,d=0;d<_;d++)for(f=0;f<_;f++)a=l+f-m,(o=u+d-m)<0||o>x||a<0||a>y||(h=4*(o*y+a),c=v[d*_+f],e+=g[h]*c,i+=g[h+1]*c,n+=g[h+2]*c,C||(r+=g[h+3]*c));w[s]=e,w[s+1]=i,w[s+2]=n,w[s+3]=C?g[s+3]:r}t.imageData=b},getUniformLocations:function(t,e){return{uMatrix:t.getUniformLocation(e,"uMatrix"),uOpaque:t.getUniformLocation(e,"uOpaque"),uHalfSize:t.getUniformLocation(e,"uHalfSize"),uSize:t.getUniformLocation(e,"uSize")}},sendUniformData:function(t,e){t.uniform1fv(e.uMatrix,this.matrix)},toObject:function(){return i(this.callSuper("toObject"),{opaque:this.opaque,matrix:this.matrix})}}),e.Image.filters.Convolute.fromObject=e.Image.filters.BaseFilter.fromObject}(e),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.Image.filters,n=e.util.createClass;i.Grayscale=n(i.BaseFilter,{type:"Grayscale",fragmentSource:{average:"precision highp float;\nuniform sampler2D uTexture;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nfloat average = (color.r + color.b + color.g) / 3.0;\ngl_FragColor = vec4(average, average, average, color.a);\n}",lightness:"precision highp float;\nuniform sampler2D uTexture;\nuniform int uMode;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 col = texture2D(uTexture, vTexCoord);\nfloat average = (max(max(col.r, col.g),col.b) + min(min(col.r, col.g),col.b)) / 2.0;\ngl_FragColor = vec4(average, average, average, col.a);\n}",luminosity:"precision highp float;\nuniform sampler2D uTexture;\nuniform int uMode;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 col = texture2D(uTexture, vTexCoord);\nfloat average = 0.21 * col.r + 0.72 * col.g + 0.07 * col.b;\ngl_FragColor = vec4(average, average, average, col.a);\n}"},mode:"average",mainParameter:"mode",applyTo2d:function(t){var e,i,n=t.imageData.data,r=n.length,s=this.mode;for(e=0;e<r;e+=4)"average"===s?i=(n[e]+n[e+1]+n[e+2])/3:"lightness"===s?i=(Math.min(n[e],n[e+1],n[e+2])+Math.max(n[e],n[e+1],n[e+2]))/2:"luminosity"===s&&(i=.21*n[e]+.72*n[e+1]+.07*n[e+2]),n[e]=i,n[e+1]=i,n[e+2]=i},retrieveShader:function(t){var e=this.type+"_"+this.mode;if(!t.programCache.hasOwnProperty(e)){var i=this.fragmentSource[this.mode];t.programCache[e]=this.createProgram(t.context,i)}return t.programCache[e]},getUniformLocations:function(t,e){return{uMode:t.getUniformLocation(e,"uMode")}},sendUniformData:function(t,e){t.uniform1i(e.uMode,1)},isNeutralState:function(){return!1}}),e.Image.filters.Grayscale.fromObject=e.Image.filters.BaseFilter.fromObject}(e),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.Image.filters,n=e.util.createClass;i.Invert=n(i.BaseFilter,{type:"Invert",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform int uInvert;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nif (uInvert == 1) {\ngl_FragColor = vec4(1.0 - color.r,1.0 -color.g,1.0 -color.b,color.a);\n} else {\ngl_FragColor = color;\n}\n}",invert:!0,mainParameter:"invert",applyTo2d:function(t){var e,i=t.imageData.data,n=i.length;for(e=0;e<n;e+=4)i[e]=255-i[e],i[e+1]=255-i[e+1],i[e+2]=255-i[e+2]},isNeutralState:function(){return!this.invert},getUniformLocations:function(t,e){return{uInvert:t.getUniformLocation(e,"uInvert")}},sendUniformData:function(t,e){t.uniform1i(e.uInvert,this.invert)}}),e.Image.filters.Invert.fromObject=e.Image.filters.BaseFilter.fromObject}(e),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.extend,n=e.Image.filters,r=e.util.createClass;n.Noise=r(n.BaseFilter,{type:"Noise",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uStepH;\nuniform float uNoise;\nuniform float uSeed;\nvarying vec2 vTexCoord;\nfloat rand(vec2 co, float seed, float vScale) {\nreturn fract(sin(dot(co.xy * vScale ,vec2(12.9898 , 78.233))) * 43758.5453 * (seed + 0.01) / 2.0);\n}\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\ncolor.rgb += (0.5 - rand(vTexCoord, uSeed, 0.1 / uStepH)) * uNoise;\ngl_FragColor = color;\n}",mainParameter:"noise",noise:0,applyTo2d:function(t){if(0!==this.noise){var e,i,n=t.imageData.data,r=n.length,s=this.noise;for(e=0,r=n.length;e<r;e+=4)i=(.5-Math.random())*s,n[e]+=i,n[e+1]+=i,n[e+2]+=i}},getUniformLocations:function(t,e){return{uNoise:t.getUniformLocation(e,"uNoise"),uSeed:t.getUniformLocation(e,"uSeed")}},sendUniformData:function(t,e){t.uniform1f(e.uNoise,this.noise/255),t.uniform1f(e.uSeed,Math.random())},toObject:function(){return i(this.callSuper("toObject"),{noise:this.noise})}}),e.Image.filters.Noise.fromObject=e.Image.filters.BaseFilter.fromObject}(e),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.Image.filters,n=e.util.createClass;i.Pixelate=n(i.BaseFilter,{type:"Pixelate",blocksize:4,mainParameter:"blocksize",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uBlocksize;\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nfloat blockW = uBlocksize * uStepW;\nfloat blockH = uBlocksize * uStepW;\nint posX = int(vTexCoord.x / blockW);\nint posY = int(vTexCoord.y / blockH);\nfloat fposX = float(posX);\nfloat fposY = float(posY);\nvec2 squareCoords = vec2(fposX * blockW, fposY * blockH);\nvec4 color = texture2D(uTexture, squareCoords);\ngl_FragColor = color;\n}",applyTo2d:function(t){var e,i,n,r,s,a,o,h,c,l,u,f=t.imageData,d=f.data,p=f.height,g=f.width;for(i=0;i<p;i+=this.blocksize)for(n=0;n<g;n+=this.blocksize)for(r=d[e=4*i*g+4*n],s=d[e+1],a=d[e+2],o=d[e+3],l=Math.min(i+this.blocksize,p),u=Math.min(n+this.blocksize,g),h=i;h<l;h++)for(c=n;c<u;c++)d[e=4*h*g+4*c]=r,d[e+1]=s,d[e+2]=a,d[e+3]=o},isNeutralState:function(){return 1===this.blocksize},getUniformLocations:function(t,e){return{uBlocksize:t.getUniformLocation(e,"uBlocksize"),uStepW:t.getUniformLocation(e,"uStepW"),uStepH:t.getUniformLocation(e,"uStepH")}},sendUniformData:function(t,e){t.uniform1f(e.uBlocksize,this.blocksize)}}),e.Image.filters.Pixelate.fromObject=e.Image.filters.BaseFilter.fromObject}(e),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.extend,n=e.Image.filters,r=e.util.createClass;n.RemoveColor=r(n.BaseFilter,{type:"RemoveColor",color:"#FFFFFF",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform vec4 uLow;\nuniform vec4 uHigh;\nvarying vec2 vTexCoord;\nvoid main() {\ngl_FragColor = texture2D(uTexture, vTexCoord);\nif(all(greaterThan(gl_FragColor.rgb,uLow.rgb)) && all(greaterThan(uHigh.rgb,gl_FragColor.rgb))) {\ngl_FragColor.a = 0.0;\n}\n}",distance:.02,useAlpha:!1,applyTo2d:function(t){var i,n,r,s,a=t.imageData.data,o=255*this.distance,h=new e.Color(this.color).getSource(),c=[h[0]-o,h[1]-o,h[2]-o],l=[h[0]+o,h[1]+o,h[2]+o];for(i=0;i<a.length;i+=4)n=a[i],r=a[i+1],s=a[i+2],n>c[0]&&r>c[1]&&s>c[2]&&n<l[0]&&r<l[1]&&s<l[2]&&(a[i+3]=0)},getUniformLocations:function(t,e){return{uLow:t.getUniformLocation(e,"uLow"),uHigh:t.getUniformLocation(e,"uHigh")}},sendUniformData:function(t,i){var n=new e.Color(this.color).getSource(),r=parseFloat(this.distance),s=[0+n[0]/255-r,0+n[1]/255-r,0+n[2]/255-r,1],a=[n[0]/255+r,n[1]/255+r,n[2]/255+r,1];t.uniform4fv(i.uLow,s),t.uniform4fv(i.uHigh,a)},toObject:function(){return i(this.callSuper("toObject"),{color:this.color,distance:this.distance})}}),e.Image.filters.RemoveColor.fromObject=e.Image.filters.BaseFilter.fromObject}(e),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.Image.filters,n=e.util.createClass,r={Brownie:[.5997,.34553,-.27082,0,.186,-.0377,.86095,.15059,0,-.1449,.24113,-.07441,.44972,0,-.02965,0,0,0,1,0],Vintage:[.62793,.32021,-.03965,0,.03784,.02578,.64411,.03259,0,.02926,.0466,-.08512,.52416,0,.02023,0,0,0,1,0],Kodachrome:[1.12855,-.39673,-.03992,0,.24991,-.16404,1.08352,-.05498,0,.09698,-.16786,-.56034,1.60148,0,.13972,0,0,0,1,0],Technicolor:[1.91252,-.85453,-.09155,0,.04624,-.30878,1.76589,-.10601,0,-.27589,-.2311,-.75018,1.84759,0,.12137,0,0,0,1,0],Polaroid:[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0],Sepia:[.393,.769,.189,0,0,.349,.686,.168,0,0,.272,.534,.131,0,0,0,0,0,1,0],BlackWhite:[1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,0,0,0,1,0]};for(var s in r)i[s]=n(i.ColorMatrix,{type:s,matrix:r[s],mainParameter:!1,colorsOnly:!0}),e.Image.filters[s].fromObject=e.Image.filters.BaseFilter.fromObject}(e),function(t){"use strict";var i=(true?e:undefined).fabric,n=i.Image.filters,r=i.util.createClass;n.BlendColor=r(n.BaseFilter,{type:"BlendColor",color:"#F95C63",mode:"multiply",alpha:1,fragmentSource:{multiply:"gl_FragColor.rgb *= uColor.rgb;\n",screen:"gl_FragColor.rgb = 1.0 - (1.0 - gl_FragColor.rgb) * (1.0 - uColor.rgb);\n",add:"gl_FragColor.rgb += uColor.rgb;\n",diff:"gl_FragColor.rgb = abs(gl_FragColor.rgb - uColor.rgb);\n",subtract:"gl_FragColor.rgb -= uColor.rgb;\n",lighten:"gl_FragColor.rgb = max(gl_FragColor.rgb, uColor.rgb);\n",darken:"gl_FragColor.rgb = min(gl_FragColor.rgb, uColor.rgb);\n",exclusion:"gl_FragColor.rgb += uColor.rgb - 2.0 * (uColor.rgb * gl_FragColor.rgb);\n",overlay:"if (uColor.r < 0.5) {\ngl_FragColor.r *= 2.0 * uColor.r;\n} else {\ngl_FragColor.r = 1.0 - 2.0 * (1.0 - gl_FragColor.r) * (1.0 - uColor.r);\n}\nif (uColor.g < 0.5) {\ngl_FragColor.g *= 2.0 * uColor.g;\n} else {\ngl_FragColor.g = 1.0 - 2.0 * (1.0 - gl_FragColor.g) * (1.0 - uColor.g);\n}\nif (uColor.b < 0.5) {\ngl_FragColor.b *= 2.0 * uColor.b;\n} else {\ngl_FragColor.b = 1.0 - 2.0 * (1.0 - gl_FragColor.b) * (1.0 - uColor.b);\n}\n",tint:"gl_FragColor.rgb *= (1.0 - uColor.a);\ngl_FragColor.rgb += uColor.rgb;\n"},buildSource:function(t){return"precision highp float;\nuniform sampler2D uTexture;\nuniform vec4 uColor;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\ngl_FragColor = color;\nif (color.a > 0.0) {\n"+this.fragmentSource[t]+"}\n}"},retrieveShader:function(t){var e,i=this.type+"_"+this.mode;return t.programCache.hasOwnProperty(i)||(e=this.buildSource(this.mode),t.programCache[i]=this.createProgram(t.context,e)),t.programCache[i]},applyTo2d:function(t){var e,n,r,s,a,o,h,c=t.imageData.data,l=c.length,u=1-this.alpha;e=(h=new i.Color(this.color).getSource())[0]*this.alpha,n=h[1]*this.alpha,r=h[2]*this.alpha;for(var f=0;f<l;f+=4)switch(s=c[f],a=c[f+1],o=c[f+2],this.mode){case"multiply":c[f]=s*e/255,c[f+1]=a*n/255,c[f+2]=o*r/255;break;case"screen":c[f]=255-(255-s)*(255-e)/255,c[f+1]=255-(255-a)*(255-n)/255,c[f+2]=255-(255-o)*(255-r)/255;break;case"add":c[f]=s+e,c[f+1]=a+n,c[f+2]=o+r;break;case"diff":case"difference":c[f]=Math.abs(s-e),c[f+1]=Math.abs(a-n),c[f+2]=Math.abs(o-r);break;case"subtract":c[f]=s-e,c[f+1]=a-n,c[f+2]=o-r;break;case"darken":c[f]=Math.min(s,e),c[f+1]=Math.min(a,n),c[f+2]=Math.min(o,r);break;case"lighten":c[f]=Math.max(s,e),c[f+1]=Math.max(a,n),c[f+2]=Math.max(o,r);break;case"overlay":c[f]=e<128?2*s*e/255:255-2*(255-s)*(255-e)/255,c[f+1]=n<128?2*a*n/255:255-2*(255-a)*(255-n)/255,c[f+2]=r<128?2*o*r/255:255-2*(255-o)*(255-r)/255;break;case"exclusion":c[f]=e+s-2*e*s/255,c[f+1]=n+a-2*n*a/255,c[f+2]=r+o-2*r*o/255;break;case"tint":c[f]=e+s*u,c[f+1]=n+a*u,c[f+2]=r+o*u}},getUniformLocations:function(t,e){return{uColor:t.getUniformLocation(e,"uColor")}},sendUniformData:function(t,e){var n=new i.Color(this.color).getSource();n[0]=this.alpha*n[0]/255,n[1]=this.alpha*n[1]/255,n[2]=this.alpha*n[2]/255,n[3]=this.alpha,t.uniform4fv(e.uColor,n)},toObject:function(){return{type:this.type,color:this.color,mode:this.mode,alpha:this.alpha}}}),i.Image.filters.BlendColor.fromObject=i.Image.filters.BaseFilter.fromObject}(),function(t){"use strict";var i=(true?e:undefined).fabric,n=i.Image.filters,r=i.util.createClass;n.BlendImage=r(n.BaseFilter,{type:"BlendImage",image:null,mode:"multiply",alpha:1,vertexSource:"attribute vec2 aPosition;\nvarying vec2 vTexCoord;\nvarying vec2 vTexCoord2;\nuniform mat3 uTransformMatrix;\nvoid main() {\nvTexCoord = aPosition;\nvTexCoord2 = (uTransformMatrix * vec3(aPosition, 1.0)).xy;\ngl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);\n}",fragmentSource:{multiply:"precision highp float;\nuniform sampler2D uTexture;\nuniform sampler2D uImage;\nuniform vec4 uColor;\nvarying vec2 vTexCoord;\nvarying vec2 vTexCoord2;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nvec4 color2 = texture2D(uImage, vTexCoord2);\ncolor.rgba *= color2.rgba;\ngl_FragColor = color;\n}",mask:"precision highp float;\nuniform sampler2D uTexture;\nuniform sampler2D uImage;\nuniform vec4 uColor;\nvarying vec2 vTexCoord;\nvarying vec2 vTexCoord2;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nvec4 color2 = texture2D(uImage, vTexCoord2);\ncolor.a = color2.a;\ngl_FragColor = color;\n}"},retrieveShader:function(t){var e=this.type+"_"+this.mode,i=this.fragmentSource[this.mode];return t.programCache.hasOwnProperty(e)||(t.programCache[e]=this.createProgram(t.context,i)),t.programCache[e]},applyToWebGL:function(t){var e=t.context,i=this.createTexture(t.filterBackend,this.image);this.bindAdditionalTexture(e,i,e.TEXTURE1),this.callSuper("applyToWebGL",t),this.unbindAdditionalTexture(e,e.TEXTURE1)},createTexture:function(t,e){return t.getCachedTexture(e.cacheKey,e._element)},calculateMatrix:function(){var t=this.image,e=t._element.width,i=t._element.height;return[1/t.scaleX,0,0,0,1/t.scaleY,0,-t.left/e,-t.top/i,1]},applyTo2d:function(t){var e,n,r,s,a,o,h,c,l,u,f,d=t.imageData,p=t.filterBackend.resources,g=d.data,v=g.length,_=d.width,m=d.height,y=this.image;p.blendImage||(p.blendImage=i.util.createCanvasElement()),u=(l=p.blendImage).getContext("2d"),l.width!==_||l.height!==m?(l.width=_,l.height=m):u.clearRect(0,0,_,m),u.setTransform(y.scaleX,0,0,y.scaleY,y.left,y.top),u.drawImage(y._element,0,0,_,m),f=u.getImageData(0,0,_,m).data;for(var x=0;x<v;x+=4)switch(a=g[x],o=g[x+1],h=g[x+2],c=g[x+3],e=f[x],n=f[x+1],r=f[x+2],s=f[x+3],this.mode){case"multiply":g[x]=a*e/255,g[x+1]=o*n/255,g[x+2]=h*r/255,g[x+3]=c*s/255;break;case"mask":g[x+3]=s}},getUniformLocations:function(t,e){return{uTransformMatrix:t.getUniformLocation(e,"uTransformMatrix"),uImage:t.getUniformLocation(e,"uImage")}},sendUniformData:function(t,e){var i=this.calculateMatrix();t.uniform1i(e.uImage,1),t.uniformMatrix3fv(e.uTransformMatrix,!1,i)},toObject:function(){return{type:this.type,image:this.image&&this.image.toObject(),mode:this.mode,alpha:this.alpha}}}),i.Image.filters.BlendImage.fromObject=function(t,e){i.Image.fromObject(t.image,function(n){var r=i.util.object.clone(t);r.image=n,e(new i.Image.filters.BlendImage(r))})}}(),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=Math.pow,n=Math.floor,r=Math.sqrt,s=Math.abs,a=Math.round,o=Math.sin,h=Math.ceil,c=e.Image.filters,l=e.util.createClass;c.Resize=l(c.BaseFilter,{type:"Resize",resizeType:"hermite",scaleX:1,scaleY:1,lanczosLobes:3,getUniformLocations:function(t,e){return{uDelta:t.getUniformLocation(e,"uDelta"),uTaps:t.getUniformLocation(e,"uTaps")}},sendUniformData:function(t,e){t.uniform2fv(e.uDelta,this.horizontal?[1/this.width,0]:[0,1/this.height]),t.uniform1fv(e.uTaps,this.taps)},retrieveShader:function(t){var e=this.getFilterWindow(),i=this.type+"_"+e;if(!t.programCache.hasOwnProperty(i)){var n=this.generateShader(e);t.programCache[i]=this.createProgram(t.context,n)}return t.programCache[i]},getFilterWindow:function(){var t=this.tempScale;return Math.ceil(this.lanczosLobes/t)},getTaps:function(){for(var t=this.lanczosCreate(this.lanczosLobes),e=this.tempScale,i=this.getFilterWindow(),n=new Array(i),r=1;r<=i;r++)n[r-1]=t(r*e);return n},generateShader:function(t){for(var e=new Array(t),i=this.fragmentSourceTOP,n=1;n<=t;n++)e[n-1]=n+".0 * uDelta";return i+="uniform float uTaps["+t+"];\n",i+="void main() {\n",i+="  vec4 color = texture2D(uTexture, vTexCoord);\n",i+="  float sum = 1.0;\n",e.forEach(function(t,e){i+="  color += texture2D(uTexture, vTexCoord + "+t+") * uTaps["+e+"];\n",i+="  color += texture2D(uTexture, vTexCoord - "+t+") * uTaps["+e+"];\n",i+="  sum += 2.0 * uTaps["+e+"];\n"}),i+="  gl_FragColor = color / sum;\n",i+="}"},fragmentSourceTOP:"precision highp float;\nuniform sampler2D uTexture;\nuniform vec2 uDelta;\nvarying vec2 vTexCoord;\n",applyTo:function(t){t.webgl?(t.passes++,this.width=t.sourceWidth,this.horizontal=!0,this.dW=Math.round(this.width*this.scaleX),this.dH=t.sourceHeight,this.tempScale=this.dW/this.width,this.taps=this.getTaps(),t.destinationWidth=this.dW,this._setupFrameBuffer(t),this.applyToWebGL(t),this._swapTextures(t),t.sourceWidth=t.destinationWidth,this.height=t.sourceHeight,this.horizontal=!1,this.dH=Math.round(this.height*this.scaleY),this.tempScale=this.dH/this.height,this.taps=this.getTaps(),t.destinationHeight=this.dH,this._setupFrameBuffer(t),this.applyToWebGL(t),this._swapTextures(t),t.sourceHeight=t.destinationHeight):this.applyTo2d(t)},isNeutralState:function(){return 1===this.scaleX&&1===this.scaleY},lanczosCreate:function(t){return function(e){if(e>=t||e<=-t)return 0;if(e<1.1920929e-7&&e>-1.1920929e-7)return 1;var i=(e*=Math.PI)/t;return o(e)/e*o(i)/i}},applyTo2d:function(t){var e=t.imageData,i=this.scaleX,n=this.scaleY;this.rcpScaleX=1/i,this.rcpScaleY=1/n;var r,s=e.width,o=e.height,h=a(s*i),c=a(o*n);"sliceHack"===this.resizeType?r=this.sliceByTwo(t,s,o,h,c):"hermite"===this.resizeType?r=this.hermiteFastResize(t,s,o,h,c):"bilinear"===this.resizeType?r=this.bilinearFiltering(t,s,o,h,c):"lanczos"===this.resizeType&&(r=this.lanczosResize(t,s,o,h,c)),t.imageData=r},sliceByTwo:function(t,i,r,s,a){var o,h,c=t.imageData,l=!1,u=!1,f=.5*i,d=.5*r,p=e.filterBackend.resources,g=0,v=0,_=i,m=0;for(p.sliceByTwo||(p.sliceByTwo=document.createElement("canvas")),((o=p.sliceByTwo).width<1.5*i||o.height<r)&&(o.width=1.5*i,o.height=r),(h=o.getContext("2d")).clearRect(0,0,1.5*i,r),h.putImageData(c,0,0),s=n(s),a=n(a);!l||!u;)i=f,r=d,s<n(.5*f)?f=n(.5*f):(f=s,l=!0),a<n(.5*d)?d=n(.5*d):(d=a,u=!0),h.drawImage(o,g,v,i,r,_,m,f,d),g=_,v=m,m+=d;return h.getImageData(g,v,s,a)},lanczosResize:function(t,e,a,o,c){var l=t.imageData.data,u=t.ctx.createImageData(o,c),f=u.data,d=this.lanczosCreate(this.lanczosLobes),p=this.rcpScaleX,g=this.rcpScaleY,v=2/this.rcpScaleX,_=2/this.rcpScaleY,m=h(p*this.lanczosLobes/2),y=h(g*this.lanczosLobes/2),x={},b={},w={};return function t(h){var C,S,T,k,O,A,P,E,M,I,L;for(b.x=(h+.5)*p,w.x=n(b.x),C=0;C<c;C++){for(b.y=(C+.5)*g,w.y=n(b.y),O=0,A=0,P=0,E=0,M=0,S=w.x-m;S<=w.x+m;S++)if(!(S<0||S>=e)){I=n(1e3*s(S-b.x)),x[I]||(x[I]={});for(var D=w.y-y;D<=w.y+y;D++)D<0||D>=a||(L=n(1e3*s(D-b.y)),x[I][L]||(x[I][L]=d(r(i(I*v,2)+i(L*_,2))/1e3)),(T=x[I][L])>0&&(O+=T,A+=T*l[k=4*(D*e+S)],P+=T*l[k+1],E+=T*l[k+2],M+=T*l[k+3]))}f[k=4*(C*o+h)]=A/O,f[k+1]=P/O,f[k+2]=E/O,f[k+3]=M/O}return++h<o?t(h):u}(0)},bilinearFiltering:function(t,e,i,r,s){var a,o,h,c,l,u,f,d,p,g=0,v=this.rcpScaleX,_=this.rcpScaleY,m=4*(e-1),y=t.imageData.data,x=t.ctx.createImageData(r,s),b=x.data;for(h=0;h<s;h++)for(c=0;c<r;c++)for(l=v*c-(a=n(v*c)),u=_*h-(o=n(_*h)),p=4*(o*e+a),f=0;f<4;f++)d=y[p+f]*(1-l)*(1-u)+y[p+4+f]*l*(1-u)+y[p+m+f]*u*(1-l)+y[p+m+4+f]*l*u,b[g++]=d;return x},hermiteFastResize:function(t,e,i,a,o){for(var c=this.rcpScaleX,l=this.rcpScaleY,u=h(c/2),f=h(l/2),d=t.imageData.data,p=t.ctx.createImageData(a,o),g=p.data,v=0;v<o;v++)for(var _=0;_<a;_++){for(var m=4*(_+v*a),y=0,x=0,b=0,w=0,C=0,S=0,T=0,k=(v+.5)*l,O=n(v*l);O<(v+1)*l;O++)for(var A=s(k-(O+.5))/f,P=(_+.5)*c,E=A*A,M=n(_*c);M<(_+1)*c;M++){var I=s(P-(M+.5))/u,L=r(E+I*I);L>1&&L<-1||(y=2*L*L*L-3*L*L+1)>0&&(T+=y*d[(I=4*(M+O*e))+3],b+=y,d[I+3]<255&&(y=y*d[I+3]/250),w+=y*d[I],C+=y*d[I+1],S+=y*d[I+2],x+=y)}g[m]=w/x,g[m+1]=C/x,g[m+2]=S/x,g[m+3]=T/b}return p},toObject:function(){return{type:this.type,scaleX:this.scaleX,scaleY:this.scaleY,resizeType:this.resizeType,lanczosLobes:this.lanczosLobes}}}),e.Image.filters.Resize.fromObject=e.Image.filters.BaseFilter.fromObject}(e),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.Image.filters,n=e.util.createClass;i.Contrast=n(i.BaseFilter,{type:"Contrast",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uContrast;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nfloat contrastF = 1.015 * (uContrast + 1.0) / (1.0 * (1.015 - uContrast));\ncolor.rgb = contrastF * (color.rgb - 0.5) + 0.5;\ngl_FragColor = color;\n}",contrast:0,mainParameter:"contrast",applyTo2d:function(t){if(0!==this.contrast){var e,i=t.imageData.data,n=i.length,r=Math.floor(255*this.contrast),s=259*(r+255)/(255*(259-r));for(e=0;e<n;e+=4)i[e]=s*(i[e]-128)+128,i[e+1]=s*(i[e+1]-128)+128,i[e+2]=s*(i[e+2]-128)+128}},getUniformLocations:function(t,e){return{uContrast:t.getUniformLocation(e,"uContrast")}},sendUniformData:function(t,e){t.uniform1f(e.uContrast,this.contrast)}}),e.Image.filters.Contrast.fromObject=e.Image.filters.BaseFilter.fromObject}(e),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.Image.filters,n=e.util.createClass;i.Saturation=n(i.BaseFilter,{type:"Saturation",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uSaturation;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nfloat rgMax = max(color.r, color.g);\nfloat rgbMax = max(rgMax, color.b);\ncolor.r += rgbMax != color.r ? (rgbMax - color.r) * uSaturation : 0.00;\ncolor.g += rgbMax != color.g ? (rgbMax - color.g) * uSaturation : 0.00;\ncolor.b += rgbMax != color.b ? (rgbMax - color.b) * uSaturation : 0.00;\ngl_FragColor = color;\n}",saturation:0,mainParameter:"saturation",applyTo2d:function(t){if(0!==this.saturation){var e,i,n=t.imageData.data,r=n.length,s=-this.saturation;for(e=0;e<r;e+=4)i=Math.max(n[e],n[e+1],n[e+2]),n[e]+=i!==n[e]?(i-n[e])*s:0,n[e+1]+=i!==n[e+1]?(i-n[e+1])*s:0,n[e+2]+=i!==n[e+2]?(i-n[e+2])*s:0}},getUniformLocations:function(t,e){return{uSaturation:t.getUniformLocation(e,"uSaturation")}},sendUniformData:function(t,e){t.uniform1f(e.uSaturation,-this.saturation)}}),e.Image.filters.Saturation.fromObject=e.Image.filters.BaseFilter.fromObject}(e),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.Image.filters,n=e.util.createClass;i.Blur=n(i.BaseFilter,{type:"Blur",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform vec2 uDelta;\nvarying vec2 vTexCoord;\nconst float nSamples = 15.0;\nvec3 v3offset = vec3(12.9898, 78.233, 151.7182);\nfloat random(vec3 scale) {\nreturn fract(sin(dot(gl_FragCoord.xyz, scale)) * 43758.5453);\n}\nvoid main() {\nvec4 color = vec4(0.0);\nfloat total = 0.0;\nfloat offset = random(v3offset);\nfor (float t = -nSamples; t <= nSamples; t++) {\nfloat percent = (t + offset - 0.5) / nSamples;\nfloat weight = 1.0 - abs(percent);\ncolor += texture2D(uTexture, vTexCoord + uDelta * percent) * weight;\ntotal += weight;\n}\ngl_FragColor = color / total;\n}",blur:0,mainParameter:"blur",applyTo:function(t){t.webgl?(this.aspectRatio=t.sourceWidth/t.sourceHeight,t.passes++,this._setupFrameBuffer(t),this.horizontal=!0,this.applyToWebGL(t),this._swapTextures(t),this._setupFrameBuffer(t),this.horizontal=!1,this.applyToWebGL(t),this._swapTextures(t)):this.applyTo2d(t)},applyTo2d:function(t){t.imageData=this.simpleBlur(t)},simpleBlur:function(t){var i,n,r=t.filterBackend.resources,s=t.imageData.width,a=t.imageData.height;r.blurLayer1||(r.blurLayer1=e.util.createCanvasElement(),r.blurLayer2=e.util.createCanvasElement()),i=r.blurLayer1,n=r.blurLayer2,i.width===s&&i.height===a||(n.width=i.width=s,n.height=i.height=a);var o,h,c,l,u=i.getContext("2d"),f=n.getContext("2d"),d=.06*this.blur*.5;for(u.putImageData(t.imageData,0,0),f.clearRect(0,0,s,a),l=-15;l<=15;l++)c=d*(h=l/15)*s+(o=(Math.random()-.5)/4),f.globalAlpha=1-Math.abs(h),f.drawImage(i,c,o),u.drawImage(n,0,0),f.globalAlpha=1,f.clearRect(0,0,n.width,n.height);for(l=-15;l<=15;l++)c=d*(h=l/15)*a+(o=(Math.random()-.5)/4),f.globalAlpha=1-Math.abs(h),f.drawImage(i,o,c),u.drawImage(n,0,0),f.globalAlpha=1,f.clearRect(0,0,n.width,n.height);t.ctx.drawImage(i,0,0);var p=t.ctx.getImageData(0,0,i.width,i.height);return u.globalAlpha=1,u.clearRect(0,0,i.width,i.height),p},getUniformLocations:function(t,e){return{delta:t.getUniformLocation(e,"uDelta")}},sendUniformData:function(t,e){var i=this.chooseRightDelta();t.uniform2fv(e.delta,i)},chooseRightDelta:function(){var t,e=1,i=[0,0];return this.horizontal?this.aspectRatio>1&&(e=1/this.aspectRatio):this.aspectRatio<1&&(e=this.aspectRatio),t=e*this.blur*.12,this.horizontal?i[0]=t:i[1]=t,i}}),i.Blur.fromObject=e.Image.filters.BaseFilter.fromObject}(e),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.Image.filters,n=e.util.createClass;i.Gamma=n(i.BaseFilter,{type:"Gamma",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform vec3 uGamma;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nvec3 correction = (1.0 / uGamma);\ncolor.r = pow(color.r, correction.r);\ncolor.g = pow(color.g, correction.g);\ncolor.b = pow(color.b, correction.b);\ngl_FragColor = color;\ngl_FragColor.rgb *= color.a;\n}",gamma:[1,1,1],mainParameter:"gamma",initialize:function(t){this.gamma=[1,1,1],i.BaseFilter.prototype.initialize.call(this,t)},applyTo2d:function(t){var e,i=t.imageData.data,n=this.gamma,r=i.length,s=1/n[0],a=1/n[1],o=1/n[2];for(this.rVals||(this.rVals=new Uint8Array(256),this.gVals=new Uint8Array(256),this.bVals=new Uint8Array(256)),e=0,r=256;e<r;e++)this.rVals[e]=255*Math.pow(e/255,s),this.gVals[e]=255*Math.pow(e/255,a),this.bVals[e]=255*Math.pow(e/255,o);for(e=0,r=i.length;e<r;e+=4)i[e]=this.rVals[i[e]],i[e+1]=this.gVals[i[e+1]],i[e+2]=this.bVals[i[e+2]]},getUniformLocations:function(t,e){return{uGamma:t.getUniformLocation(e,"uGamma")}},sendUniformData:function(t,e){t.uniform3fv(e.uGamma,this.gamma)}}),e.Image.filters.Gamma.fromObject=e.Image.filters.BaseFilter.fromObject}(e),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.Image.filters,n=e.util.createClass;i.Composed=n(i.BaseFilter,{type:"Composed",subFilters:[],initialize:function(t){this.callSuper("initialize",t),this.subFilters=this.subFilters.slice(0)},applyTo:function(t){t.passes+=this.subFilters.length-1,this.subFilters.forEach(function(e){e.applyTo(t)})},toObject:function(){return e.util.object.extend(this.callSuper("toObject"),{subFilters:this.subFilters.map(function(t){return t.toObject()})})},isNeutralState:function(){return!this.subFilters.some(function(t){return!t.isNeutralState()})}}),e.Image.filters.Composed.fromObject=function(t,i){var n=(t.subFilters||[]).map(function(t){return new e.Image.filters[t.type](t)}),r=new e.Image.filters.Composed({subFilters:n});return i&&i(r),r}}(e),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.Image.filters,n=e.util.createClass;i.HueRotation=n(i.ColorMatrix,{type:"HueRotation",rotation:0,mainParameter:"rotation",calculateMatrix:function(){var t=this.rotation*Math.PI,i=e.util.cos(t),n=e.util.sin(t),r=Math.sqrt(1/3)*n,s=1-i;this.matrix=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],this.matrix[0]=i+s/3,this.matrix[1]=1/3*s-r,this.matrix[2]=1/3*s+r,this.matrix[5]=1/3*s+r,this.matrix[6]=i+1/3*s,this.matrix[7]=1/3*s-r,this.matrix[10]=1/3*s-r,this.matrix[11]=1/3*s+r,this.matrix[12]=i+1/3*s},isNeutralState:function(t){return this.calculateMatrix(),i.BaseFilter.prototype.isNeutralState.call(this,t)},applyTo:function(t){this.calculateMatrix(),i.BaseFilter.prototype.applyTo.call(this,t)}}),e.Image.filters.HueRotation.fromObject=e.Image.filters.BaseFilter.fromObject}(e),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.clone;e.Text?e.warn("fabric.Text is already defined"):(e.Text=e.util.createClass(e.Object,{_dimensionAffectingProps:["fontSize","fontWeight","fontFamily","fontStyle","lineHeight","text","charSpacing","textAlign","styles"],_reNewline:/\r?\n/,_reSpacesAndTabs:/[ \t\r]/g,_reSpaceAndTab:/[ \t\r]/,_reWords:/\S+/g,type:"text",fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",underline:!1,overline:!1,linethrough:!1,textAlign:"left",fontStyle:"normal",lineHeight:1.16,superscript:{size:.6,baseline:-.35},subscript:{size:.6,baseline:.11},textBackgroundColor:"",stateProperties:e.Object.prototype.stateProperties.concat("fontFamily","fontWeight","fontSize","text","underline","overline","linethrough","textAlign","fontStyle","lineHeight","textBackgroundColor","charSpacing","styles"),cacheProperties:e.Object.prototype.cacheProperties.concat("fontFamily","fontWeight","fontSize","text","underline","overline","linethrough","textAlign","fontStyle","lineHeight","textBackgroundColor","charSpacing","styles"),stroke:null,shadow:null,_fontSizeFraction:.222,offsets:{underline:.1,linethrough:-.315,overline:-.88},_fontSizeMult:1.13,charSpacing:0,styles:null,_measuringContext:null,deltaY:0,_styleProperties:["stroke","strokeWidth","fill","fontFamily","fontSize","fontWeight","fontStyle","underline","overline","linethrough","deltaY","textBackgroundColor"],__charBounds:[],CACHE_FONT_SIZE:400,MIN_TEXT_WIDTH:2,initialize:function(t,e){this.styles=e&&e.styles||{},this.text=t,this.__skipDimension=!0,this.callSuper("initialize",e),this.__skipDimension=!1,this.initDimensions(),this.setCoords(),this.setupState({propertySet:"_dimensionAffectingProps"})},getMeasuringContext:function(){return e._measuringContext||(e._measuringContext=this.canvas&&this.canvas.contextCache||e.util.createCanvasElement().getContext("2d")),e._measuringContext},_splitText:function(){var t=this._splitTextIntoLines(this.text);return this.textLines=t.lines,this._textLines=t.graphemeLines,this._unwrappedTextLines=t._unwrappedLines,this._text=t.graphemeText,t},initDimensions:function(){this.__skipDimension||(this._splitText(),this._clearCache(),this.width=this.calcTextWidth()||this.cursorWidth||this.MIN_TEXT_WIDTH,-1!==this.textAlign.indexOf("justify")&&this.enlargeSpaces(),this.height=this.calcTextHeight(),this.saveState({propertySet:"_dimensionAffectingProps"}))},enlargeSpaces:function(){for(var t,e,i,n,r,s,a,o=0,h=this._textLines.length;o<h;o++)if(("justify"===this.textAlign||o!==h-1&&!this.isEndOfWrapping(o))&&(n=0,r=this._textLines[o],(e=this.getLineWidth(o))<this.width&&(a=this.textLines[o].match(this._reSpacesAndTabs)))){i=a.length,t=(this.width-e)/i;for(var c=0,l=r.length;c<=l;c++)s=this.__charBounds[o][c],this._reSpaceAndTab.test(r[c])?(s.width+=t,s.kernedWidth+=t,s.left+=n,n+=t):s.left+=n}},isEndOfWrapping:function(t){return t===this._textLines.length-1},toString:function(){return"#<fabric.Text ("+this.complexity()+'): { "text": "'+this.text+'", "fontFamily": "'+this.fontFamily+'" }>'},_getCacheCanvasDimensions:function(){var t=this.callSuper("_getCacheCanvasDimensions"),e=this.fontSize;return t.width+=e*t.zoomX,t.height+=e*t.zoomY,t},_render:function(t){this._setTextStyles(t),this._renderTextLinesBackground(t),this._renderTextDecoration(t,"underline"),this._renderText(t),this._renderTextDecoration(t,"overline"),this._renderTextDecoration(t,"linethrough")},_renderText:function(t){"stroke"===this.paintFirst?(this._renderTextStroke(t),this._renderTextFill(t)):(this._renderTextFill(t),this._renderTextStroke(t))},_setTextStyles:function(t,e,i){t.textBaseline="alphabetic",t.font=this._getFontDeclaration(e,i)},calcTextWidth:function(){for(var t=this.getLineWidth(0),e=1,i=this._textLines.length;e<i;e++){var n=this.getLineWidth(e);n>t&&(t=n)}return t},_renderTextLine:function(t,e,i,n,r,s){this._renderChars(t,e,i,n,r,s)},_renderTextLinesBackground:function(t){if(this.textBackgroundColor||this.styleHas("textBackgroundColor")){for(var e,i,n,r,s,a,o=0,h=t.fillStyle,c=this._getLeftOffset(),l=this._getTopOffset(),u=0,f=0,d=0,p=this._textLines.length;d<p;d++)if(e=this.getHeightOfLine(d),this.textBackgroundColor||this.styleHas("textBackgroundColor",d)){n=this._textLines[d],i=this._getLineLeftOffset(d),f=0,u=0,r=this.getValueOfPropertyAt(d,0,"textBackgroundColor");for(var g=0,v=n.length;g<v;g++)s=this.__charBounds[d][g],(a=this.getValueOfPropertyAt(d,g,"textBackgroundColor"))!==r?(t.fillStyle=r,r&&t.fillRect(c+i+u,l+o,f,e/this.lineHeight),u=s.left,f=s.width,r=a):f+=s.kernedWidth;a&&(t.fillStyle=a,t.fillRect(c+i+u,l+o,f,e/this.lineHeight)),o+=e}else o+=e;t.fillStyle=h,this._removeShadow(t)}},getFontCache:function(t){var i=t.fontFamily.toLowerCase();e.charWidthsCache[i]||(e.charWidthsCache[i]={});var n=e.charWidthsCache[i],r=t.fontStyle.toLowerCase()+"_"+(t.fontWeight+"").toLowerCase();return n[r]||(n[r]={}),n[r]},_applyCharStyles:function(t,e,i,n,r){this._setFillStyles(e,r),this._setStrokeStyles(e,r),e.font=this._getFontDeclaration(r)},_measureChar:function(t,e,i,n){var r,s,a,o,h=this.getFontCache(e),c=i+t,l=this._getFontDeclaration(e)===this._getFontDeclaration(n),u=e.fontSize/this.CACHE_FONT_SIZE;if(i&&void 0!==h[i]&&(a=h[i]),void 0!==h[t]&&(o=r=h[t]),l&&void 0!==h[c]&&(o=(s=h[c])-a),void 0===r||void 0===a||void 0===s){var f=this.getMeasuringContext();this._setTextStyles(f,e,!0)}return void 0===r&&(o=r=f.measureText(t).width,h[t]=r),void 0===a&&l&&i&&(a=f.measureText(i).width,h[i]=a),l&&void 0===s&&(s=f.measureText(c).width,h[c]=s,o=s-a),{width:r*u,kernedWidth:o*u}},getHeightOfChar:function(t,e){return this.getValueOfPropertyAt(t,e,"fontSize")},measureLine:function(t){var e=this._measureLine(t);return 0!==this.charSpacing&&(e.width-=this._getWidthOfCharSpacing()),e.width<0&&(e.width=0),e},_measureLine:function(t){var e,i,n,r,s=0,a=this._textLines[t],o=new Array(a.length);for(this.__charBounds[t]=o,e=0;e<a.length;e++)i=a[e],r=this._getGraphemeBox(i,t,e,n),o[e]=r,s+=r.kernedWidth,n=i;return o[e]={left:r?r.left+r.width:0,width:0,kernedWidth:0,height:this.fontSize},{width:s,numOfSpaces:0}},_getGraphemeBox:function(t,e,i,n,r){var s,a=this.getCompleteStyleDeclaration(e,i),o=n?this.getCompleteStyleDeclaration(e,i-1):{},h=this._measureChar(t,a,n,o),c=h.kernedWidth,l=h.width;0!==this.charSpacing&&(l+=s=this._getWidthOfCharSpacing(),c+=s);var u={width:l,left:0,height:a.fontSize,kernedWidth:c,deltaY:a.deltaY};if(i>0&&!r){var f=this.__charBounds[e][i-1];u.left=f.left+f.width+h.kernedWidth-h.width}return u},getHeightOfLine:function(t){if(this.__lineHeights[t])return this.__lineHeights[t];for(var e=this._textLines[t],i=this.getHeightOfChar(t,0),n=1,r=e.length;n<r;n++)i=Math.max(this.getHeightOfChar(t,n),i);return this.__lineHeights[t]=i*this.lineHeight*this._fontSizeMult},calcTextHeight:function(){for(var t,e=0,i=0,n=this._textLines.length;i<n;i++)t=this.getHeightOfLine(i),e+=i===n-1?t/this.lineHeight:t;return e},_getLeftOffset:function(){return-this.width/2},_getTopOffset:function(){return-this.height/2},_renderTextCommon:function(t,e){t.save();for(var i=0,n=this._getLeftOffset(),r=this._getTopOffset(),s=this._applyPatternGradientTransform(t,"fillText"===e?this.fill:this.stroke),a=0,o=this._textLines.length;a<o;a++){var h=this.getHeightOfLine(a),c=h/this.lineHeight,l=this._getLineLeftOffset(a);this._renderTextLine(e,t,this._textLines[a],n+l-s.offsetX,r+i+c-s.offsetY,a),i+=h}t.restore()},_renderTextFill:function(t){(this.fill||this.styleHas("fill"))&&this._renderTextCommon(t,"fillText")},_renderTextStroke:function(t){(this.stroke&&0!==this.strokeWidth||!this.isEmptyStyles())&&(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(t),t.save(),this._setLineDash(t,this.strokeDashArray),t.beginPath(),this._renderTextCommon(t,"strokeText"),t.closePath(),t.restore())},_renderChars:function(t,e,i,n,r,s){var a,o,h,c,l=this.getHeightOfLine(s),u=-1!==this.textAlign.indexOf("justify"),f="",d=0,p=!u&&0===this.charSpacing&&this.isEmptyStyles(s);if(e.save(),r-=l*this._fontSizeFraction/this.lineHeight,p)return this._renderChar(t,e,s,0,this.textLines[s],n,r,l),void e.restore();for(var g=0,v=i.length-1;g<=v;g++)c=g===v||this.charSpacing,f+=i[g],h=this.__charBounds[s][g],0===d?(n+=h.kernedWidth-h.width,d+=h.width):d+=h.kernedWidth,u&&!c&&this._reSpaceAndTab.test(i[g])&&(c=!0),c||(a=a||this.getCompleteStyleDeclaration(s,g),o=this.getCompleteStyleDeclaration(s,g+1),c=this._hasStyleChanged(a,o)),c&&(this._renderChar(t,e,s,g,f,n,r,l),f="",a=o,n+=d,d=0);e.restore()},_renderChar:function(t,e,i,n,r,s,a){var o=this._getStyleDeclaration(i,n),h=this.getCompleteStyleDeclaration(i,n),c="fillText"===t&&h.fill,l="strokeText"===t&&h.stroke&&h.strokeWidth;(l||c)&&(o&&e.save(),this._applyCharStyles(t,e,i,n,h),o&&o.textBackgroundColor&&this._removeShadow(e),o&&o.deltaY&&(a+=o.deltaY),c&&e.fillText(r,s,a),l&&e.strokeText(r,s,a),o&&e.restore())},setSuperscript:function(t,e){return this._setScript(t,e,this.superscript)},setSubscript:function(t,e){return this._setScript(t,e,this.subscript)},_setScript:function(t,e,i){var n=this.get2DCursorLocation(t,!0),r=this.getValueOfPropertyAt(n.lineIndex,n.charIndex,"fontSize"),s=this.getValueOfPropertyAt(n.lineIndex,n.charIndex,"deltaY"),a={fontSize:r*i.size,deltaY:s+r*i.baseline};return this.setSelectionStyles(a,t,e),this},_hasStyleChanged:function(t,e){return t.fill!==e.fill||t.stroke!==e.stroke||t.strokeWidth!==e.strokeWidth||t.fontSize!==e.fontSize||t.fontFamily!==e.fontFamily||t.fontWeight!==e.fontWeight||t.fontStyle!==e.fontStyle||t.deltaY!==e.deltaY},_hasStyleChangedForSvg:function(t,e){return this._hasStyleChanged(t,e)||t.overline!==e.overline||t.underline!==e.underline||t.linethrough!==e.linethrough},_getLineLeftOffset:function(t){var e=this.getLineWidth(t);return"center"===this.textAlign?(this.width-e)/2:"right"===this.textAlign?this.width-e:"justify-center"===this.textAlign&&this.isEndOfWrapping(t)?(this.width-e)/2:"justify-right"===this.textAlign&&this.isEndOfWrapping(t)?this.width-e:0},_clearCache:function(){this.__lineWidths=[],this.__lineHeights=[],this.__charBounds=[]},_shouldClearDimensionCache:function(){var t=this._forceClearCache;return t||(t=this.hasStateChanged("_dimensionAffectingProps")),t&&(this.dirty=!0,this._forceClearCache=!1),t},getLineWidth:function(t){return this.__lineWidths[t]?this.__lineWidths[t]:(e=""===this._textLines[t]?0:this.measureLine(t).width,this.__lineWidths[t]=e,e);var e},_getWidthOfCharSpacing:function(){return 0!==this.charSpacing?this.fontSize*this.charSpacing/1e3:0},getValueOfPropertyAt:function(t,e,i){var n=this._getStyleDeclaration(t,e);return n&&void 0!==n[i]?n[i]:this[i]},_renderTextDecoration:function(t,e){if(this[e]||this.styleHas(e)){for(var i,n,r,s,a,o,h,c,l,u,f,d,p,g,v,_,m=this._getLeftOffset(),y=this._getTopOffset(),x=this._getWidthOfCharSpacing(),b=0,w=this._textLines.length;b<w;b++)if(i=this.getHeightOfLine(b),this[e]||this.styleHas(e,b)){h=this._textLines[b],g=i/this.lineHeight,s=this._getLineLeftOffset(b),u=0,f=0,c=this.getValueOfPropertyAt(b,0,e),_=this.getValueOfPropertyAt(b,0,"fill"),l=y+g*(1-this._fontSizeFraction),n=this.getHeightOfChar(b,0),a=this.getValueOfPropertyAt(b,0,"deltaY");for(var C=0,S=h.length;C<S;C++)d=this.__charBounds[b][C],p=this.getValueOfPropertyAt(b,C,e),v=this.getValueOfPropertyAt(b,C,"fill"),r=this.getHeightOfChar(b,C),o=this.getValueOfPropertyAt(b,C,"deltaY"),(p!==c||v!==_||r!==n||o!==a)&&f>0?(t.fillStyle=_,c&&_&&t.fillRect(m+s+u,l+this.offsets[e]*n+a,f,this.fontSize/15),u=d.left,f=d.width,c=p,_=v,n=r,a=o):f+=d.kernedWidth;t.fillStyle=v,p&&v&&t.fillRect(m+s+u,l+this.offsets[e]*n+a,f-x,this.fontSize/15),y+=i}else y+=i;this._removeShadow(t)}},_getFontDeclaration:function(t,i){var n=t||this,r=this.fontFamily,s=e.Text.genericFonts.indexOf(r.toLowerCase())>-1,a=void 0===r||r.indexOf("'")>-1||r.indexOf('"')>-1||s?n.fontFamily:'"'+n.fontFamily+'"';return[e.isLikelyNode?n.fontWeight:n.fontStyle,e.isLikelyNode?n.fontStyle:n.fontWeight,i?this.CACHE_FONT_SIZE+"px":n.fontSize+"px",a].join(" ")},render:function(t){this.visible&&(this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(this._shouldClearDimensionCache()&&this.initDimensions(),this.callSuper("render",t)))},_splitTextIntoLines:function(t){for(var i=t.split(this._reNewline),n=new Array(i.length),r=["\n"],s=[],a=0;a<i.length;a++)n[a]=e.util.string.graphemeSplit(i[a]),s=s.concat(n[a],r);return s.pop(),{_unwrappedLines:n,lines:i,graphemeText:s,graphemeLines:n}},toObject:function(t){var e=["text","fontSize","fontWeight","fontFamily","fontStyle","lineHeight","underline","overline","linethrough","textAlign","textBackgroundColor","charSpacing"].concat(t),n=this.callSuper("toObject",e);return n.styles=i(this.styles,!0),n},set:function(t,e){this.callSuper("set",t,e);var i=!1;if("object"==typeof t)for(var n in t)i=i||-1!==this._dimensionAffectingProps.indexOf(n);else i=-1!==this._dimensionAffectingProps.indexOf(t);return i&&(this.initDimensions(),this.setCoords()),this},complexity:function(){return 1}}),e.Text.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat("x y dx dy font-family font-style font-weight font-size letter-spacing text-decoration text-anchor".split(" ")),e.Text.DEFAULT_SVG_FONT_SIZE=16,e.Text.fromElement=function(t,n,r){if(!t)return n(null);var s=e.parseAttributes(t,e.Text.ATTRIBUTE_NAMES),a=s.textAnchor||"left";if((r=e.util.object.extend(r?i(r):{},s)).top=r.top||0,r.left=r.left||0,s.textDecoration){var o=s.textDecoration;-1!==o.indexOf("underline")&&(r.underline=!0),-1!==o.indexOf("overline")&&(r.overline=!0),-1!==o.indexOf("line-through")&&(r.linethrough=!0),delete r.textDecoration}"dx"in s&&(r.left+=s.dx),"dy"in s&&(r.top+=s.dy),"fontSize"in r||(r.fontSize=e.Text.DEFAULT_SVG_FONT_SIZE);var h="";"textContent"in t?h=t.textContent:"firstChild"in t&&null!==t.firstChild&&"data"in t.firstChild&&null!==t.firstChild.data&&(h=t.firstChild.data),h=h.replace(/^\s+|\s+$|\n+/g,"").replace(/\s+/g," ");var c=r.strokeWidth;r.strokeWidth=0;var l=new e.Text(h,r),u=l.getScaledHeight()/l.height,f=((l.height+l.strokeWidth)*l.lineHeight-l.height)*u,d=l.getScaledHeight()+f,p=0;"center"===a&&(p=l.getScaledWidth()/2),"right"===a&&(p=l.getScaledWidth()),l.set({left:l.left-p,top:l.top-(d-l.fontSize*(.07+l._fontSizeFraction))/l.lineHeight,strokeWidth:void 0!==c?c:1}),n(l)},e.Text.fromObject=function(t,i){return e.Object._fromObject("Text",t,i,"text")},e.Text.genericFonts=["sans-serif","serif","cursive","fantasy","monospace"],e.util.createAccessors&&e.util.createAccessors(e.Text))}(e),b.util.object.extend(b.Text.prototype,{isEmptyStyles:function(t){if(!this.styles)return!0;if(void 0!==t&&!this.styles[t])return!0;var e=void 0===t?this.styles:{line:this.styles[t]};for(var i in e)for(var n in e[i])for(var r in e[i][n])return!1;return!0},styleHas:function(t,e){if(!this.styles||!t||""===t)return!1;if(void 0!==e&&!this.styles[e])return!1;var i=void 0===e?this.styles:{line:this.styles[e]};for(var n in i)for(var r in i[n])if(void 0!==i[n][r][t])return!0;return!1},cleanStyle:function(t){if(!this.styles||!t||""===t)return!1;var e,i,n=this.styles,r=0,s=!0,a=0;for(var o in n){for(var h in e=0,n[o]){var c;r++,(c=n[o][h]).hasOwnProperty(t)?(i?c[t]!==i&&(s=!1):i=c[t],c[t]===this[t]&&delete c[t]):s=!1,0!==Object.keys(c).length?e++:delete n[o][h]}0===e&&delete n[o]}for(var l=0;l<this._textLines.length;l++)a+=this._textLines[l].length;s&&r===a&&(this[t]=i,this.removeStyle(t))},removeStyle:function(t){if(this.styles&&t&&""!==t){var e,i,n,r=this.styles;for(i in r){for(n in e=r[i])delete e[n][t],0===Object.keys(e[n]).length&&delete e[n];0===Object.keys(e).length&&delete r[i]}}},_extendStyles:function(t,e){var i=this.get2DCursorLocation(t);this._getLineStyle(i.lineIndex)||this._setLineStyle(i.lineIndex,{}),this._getStyleDeclaration(i.lineIndex,i.charIndex)||this._setStyleDeclaration(i.lineIndex,i.charIndex,{}),b.util.object.extend(this._getStyleDeclaration(i.lineIndex,i.charIndex),e)},get2DCursorLocation:function(t,e){void 0===t&&(t=this.selectionStart);for(var i=e?this._unwrappedTextLines:this._textLines,n=i.length,r=0;r<n;r++){if(t<=i[r].length)return{lineIndex:r,charIndex:t};t-=i[r].length+1}return{lineIndex:r-1,charIndex:i[r-1].length<t?i[r-1].length:t}},getSelectionStyles:function(t,e,i){void 0===t&&(t=this.selectionStart||0),void 0===e&&(e=this.selectionEnd||t);for(var n=[],r=t;r<e;r++)n.push(this.getStyleAtPosition(r,i));return n},getStyleAtPosition:function(t,e){var i=this.get2DCursorLocation(t);return(e?this.getCompleteStyleDeclaration(i.lineIndex,i.charIndex):this._getStyleDeclaration(i.lineIndex,i.charIndex))||{}},setSelectionStyles:function(t,e,i){void 0===e&&(e=this.selectionStart||0),void 0===i&&(i=this.selectionEnd||e);for(var n=e;n<i;n++)this._extendStyles(n,t);return this._forceClearCache=!0,this},_getStyleDeclaration:function(t,e){var i=this.styles&&this.styles[t];return i?i[e]:null},getCompleteStyleDeclaration:function(t,e){for(var i,n=this._getStyleDeclaration(t,e)||{},r={},s=0;s<this._styleProperties.length;s++)r[i=this._styleProperties[s]]=void 0===n[i]?this[i]:n[i];return r},_setStyleDeclaration:function(t,e,i){this.styles[t][e]=i},_deleteStyleDeclaration:function(t,e){delete this.styles[t][e]},_getLineStyle:function(t){return this.styles[t]},_setLineStyle:function(t,e){this.styles[t]=e},_deleteLineStyle:function(t){delete this.styles[t]}}),function(){function t(t){t.textDecoration&&(t.textDecoration.indexOf("underline")>-1&&(t.underline=!0),t.textDecoration.indexOf("line-through")>-1&&(t.linethrough=!0),t.textDecoration.indexOf("overline")>-1&&(t.overline=!0),delete t.textDecoration)}b.IText=b.util.createClass(b.Text,b.Observable,{type:"i-text",selectionStart:0,selectionEnd:0,selectionColor:"rgba(17,119,255,0.3)",isEditing:!1,editable:!0,editingBorderColor:"rgba(102,153,255,0.25)",cursorWidth:2,cursorColor:"#333",cursorDelay:1e3,cursorDuration:600,caching:!0,_reSpace:/\s|\n/,_currentCursorOpacity:0,_selectionDirection:null,_abortCursorAnimation:!1,__widthOfSpace:[],inCompositionMode:!1,initialize:function(t,e){this.callSuper("initialize",t,e),this.initBehavior()},setSelectionStart:function(t){t=Math.max(t,0),this._updateAndFire("selectionStart",t)},setSelectionEnd:function(t){t=Math.min(t,this.text.length),this._updateAndFire("selectionEnd",t)},_updateAndFire:function(t,e){this[t]!==e&&(this._fireSelectionChanged(),this[t]=e),this._updateTextarea()},_fireSelectionChanged:function(){this.fire("selection:changed"),this.canvas&&this.canvas.fire("text:selection:changed",{target:this})},initDimensions:function(){this.isEditing&&this.initDelayedCursor(),this.clearContextTop(),this.callSuper("initDimensions")},render:function(t){this.clearContextTop(),this.callSuper("render",t),this.cursorOffsetCache={},this.renderCursorOrSelection()},_render:function(t){this.callSuper("_render",t)},clearContextTop:function(t){if(this.isEditing&&this.canvas&&this.canvas.contextTop){var e=this.canvas.contextTop,i=this.canvas.viewportTransform;e.save(),e.transform(i[0],i[1],i[2],i[3],i[4],i[5]),this.transform(e),this.transformMatrix&&e.transform.apply(e,this.transformMatrix),this._clearTextArea(e),t||e.restore()}},renderCursorOrSelection:function(){if(this.isEditing&&this.canvas){var t,e=this._getCursorBoundaries();this.canvas&&this.canvas.contextTop?(t=this.canvas.contextTop,this.clearContextTop(!0)):(t=this.canvas.contextContainer).save(),this.selectionStart===this.selectionEnd?this.renderCursor(e,t):this.renderSelection(e,t),t.restore()}},_clearTextArea:function(t){var e=this.width+4,i=this.height+4;t.clearRect(-e/2,-i/2,e,i)},_getCursorBoundaries:function(t){void 0===t&&(t=this.selectionStart);var e=this._getLeftOffset(),i=this._getTopOffset(),n=this._getCursorBoundariesOffsets(t);return{left:e,top:i,leftOffset:n.left,topOffset:n.top}},_getCursorBoundariesOffsets:function(t){if(this.cursorOffsetCache&&"top"in this.cursorOffsetCache)return this.cursorOffsetCache;var e,i,n,r,s=0,a=0,o=this.get2DCursorLocation(t);n=o.charIndex,i=o.lineIndex;for(var h=0;h<i;h++)s+=this.getHeightOfLine(h);e=this._getLineLeftOffset(i);var c=this.__charBounds[i][n];return c&&(a=c.left),0!==this.charSpacing&&n===this._textLines[i].length&&(a-=this._getWidthOfCharSpacing()),r={top:s,left:e+(a>0?a:0)},this.cursorOffsetCache=r,this.cursorOffsetCache},renderCursor:function(t,e){var i=this.get2DCursorLocation(),n=i.lineIndex,r=i.charIndex>0?i.charIndex-1:0,s=this.getValueOfPropertyAt(n,r,"fontSize"),a=this.scaleX*this.canvas.getZoom(),o=this.cursorWidth/a,h=t.topOffset,c=this.getValueOfPropertyAt(n,r,"deltaY");h+=(1-this._fontSizeFraction)*this.getHeightOfLine(n)/this.lineHeight-s*(1-this._fontSizeFraction),this.inCompositionMode&&this.renderSelection(t,e),e.fillStyle=this.getValueOfPropertyAt(n,r,"fill"),e.globalAlpha=this.__isMousedown?1:this._currentCursorOpacity,e.fillRect(t.left+t.leftOffset-o/2,h+t.top+c,o,s)},renderSelection:function(t,e){for(var i=this.inCompositionMode?this.hiddenTextarea.selectionStart:this.selectionStart,n=this.inCompositionMode?this.hiddenTextarea.selectionEnd:this.selectionEnd,r=-1!==this.textAlign.indexOf("justify"),s=this.get2DCursorLocation(i),a=this.get2DCursorLocation(n),o=s.lineIndex,h=a.lineIndex,c=s.charIndex<0?0:s.charIndex,l=a.charIndex<0?0:a.charIndex,u=o;u<=h;u++){var f,d=this._getLineLeftOffset(u)||0,p=this.getHeightOfLine(u),g=0,v=0;if(u===o&&(g=this.__charBounds[o][c].left),u>=o&&u<h)v=r&&!this.isEndOfWrapping(u)?this.width:this.getLineWidth(u)||5;else if(u===h)if(0===l)v=this.__charBounds[h][l].left;else{var _=this._getWidthOfCharSpacing();v=this.__charBounds[h][l-1].left+this.__charBounds[h][l-1].width-_}f=p,(this.lineHeight<1||u===h&&this.lineHeight>1)&&(p/=this.lineHeight),this.inCompositionMode?(e.fillStyle=this.compositionColor||"black",e.fillRect(t.left+d+g,t.top+t.topOffset+p,v-g,1)):(e.fillStyle=this.selectionColor,e.fillRect(t.left+d+g,t.top+t.topOffset,v-g,p)),t.topOffset+=f}},getCurrentCharFontSize:function(){var t=this._getCurrentCharIndex();return this.getValueOfPropertyAt(t.l,t.c,"fontSize")},getCurrentCharColor:function(){var t=this._getCurrentCharIndex();return this.getValueOfPropertyAt(t.l,t.c,"fill")},_getCurrentCharIndex:function(){var t=this.get2DCursorLocation(this.selectionStart,!0),e=t.charIndex>0?t.charIndex-1:0;return{l:t.lineIndex,c:e}}}),b.IText.fromObject=function(e,i){if(t(e),e.styles)for(var n in e.styles)for(var r in e.styles[n])t(e.styles[n][r]);b.Object._fromObject("IText",e,i,"text")}}(),_=b.util.object.clone,b.util.object.extend(b.IText.prototype,{initBehavior:function(){this.initAddedHandler(),this.initRemovedHandler(),this.initCursorSelectionHandlers(),this.initDoubleClickSimulation(),this.mouseMoveHandler=this.mouseMoveHandler.bind(this)},onDeselect:function(){this.isEditing&&this.exitEditing(),this.selected=!1},initAddedHandler:function(){var t=this;this.on("added",function(){var e=t.canvas;e&&(e._hasITextHandlers||(e._hasITextHandlers=!0,t._initCanvasHandlers(e)),e._iTextInstances=e._iTextInstances||[],e._iTextInstances.push(t))})},initRemovedHandler:function(){var t=this;this.on("removed",function(){var e=t.canvas;e&&(e._iTextInstances=e._iTextInstances||[],b.util.removeFromArray(e._iTextInstances,t),0===e._iTextInstances.length&&(e._hasITextHandlers=!1,t._removeCanvasHandlers(e)))})},_initCanvasHandlers:function(t){t._mouseUpITextHandler=function(){t._iTextInstances&&t._iTextInstances.forEach(function(t){t.__isMousedown=!1})},t.on("mouse:up",t._mouseUpITextHandler)},_removeCanvasHandlers:function(t){t.off("mouse:up",t._mouseUpITextHandler)},_tick:function(){this._currentTickState=this._animateCursor(this,1,this.cursorDuration,"_onTickComplete")},_animateCursor:function(t,e,i,n){var r;return r={isAborted:!1,abort:function(){this.isAborted=!0}},t.animate("_currentCursorOpacity",e,{duration:i,onComplete:function(){r.isAborted||t[n]()},onChange:function(){t.canvas&&t.selectionStart===t.selectionEnd&&t.renderCursorOrSelection()},abort:function(){return r.isAborted}}),r},_onTickComplete:function(){var t=this;this._cursorTimeout1&&clearTimeout(this._cursorTimeout1),this._cursorTimeout1=setTimeout(function(){t._currentTickCompleteState=t._animateCursor(t,0,this.cursorDuration/2,"_tick")},100)},initDelayedCursor:function(t){var e=this,i=t?0:this.cursorDelay;this.abortCursorAnimation(),this._currentCursorOpacity=1,this._cursorTimeout2=setTimeout(function(){e._tick()},i)},abortCursorAnimation:function(){var t=this._currentTickState||this._currentTickCompleteState,e=this.canvas;this._currentTickState&&this._currentTickState.abort(),this._currentTickCompleteState&&this._currentTickCompleteState.abort(),clearTimeout(this._cursorTimeout1),clearTimeout(this._cursorTimeout2),this._currentCursorOpacity=0,t&&e&&e.clearContext(e.contextTop||e.contextContainer)},selectAll:function(){return this.selectionStart=0,this.selectionEnd=this._text.length,this._fireSelectionChanged(),this._updateTextarea(),this},getSelectedText:function(){return this._text.slice(this.selectionStart,this.selectionEnd).join("")},findWordBoundaryLeft:function(t){var e=0,i=t-1;if(this._reSpace.test(this._text[i]))for(;this._reSpace.test(this._text[i]);)e++,i--;for(;/\S/.test(this._text[i])&&i>-1;)e++,i--;return t-e},findWordBoundaryRight:function(t){var e=0,i=t;if(this._reSpace.test(this._text[i]))for(;this._reSpace.test(this._text[i]);)e++,i++;for(;/\S/.test(this._text[i])&&i<this.text.length;)e++,i++;return t+e},findLineBoundaryLeft:function(t){for(var e=0,i=t-1;!/\n/.test(this._text[i])&&i>-1;)e++,i--;return t-e},findLineBoundaryRight:function(t){for(var e=0,i=t;!/\n/.test(this._text[i])&&i<this.text.length;)e++,i++;return t+e},searchWordBoundary:function(t,e){for(var i=this._reSpace.test(this.text.charAt(t))?t-1:t,n=this.text.charAt(i),r=/[ \n\.,;!\?\-]/;!r.test(n)&&i>0&&i<this.text.length;)i+=e,n=this.text.charAt(i);return r.test(n)&&"\n"!==n&&(i+=1===e?0:1),i},selectWord:function(t){t=t||this.selectionStart;var e=this.searchWordBoundary(t,-1),i=this.searchWordBoundary(t,1);this.selectionStart=e,this.selectionEnd=i,this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()},selectLine:function(t){t=t||this.selectionStart;var e=this.findLineBoundaryLeft(t),i=this.findLineBoundaryRight(t);return this.selectionStart=e,this.selectionEnd=i,this._fireSelectionChanged(),this._updateTextarea(),this},enterEditing:function(t){if(!this.isEditing&&this.editable)return this.canvas&&(this.canvas.calcOffset(),this.exitEditingOnOthers(this.canvas)),this.isEditing=!0,this.initHiddenTextarea(t),this.hiddenTextarea.focus(),this.hiddenTextarea.value=this.text,this._updateTextarea(),this._saveEditingProps(),this._setEditingProps(),this._textBeforeEdit=this.text,this._tick(),this.fire("editing:entered"),this._fireSelectionChanged(),this.canvas?(this.canvas.fire("text:editing:entered",{target:this}),this.initMouseMoveHandler(),this.canvas.requestRenderAll(),this):this},exitEditingOnOthers:function(t){t._iTextInstances&&t._iTextInstances.forEach(function(t){t.selected=!1,t.isEditing&&t.exitEditing()})},initMouseMoveHandler:function(){this.canvas.on("mouse:move",this.mouseMoveHandler)},mouseMoveHandler:function(t){if(this.__isMousedown&&this.isEditing){var e=this.getSelectionStartFromPointer(t.e),i=this.selectionStart,n=this.selectionEnd;(e===this.__selectionStartOnMouseDown&&i!==n||i!==e&&n!==e)&&(e>this.__selectionStartOnMouseDown?(this.selectionStart=this.__selectionStartOnMouseDown,this.selectionEnd=e):(this.selectionStart=e,this.selectionEnd=this.__selectionStartOnMouseDown),this.selectionStart===i&&this.selectionEnd===n||(this.restartCursorIfNeeded(),this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()))}},_setEditingProps:function(){this.hoverCursor="text",this.canvas&&(this.canvas.defaultCursor=this.canvas.moveCursor="text"),this.borderColor=this.editingBorderColor,this.hasControls=this.selectable=!1,this.lockMovementX=this.lockMovementY=!0},fromStringToGraphemeSelection:function(t,e,i){var n=i.slice(0,t),r=b.util.string.graphemeSplit(n).length;if(t===e)return{selectionStart:r,selectionEnd:r};var s=i.slice(t,e);return{selectionStart:r,selectionEnd:r+b.util.string.graphemeSplit(s).length}},fromGraphemeToStringSelection:function(t,e,i){var n=i.slice(0,t).join("").length;return t===e?{selectionStart:n,selectionEnd:n}:{selectionStart:n,selectionEnd:n+i.slice(t,e).join("").length}},_updateTextarea:function(){if(this.cursorOffsetCache={},this.hiddenTextarea){if(!this.inCompositionMode){var t=this.fromGraphemeToStringSelection(this.selectionStart,this.selectionEnd,this._text);this.hiddenTextarea.selectionStart=t.selectionStart,this.hiddenTextarea.selectionEnd=t.selectionEnd}this.updateTextareaPosition()}},updateFromTextArea:function(){if(this.hiddenTextarea){this.cursorOffsetCache={},this.text=this.hiddenTextarea.value,this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords());var t=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value);this.selectionEnd=this.selectionStart=t.selectionEnd,this.inCompositionMode||(this.selectionStart=t.selectionStart),this.updateTextareaPosition()}},updateTextareaPosition:function(){if(this.selectionStart===this.selectionEnd){var t=this._calcTextareaPosition();this.hiddenTextarea.style.left=t.left,this.hiddenTextarea.style.top=t.top}},_calcTextareaPosition:function(){if(!this.canvas)return{x:1,y:1};var t=this.inCompositionMode?this.compositionStart:this.selectionStart,e=this._getCursorBoundaries(t),i=this.get2DCursorLocation(t),n=i.lineIndex,r=i.charIndex,s=this.getValueOfPropertyAt(n,r,"fontSize")*this.lineHeight,a=e.leftOffset,o=this.calcTransformMatrix(),h={x:e.left+a,y:e.top+e.topOffset+s},c=this.canvas.upperCanvasEl,l=c.width,u=c.height,f=l-s,d=u-s,p=c.clientWidth/l,g=c.clientHeight/u;return h=b.util.transformPoint(h,o),(h=b.util.transformPoint(h,this.canvas.viewportTransform)).x*=p,h.y*=g,h.x<0&&(h.x=0),h.x>f&&(h.x=f),h.y<0&&(h.y=0),h.y>d&&(h.y=d),h.x+=this.canvas._offset.left,h.y+=this.canvas._offset.top,{left:h.x+"px",top:h.y+"px",fontSize:s+"px",charHeight:s}},_saveEditingProps:function(){this._savedProps={hasControls:this.hasControls,borderColor:this.borderColor,lockMovementX:this.lockMovementX,lockMovementY:this.lockMovementY,hoverCursor:this.hoverCursor,defaultCursor:this.canvas&&this.canvas.defaultCursor,moveCursor:this.canvas&&this.canvas.moveCursor}},_restoreEditingProps:function(){this._savedProps&&(this.hoverCursor=this._savedProps.hoverCursor,this.hasControls=this._savedProps.hasControls,this.borderColor=this._savedProps.borderColor,this.lockMovementX=this._savedProps.lockMovementX,this.lockMovementY=this._savedProps.lockMovementY,this.canvas&&(this.canvas.defaultCursor=this._savedProps.defaultCursor,this.canvas.moveCursor=this._savedProps.moveCursor))},exitEditing:function(){var t=this._textBeforeEdit!==this.text;return this.selected=!1,this.isEditing=!1,this.selectable=!0,this.selectionEnd=this.selectionStart,this.hiddenTextarea&&(this.hiddenTextarea.blur&&this.hiddenTextarea.blur(),this.canvas&&this.hiddenTextarea.parentNode.removeChild(this.hiddenTextarea),this.hiddenTextarea=null),this.abortCursorAnimation(),this._restoreEditingProps(),this._currentCursorOpacity=0,this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this.fire("editing:exited"),t&&this.fire("modified"),this.canvas&&(this.canvas.off("mouse:move",this.mouseMoveHandler),this.canvas.fire("text:editing:exited",{target:this}),t&&this.canvas.fire("object:modified",{target:this})),this},_removeExtraneousStyles:function(){for(var t in this.styles)this._textLines[t]||delete this.styles[t]},removeStyleFromTo:function(t,e){var i,n,r=this.get2DCursorLocation(t,!0),s=this.get2DCursorLocation(e,!0),a=r.lineIndex,o=r.charIndex,h=s.lineIndex,c=s.charIndex;if(a!==h){if(this.styles[a])for(i=o;i<this._unwrappedTextLines[a].length;i++)delete this.styles[a][i];if(this.styles[h])for(i=c;i<this._unwrappedTextLines[h].length;i++)(n=this.styles[h][i])&&(this.styles[a]||(this.styles[a]={}),this.styles[a][o+i-c]=n);for(i=a+1;i<=h;i++)delete this.styles[i];this.shiftLineStyles(h,a-h)}else if(this.styles[a]){n=this.styles[a];var l,u,f=c-o;for(i=o;i<c;i++)delete n[i];for(u in this.styles[a])(l=parseInt(u,10))>=c&&(n[l-f]=n[u],delete n[u])}},shiftLineStyles:function(t,e){var i=_(this.styles);for(var n in this.styles){var r=parseInt(n,10);r>t&&(this.styles[r+e]=i[r],i[r-e]||delete this.styles[r])}},restartCursorIfNeeded:function(){this._currentTickState&&!this._currentTickState.isAborted&&this._currentTickCompleteState&&!this._currentTickCompleteState.isAborted||this.initDelayedCursor()},insertNewlineStyleObject:function(t,e,i,n){var r,s={},a=!1;for(var o in i||(i=1),this.shiftLineStyles(t,i),this.styles[t]&&(r=this.styles[t][0===e?e:e-1]),this.styles[t]){var h=parseInt(o,10);h>=e&&(a=!0,s[h-e]=this.styles[t][o],delete this.styles[t][o])}for(a?this.styles[t+i]=s:delete this.styles[t+i];i>1;)i--,n&&n[i]?this.styles[t+i]={0:_(n[i])}:r?this.styles[t+i]={0:_(r)}:delete this.styles[t+i];this._forceClearCache=!0},insertCharStyleObject:function(t,e,i,n){this.styles||(this.styles={});var r=this.styles[t],s=r?_(r):{};for(var a in i||(i=1),s){var o=parseInt(a,10);o>=e&&(r[o+i]=s[o],s[o-i]||delete r[o])}if(this._forceClearCache=!0,n)for(;i--;)Object.keys(n[i]).length&&(this.styles[t]||(this.styles[t]={}),this.styles[t][e+i]=_(n[i]));else if(r)for(var h=r[e?e-1:1];h&&i--;)this.styles[t][e+i]=_(h)},insertNewStyleBlock:function(t,e,i){for(var n=this.get2DCursorLocation(e,!0),r=[0],s=0,a=0;a<t.length;a++)"\n"===t[a]?r[++s]=0:r[s]++;for(r[0]>0&&(this.insertCharStyleObject(n.lineIndex,n.charIndex,r[0],i),i=i&&i.slice(r[0]+1)),s&&this.insertNewlineStyleObject(n.lineIndex,n.charIndex+r[0],s),a=1;a<s;a++)r[a]>0?this.insertCharStyleObject(n.lineIndex+a,0,r[a],i):i&&(this.styles[n.lineIndex+a][0]=i[0]),i=i&&i.slice(r[a]+1);r[a]>0&&this.insertCharStyleObject(n.lineIndex+a,0,r[a],i)},setSelectionStartEndWithShift:function(t,e,i){i<=t?(e===t?this._selectionDirection="left":"right"===this._selectionDirection&&(this._selectionDirection="left",this.selectionEnd=t),this.selectionStart=i):i>t&&i<e?"right"===this._selectionDirection?this.selectionEnd=i:this.selectionStart=i:(e===t?this._selectionDirection="right":"left"===this._selectionDirection&&(this._selectionDirection="right",this.selectionStart=e),this.selectionEnd=i)},setSelectionInBoundaries:function(){var t=this.text.length;this.selectionStart>t?this.selectionStart=t:this.selectionStart<0&&(this.selectionStart=0),this.selectionEnd>t?this.selectionEnd=t:this.selectionEnd<0&&(this.selectionEnd=0)}}),b.util.object.extend(b.IText.prototype,{initDoubleClickSimulation:function(){this.__lastClickTime=+new Date,this.__lastLastClickTime=+new Date,this.__lastPointer={},this.on("mousedown",this.onMouseDown)},onMouseDown:function(t){if(this.canvas){this.__newClickTime=+new Date;var e=t.pointer;this.isTripleClick(e)&&(this.fire("tripleclick",t),this._stopEvent(t.e)),this.__lastLastClickTime=this.__lastClickTime,this.__lastClickTime=this.__newClickTime,this.__lastPointer=e,this.__lastIsEditing=this.isEditing,this.__lastSelected=this.selected}},isTripleClick:function(t){return this.__newClickTime-this.__lastClickTime<500&&this.__lastClickTime-this.__lastLastClickTime<500&&this.__lastPointer.x===t.x&&this.__lastPointer.y===t.y},_stopEvent:function(t){t.preventDefault&&t.preventDefault(),t.stopPropagation&&t.stopPropagation()},initCursorSelectionHandlers:function(){this.initMousedownHandler(),this.initMouseupHandler(),this.initClicks()},initClicks:function(){this.on("mousedblclick",function(t){this.selectWord(this.getSelectionStartFromPointer(t.e))}),this.on("tripleclick",function(t){this.selectLine(this.getSelectionStartFromPointer(t.e))})},_mouseDownHandler:function(t){!this.canvas||!this.editable||t.e.button&&1!==t.e.button||(this.__isMousedown=!0,this.selected&&this.setCursorByClick(t.e),this.isEditing&&(this.__selectionStartOnMouseDown=this.selectionStart,this.selectionStart===this.selectionEnd&&this.abortCursorAnimation(),this.renderCursorOrSelection()))},_mouseDownHandlerBefore:function(t){!this.canvas||!this.editable||t.e.button&&1!==t.e.button||this===this.canvas._activeObject&&(this.selected=!0)},initMousedownHandler:function(){this.on("mousedown",this._mouseDownHandler),this.on("mousedown:before",this._mouseDownHandlerBefore)},initMouseupHandler:function(){this.on("mouseup",this.mouseUpHandler)},mouseUpHandler:function(t){if(this.__isMousedown=!1,!(!this.editable||this.group||t.transform&&t.transform.actionPerformed||t.e.button&&1!==t.e.button)){if(this.canvas){var e=this.canvas._activeObject;if(e&&e!==this)return}this.__lastSelected&&!this.__corner?(this.selected=!1,this.__lastSelected=!1,this.enterEditing(t.e),this.selectionStart===this.selectionEnd?this.initDelayedCursor(!0):this.renderCursorOrSelection()):this.selected=!0}},setCursorByClick:function(t){var e=this.getSelectionStartFromPointer(t),i=this.selectionStart,n=this.selectionEnd;t.shiftKey?this.setSelectionStartEndWithShift(i,n,e):(this.selectionStart=e,this.selectionEnd=e),this.isEditing&&(this._fireSelectionChanged(),this._updateTextarea())},getSelectionStartFromPointer:function(t){for(var e=this.getLocalPointer(t),i=0,n=0,r=0,s=0,a=0,o=0,h=this._textLines.length;o<h&&r<=e.y;o++)r+=this.getHeightOfLine(o)*this.scaleY,a=o,o>0&&(s+=this._textLines[o-1].length+1);n=this._getLineLeftOffset(a)*this.scaleX;for(var c=0,l=this._textLines[a].length;c<l&&(i=n,(n+=this.__charBounds[a][c].kernedWidth*this.scaleX)<=e.x);c++)s++;return this._getNewSelectionStartFromOffset(e,i,n,s,l)},_getNewSelectionStartFromOffset:function(t,e,i,n,r){var s=t.x-e,a=i-t.x,o=n+(a>s||a<0?0:1);return this.flipX&&(o=r-o),o>this._text.length&&(o=this._text.length),o}}),b.util.object.extend(b.IText.prototype,{initHiddenTextarea:function(){this.hiddenTextarea=b.document.createElement("textarea"),this.hiddenTextarea.setAttribute("autocapitalize","off"),this.hiddenTextarea.setAttribute("autocorrect","off"),this.hiddenTextarea.setAttribute("autocomplete","off"),this.hiddenTextarea.setAttribute("spellcheck","false"),this.hiddenTextarea.setAttribute("data-fabric-hiddentextarea",""),this.hiddenTextarea.setAttribute("wrap","off");var t=this._calcTextareaPosition();this.hiddenTextarea.style.cssText="position: absolute; top: "+t.top+"; left: "+t.left+"; z-index: -999; opacity: 0; width: 1px; height: 1px; font-size: 1px; paddingtop: "+t.fontSize+";",b.document.body.appendChild(this.hiddenTextarea),b.util.addListener(this.hiddenTextarea,"keydown",this.onKeyDown.bind(this)),b.util.addListener(this.hiddenTextarea,"keyup",this.onKeyUp.bind(this)),b.util.addListener(this.hiddenTextarea,"input",this.onInput.bind(this)),b.util.addListener(this.hiddenTextarea,"copy",this.copy.bind(this)),b.util.addListener(this.hiddenTextarea,"cut",this.copy.bind(this)),b.util.addListener(this.hiddenTextarea,"paste",this.paste.bind(this)),b.util.addListener(this.hiddenTextarea,"compositionstart",this.onCompositionStart.bind(this)),b.util.addListener(this.hiddenTextarea,"compositionupdate",this.onCompositionUpdate.bind(this)),b.util.addListener(this.hiddenTextarea,"compositionend",this.onCompositionEnd.bind(this)),!this._clickHandlerInitialized&&this.canvas&&(b.util.addListener(this.canvas.upperCanvasEl,"click",this.onClick.bind(this)),this._clickHandlerInitialized=!0)},keysMap:{9:"exitEditing",27:"exitEditing",33:"moveCursorUp",34:"moveCursorDown",35:"moveCursorRight",36:"moveCursorLeft",37:"moveCursorLeft",38:"moveCursorUp",39:"moveCursorRight",40:"moveCursorDown"},ctrlKeysMapUp:{67:"copy",88:"cut"},ctrlKeysMapDown:{65:"selectAll"},onClick:function(){this.hiddenTextarea&&this.hiddenTextarea.focus()},onKeyDown:function(t){if(this.isEditing&&!this.inCompositionMode){if(t.keyCode in this.keysMap)this[this.keysMap[t.keyCode]](t);else{if(!(t.keyCode in this.ctrlKeysMapDown&&(t.ctrlKey||t.metaKey)))return;this[this.ctrlKeysMapDown[t.keyCode]](t)}t.stopImmediatePropagation(),t.preventDefault(),t.keyCode>=33&&t.keyCode<=40?(this.clearContextTop(),this.renderCursorOrSelection()):this.canvas&&this.canvas.requestRenderAll()}},onKeyUp:function(t){!this.isEditing||this._copyDone||this.inCompositionMode?this._copyDone=!1:t.keyCode in this.ctrlKeysMapUp&&(t.ctrlKey||t.metaKey)&&(this[this.ctrlKeysMapUp[t.keyCode]](t),t.stopImmediatePropagation(),t.preventDefault(),this.canvas&&this.canvas.requestRenderAll())},onInput:function(t){var e=this.fromPaste;if(this.fromPaste=!1,t&&t.stopPropagation(),this.isEditing){var i,n,r=this._splitTextIntoLines(this.hiddenTextarea.value).graphemeText,s=this._text.length,a=r.length,o=a-s;if(""===this.hiddenTextarea.value)return this.styles={},this.updateFromTextArea(),this.fire("changed"),void(this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll()));var h=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value),c=this.selectionStart>h.selectionStart;this.selectionStart!==this.selectionEnd?(i=this._text.slice(this.selectionStart,this.selectionEnd),o+=this.selectionEnd-this.selectionStart):a<s&&(i=c?this._text.slice(this.selectionEnd+o,this.selectionEnd):this._text.slice(this.selectionStart,this.selectionStart-o)),n=r.slice(h.selectionEnd-o,h.selectionEnd),i&&i.length&&(this.selectionStart!==this.selectionEnd?this.removeStyleFromTo(this.selectionStart,this.selectionEnd):c?this.removeStyleFromTo(this.selectionEnd-i.length,this.selectionEnd):this.removeStyleFromTo(this.selectionEnd,this.selectionEnd+i.length)),n.length&&(e&&n.join("")===b.copiedText?this.insertNewStyleBlock(n,this.selectionStart,b.copiedTextStyle):this.insertNewStyleBlock(n,this.selectionStart)),this.updateFromTextArea(),this.fire("changed"),this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll())}},onCompositionStart:function(){this.inCompositionMode=!0},onCompositionEnd:function(){this.inCompositionMode=!1},onCompositionUpdate:function(t){this.compositionStart=t.target.selectionStart,this.compositionEnd=t.target.selectionEnd,this.updateTextareaPosition()},copy:function(){this.selectionStart!==this.selectionEnd&&(b.copiedText=this.getSelectedText(),b.copiedTextStyle=this.getSelectionStyles(this.selectionStart,this.selectionEnd,!0),this._copyDone=!0)},paste:function(){this.fromPaste=!0},_getClipboardData:function(t){return t&&t.clipboardData||b.window.clipboardData},_getWidthBeforeCursor:function(t,e){var i,n=this._getLineLeftOffset(t);return e>0&&(n+=(i=this.__charBounds[t][e-1]).left+i.width),n},getDownCursorOffset:function(t,e){var i=this._getSelectionForOffset(t,e),n=this.get2DCursorLocation(i),r=n.lineIndex;if(r===this._textLines.length-1||t.metaKey||34===t.keyCode)return this._text.length-i;var s=n.charIndex,a=this._getWidthBeforeCursor(r,s),o=this._getIndexOnLine(r+1,a);return this._textLines[r].slice(s).length+o+2},_getSelectionForOffset:function(t,e){return t.shiftKey&&this.selectionStart!==this.selectionEnd&&e?this.selectionEnd:this.selectionStart},getUpCursorOffset:function(t,e){var i=this._getSelectionForOffset(t,e),n=this.get2DCursorLocation(i),r=n.lineIndex;if(0===r||t.metaKey||33===t.keyCode)return-i;var s=n.charIndex,a=this._getWidthBeforeCursor(r,s),o=this._getIndexOnLine(r-1,a),h=this._textLines[r].slice(0,s);return-this._textLines[r-1].length+o-h.length},_getIndexOnLine:function(t,e){for(var i,n,r=this._textLines[t],s=this._getLineLeftOffset(t),a=0,o=0,h=r.length;o<h;o++)if((s+=i=this.__charBounds[t][o].width)>e){n=!0;var c=s-i,l=s,u=Math.abs(c-e);a=Math.abs(l-e)<u?o:o-1;break}return n||(a=r.length-1),a},moveCursorDown:function(t){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorUpOrDown("Down",t)},moveCursorUp:function(t){0===this.selectionStart&&0===this.selectionEnd||this._moveCursorUpOrDown("Up",t)},_moveCursorUpOrDown:function(t,e){var i=this["get"+t+"CursorOffset"](e,"right"===this._selectionDirection);e.shiftKey?this.moveCursorWithShift(i):this.moveCursorWithoutShift(i),0!==i&&(this.setSelectionInBoundaries(),this.abortCursorAnimation(),this._currentCursorOpacity=1,this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())},moveCursorWithShift:function(t){var e="left"===this._selectionDirection?this.selectionStart+t:this.selectionEnd+t;return this.setSelectionStartEndWithShift(this.selectionStart,this.selectionEnd,e),0!==t},moveCursorWithoutShift:function(t){return t<0?(this.selectionStart+=t,this.selectionEnd=this.selectionStart):(this.selectionEnd+=t,this.selectionStart=this.selectionEnd),0!==t},moveCursorLeft:function(t){0===this.selectionStart&&0===this.selectionEnd||this._moveCursorLeftOrRight("Left",t)},_move:function(t,e,i){var n;if(t.altKey)n=this["findWordBoundary"+i](this[e]);else{if(!t.metaKey&&35!==t.keyCode&&36!==t.keyCode)return this[e]+="Left"===i?-1:1,!0;n=this["findLineBoundary"+i](this[e])}if(void 0!==typeof n&&this[e]!==n)return this[e]=n,!0},_moveLeft:function(t,e){return this._move(t,e,"Left")},_moveRight:function(t,e){return this._move(t,e,"Right")},moveCursorLeftWithoutShift:function(t){var e=!0;return this._selectionDirection="left",this.selectionEnd===this.selectionStart&&0!==this.selectionStart&&(e=this._moveLeft(t,"selectionStart")),this.selectionEnd=this.selectionStart,e},moveCursorLeftWithShift:function(t){return"right"===this._selectionDirection&&this.selectionStart!==this.selectionEnd?this._moveLeft(t,"selectionEnd"):0!==this.selectionStart?(this._selectionDirection="left",this._moveLeft(t,"selectionStart")):void 0},moveCursorRight:function(t){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorLeftOrRight("Right",t)},_moveCursorLeftOrRight:function(t,e){var i="moveCursor"+t+"With";this._currentCursorOpacity=1,e.shiftKey?i+="Shift":i+="outShift",this[i](e)&&(this.abortCursorAnimation(),this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())},moveCursorRightWithShift:function(t){return"left"===this._selectionDirection&&this.selectionStart!==this.selectionEnd?this._moveRight(t,"selectionStart"):this.selectionEnd!==this._text.length?(this._selectionDirection="right",this._moveRight(t,"selectionEnd")):void 0},moveCursorRightWithoutShift:function(t){var e=!0;return this._selectionDirection="right",this.selectionStart===this.selectionEnd?(e=this._moveRight(t,"selectionStart"),this.selectionEnd=this.selectionStart):this.selectionStart=this.selectionEnd,e},removeChars:function(t,e){void 0===e&&(e=t+1),this.removeStyleFromTo(t,e),this._text.splice(t,e-t),this.text=this._text.join(""),this.set("dirty",!0),this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this._removeExtraneousStyles()},insertChars:function(t,e,i,n){void 0===n&&(n=i),n>i&&this.removeStyleFromTo(i,n);var r=b.util.string.graphemeSplit(t);this.insertNewStyleBlock(r,i,e),this._text=[].concat(this._text.slice(0,i),r,this._text.slice(n)),this.text=this._text.join(""),this.set("dirty",!0),this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this._removeExtraneousStyles()}}),m=b.util.toFixed,y=/  +/g,b.util.object.extend(b.Text.prototype,{toSVG:function(t){var e=this._getSVGLeftTopOffsets(),i=this._getSVGTextAndBg(e.textTop,e.textLeft),n=this._wrapSVGTextAndBg(i);return this._createBaseSVGMarkup(n,{reviver:t,noStyle:!0,withShadow:!0})},_getSVGLeftTopOffsets:function(){return{textLeft:-this.width/2,textTop:-this.height/2,lineTop:this.getHeightOfLine(0)}},_wrapSVGTextAndBg:function(t){var e=this.getSvgTextDecoration(this);return[t.textBgRects.join(""),'\t\t<text xml:space="preserve" ',this.fontFamily?'font-family="'+this.fontFamily.replace(/"/g,"'")+'" ':"",this.fontSize?'font-size="'+this.fontSize+'" ':"",this.fontStyle?'font-style="'+this.fontStyle+'" ':"",this.fontWeight?'font-weight="'+this.fontWeight+'" ':"",e?'text-decoration="'+e+'" ':"",'style="',this.getSvgStyles(!0),'"',this.addPaintOrder()," >",t.textSpans.join(""),"</text>\n"]},_getSVGTextAndBg:function(t,e){var i,n=[],r=[],s=t;this._setSVGBg(r);for(var a=0,o=this._textLines.length;a<o;a++)i=this._getLineLeftOffset(a),(this.textBackgroundColor||this.styleHas("textBackgroundColor",a))&&this._setSVGTextLineBg(r,a,e+i,s),this._setSVGTextLineText(n,a,e+i,s),s+=this.getHeightOfLine(a);return{textSpans:n,textBgRects:r}},_createTextCharSpan:function(t,e,i,n){var r=t!==t.trim()||t.match(y),s=this.getSvgSpanStyles(e,r),a=s?'style="'+s+'"':"",o=e.deltaY,h="",c=b.Object.NUM_FRACTION_DIGITS;return o&&(h=' dy="'+m(o,c)+'" '),['<tspan x="',m(i,c),'" y="',m(n,c),'" ',h,a,">",b.util.string.escapeXml(t),"</tspan>"].join("")},_setSVGTextLineText:function(t,e,i,n){var r,s,a,o,h,c=this.getHeightOfLine(e),l=-1!==this.textAlign.indexOf("justify"),u="",f=0,d=this._textLines[e];n+=c*(1-this._fontSizeFraction)/this.lineHeight;for(var p=0,g=d.length-1;p<=g;p++)h=p===g||this.charSpacing,u+=d[p],a=this.__charBounds[e][p],0===f?(i+=a.kernedWidth-a.width,f+=a.width):f+=a.kernedWidth,l&&!h&&this._reSpaceAndTab.test(d[p])&&(h=!0),h||(r=r||this.getCompleteStyleDeclaration(e,p),s=this.getCompleteStyleDeclaration(e,p+1),h=this._hasStyleChangedForSvg(r,s)),h&&(o=this._getStyleDeclaration(e,p)||{},t.push(this._createTextCharSpan(u,o,i,n)),u="",r=s,i+=f,f=0)},_pushTextBgRect:function(t,e,i,n,r,s){var a=b.Object.NUM_FRACTION_DIGITS;t.push("\t\t<rect ",this._getFillAttributes(e),' x="',m(i,a),'" y="',m(n,a),'" width="',m(r,a),'" height="',m(s,a),'"></rect>\n')},_setSVGTextLineBg:function(t,e,i,n){for(var r,s,a=this._textLines[e],o=this.getHeightOfLine(e)/this.lineHeight,h=0,c=0,l=this.getValueOfPropertyAt(e,0,"textBackgroundColor"),u=0,f=a.length;u<f;u++)r=this.__charBounds[e][u],(s=this.getValueOfPropertyAt(e,u,"textBackgroundColor"))!==l?(l&&this._pushTextBgRect(t,l,i+c,n,h,o),c=r.left,h=r.width,l=s):h+=r.kernedWidth;s&&this._pushTextBgRect(t,s,i+c,n,h,o)},_getFillAttributes:function(t){var e=t&&"string"==typeof t?new b.Color(t):"";return e&&e.getSource()&&1!==e.getAlpha()?'opacity="'+e.getAlpha()+'" fill="'+e.setAlpha(1).toRgb()+'"':'fill="'+t+'"'},_getSVGLineTopOffset:function(t){for(var e,i=0,n=0;n<t;n++)i+=this.getHeightOfLine(n);return e=this.getHeightOfLine(n),{lineTop:i,offset:(this._fontSizeMult-this._fontSizeFraction)*e/(this.lineHeight*this._fontSizeMult)}},getSvgStyles:function(t){return b.Object.prototype.getSvgStyles.call(this,t)+" white-space: pre;"}}),function(t){"use strict";var e=t.fabric||(t.fabric={});e.Textbox=e.util.createClass(e.IText,e.Observable,{type:"textbox",minWidth:20,dynamicMinWidth:2,__cachedLines:null,lockScalingFlip:!0,noScaleCache:!1,_dimensionAffectingProps:e.Text.prototype._dimensionAffectingProps.concat("width"),initDimensions:function(){this.__skipDimension||(this.isEditing&&this.initDelayedCursor(),this.clearContextTop(),this._clearCache(),this.dynamicMinWidth=0,this._styleMap=this._generateStyleMap(this._splitText()),this.dynamicMinWidth>this.width&&this._set("width",this.dynamicMinWidth),-1!==this.textAlign.indexOf("justify")&&this.enlargeSpaces(),this.height=this.calcTextHeight(),this.saveState({propertySet:"_dimensionAffectingProps"}))},_generateStyleMap:function(t){for(var e=0,i=0,n=0,r={},s=0;s<t.graphemeLines.length;s++)"\n"===t.graphemeText[n]&&s>0?(i=0,n++,e++):this._reSpaceAndTab.test(t.graphemeText[n])&&s>0&&(i++,n++),r[s]={line:e,offset:i},n+=t.graphemeLines[s].length,i+=t.graphemeLines[s].length;return r},styleHas:function(t,i){if(this._styleMap&&!this.isWrapping){var n=this._styleMap[i];n&&(i=n.line)}return e.Text.prototype.styleHas.call(this,t,i)},isEmptyStyles:function(t){var e,i,n=0,r=!1,s=this._styleMap[t],a=this._styleMap[t+1];for(var o in s&&(t=s.line,n=s.offset),a&&(r=a.line===t,e=a.offset),i=void 0===t?this.styles:{line:this.styles[t]})for(var h in i[o])if(h>=n&&(!r||h<e))for(var c in i[o][h])return!1;return!0},_getStyleDeclaration:function(t,e){if(this._styleMap&&!this.isWrapping){var i=this._styleMap[t];if(!i)return null;t=i.line,e=i.offset+e}return this.callSuper("_getStyleDeclaration",t,e)},_setStyleDeclaration:function(t,e,i){var n=this._styleMap[t];t=n.line,e=n.offset+e,this.styles[t][e]=i},_deleteStyleDeclaration:function(t,e){var i=this._styleMap[t];t=i.line,e=i.offset+e,delete this.styles[t][e]},_getLineStyle:function(t){var e=this._styleMap[t];return this.styles[e.line]},_setLineStyle:function(t,e){var i=this._styleMap[t];this.styles[i.line]=e},_deleteLineStyle:function(t){var e=this._styleMap[t];delete this.styles[e.line]},_wrapText:function(t,e){var i,n=[];for(this.isWrapping=!0,i=0;i<t.length;i++)n=n.concat(this._wrapLine(t[i],i,e));return this.isWrapping=!1,n},_measureWord:function(t,e,i){var n,r=0;i=i||0;for(var s=0,a=t.length;s<a;s++){r+=this._getGraphemeBox(t[s],e,s+i,n,!0).kernedWidth,n=t[s]}return r},_wrapLine:function(t,i,n,r){var s=0,a=[],o=[],h=t.split(this._reSpaceAndTab),c="",l=0,u=0,f=0,d=0,p=!0,g=this._getWidthOfCharSpacing();n-=r=r||0;for(var v=0;v<h.length;v++)c=e.util.string.graphemeSplit(h[v]),u=this._measureWord(c,i,l),l+=c.length,(s+=f+u-g)>=n&&!p?(a.push(o),o=[],s=u,p=!0):s+=g,p||o.push(" "),o=o.concat(c),f=this._measureWord([" "],i,l),l++,p=!1,u>d&&(d=u);return v&&a.push(o),d+r>this.dynamicMinWidth&&(this.dynamicMinWidth=d-g+r),a},isEndOfWrapping:function(t){return!this._styleMap[t+1]||this._styleMap[t+1].line!==this._styleMap[t].line},_splitTextIntoLines:function(t){for(var i=e.Text.prototype._splitTextIntoLines.call(this,t),n=this._wrapText(i.lines,this.width),r=new Array(n.length),s=0;s<n.length;s++)r[s]=n[s].join("");return i.lines=r,i.graphemeLines=n,i},getMinWidth:function(){return Math.max(this.minWidth,this.dynamicMinWidth)},toObject:function(t){return this.callSuper("toObject",["minWidth"].concat(t))}}),e.Textbox.fromObject=function(t,i){return e.Object._fromObject("Textbox",t,i,"text")}}(e),x=b.Canvas.prototype._setObjectScale,b.Canvas.prototype._setObjectScale=function(t,e,i,n,r,s,a){var o=e.target;if(!("x"===r&&o instanceof b.Textbox))return x.call(b.Canvas.prototype,t,e,i,n,r,s,a);var h=o._getTransformedDimensions().x,c=o.width*(t.x/h);return c>=o.getMinWidth()?(o.set("width",c),!0):void 0},b.util.object.extend(b.Textbox.prototype,{_removeExtraneousStyles:function(){for(var t in this._styleMap)this._textLines[t]||delete this.styles[this._styleMap[t].line]}})}).call(this,i(6).Buffer)}}]);